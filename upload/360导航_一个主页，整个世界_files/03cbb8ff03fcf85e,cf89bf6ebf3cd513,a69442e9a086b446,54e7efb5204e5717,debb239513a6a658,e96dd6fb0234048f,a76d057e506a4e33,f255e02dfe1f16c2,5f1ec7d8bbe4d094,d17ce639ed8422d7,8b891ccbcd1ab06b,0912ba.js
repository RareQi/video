(function(){function r(t){this.conf=e({wrapEl:"#search",tabsEl:".tab>li",engsElWap:".eng-list",defaultCate:"webpage",defaultEng:"somulti",cateChangeEvent:"click",engChangeEvent:"click",tabsOnClass:"on"},t,!0),e(this,this.conf),this._init()}var e=QW.ObjectH.mix,t=QW.CustEvent.createEvents,n=ObjectH.isArray;r.UI=function(t){e(this,e(t,{kwEl:"#search-kw",sbtnEl:"#search-btn",logoShowEl:"#eng-logo",formEl:"#search-form"}),!0),this._init()},r.UI.prototype={_init:function(){},selectTab:function(e){W(this.tabsEl+"[data-cate]",W(this.wrapEl)).removeClass(this.tabsOnClass),W(this.tabsEl+"[data-cate="+e+"]",W(this.wrapEl)).addClass(this.tabsOnClass)},updateForms:function(e,t,n){var r=n[0],i=n[1],s=n[5]||n[2]+"\u641c\u7d22",o=n[3],u=n[4],a=u.split(";"),f=W(this.formEl);if(!f&&W(this.kwEl,f))return;var l='<input type="hidden" name="$1" value="$2" />',c=e+"-"+t;W(".others-params input",f).forEach(function(e){e.disabled=!0});if(W("."+c,f).length)W("."+c+" input",f).forEach(function(e){e.disabled=!1});else{var h=W('<div class="others-params" style="display:none"></div>'),p="";h.addClass(c),h.addClass("cates-"+e),a.forEach(function(e){var t=e.split(":");p+=l.replace("$1",t[0].encode4HtmlValue()).replace("$2",(t[1]||"").encode4HtmlValue())}),h.html(p),f.insert("afterbegin",h)}W(this.kwEl,f).attr("name",i).val(W(this.kwEl,f).val()).focus();var d=W(this.sbtnEl,f);d[0]&&d[0].nodeName.toLowerCase()=="button"?d[0].innerHTML=s:d.val(s),f.attr("action",r),W(this.logoShowEl,W(this.wrapEl)).length&&W(this.logoShowEl,W(this.wrapEl)).attr("className",t).attr("href",o).attr("title",n[2])},rmHiddenInputs:function(e,t){if(!W(this.formEl))return;var n=this;e.forEach(function(e){var r=W("."+t+"-"+e);r.length&&W(n.formEl).removeChild(r)})},rmTabs:function(e){n(e)||(e=[e]);var t=this;e.forEach(function(e){W(W(".cates-"+e),t.formEl).length&&W(t.formEl).removeChild(W(".cates-"+e))})},updateTabs:function(e,t){if(!e)return;var n=W(this.formEl);if(!n)return;var r=this;e.forEach(function(e,i){W(r.tabsEl+"[data-cate="+e+"]",W(r.wrapEl)).attr("data-cate",t[i]),W(".cates-"+e,n).toggleClass("cates-"+e,"cates-"+t[i])})}};var i=["change","catechange","error","update"];e(r.prototype,{_init:function(){this.cate=this.defaultCate,this.eng=this.defaultByCate[this.cate],this.engid=[this.cate,this.eng].join("-"),this.lastEngOfCate=e(this.defaultByCate,{}),this.lastEngOfCate[this.cate]=this.eng,t(this,i),this.ui=new r.UI(this.conf)},_onUpdate:function(e,t,n){e=="update"&&t&&this.ui.rmHiddenInputs(t,n)},_onUpdateCate:function(e,t,n){switch(e){case"removecate":this.ui.rmTabs(t);break;case"updatecate":this.ui.updateTabs(t,n)}},_onChangeCate:function(){this.ui.selectTab(this.cate)},_onChangeEng:function(){var e=this.engData[this.cate][this.eng];this.ui.updateForms(this.cate,this.eng,e)},getCate:function(){return this.cate},getEng:function(){return[this.cate,this.eng]},setCate:function(e,t,n){return e==this.cate&&!n||!this.engData[e]?(this.fire("error",{code:"301",data:{funcName:"setCate",cate:this.cate,eng:this.eng},msg:"\u9519\u8bef\u7684cate\u540d\u6216cate\u540d\u65e0\u53d8\u5316"}),this):(this.cate=e,this.setEng(t||this.lastEngOfCate[e],e),this.fire("catechange",{cate:this.cate,eng:this.lastEngOfCate[this.cate],data:this.engData[this.cate]})&&this._onChangeCate(),this)},setEng:function(e,t,n){var t=t||this.cate;return!e||this.engid==[t,e].join("-")&&!n?(this.fire("error",{code:"302",data:{funcName:"setEng",cate:this.cate,eng:this.eng},msg:"\u672a\u6307\u5b9a\u641c\u7d22\u5f15\u64ce\u540d\u6216\u6307\u5b9a\u7684\u641c\u7d22\u5f15\u64ce\u4e0e\u5f53\u524d\u6ca1\u53d8\u5316"}),this):!this.engData[t]||!this.engData[t][e]?(this.fire("error",{code:"404",data:{funcName:"setEng",cate:this.cate,eng:this.eng},msg:"\u6ca1\u6709\u8be5\u641c\u7d22\u5f15\u64ce"}),this):t!=this.cate?(this.setCate(t,e),this):(this.eng=e,this.engid=[t,e].join("-"),this.lastEngOfCate[t]=this.eng,this.fire("change",{cate:this.cate,eng:this.eng,data:this.engData[this.cate][this.eng]})&&this._onChangeEng(),this)},forceChange:function(e,t){this.cate=e,this.eng=t||this.lastEngOfCate[e],this.engid=[e,this.eng].join("-"),this.lastEngOfCate[this.cate]=this.eng,this.fire("catechange",{cate:this.cate,eng:this.lastEngOfCate[this.cate],data:this.engData[this.cate],isForce:!0})&&this._onChangeCate(),this.fire("change",{cate:this.cate,eng:this.eng,data:this.engData[this.cate][this.eng],isForce:!0})&&this._onChangeEng()},set:function(e,t){return this.setEng(e,t)},get:function(){return this.getEng()},setDefaults:function(t,n){var r={};if(cateof(t)=="string"&&n)r[t]=n;else{if(cateof(t)!="object")return this.fire("error",{code:"400",data:{funcName:"setDefaults",cate:this.cate,eng:this.eng},msg:"\u53c2\u6570\u9519\u8bef"}),this;r=e(r,t,!0)}for(var i in r)this.defaultByCate[i]&&this.engData[i][r[i]]?this.defaultByCate[i]=r[i]:this.fire("error",{code:"404",data:{funcName:"setDefaults",cate:this.cate,eng:this.eng},msg:"\u6ca1\u6709\u5982\u4e0bcate\u6216\u641c\u7d22\u5f15\u64ce\uff1a"+[i,r[i]]});return this},update:function(e,t,n){t=t||this.cate;var r=this,i=[];for(var s in e){var o=s;if(!r.engData[t][s]||!n)r.engData[t][s]=e[s],i.push(o)}var u=n?"add":"update";return this.fire("update",{action:u,keys:i})&&this._onUpdate(u,i,t),t==this.cate&&i.indexOf(this.eng)!=-1&&this.setEng(this.eng,this.cate,!0),this},updateParams:function(t,r,i){var s=this;return i=n(i)?i:[i],i.forEach(function(n){var i=s.engData[n],o=i[r];if(o){var u={},a=[],f={},l=o[4].split(";");l.forEach(function(e){var t=e.split(":");u[t[0]]=t[1]}),e(u,t,!0);for(var c in u)a.push(c+":"+u[c]);o[4]=a.join(";"),f[r]=o,s.update(f,n)}}),this},add:function(e,t){this.update(e,t,!0)},remove:function(e,t){t=t||this.cate;var r=this;if(!this.engData[t])return this.fire("error",{code:"404",data:{funcName:"remove",cate:this.cate,eng:this.eng},msg:"\u6ca1\u6709\u8be5\u5206\u7c7b\u7684\u641c\u7d22\u5f15\u64ce\u6570\u636e"}),this;n(e)||(e=[e]);var i=!0,s=[];return e.forEach(function(e){r.eng==e&&(r.fire("error",{code:"405",data:{funcName:"remove",cate:this.cate,eng:this.eng},msg:"\u4e0d\u80fd\u5220\u9664\u5f53\u524d\u6b63\u5728\u4f7f\u7528\u7684\u641c\u7d22\u5f15\u64ce:"+e}),i=!1),r.engData[t][e]||(r.fire("error",{code:"404",data:{funcName:"remove",cate:this.cate,eng:this.eng},msg:"\u6ca1\u6709\u8be5\u641c\u7d22\u5f15\u64ce:"+e}),i=!1),i&&(delete r.engData[t][e],s.push(e)),i=!0}),this.fire("update",{action:"remove",keys:s})&&this._onUpdate("remove",s,t),this},addCate:function(e,t,n){if(this.engData[e]){this.fire("error",{code:"409",data:{funcName:"addCate",cate:this.cate,eng:this.eng},msg:"\u5df2\u6709\u8be5\u5206\u7c7b\uff1a"+e});return}return this.defaultByCate[e]=t||"",this.engData[e]={},n&&this.add(n,e),this.fire("update",{action:"addcate",cates:e})&&this._onUpdateCate("addcate",e),this},removeCate:function(e){arguments.length>1&&(e=Array.prototype.slice.call(arguments)),n(e)||(e=[e]);var t=this,r=[];return e.forEach(function(e){if(!t.engData[e]){t.fire("error",{code:"404",data:{funcName:"removeCate",cate:this.cate,eng:this.eng},msg:"\u6ca1\u6709\u8be5\u5206\u7c7b\uff1a"+e});return}if(e==t.cate){t.fire("error",{code:"405",data:{funcName:"removeCate",cate:this.cate,eng:this.eng},msg:"\u4e0d\u80fd\u5220\u9664\u5f53\u524d\u6b63\u5728\u4f7f\u7528\u7684\u5206\u7c7b"+e});return}delete t.defaultByCate[e],delete t.engData[e],r.push(e)}),this.fire("update",{action:"removecate",cates:r})&&this._onUpdateCate("removecate",r),this},updateCate:function(e,t){var r=Array.prototype.slice.call(arguments);n(r[0])||(r=[[r[0],r[1]]]);var i=this,s=[],o=[];return r.forEach(function(e){var t=e[0],n=e[1];!t||!newcate?i.fire("error",{code:"400",data:{funcName:"updateCate",cate:this.cate,eng:this.eng},msg:"\u53c2\u6570\u9519\u8bef"}):i.engData[t]?i.engData[newcate]?i.fire("error",{code:"501",data:{funcName:"updateCate",cate:this.cate,eng:this.eng},msg:"\u4e0d\u80fd\u547d\u540d\u6210\u4ee5\u4e0b\u5206\u7c7b\uff0c\u56e0\u4e3a\u5206\u7c7b\u5df2\u5b58\u5728\uff1a"+n}):t==i.cate?i.fire("error",{code:"405",data:{funcName:"updateCate",cate:this.cate,eng:this.eng},msg:"\u4e0d\u80fd\u66f4\u65b0\u6b63\u5728\u4f7f\u7528\u7684\u5206\u7c7b\uff1a"+t}):(i.defaultByCate[newcate]=i.defaultByCate[t],i.engData[newcate]=i.engData[t],delete i.defaultByCate[t],delete i.engData[t],s.push(t),o.push(newcate)):i.fire("error",{code:"404",data:{funcName:"updateCate",cate:this.cate,eng:this.eng},msg:"\u6ca1\u6709\u8be5\u5206\u7c7b\uff1a"+t})}),this.fire("update",{action:"updatecate",cates:s})&&this._onUpdateCate("updatecate",s,o),this},_cateChangeListener:function(){if(!this.tabsEl)return;var e=this,t=this.wrapEl+" "+this.tabsEl+"[data-cate]";W(document).delegate(t,this.cateChangeEvent,function(t){W(this).hasClass(e.tabsOnClass)||t.preventDefault(),e.setCate(W(this).attr("data-cate"))}).delegate(t,"mouseover",function(e){W(this).addClass("hover")}).delegate(t,"mouseout",function(e){W(this).removeClass("hover")})},_engChangeListener:function(){if(!this.engsElWap)return;var e=this,t=this.wrapEl+" "+this.engsElWap+" *[data-site]";W(document).delegate(t,this.engChangeEvent,function(t){t.preventDefault(),e.setEng(W(this).attr("data-site"),W(this).attr("data-cate"))})},render:function(e,t,n){var t=t||W(this.tabsEl+"."+this.tabsOnClass,W(this.wrapEl)).attr("data-cate")||this.cate,e=e||this.defaultByCate[t]||this.eng;return n!==!1&&this.wrapEl&&(this._cateChangeListener(),this._engChangeListener()),this.setCate(t,e,!0).setEng(e,t,!0),this}}),QW.provide("SearchTab",r)})();M({container:"#search"},function(e,t){function g(t){if(e("#widget-"+t).html()||m[t])return;m[t]=!0,qboot.jsonp(v.host,{widget:t,v2:v.v},function(){},{threshold:v.threshold,jsonp:"r"})}var n=qboot.cookie,r=HAO_CONFIG.search,i=HAO_DATA.searchTabData,s=new AppData("api.hao.360.cn",r.r),o=VersionHub.is("so","search-hotrealtime"),u=s.get("defaultEng")||"somulti",a="webpage";if(/^\?1009(\W|$)/.test(location.search)){var f=ObjectH.mix(i.defaultByCate,{image:"so360",webpage:"so360"},!0),l=i.searchEngConf;for(var c in f){if(c=="shopping")continue;var h=f[c],p=l[c][h];l[c]={},l[c][h]=p}i.searchEngConf=l,u="so360"}var d=new SearchTab({engData:i.searchEngConf,defaultByCate:i.defaultByCate});window.search=d,d.on("catechange",function(n){var r=n.cate,i=n.eng,s=this.engData[r],o="html-"+r,u='<a class="$1" title="$2" data-site="$1" data-cate="$3">$1</a>',a='<a class="jump" title="$1" href="$2">$1\u641c\u7d22</a>',f="";for(var l in s)if(l!="jump")f+=u.replace(/\$1/g,l).replace(/\$2/g,s[l][2]).replace(/\$3/g,r);else{f+='<span class="divide">\u4ee5\u4e0b\u5f39\u51fa\u641c\u7d22</span><div class="jump-rect">';for(var c in s.jump)f+=a.replace(/\$1/g,s.jump[c][2]).replace(/\$2/g,s.jump[c][0]);f+="</div>"}e(".eng-list").html(f),e("#search-engine")[ObjectH.keys(n.data).length===1?"addClass":"removeClass"]("single"),t.tweet("search-cate-change",{cate:r,eng:i,data:n.data})}),d.on("change",function(e){t.tweet("search-eng-change",{cate:e.cate,eng:e.eng,data:e.data,isForce:!!e.isForce})}),d.render(u,a),t.receive("search-cate-change",function(t){e(".hotwords-cate").removeClass("hotwords-cate-show"),e(".hotwords-cate-"+t.data.cate).addClass("hotwords-cate-show")}),t.delegate(".eng-list>a","click",function(t){var n=e(this).attr("data-cate");if(n=="webpage"){t.preventDefault();var r=e(this).attr("data-site"),i;r!="so360"&&(expiresDays=(1+Math.floor(Math.random()*1))*864e5,i=(new Date).getTime()+expiresDays),s.set("defaultEng",r,i)}e("#search-engine").toggleClass("open")}),t.delegate(".divide","click",function(n){$this=e(this),$this.hasClass("expend")?t.query(".jump-rect").hide():t.query(".jump-rect").show(),$this.toggleClass("expend")});var v=HAO_CONFIG.widget,m={};t.receive("widget-change",function(t){var n=t.data.widget;e(".form-group").hide(),e(".widget-group").hide(),e("#widget-"+n).show(),g(n)}),e("[data-widget]").click(function(n){t.tweet("widget-change",{widget:e(this).attr("data-widget")})}),e("#search-engine .g-toggle").click(function(t){t.preventDefault(),e("#search-engine").toggleClass("open")}),e("#eng-logo").click(function(t){e("#search-engine").removeClass("open").removeClass("hover")});var y={};e("[data-link]").forEach(function(t){e(t).attr("data-href",e(t).query("a").attr("href"))}),e(".search-hd>ul>li").hover(function(t){e(this).toggleClass("hover")}).click(function(t){(!e(t.target).hasClass("link")||!e(t.target).parentNode(".on").length)&&t.preventDefault();if(e(this).attr("data-link")){window.open(e(this).query("a").attr("href"));return}e(this).attr("data-cate")&&!e(".form-group").isVisible()&&(e(".widget-group").hide(),e(".form-group").show()),e(this).hasClass("on")&&e(this).query(".link").attr("href")&&LogHub.search("jump",{cate:e(this).attr("data-cate")}),e(".search-hd>ul>li").removeClass("on"),e(this).addClass("on"),t.target.tagName=="A"&&t.target.blur();if(o){var n={webpage:"\u7f51\u9875",news:"\u8d44\u8baf",video:"\u89c6\u9891",image:"\u56fe\u7247",liangyi:"\u826f\u533b",weibo:"\u5fae\u535a",map:"\u5730\u56fe",wenda:"\u95ee\u7b54"};e(".search-switchtab .oncate").html(n[e(this).attr("data-cate")])}}).on("mouseover",function(){e(this).attr("data-widget")&&g(e(this).attr("data-widget"))}).on("mousedown",function(t){if(e(this).attr("data-link")){var n=e("#search-kw").val(),r=e(this).attr("data-link");if(!n){e(this).query(">a").attr("href",e(this).attr("data-href"));return}if(!y[r]){var s=i.searchEngConf[r]&&i.defaultByCate[r]&&i.searchEngConf[r][i.defaultByCate[r]];if(!s)return;var o=s[4].split(";"),u={};o.forEach(function(e){var t=e.split(":");u[t[0]]=t[1]}),y[r]={k:s[1],url:s[0],querys:u}}var a=y[r];a.querys[a.k]=n;var f=a.url+"?"+ObjectH.encodeURIJson(a.querys);e(this).query("a").attr("href",f)}}),e("#search-btn").hover(function(t){e(this).toggleClass("hover")}).on("mousedown",function(t){e(this).addClass("mousedown")}).on("mouseup",function(t){e(this).removeClass("mousedown")}).on("mouseout",function(t){e(this).removeClass("mousedown")}),QW.W(document).click(function(t){var n=t.target,r=e(n);r.attr("id")=="search-engine"||r.parentNode("#search-engine").length||r.hasClass("eng-list")||r.parentNode(".eng-list").length||e("#search-engine").removeClass("open")});var b=d.lastEngOfCate.webpage;setTimeout(function(){var e=n.get("customEng"),t=(new Date).getMonth()+1+"-"+(new Date).getDate();e!==t&&(LogHub.search("custom",{eng:d.lastEngOfCate.webpage}),n.set("customEng",t))},1500),e(t).query("#search-kw").on("mouseenter",function(){e("#search-kw").val().trim()==""&&e("#search-kw").focus()}).on("click,keyup",function(){if(!window.preHttps){var e=s.get("defaultEng")||"somulti";if(e=="so360"||e=="somulti")window.preHttps=!0,setTimeout(function(){window.preHttps=!1},2e4),setTimeout(function(){var e=+(new Date)+Math.random(),t="slog"+e,n=window[t]=new Image;n.src="https://www.so.com/_.gif?"+e,n.onload=n.error=function(){window[t]=null}},0)}});if(o){function w(){e(".search-switchtab").removeClass("tabon"),e(window).un("scroll",w)}e(".search-hd").addClass("drop").insertTo("beforeend",e(".search-switchtab")),e(".search-switchtab").on("click",function(){e(this).toggleClass("tabon"),e(this).hasClass("tabon")?e(window).on("scroll",w):e(window).un("scroll",w)}),e(document).on("click",function(t){var n=e(t.target),r=n.parentNode(".search-switchtab").length||n.hasClass("search-switchtab");r||(e(".search-switchtab").removeClass("tabon"),e(window).un("scroll",w))})}}),function(){var e=QW.W,t=function(e){var t=e!=null&&e==e.window;return t?e:e.nodeType===9?e.defaultView||e.parentWindow:!1},n=function(e,t){return t||(t={},t.top=0,t.left=0),e==document.body?t:(t.top+=e.offsetTop,t.left+=e.offsetLeft,n(e.parentNode,t))},r=function(e){var n=t(e),r="scrollTop",i="pageYOffset";return n?i in n?n[i]:n.document.documentElement[r]:e[r]},i=function(){var t="so360",i="webpage",s="hao_360so_top",o=window.search,u={},a=e(window),f=e(document),l=e("#search-wrap"),c=e("#search-engine"),h=c.query(".eng-list"),p=e("#eng-logo"),d=l.query(".theme-search-tab"),v=e("#search-hotword"),m=e("#search-form"),g="search-fixed",y=e("#search-frame"),b={fixedHeight:n(y[0]).top,cate:i,eng:t,webpageEng:t},w=function(){var e=d.query(".on");b.cate=e.getAttr("data-cate")||e.getAttr("data-widget"),b.eng=p.getAttr("class"),b.webpageEng=o.lastEngOfCate.webpage},E=function(){b.fixedHeight=n(y[0]).top},S=function(){return l.hasClass(g)?"fixed":"default"},x=function(){var e=b.fixedHeight,t=r(a[0]);return t>=e?"fixed":"default"},T=function(){return e("#suggest-container").css("visibility")=="visible"},N=function(){return c.hasClass("open")},C=function(){v.removeClass("open"),e("#suggest-container").css("visibility","hidden")},k=function(){c.removeClass("open")},L=function(e){return["car","flytrip"].indexOf(e)>-1},A=function(e,t,n){if(n){var r=d.query('[data-cate="{key}"]'.replace("{key}",e));r.length||(r=d.query('[data-widget="{key}"]'.replace("{key}",e))),r.length&&r.fire("click"),h.query("."+t).fire("click"),c.removeClass("open")}else setTimeout(function(){e!==o.cate&&o.forceChange(e,t)},0)},O=function(e){var t=m.query(".webpage-so360 input[name=src]");b.src=t.getValue(),t.setValue(e)},M=function(){var e=m.query(".webpage-so360 input[name=src]");e.setValue(b.src)},_=function(e){e?l.addClass(g):l.removeClass(g)},D=function(e,t){f.tweet(e,t)},P=function(e){switch(e){case"fixed":w(),A(i,t,L(b.cate)),_(!0),D("search-fixed-state-turn","fixed");break;case"default":default:A(i,b.webpageEng,!1),A(b.cate,b.eng,L(b.cate)),_(!1),D("search-fixed-state-turn","default")}},H=function(){var e=S(),t=x(),n=e!=t,r=T(),i=N();r&&C(),i&&k(),n&&(E(),P(t),qboot.events&&qboot.events.fire("seach:updateposition"))};return u.init=function(){if(Browser.ie<7)return;w(),a.on("scroll",function(e){H()})},u}();i.init()}();(function(){if(!window.TOPIC_CONFIG)return;var e=TOPIC_CONFIG.weatherPaoPaoConfig,t=e.id,n=new AppData("api.hao.360.cn",HAO_CONFIG.weather.weather.r),r=TOPIC_CONFIG.blackList,i=W("#doc-hd"),s=function(){return qboot.cookie.get("wpaoclose")},o=function(e,t){if(!e||!t)return!1;var n=hao360.queryUrl(location.href,"previewTime");return n=n?new Date(n):hao360.todayObj,n>e&&n<t},u=function(e){return e.name&&e.img&&o(e.startTime,e.endTime)},a=function(e){var t=e[1][0];return r.join().indexOf(t)>-1},f=function(){var e=["weather-paopao"];window.moniter&&moniter.setId(e)},l=function(){m(),qboot.cookie.set("wpaoclose",1,{expires:864e5})},c=function(){var e=W("#"+t);e.delegate("a","click",function(e){l();var n=W(this).attr("data-tag");LogHub.behavior(t,"click-"+n)}).delegate("#close-paopao","click",function(e){l(),LogHub.behavior(t,"close")})},h=function(t){var n=e.special,r=e.normal,i,s;if(n&&n[0])for(s=0;s<n.length;s++){i=n[s];if(t==i.keyword&&u(i))return{img:i.img,name:i.name,isSpecial:!0}}return r&&u(r)?{img:r.img,name:r.name,isSpecial:!1}:{img:"",name:"",isSpecial:!1}},p=function(e){var t=e[0][0],n=e[1][0],r=h(t),i="http://zonghe.hao.360.cn/query?q="+n,s;return r.isSpecial?{img:r.img,url:i,name:r.name}:(r=h(n),{img:r.img,url:i,name:r.name})},d=function(n){var r=e.isOn,i=W("#"+t);if(!r||!n||a(n)||s()){g();return}var o=p(n);if(!o.img||!o.name)return;o.tag=o.name;var u='<a href="{$url}" data-tag="{$tag}"><img src="{$img}" width="90" height="50"></a>';i.query(".main").empty().appendChild(W(u.tmpl(o))),i.show()},v=function(){var t='<div class="container" style="position:relative"><div id="{$id}"><div class="arrow"></div><div class="main"></div><div id="close-paopao"></div></div></div>';W(t.tmpl(e)).appendTo(i[0]),c()},m=function(){var e=W("#"+t);e.undelegate(),i.removeChild(e.parentNode()[0])},g=function(){var e=W("#"+t);e.query(".main").empty(),e.hide()},y=function(){var e=W("#"+t);e.hide()},b=function(){var e=W("#"+t);e.query("a")[0]&&e.show()},w={render:d,hide:y,show:b,init:function(){v(),qboot.await(function(){return n.get("weather")},function(){var e=n.get("weather").area;d(e)})}};window.WeatherPaoPao=w,w.init()})();M({container:"#weather"},function(e,t){function r(t){e(".setting")[t=="show"?"hide":"show"](),e(".inner")[t=="set"?"hide":"show"](),"set"==t&&!e("#weather-prov").val()&&Weather.getProvince(function(e){i(e,"prov",hao360.area.get("prov"))})}function i(t,n,r){var i="",n=n||"prov";t.forEach(function(e,t){r!=e[1]?i+='<option value="'+e[1]+'">'+e[0]+"</option>":i+='<option selected="selected" value="'+e[1]+'">'+e[0]+"</option>"}),e("#weather-"+n).html(i).fire("change")}var n=QW.g;QW.W(document).delegate("#weather-change","click",function(e){e.preventDefault(),r("set"),window.WeatherPaoPao&&WeatherPaoPao.hide()}),e("#weather-cancel").click(function(e){e.preventDefault(),r("show"),window.WeatherPaoPao&&WeatherPaoPao.show()}),e(".done").click(function(i){i.preventDefault();var s=this;e(this).attr("disabled","disabled");if(e(this).attr("disabled")=="disabled")return;var o={prov:n("weather-prov").value,city:n("weather-city").value,town:n("weather-town").value},u=function(n){var i=n.area[2][1];t.tweet("weather-loaded",{code:i}),R("weather-inner").render("weather-template",n),window.WeatherPaoPao&&WeatherPaoPao.render(n.area),r("show"),e(s).attr("disabled",""),hao360.cityCode.set(i)};Weather.getWeather(function(e){e&&u(e)},o.town,1)}),e(".setting select").on("change",function(t){var n={"weather-prov":"city","weather-city":"town"},r=n[e(this).attr("id")],s=hao360.area.get(r);if(!r)return;Weather.getArea(r,function(e){i(e,r,s)},e(this).val())});var s=["\u7a7a\u6c14\u8d28\u91cf\u4f18\uff0c\u53ef\u4ee5\u5c3d\u60c5\u4eab\u53d7\u6e05\u65b0\u7a7a\u6c14","\u7a7a\u6c14\u8d28\u91cf\u826f\uff0c\u6781\u5c11\u6570\u654f\u611f\u4eba\u7fa4\u5e94\u51cf\u5c11\u6237\u5916\u6d3b\u52a8","\u7a7a\u6c14\u8f7b\u5ea6\u6c61\u67d3\uff0c\u6613\u611f\u4eba\u7fa4\u5728\u6237\u5916\u6d3b\u52a8\u65f6\u95f4\u4e0d\u5b9c\u8fc7\u957f\uff0c\u8001\u4eba\u3001\u513f\u7ae5\u5e94\u51cf\u5c11\u6237\u5916\u6d3b\u52a8","\u7a7a\u6c14\u4e2d\u5ea6\u6c61\u67d3\uff0c\u5bf9\u8001\u4eba\u3001\u5c0f\u5b69\u3001\u547c\u5438\u9053\u75be\u75c5\u60a3\u8005\u7b49\u654f\u611f\u4eba\u7fa4\u5f71\u54cd\u8f83\u5927\uff0c\u5916\u51fa\u4f69\u6234\u53e3\u7f69","\u7a7a\u6c14\u91cd\u5ea6\u6c61\u67d3\uff0c\u5bb9\u6613\u8bf1\u53d1\u547c\u5438\u7cfb\u7edf\u75be\u75c5\uff0c\u6240\u6709\u4eba\u5e94\u9002\u5f53\u51cf\u5c11\u5ba4\u5916\u6d3b\u52a8\uff0c\u5916\u51fa\u4f69\u6234\u53e3\u7f69","\u7a7a\u6c14\u4e25\u91cd\u6c61\u67d3\uff0c\u6240\u6709\u4eba\u7684\u5065\u5eb7\u90fd\u4f1a\u53d7\u5230\u5371\u5bb3\uff0c\u5e94\u5c3d\u91cf\u907f\u514d\u6237\u5916\u6d3b\u52a8","\u7a7a\u6c14\u6c61\u67d3\u7269\u4e25\u91cd\u8d85\u6807\uff0c\u7a7a\u6c14\u5bf9\u60a8\u7684\u8eab\u4f53\u4f24\u5bb3\u5de8\u5927\uff0c\u5e94\u5c3d\u91cf\u907f\u514d\u6237\u5916\u6d3b\u52a8"];t.receive("pm25-loaded",function(t){setTimeout(function(){e(".extend-list").animate({top:{to:"-22px"}})},500)});var o='<li><a href="http://www.so.com/s?ie=utf-8&amp;src=hao_360weather&amp;q={$city}pm2.5" class="pm25 pm-level{$step}" title="{$title}"><em>{$level}</em></a></li>';t.receive("weather-loaded",function(n){Weather.getPm25(function(n){n&&(n.title="\u4eca\u65e5pm2.5\u6307\u6570\u4e3a"+n.pm25+"\uff0c"+s[n.step],qboot.await(function(){return R("weather-inner").getStatus()==R.STATUS_OK},function(){var r=e(".name a").html()||e(".name").html();n.city=encodeURIComponent(r),e(".extend-list").appendChild(e(o.tmpl(n))),t.tweet("pm25-loaded"),e(".weather-extend").hover(function(t){e(".today").toggleClass("hover")})},function(){},50,20))},n.data.code,1)}),qboot.await(function(){return hao360.cityCode.get()},function(){t.tweet("weather-loaded",{code:hao360.cityCode.get()})})});(function(){var e=QW.EventTargetH,t=QW.CustEvent,n=e.delegate,r=e.undelegate,i=e.on,s=QW.Selector.filter,o=QW.ObjectH.keys,u=function(e){return e=e||document,{on:function(t,r,i){i=i||{};var s=o(r);s.forEach(function(r){var s=this;n(e,r,t,function(e){i.preventDefault&&e.preventDefault(),s[r].call(this,e)})},r)},off:function(t,n,i){var s=o(n);s.forEach(function(n){var s=this;i?r(e,n,t,i):r(e,n,t)},n)}}};QW.provide("uiproxy",u)})();(function(){function u(){function r(e){return function(){var n,r;t=this.slice().reverse();while(r=t.pop())n=r[e].apply(r,arguments);return t=!1,n}}var e=[],t=!1;return n(e,{call:r("call"),apply:r("apply"),clear:function(e){if(!e)this.length=0;else{var n=this.length,r=n-t.length;for(var i=this.length-1;i>=0;i--)this[i]===e&&(this.splice(i,1),t&&i>=r&&t.splice(n-i-1,1));if(i<0)return!1}return!0}}),e}var e=QW.EventTargetH,t=e.on,n=QW.ObjectH.mix,r=QW.ObjectH.isFunction,i=QW.Selector.filter,s=QW.ObjectH.keys,o=QW.ArrayH.forEach,a=function(){function r(e){var t=this;e=e||{},this.target=e.target||document,this.keyHandlers={},this.globalKeyHandlers={},this.rules=[],this.sequence={},this.sequenceNums=[],this.history=[],this.trace=e.trace,this.traceStack=e.traceStack||[],this.forTextarea=e.forTextarea||!1,this._handler=function(e){if(t.forTextarea&&!/textarea|input/i.test(e.target.nodeName)&&e.target.type!=="text")return;if(!t.forTextarea&&this!==e.target&&(/textarea|select/i.test(e.target.nodeName)||e.target.type==="text"))return;var n,r=t.lock||!t.check(this,e),s=t.keyHandlers[e.type],o=t.globalKeyHandlers[e.type];if(s){var u=i(e),a,f;for(var l in u){a=s[l];if(a)break}if(t.sequenceNums.length&&!r){var c=t.history;c.push(l),c.length>10&&c.shift();if(c.length>1)for(var h=t.sequenceNums.length-1;h>=0;h--){f=s[c.slice(0-t.sequenceNums[h]).join("->")];if(f)return t.trace&&t._trace(h),n=f.apply(this,arguments),c.length=0,n||e.preventDefault(),n}}if(a){if(r)return!1;t.trace&&t._trace(l),n=a.apply(this,arguments),n||e.preventDefault()}}if(o){if(r)return!1;n=o.apply(this,arguments),n||e.preventDefault()}return n}}function i(e){var r=e.type!=="keypress"&&t[e.which],i=String.fromCharCode(e.which).toLowerCase(),s="",o={};e.altKey&&r!=="alt"&&(s+="alt+"),e.ctrlKey&&r!=="ctrl"&&(s+="ctrl+"),e.metaKey&&!e.ctrlKey&&r!=="meta"&&(s+="meta+"),e.shiftKey&&r!=="shift"&&(s+="shift+");if(r)o[s+r]=!0;else{var u=s+i;u&&(o[u]=!0),u=n[i],u&&(o[s+u]=!0,s==="shift+"&&(u=n[i],u&&(o[u]=!0)))}return o}function s(e){return new r(e)}var t={8:"backspace",9:"tab",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",191:"/",224:"meta"},n={"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":":","'":'"',",":"<",".":">","/":"?","\\":"|"};return r.prototype={addHandler:function(t,n,r){function o(e){if(e){var n=e.split("->");if(n.length>1){i.sequence[n.length]=1;var o=[];for(var a in i.sequence)o.push(parseInt(a,10));i.sequenceNums=o.sort(function(e,t){return e-t})}var f=e.toLowerCase();s[f]||(s[f]=u()),s[f].push(r)}else{var l=i.globalKeyHandlers[t];l||(l=i.globalKeyHandlers[t]=u()),l.push(r)}}var i=this,s=this.keyHandlers[t];return r||(r=n,n=""),s||(s=this.keyHandlers[t]={},e.on(this.target,t,this._handler)),ObjectH.isArray(n)?n.forEach(function(e){o(e)}):o(n),this},_trace:function(e){this.traceStack.unshift("["+e+"]"),this.traceStack.length>this.trace&&this.traceStack.pop()},reset:function(){for(var t in this.keyHandlers)e.un(t,this._handler);this.keyHandlers={},this.rules=[],this.history=[],delete this._handler,this.lock=!1},addRule:function(e){return this.rules.push(e),this},enable:function(){this.lock=!1},disable:function(){this.lock=!0},check:function(e,t){var n=!0,r=this.rules;for(var i=0,s=r.length;i<s;i++)if(!r[i].call(e,t)){n=!1;break}return n}},["down","up","press"].forEach(function(e){this[e]=function(t,n){return this.addHandler("key"+e,t,n),this}},r.prototype),s.KEYS_CODE=t,s}();QW.provide("Konami",a)})();(function(){function e(e,t){this._dom=e,this._containter=t.refercontainer||document,this._hasVisible=!1,this._totalVisible=!1,this.onentervisible=t.onentervisible,this.ontotalvisible=t.ontotalvisible,this.onovervisible=t.onovervisible,this.threshold=t.threshold||0,this.triggers=t.triggers||[{window:"resize"},{window:"scroll"}],this._init()}e.prototype._init=function(){if(this.triggers){var e={window:window,document:document},t=this;t.dealWithVisible(),this.triggers.forEach(function(n){for(var r in n){var i=n[r];e[r]&&(r=e[r]),W(r).on(i,function(){t.dealWithVisible()})}})}},e.prototype.dealWithVisible=function(){var e=DomU.getDocRect(this._containter),t={left:e.scrollX,right:e.width+e.scrollX+this.threshold,top:e.scrollY,bottom:e.height+e.scrollY+this.threshold},n=NodeH.getRect(this._dom),r={top:t.top-n.top,bottom:t.bottom-n.bottom,left:t.left-n.left,right:t.right-n.right},i=function(){return r.top<0&&r.bottom>0&&r.left<0&&r.right>0};DomU.rectIntersect(n,t)&&(!this._hasVisible&&this.onentervisible&&(this.onentervisible(),this._hasVisible=!0),i()&&!this._totalVisible&&this.ontotalvisible&&(this.ontotalvisible(),this._totalVisible=!0),this.onovervisible&&this.onovervisible(r))},window.visibleDetector=e})();var vendor=function(){var e=document.createElement("div").style,t=function(){var t="webkitT,t,MozT,msT,OT".split(","),n,r=0,i=t.length;for(;r<i;r++){n=t[r]+"ransform";if(n in e)return t[r].substr(0,t[r].length-1)}return!1}(),n=t?"-"+t.toLowerCase()+"-":"",r=function(e){return t===""?e:(e=e.charAt(0).toUpperCase()+e.substr(1),t+e)},i=r("transform"),s=r("transition"),o=r("transitionProperty"),u=r("transitionDuration"),a=r("transformOrigin"),f=r("transitionTimingFunction"),l=r("transitionDelay"),c=function(){return t==="webkit"||t==="O"?t.toLowerCase()+"TransitionEnd":"transitionend"}(),h=r("animation"),p=r("animationName"),d=r("animationDuration"),v=r("animationTimingFunction"),m=r("animationDelay");return e=null,{propPrefix:t,cssPrefix:n,transform:i,transformOrigin:a,transition:s,transitionProperty:o,transitionDuration:u,transitionTimingFunction:f,transitionDelay:l,transitionEndEvent:c,animation:h,animationName:p,animationDuration:d,animationTimingFunction:v,animationDelay:m,isPlaying:function(e){return e&&e.length&&e.hasClass("play")},animate:function(e,t,n){if(this.isPlaying(e))return;t.animationDuration=parseInt(t.animationDuration,10)||0,t.animated=t.animation+" animated play",this.listenTransition(e[0],t.animationDuration,function(){!t.animationInfinite&&e.removeClass(t.animated),n&&n(t)}),e.css(this.cssPrefix+"animation-duration",t.animationDuration+"ms"),e.addClass(t.animated)},listenTransition:function(e,t,n){var r=this,i=function(){e.transitionTimer&&clearTimeout(e.transitionTimer),e.transitionTimer=null,e.removeEventListener&&e.removeEventListener(this.transitionEndEvent,s,!1)},s=function(){i(),n&&n.call(r),n=null};i(),e.addEventListener&&e.addEventListener(this.transitionEndEvent,s,!1),e.transitionTimer=setTimeout(s,t+50)}}}();(function(){var e=window.configHuodong&&configHuodong.sidebar||{},t="";if(!(e.data&&e.data.length>0))return;var n=e.data;for(var r=0;r<n.length;r++)if(n[r].iconTitle==="\u4e3e\u62a5"){t=n[r];break}var i=function(e){this.options=e||{},this.data=t,this.panel=W("#toolbar-report"),this.init()};i.prototype.init=function(){this.render()},i.prototype.render=function(){var e=this,t=this.createTmpl();this.panel.appendChild(R.tmpl(t.tpl(),this.data));var n=function(){var n=[];return W(e.data.list.forEach(function(e){e.image=e.image.clipImage({whq:"190_110_75",webp:!0}),n.push(R.tmpl(t.slideTpl(),e))})),n.join("")}();this.panel.query(".slide-column-wrap").html(n),this.switchable(),this.event()},i.prototype.switchable=function(){this.data.imageSwitch&&this.data.list.length>1&&(this.panel.query(".pic-switch").switchable({animType:"scroll",viewSelector:".piclist",pageUpSelector:".slide-column-pageup",pageDownSelector:".slide-column-pagedown",mouseenterSwitchTime:null,autoPlay:!0,autoPlayTime:3e3,animDur:150}),this.panel.query(".slide-switch").hover(function(){W(this).addClass("slide-switch-hover")},function(){W(this).removeClass("slide-switch-hover")}))},i.prototype.createTmpl=function(){return{tpl:function(){return['<div class="report-content" id="report-content">','<span class="title">','<a href="{zhiboIconLink}"><span class="big">{zhiboTitle}</span></a><span class="big">\u2022</span>{videoTitle}',"</span>",'<div class="switch-content">','<div class="slide-switch pic-switch">','<div class="slide-content">','<div class="slide-column-wrap">',"</div>","</div>",'<a href="###" class="slide-column-pageup"><span>\u4e0a\u4e00\u5c4f</span><i class="bg"></i></a>','<a href="###" class="slide-column-pagedown"><span>\u4e0b\u4e00\u5c4f</span><i class="bg"></i></a>',"</div>","</div>","</div>"].join("")},slideTpl:function(){return['<div class="piclist">','<div class="g-pic">','<a href="{extendLink}">','<img src="{image}">','<img src="{imagePin}" class="pin-pic">','<div class="pic-title">',"<span>{title}</span>",'<img src="//hao2.qhimg.com/t0155645fabaae3f369.png" class="play">','<div class="bg"></div>',"</div>","</a>","</div>","</div>"].join("")}}},i.prototype.event=function(){var e=function(e){var t=/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/;if(/^(rgb|RGB)/.test(e)){var n=e.replace(/(?:\(|\)|rgb|RGB)*/g,"").split(","),r="#";for(var i=0;i<n.length;i++){var s=Number(n[i]).toString(16);s==="0"&&(s+=s),r+=s}return r.length!==7&&(r=e),r}if(!t.test(e))return e;var o=e.replace(/#/,"").split("");if(o.length===6)return e;if(o.length===3){var u="#";for(var i=0;i<o.length;i+=1)u+=o[i]+o[i];return u}},t=function(e,t){if(!e)return;return e.currentStyle?e.currentStyle[t]:window.getComputedStyle(e,null)[t]};this.panel.hover(function(){W(this).addClass("toolbar-report-hover");var n=W(this).query(".report-text")[0],r=t(n,"color");r&&e(r)==="#ffffff"&&W(n).addClass("important-report-text")},function(){W(this).removeClass("toolbar-report-hover")})},new i({})})();M("#topbar",function(e,t){var n=function(t){var t=t||"on";t=="off"?(e("#toolbar-edition").removeClass("on"),e(".more-edition").hide()):(e("#toolbar-edition").addClass("on"),e(".more-edition").show())};e("#toolbar-edition").click(function(e){e.preventDefault(),n()}).on("mouseenter",function(t){e("#toolbar-edition").addClass("on")}).on("mouseleave",function(e){n("off")});var r=function(){return window.topBarConfig&&!window.topBarConfig.redbagTips.isOn?!1:(new AppData("api.hao.360.cn")).get("topbar-redbag-tips-close")?!1:!0};r()&&e(".redbag-tool #top-tips").show(),e(".redbag-tool").delegate(".toolsite, .close, .inner-tips","click",function(t){e(".redbag-tool #top-tips").hide(),(new AppData("api.hao.360.cn")).set("topbar-redbag-tips-close",1,(new Date).getTime()+864e5)}),e(".more-edition>div").hover(function(t){e(this).toggleClass("hover")}).click(function(n){n.preventDefault(),t.tweet("index-change",{index:e(this).attr("data-v")})});var i={my:"https://hao.360.com",kuanping:"https://hao.360.com"};QW.TweetH.receive(document,"index-change",function(e){var t=i[e.data.index];typeof t=="string"?(qboot.cookie.set("360WEBINDEXCK",t,{expires:31536e6}),setTimeout(function(){window.location.href=t},200)):typeof t=="function"&&t()}),e("#toolbar-themetrigger").on("mouseover",function(){var e=QW.W("#theme-panel").css("display")=="none";t.tweet("global:themeTrigger",{action:"over",status:e?"open":"close"})}),e("#toolbar-themetrigger").click(function(e){e.preventDefault(),document.body.scrollTop==0?document.documentElement.scrollTop=0:document.body.scrollTop=0;var n=QW.W("#theme-panel").css("display")=="none";t.tweet("global:themeTrigger",{action:"click",status:n?"open":"close"})}),Dom.ready(function(){if(!hao360.is360se()&&!hao360.is360se6()&&!hao360.is360ee()){var t="";t+='<div id="download-se360" class="download-se360" data-state="close">',t+="<p><em>\u4eb2\uff0c\u60f3\u628a360\u5bfc\u822a\u8bbe\u4e3a\u4e3b\u9875\uff1f</em></p>",t+="<p>\u60a8\u7684\u6d4f\u89c8\u5668\u4e0d\u652f\u6301\u4e00\u952e\u8bbe\u4e3a\u4e3b\u9875\uff0c</p>",t+="<p>\u5efa\u8bae\u4e0b\u8f7d360\u5b89\u5168\u6d4f\u89c8\u5668\uff0c\u4e0a\u7f51\u66f4\u5b89\u5168\uff01</p>",t+='<div class="download"><a id="start-download" href="http://down.360safe.com/se/sedh.exe">\u4e0b\u8f7d360\u5b89\u5168\u6d4f\u89c8\u5668</a></div>',t+='<p class="link"><a id="goto-sethome" href="http://hao.360.com/sub/sethomepage.html" onclick="try{this.style.behavior=\'url(#default#homepage)\';this.setHomePage(\''+location.protocol+"//"+hao360.host+"/');return(false);}catch(e){}\">\u5982\u4f55\u624b\u52a8\u8bbe\u7f6e360\u5bfc\u822a\u4e3a\u4e3b\u9875\uff1f</a></p>",t+='<a href="###" class="close">\u5173\u95ed</a>',t+='<span class="arrow arrow-top"><span class="border"></span><span class="bg"></span></span>',t+="</div>",e(".topbar-bd").appendChild(e(t)[0]);var n=e("#download-se360"),r=function(e){e==="close"?(n.hide(),n.attr("data-state","close")):(n.show(),n.attr("data-state","open"))},i=function(e,t){LogHub.behavior(e,t)};e(document).on("click",function(){r("close")}),e("#setHomepage").on("click",function(e){e.preventDefault(),e.stopPropagation(),r("open"),n.addClass("download-se360-css3"),i("setHomepage","click")}),e("#download-se360").on("click",function(e){e.stopPropagation(),r("open")}),e("#start-download").on("click",function(e){e.stopPropagation();try{hao360.downloadSe360(1900009566)!=="fail"&&e.preventDefault()}catch(t){}r("close"),i("start-download","click")}),e("#goto-sethome").on("click",function(e){e.stopPropagation(),setTimeout(function(){r("close")},100),i("goto-sethome","click")}),e("#download-se360 > .close").on("click",function(e){e.preventDefault(),e.stopPropagation(),r("close")})}})});~function(){var e=HAO_CONFIG.hotwordinject,t=HAO_CONFIG.hotword,n=qSuggest.log,r="placeholder"in document.createElement("input")&&(!Browser.ie||Browser.ie>=10),i="so-history-status",s="hotword",o="suggest",u="",a="multi",f="normal",l="suggest",c=function(){try{var e=searchInputPlaceHolderText;if(e&&e.isOn){var t=QW.ArrayH.filter(e.options,function(e){var t=hao360.queryUrl(location.href,"previewTime"),n=(new Date(e.startTime)).getTime(),r=(new Date(e.endTime)).getTime(),i=(t?new Date(t):new Date).getTime();return i>=n&&i<=r});if(t&&t.length)return t.pop().text}}catch(n){}return""},h=function(e){if(!e||!parseInt(e.is_online))return!1;var t=+hao360.todayObj,n=location.href.queryUrl("previewTime"),r=+(new Date(e.begin_time.replace(/\-/g,"/"))),i=+(new Date(e.end_time.replace(/\-/g,"/")));return n&&(t=+(new Date(n.replace(/\-/g,"/")))),t<r||t>i?!1:!0},p=function(e){return String(e).replace(/[^\x00-\xff]/g,"abc").replace(/[\d]/g,"abc").length},d=function(e){this.init(e)};d.hook=function(e){var t=!0;return function(){t&&arguments[1]&&arguments[1].length&&(e&&e.apply(null,arguments),t=!1)}},d.QUERY_DATA_HISTORY=1,d.QUERY_DATA_RECOMMEND=2,d.QUERY_DATA_NEWS=3,d.QUERY_DATA_BUSINESS=4,d.QUERY_DATA_SUGGEST=5,d.QUERY_DATA_DEFAULT=6,d.QUERY_DATA_MAP={1:"history",2:"recommend",3:"news",4:"business",5:"suggest",6:"default"},d.QUERY_MONITOR_MAP={1:"history",2:"rec",3:"hot",4:"ad",5:"suggest",6:""},d.getDataType=function(e){return d.QUERY_DATA_MAP[e]||"other"},d.getDataSrc=function(e){return d.QUERY_MONITOR_MAP[e]||""},d.prototype.constructor=d,d.prototype.defaultOptions={},d.prototype.init=function(e){QW.CustEvent.createEvents(this),this.options=qboot.mix(e||{},this.defaultOptions),this.queryInterface=new Interface(this.options.interface),this.filterHandler=new FilterHandler(this.options.filterHandler),this.hotwordStorage=new MapStorage(this.options.hotwordStorage),this.cache={},this.currentQuery="",this.initRemoteDataSource()},d.prototype.initRemoteDataSource=function(){var e=this,t=this.options.search,n=this.options.remoteDataSource,r={};r[o]=[1,50],n.bindGroupHandler(o,{request:function(n,i){if(!i||!n)return;if(n.indexOf("?")>-1)return;var s=p(n);s>=r[o][0]&&s<=r[o][1]&&e.loadSuggestData({word:n,cate:t.getCate()},function(e,t){i(e)})},receive:function(e){return e}})},d.prototype.loadSmartSuggestData=function(e,t){var n=this;e.pid=="shopping"&&!e.word?this.queryInterface.excute("getShoppingData",function(r){var i=n.filterHandler.excute("filterShoppingData",r);t.apply(n,[i,r,e])}):this.queryInterface.excute("getSmartSuggestData",e,function(r){var i=n.filterHandler.excute("filterSmartSuggestData",r),s=i.version;n.setInterfaceVersion(s),t.apply(n,[i,r,e])})},d.prototype.setInterfaceVersion=function(e){this.hotwordStorage.set("interface_version",e),this.fire("updateInterfaveVersion",{version:e})},d.prototype.getInterfaceVersion=function(){return this.hotwordStorage.set("interface_version")},d.prototype.loadBusinessData=function(e,t,n){typeof e=="function"&&(n=t,t=e,e={});var r=this;n&&this.cache.businessData?t.apply(this,[this.cache.businessData]):this.queryInterface.excute("getBusinessData",this.formatBusinessDataReqParams(e),function(n){n&&n.hotwordinject&&(r.cache.businessData=r.filterHandler.excute("filterBusinessData",n.hotwordinject)),t.apply(r,[r.cache.businessData,n,e])})},d.prototype.formatBusinessDataReqParams=function(e){try{return{pos:e.join(",")}}catch(t){return{}}},d.prototype.loadSuggestData=function(e,t){var n=this;this.loadSmartSuggestData({word:e.word,pid:e.cate},function(r){t.apply(n,[n.filterHandler.excute("filterSuggestData",r),r,e])})},d.prototype.loadHotwordData=function(e,t){var n=this,r=e.cate,i=hao360.channel.self;this.loadSmartSuggestData({pid:r},function(s){t.apply(n,[n.filterHandler.excute("filterHotwordData",{cate:r,channel:i,rawData:s}),s,e])})},d.prototype.cleanHistory=function(e){var t=this;this.queryInterface.excute("clearHistory",function(n){e.apply(t,[n])})},d.prototype.delHistory=function(e,t){var n=this;this.queryInterface.excute("deleteHistory",{q:e},function(e){t.apply(n,[e])})},d.prototype.closeHistory=function(e){var t=this;qboot.cookie.set(i,0),this.queryInterface.excute("closeHistory",function(n){e.apply(t,[n])})},d.prototype.openHistory=function(e){var t=this;qboot.cookie.set(i,1),this.queryInterface.excute("openHistory",function(n){e.apply(t,[n])})},d.prototype.getHistoryStatus=function(e){var t=this;return this.queryInterface.excute("getHistoryStatus",function(n){var r=n&&n.errno==0&&n.data=="on"?1:0;qboot.cookie.set(i,r),e&&e.apply(t,[!!r])}),qboot.cookie.get(i)},d.prototype.recordHistory=function(e){this.currentQuery=e},d.prototype.reloadHotwordData=function(e,t,n){var r=this,i=this.hotwordStorage,s=i.get(e),o=this.isValid(e)&&s;n&&o?t&&t.apply(this,[s]):r.loadHotwordData({cate:e},function(n){r.loadBusinessData(function(o){var u=r.filterHandler.excute("convertHotwordRenderData",{cate:e,hotwordData:n,businessData:o}),a={list:u},f=u&&u.length||0;if(f>=10)t&&t.apply(r,[a]),i.set(e,a),this.validCache(e);else{var l="data_error";s?l="use_cache":l="no_cache",t&&t.apply(this,[s]),r.fire("loadHotwordFail",{cate:e,reason:l,data:a,version:r.getInterfaceVersion()})}},!0)})},d.prototype.invalidCache=function(e){this.hotwordStorage.set("cate_invalid_"+e,!1)},d.prototype.isShowDiwen=function(){return window.searchInputPlaceHolderHot&&!!window.searchInputPlaceHolderHot.isOn&&VersionHub.is("so","search-diwen")},d.prototype.filterDiwenWord=function(e){var t="https://uadrec.so.360.cn/gasucs/user_ad_rec",n={mid:hao360.mid,huid:qboot.cookie.get("__huid"),src:"hao_360so_diwen_b_cube",count:1,_t:(new Date).getTime(),ret_type:"jsonp"},r=this,i=new AppData("api.hao.360.cn");qboot.jsonp(t,n,function(t){try{var n="";if(t&&t.status&&t.status.error===0&&t.data&&Object.isArray(t.data)&&t.data.length>0)r.searchDiwenWord=t.data[0].kw,n=t.data[0].q_attr,i.set("searchDiwenWord",t.data[0].kw),e&&e();else{var s=i.get("searchDiwenWord");r.searchDiwenWord=s,e&&e(),LogHub&&LogHub.behavior("search-diwenword","error")}if(r.searchDiwenWord){var o="https://s.qhupdate.com/so/click.gif?",u={pro:"so",pid:"llts",mod:"uadrec",src:"hao_360so_diwen_b_cube",mid:hao360.mid,p3:qboot.cookie.get("__huid"),nlpv:t&&t.ver?t.ver:"",type:"show",p1:r.searchDiwenWord,p2:n};logPureSender(o+qboot.encodeURIJson(u))}}catch(a){LogHub&&LogHub.behavior("search-diwenword","dataerror")}},{jsonp:"callback",timeout:5e3})},d.prototype.validCache=function(e){this.hotwordStorage.set("cate_invalid_"+e,!0)},d.prototype.isValid=function(e){return this.hotwordStorage.get("cate_invalid_"+e)};var v=function(e){this.init(e)};v.prototype.constructor=v,v.prototype.defaultOptions={},v.prototype.init=function(e){QW.CustEvent.createEvents(this),this.options=qboot.mix(e||{},this.defaultOptions),this.containerSelector=this.options.containerSelector,this.searchHotwordSelector=this.options.searchHotwordSelector,this.newHotwordCountSelector=this.options.newHotwordCountSelector,this.searchHotwordTipsSelector=this.options.searchHotwordTipsSelector,this.reciAutoShowSelector=this.options.reciAutoShowSelector,this.reciAutoCloseSelector=this.options.reciAutoCloseSelector,this.reciNoHistorySelector=this.options.reciNoHistorySelector,this.reciCleanHistorySelector=this.options.reciCleanHistorySelector,this.hotwordGroupItemSelector=this.options.hotwordGroupItemSelector,this.selectItemSelector=this.options.selectItemSelector,this.suggestGroupItemSelector=this.options.suggestGroupItemSelector,this.version=this.options.version,this.placeHolderText=this.options.placeHolderText,this.placeHolderFixSelector=this.options.placeHolderFixSelector,this.$searchHotword=W(this.searchHotwordSelector),this.$container=W(this.containerSelector),this.$newHotwordCount=W(this.newHotwordCountSelector),this.$searchHotwordTips=W(this.searchHotwordTipsSelector),this.$placeHolderFix=W(this.placeHolderFixSelector),this.multiWrapTpl=this.options.multiWrapTpl,this.multiItemTpl=this.options.multiItemTpl,this.suggestWrapTpl=this.options.suggestWrapTpl,this.normalWrapTpl=this.options.normalWrapTpl,this.normalItemTpl=this.options.normalItemTpl,this.suggestItemTpl=this.options.suggestItemTpl,this.ui=this.options.ui,this.search=this.options.search,this.cache={},this.data={},this.last={},this.historyStatus=!1,this.initUI(),this.bindEvt()},v.prototype.getItemText=function(e){return decodeURI(e.attr("data-text")||"")},v.prototype.triggerDeleteItem=function(e){this.dispatch("itemDelete",{text:this.getItemText(e)})},v.prototype.triggerCleanHistory=function(){this.dispatch("cleanHistory")},v.prototype.triggerCustormClose=function(){this.closePanel(),this.dispatch("customClose")},v.prototype.triggerTextInputClick=function(){this.last={action:"click",content:""},this.hideNewHotwordCount(),this.setStateNewHotwordCount(),this.dispatch("textInputClick",null,!0)},v.prototype.triggerItemSelect=function(e,t){var n=null;e.attr("data-ssid")&&(n=e.attr("data-ssid").decode4Html()),this.dispatch("itemSelect",{index:t.index,ssid:n,text:this.getItemText(e),label:e.attr("data-label"),link:e.attr("data-href")||e.attr("href")}),this.closePanel()},v.prototype.triggerItemFocus=function(e,t){e.addClass("hover"),this.dispatch("itemFocus",null,!0)},v.prototype.triggerItemBlur=function(e){e.removeClass("hover"),this.adaptPlaceHolder(),this.dispatch("itemBlur",null,!0)},v.prototype.triggerShow=function(){this.toggleArrow(!0),this.dispatch("show")},v.prototype.triggerHide=function(){this.toggleArrow(!1),this.unMark()},v.prototype.triggerResetPosition=function(){this.dispatch("resetPos",null,!0)},v.prototype.triggerChange=function(e){this.last={action:"change",content:e},!e&&!qboot.cookie.get("reciDenyAutoShow")&&this.dispatch("empty",null,!0),this.dispatch("change",{query:e})},v.prototype.triggerTextInputDown=function(){this.$searchHotword.fire("click")},v.prototype.triggerCloseHistory=function(){this.dispatch("closeHistory")},v.prototype.triggerOpenHistory=function(){this.dispatch("openHistory")},v.prototype.adaptDataSrc=function(e,t,n){var r=this.search,i=r.getCate(),s=r.get()[1],o=r.engData[i][s][4].split(";"),u="",a=[],f={hao_360so:!0,hao_search:!0,dlm:!0,hao_360so_a1004:!0,hao_360so_a1111:!0,hao_360so_q0001:!0,hj_llqzq:!0,hj_llq2a:!0,hj_llq1:!0,hj_llq3:!0,hj_llq2c:!0,hj_llq1a:!0,hj_llq5:!0,hj_llq6:!0,hj_llq7:!0,hj_llq7a:!0,hj_llqzq:!0,hj_llqss:!0,hj_llqee:!0},l={somulti:!0,so360:!0,sonews:!1,sovideo:!1,soimage:!1,somusic:!1,somap:!1,sowenda:!1};QW.ArrayH.forEach(o,function(e){var t=e.split(":"),n=t[0],r=t[1];n==="src"&&(u=r)});if(u&&f[u]&&l[s]){a=[u],e&&a.push(e),n&&a.push(n),hao360.project==="cube"&&a.push(hao360.project);if(t){var c=hao360.queryUrl(t,"eci"),h=hao360.queryUrl(t,"nlpv");r.updateParams({eci:c,nlpv:h},s,i)}r.updateParams({src:a.join("_")},s,i),setTimeout(function(){r.updateParams({src:u},s,i)},10)}},v.prototype.triggerSubmit=function(e,t,n,r){var i=this.getVersion();e||(n="button",i=""),this.adaptDataSrc(n,r,i),this.dispatch("formSubmit",{input:e,query:t})},v.prototype.bindDelEvent=function(e){var t=this;e&&e.length&&e.query(".del").on("click",function(e){return e.preventDefault(),e.stopPropagation(),t.triggerDeleteItem(W(this).parentNode("a.item")),!1})},v.prototype.renderPlaceHolder=function(){var e=this.placeHolderText,t=this.ui,n=t.textInput,i=this.$placeHolderFix;n&&e&&(r?n.attr("placeholder",e):i&&i.length&&(i.query("span").item(0).html(e),i.parentNode().show(),i.on("click",function(e){n.fire("mousedown")}))),this.adaptPlaceHolder()},v.prototype.adaptPlaceHolder=function(){var e=this.ui,t=e.getTextInputVal();this.triggerPlaceHolder(!t)},v.prototype.triggerPlaceHolder=function(e){var t=this.placeHolderText,n=this.ui,i=n.textInput,s=this.$placeHolderFix,o=this.search;if(o.cate!="webpage")return;r?e?i.attr("placeholder",t):i.attr("placeholder",""):e?s.show():s.hide()},v.prototype.setTextInputVal=function(e){var t=this.ui;this.triggerPlaceHolder(!e),t.setTextInputVal(e)},v.prototype.destroyPlaceHolder=function(){var e=this.ui.textInput,t=this.$placeHolderFix;e&&(r?e.attr("placeholder",""):(t.parentNode().hide(),t.off("click")))},v.prototype.isPlaceHolder=function(){var e=this.ui.textInput,t=this.$placeHolderFix.parentNode();return r?e.attr("placeholder"):t&&t.css("display")!="none"},v.prototype.preSubmitForPlaceHolder=function(){var e=this,t=this.isPlaceHolder()?this.placeHolderText:"";t&&(e.setTextInputVal(t),setTimeout(function(){e.setTextInputVal("")},50))},v.prototype.adjustPosition=function(){var e=this.ui,t=e.wrap,n=W("#search-input"),r=n.getRect().bottom-W("#doc-view-front").getRect().top;netOffset=r,t.css({top:netOffset+"px"})},v.prototype.initUI=function(){var e=this,t=this.ui,n=this.search,r=this.hotwordGroupItemSelector,i=this.suggestGroupItemSelector,u=this.selectItemSelector,a={},f="",l=function(){var e=!0;return{lock:function(){e=!0},unlock:function(){e=!1},isLock:function(){return e}}}();this.renderPlaceHolder(),t.searchForm.on("submit",function(n){var r=W(u),i=t.getFocusedGroup(),o=t.getTextInputVal(),a=t.query,c=r.attr("href"),h=r.attr("data-src"),p=null;r.attr("data-ext")&&(p=r.attr("data-ext").decode4Html()),i==s&&r[0]&&c&&!l.isLock()&&(n.preventDefault&&n.preventDefault(),window.open(c),l.lock()),o||(e.preSubmitForPlaceHolder(),o=t.getTextInputVal(),o&&(h="diwen")),f=o,e.triggerSubmit(o,a,h,p)}),t.textInput.on("mousedown",function(n){var r=t.getTextInputVal().trim(),i=t.isVisible(),s=qboot.cookie.get("reciDenyAutoShow");r||e.triggerPlaceHolder(!0),r==""&&(i||!s)?e.triggerTextInputDown():r!=""&&!i&&t.fire("change",{query:r})}),t.textInput.on("keydown",function(n){var r=t.container.html()?!0:!1;!r&&n.keyCode==40&&t.getTextInputVal().trim()==""&&e.triggerTextInputDown()}),t.bindGroupHandler(s,{render:{setup:function(){a[s]=[]},build:function(r){if(!(!r||t.query!=""&&e.last.action!="click")){var i=n.getCate(),o=r.type,u=e.build(s,i,o);return t.setGroupTotal(s,u.total),u.content.replace("checkedtmpl",qboot.cookie.get("reciDenyAutoShow")?"checked":"").replace("hCheckedtmpl",e.historyStatus==0?"checked":"")}e.toggleArrow(!1)},teardown:function(){a[s]=W(r),e.bindDelEvent(a[s])}},init:function(){t.initGroupMouseBehavior(s,r),t.container.delegate(r,"click",function(e){W(this).attr("href")||e.preventDefault()}),t.on("itemSelect",function(n){if(n.group!==s)return;if(n.index>-1&&a[s][n.index]){var r=a[s].item(n.index),i=e.getItemText(r),o=n.trigger;o!="keyboard"&&e.setTextInputVal(i),r.attr("href")?o=="keyboard"&&t.getTextInputVal()==i&&l.unlock():t.fire("enter",{trigger:o}),e.triggerItemSelect(r,n),e.triggerItemBlur(r)}}),t.on("itemFocus",function(t){if(t.group!==s)return;if(t.index>-1&&a[s][t.index]){var n=a[s].item(t.index);t.trigger==="keyboard"&&e.setTextInputVal(e.getItemText(n)),e.triggerItemFocus(n,t)}}),t.on("itemBlur",function(t){if(t.group!==s)return;t.index>-1&&a[s][t.index]&&e.triggerItemBlur(a[s].item(t.index),t)})}}),t.bindGroupHandler(o,{render:{setup:function(){a[o]=[]},build:function(){var n=0;return function(r){if(r&&r.length){var i=e.build(o,r);return t.setGroupTotal(o,i.total),n!=i.total&&(n=i.total),i.content}return""}}(),teardown:function(){a[o]=W(i),e.bindDelEvent(a[o])}},init:function(){t.initGroupMouseBehavior(o,i),t.container.delegate(o,"click",function(e){e.preventDefault()}),t.on("itemSelect",function(n){if(n.group!==o)return;if(n.index>-1&&a[o][n.index]){var r=a[o].item(n.index);n.trigger!="keyboard"&&e.setTextInputVal(e.getItemText(r)),t.fire("enter",{trigger:n.trigger}),e.triggerItemSelect(r,n),e.triggerItemBlur(r)}}),t.on("itemFocus",function(t){if(t.group!==o)return;if(t.index>-1&&a[o][t.index]){var n=a[o].item(t.index);t.trigger==="keyboard"&&e.setTextInputVal(e.getItemText(n)),e.triggerItemFocus(n,t)}}),t.on("itemBlur",function(t){if(t.group!==o)return;t.index>-1&&a[o][t.index]&&e.triggerItemBlur(a[o].item(t.index),t)})}}),t.on("show",function(n){W(r).length>0?e.mark(s):W(i).length>0&&e.mark(o),t.getTextInputVal().trim()==""&&e.triggerShow()}),t.on("hide",function(t){e.triggerHide()}),t.on("change",function(t){var n=t.query;e.triggerChange(n),e.adaptPlaceHolder()}),t.on("resetPos",function(t){e.triggerResetPosition()}),W(document).receive("search-cate-change",function(e){t.query==""&&W("#suggest-reci")[0]&&(t.fillContent(),t.query=t.getTextInputVal())}),W(document).on("mouseup",function(n){var r=W(n.target);if(r[0]==document)return;(!r.attr("id")||["search-kw","search-hotword","suggest-container"].indexOf(r.attr("id"))==-1)&&!r.parentNode("#search-kw")[0]&&!r.parentNode("#suggest-container")[0]&&!r.parentNode("#search-hotword")[0]&&!r.parentNode(".ie-placeholder-wrapper")[0]&&t.hide(),r.parentNode("#search-input")[0]||e.adaptPlaceHolder()}),W(window).on("blur",function(e){t.hide()})},v.prototype.bindEvt=function(){var e=this,t=this.$container,n=this.$searchHotword,r=this.$newHotwordCount,i=this.reciNoHistorySelector,s=this.reciAutoShowSelector,o=this.reciAutoCloseSelector,u=this.reciCleanHistorySelector;n.on("click",function(t){e.triggerTextInputClick(),e.focus(),e.changeShutdown()}),r.on("click",function(){e.triggerTextInputClick(),e.focus(),e.changeShutdown(),LogHub.behavior("suggest","newHotwordCount")}),t.delegate(s,"click",function(t){W(this).attr("checked")?e.hideAutoCloseTip():e.showAutoCloseTip()}).delegate(i,"click",function(t){W(this).attr("checked")?e.triggerCloseHistory():e.triggerOpenHistory()}).delegate(o,"click",function(t){e.triggerCustormClose()}).delegate(u,"click",function(t){e.triggerCleanHistory()})},v.prototype.update=function(e,t){this.data[e]=t},v.prototype.setHistoryStatus=function(e){this.historyStatus=e},v.prototype.hideAutoCloseTip=function(){var e=this.$searchHotwordTips;e.fadeIn(1e3,function(){setTimeout(function(){e.fadeOut()},3500)}),this.triggerAutoCloseChange(!0)},v.prototype.showAutoCloseTip=function(){this.$searchHotwordTips.fadeOut(1e3),this.triggerAutoCloseChange(!1)},v.prototype.triggerAutoCloseChange=function(e){this.dispatch("denyAutoShow",{close:+e})},v.prototype.closePanel=function(){this.ui.hide()},v.prototype.showPanel=function(){this.ui.show()},v.prototype.changeShutdown=function(){var e=this.ui;e.on("change",function(t){e.hide(),e.un("change",arguments.callee)})},v.prototype.renderPanel=function(e){var t={};t[e.group]={type:e.type},this.ui.render(t)},v.prototype.switchTo=function(e){var t=e.group,n=e.refresh;this.last.refresh=!!n;switch(t){case s:this.toggleArrow(!0),this.renderPanel(e);break;case o:this.toggleArrow(!1),this.renderPanel(e);break;case u:this.toggleArrow(!1),this.closePanel()}delete this.last.refresh},v.prototype.mark=function(e){var t=this.$container,n=t.attr("data-group"),r=t.attr("data-type"),i=this.current();t.attr("data-group",e).removeClass(n).addClass(e).attr("data-type",i).removeClass(r).addClass(i)},v.prototype.unMark=function(){var e=this.$container,t=e.attr("data-group"),n=e.attr("data-type");e.attr("data-group","").removeClass(t).attr("data-type","").removeClass(n)},v.prototype.getGroup=function(){return this.$container.attr("data-group")},v.prototype.getVersion=function(){return this.version},v.prototype.setVersion=function(e){this.version=e},v.prototype.dispatch=function(e,t,n){t=t||{},n||(t=qboot.mix(this.collectEnvParams(),t,!0)),this.fire(e,{params:t})},v.prototype.collectEnvParams=function(){return{cate:this.search.getCate(),eng:this.search.get()[1],group:this.getGroup(),type:this.current(),orgin:this.last.action,refresh:this.last.refresh,version:this.getVersion()}},v.prototype.focus=function(){this.ui.focusTextInput()},v.prototype.toggleArrow=function(e){var t=this.$searchHotword,n=e?"addClass":"removeClass";t[n]("open")},v.prototype.isOpen=function(){return this.$searchHotword.hasClass("open")},v.prototype.current=function(){return this.$container.query(".suggest-bd>div").attr("data-type")},v.prototype.build=function(e,t,n){var r=this.data,i=[];e==s&&(i=r[t]||{list:[]}),e==o&&(n=l,i={list:t});try{return{total:i.list.length,content:this.buildFragement(n,i)}}catch(u){return{total:0,content:""}}},v.prototype.buildFragement=function(e,t){var n=this[e+"ItemTpl"],r=this[e+"WrapTpl"];return R.tmpl(r,{content:QW.ArrayH.map(t.list,function(e){return R.tmpl(n,e)}).join("")})},v.prototype.setNewHotwordCount=function(e){var t=qboot.cookie.get("click_hotword_count");t!=="1"&&(this.$newHotwordCount.html(e),this.showNewHotwordCount(),LogHub.behavior("suggest","showNewHotwordCount"))},v.prototype.showNewHotwordCount=function(){var e=qboot.cookie.get("click_hotword_count");e!=="1"&&this.$newHotwordCount.show()},v.prototype.hideNewHotwordCount=function(){this.$newHotwordCount.hide()},v.prototype.setStateNewHotwordCount=function(){this.search.cate==="webpage"&&qboot.cookie.set("click_hotword_count",1,{expires:828e5})};var m=function(e){this.init(e)};m.prototype.constructor=m,m.prototype.defaultOptions={},m.prototype.init=function(n){var r=W("#search-kw")[0],i=W("#search-input")[0],s=W("#suggest-container")[0],o=W("#suggest-container .suggest-bd")[0];QW.CustEvent.createEvents(this),this.options=qboot.mix(n||{},this.defaultOptions),this.suggest=new qSuggest(r,{uiReferElem:i,uiWrapElem:s,uiContainerElem:o,posAdjust:{width:-2,top:-1},recAllTimeout:Browser.webkit?0:120}),this.search=search,this.ui=this.suggest.ui,this.data=this.suggest.data,this.model=new d({remoteDataSource:this.data,"interface":{namespace:"hao_360so",host:STATIC_CONFIG.search.soSmartSuggest,timeout:5e3,baseParams:{},apiMap:{getShoppingData:{url:t.host+"/"+t.api,params:{fmt:"jsonp","m[]":"hotword,"+t.v+","+t.r},jsonpName:"_callback"},getBusinessData:{url:e.host+"/"+e.api,params:{pos:"5,7,9","m[]":"hotwordinject,"+e.v+","+e.r},jsonpName:"_callback"},getSmartSuggestData:{api:"suggest",params:{pid:"webpage",word:"",srcg:"",src:hao360.channel.lm?"dlm_suggest":"hao_360so_suggest",encodein:"utf-8",encodeout:"utf-8",count:10},jsonpName:"callback",cache:!1},deleteHistory:{api:"historyDelete",jsonpName:"callback",params:{src:"hao_home",q:""},cache:!1},clearHistory:{api:"historyClear",jsonpName:"callback",params:{src:"hao_home"},cache:!1},closeHistory:{api:"historyClose",jsonpName:"callback",params:{src:"hao_home"},cache:!1},openHistory:{api:"historyOpen",jsonpName:"callback",params:{src:"hao_home"},cache:!1},getHistoryStatus:{api:"historyStatus",jsonpName:"callback",params:{src:"hao_home"},cache:!1}}},filterHandler:{filters:{filterShoppingData:function(e){try{var t=e.hotword.shopping;if(t&&t.length)return QW.ArrayH.map(t,function(e){return{n:e[2],q:e[0],t:"hot",href:e[1]}});return}catch(n){return}},filterSmartSuggestData:function(e){return e&&e.errno==0&&e.data?(e.data.version=e.abv||"",e.data):!1},checkBusinessData:function(e){var t={};for(var n in e)for(var r=0,i;r<e[n].length;r++)i=e[n][r],h(i)&&(t[n]=i.data);return t},formatChannelData:function(e){var t={a1004:!0,q0001:!0,a1111:!0},n=e.cate,r=e.channel,i=e.rawData;return!t[r]||n!="webpage"&&n!="news"?i:QW.ArrayH.map(i,function(e){return e.channel=r,e})},formatBusinessData:function(e){for(var t in e){var n=e[t],r=n[0],i=n[1];e[t]={text:r,href:i,news:!!n[2],label:d.QUERY_DATA_BUSINESS}}return e},formatSuggestData:function(e){if(e&&e.query&&e.result&&e.result.length>0)return{query:e.query,data:e.result,ext:e.ext||"",ssid:e.ssid||""}},formatSuggestRenderData:function(e){if(e){var t=e.data,n=e.query,r=e.ext.encode4HtmlValue(),i=e.ssid.encode4HtmlValue(),s=n.length,o=0;e.data=QW.ArrayH.filter(QW.ArrayH.map(t,function(e,t){var u=e.resrc=="his",a=e.word.trim().toLowerCase(),f=a,l=d.getDataSrc(d.QUERY_DATA_SUGGEST)+(u?"_history":"");return a===n?(o-=1,!1):(a.indexOf(n)===0&&(f=n+"<b>"+a.substring(s)+"</b>"),{src:l,text:hao360.escapeHTML(e.word),index:t+o,encodeText:encodeURI(e.word),suggest:f,ext:r,ssid:i,label:d.getDataType(d.QUERY_DATA_SUGGEST),itemClass:["item",e.resrc].join(" "),extraDom:u?'<span class="del">\u5220\u9664</span>':""})}),function(e){return!!e})}return e},mergeHotwordData:function(e){var t=e.cate||"webpage",n=e.hotwordData||[],r=e.businessData||{};if(t==="webpage")for(var i in r)n[i-1]=r[i];return n.slice(0,10)},formatHotwordRenderData:function(e){var t=e||[];return QW.ArrayH.map(t,function(e,n){var r=d.getDataType(e.label),i=d.getDataSrc(e.label),s=n+1===t.length,o=e.label===d.QUERY_DATA_HISTORY;return{src:i,hotCls:n<3?"hot":"",newCls:+e.news?"new":"",href:e.href||"",text:hao360.escapeHTML(e.text),encodeText:encodeURI(e.text),index:n,serial:n+1,label:r,itemClass:["item",r].join(" "),extraDom:o?'<span class="del">\u5220\u9664</span>':""}})},formatHotwordData:function(e){return!e||!e.length?[]:QW.ArrayH.map(e,function(e){var t=d.QUERY_DATA_DEFAULT;switch(e.t){case"his":t=d.QUERY_DATA_HISTORY;break;case"rec":t=d.QUERY_DATA_RECOMMEND;break;case"hot":t=d.QUERY_DATA_NEWS}return{label:t,text:e.q,channel:e.channel,news:!!e.n,href:e.href}})},deDuplicatioData:function(e){var t={};return QW.ArrayH.filter(e,function(e){return t[e.text]?!1:(t[e.text]=!0,!0)})},filterEmptyItem:function(e){return e=e||[],QW.ArrayH.filter(e,function(e){return!!e})}},rules:{filterBusinessData:["checkBusinessData","formatBusinessData"],filterSuggestData:["formatSuggestData","formatSuggestRenderData"],filterHotwordData:["formatChannelData","formatHotwordData","deDuplicatioData"],convertHotwordRenderData:["mergeHotwordData","formatHotwordRenderData","filterEmptyItem"]}},search:this.search,hotwordStorage:{key:"multi-hotword",expires:1728e5}}),this.view=new v({placeHolderText:c(),placeHolderFixSelector:"#search-input .ie-placeholder-wrapper .placeholder",containerSelector:"#suggest-container",searchHotwordSelector:"#search-hotword",newHotwordCountSelector:"#search-new-hotword-count",searchHotwordTipsSelector:"#search-hotword-tips",reciAutoShowSelector:"#reci-auto-show",reciAutoCloseSelector:"#reci-auto-close",reciNoHistorySelector:"#reci-no-history",reciCleanHistorySelector:"#reci-clean-history",hotwordGroupItemSelector:"#suggest-reci>a",suggestGroupItemSelector:"#suggest-common>a",selectItemSelector:"#suggest-container>.suggest-bd a.hover",search:this.search,ui:this.ui,version:this.model.getInterfaceVersion(),multiWrapTpl:'<div id="suggest-reci" data-type="multi" style="background:none;">                    {content}                     <div class="reci-setting">                        <label for="reci-auto-show">                            <input id="reci-auto-show" type="checkbox" checkedtmpl/>\u4e0d\u518d\u81ea\u52a8\u663e\u793a                        </label>                        <label id="reci-clean-history" href="javascript:void(0);">\u6e05\u7a7a\u5386\u53f2\u8bb0\u5f55</label>                        <label class="mul-declare">\u7531360\u641c\u7d22\u63d0\u4f9b</label>                    </div>                 </div>',normalWrapTpl:'<div id="suggest-reci" data-type="normal">                     {content}                    <div class="reci-setting">                        <label for="reci-auto-show">                            <input id="reci-auto-show" type="checkbox" checkedtmpl/>\u4e0d\u518d\u81ea\u52a8\u663e\u793a                        </label>                        <label class="mul-declare">\u7531360\u641c\u7d22\u63d0\u4f9b</label>                    </div>                </div>',suggestWrapTpl:'<div id="suggest-common" data-type="suggest">{content}</div><label class="suggest-declare">\u7531360\u641c\u7d22\u63d0\u4f9b</label>',multiItemTpl:'<a class="{itemClass}" href="{href}" data-text="{encodeText}" data-label="{label}" data-index="{index}" data-src="{src}">                     <span class="text">{text}</span>                    {extraDom}                </a>',normalItemTpl:'<a class="{itemClass}" href="{href}" data-text="{encodeText}" data-label="{label}" data-index="{index}" data-src="{src}">                     <em></em>                    <span class="{newCls} text">{text}</span>                    {extraDom}                </a>',suggestItemTpl:'<a class="{itemClass}" data-text="{encodeText}" data-label="{label}"  data-index="{index}" data-src="{src}" data-ext="{ext}" data-ssid="{ssid}">                     <span class="text">{suggest}</span>                    {extraDom}                </a>'}),this.bindEvt()},m.prototype.refresh=function(){this.switchTo(this.view.getGroup(),!0)},m.prototype.switchTo=function(e,t){var n=this,r=this.view,i=this.model,l=this.search,c=l.getCate(),h=f,p={group:e,cate:c,type:h,refresh:!!t},d=!t;switch(e){case u:r.switchTo(p);break;case s:i.reloadHotwordData(c,function(e){if(e&&e.list){var t=QW.ArrayH.some(e.list,function(e){return e.src!=="hot"&&e.src!=="ad"});t&&(p.type=a),r.update(c,e),r.switchTo(p)}else n.fire("switchToHotwordFail",{reason:"no_data",cate:c})},d);break;case o:var v=this.ui.query;this.data.setOne(o,v,null),this.ui.fire("change",{query:v});break;default:}},m.prototype.bindEvt=function(){var e=this,t=this.view,r=this.model,i=this.search;CustomEventHub.on(CustomEventHub.Interface_RequestComplete,function(e){var t=e.data,n=t.status,r=t.namespace,i=t.key,s=t.reason,o=t.params;r=="hao_360so"&&(i=="getSmartSuggestData"&&(o&&o.word==""?i="getHotword":i="getSuggest"),n=="error"&&LogHub.reci("error",{namespace:r,key:i,reason:s}))}),r.on("loadHotwordFail",function(e){LogHub.reci("error",{namespace:"hao_360so",key:"loadHotword",reason:e.reason,cate:e.cate})}),r.on("updateInterfaveVersion",function(e){var n=e.version;t.setVersion(n)}),e.on("switchToHotwordFail",function(e){LogHub.reci("error",{namespace:"hao_360so",key:"showHotword",reason:e.reason,cate:e.cate})}),i.on("catechange",function(e){var n=e.cate;n=="webpage"?(t.renderPlaceHolder(),t.showNewHotwordCount()):(t.destroyPlaceHolder(),t.hideNewHotwordCount()),r.reloadHotwordData(n,null,!1)}),t.on("textInputClick",function(n){t.isOpen()?e.switchTo(u):e.switchTo(s)}),t.on("empty",function(t){e.switchTo(s)}),t.on("itemSelect",function(t){var r=t.params,i=r.group,u=r.eng,a=r.index,f=r.text,l=r.ssid,c=e.suggest.renderQuery,h=e.suggest.query;i===s?LogHub.reci("click",r):i===o&&(n("itemSelect[COMMON] index:"+a),LogHub.suggest("commonClk",{inputKw:c,suggestKw:f,index:a,eng:u,ssid:l}),c!=h&&LogHub.behavior("suggest","queryIsDifferent"))}),t.on("formSubmit",function(t){var n=t.params,i=n.input,o=n.query,u=n.cate;i&&i.trim()&&(r.recordHistory(i),r.invalidCache(u),e.data.cleanAll()),i==o&&LogHub.suggest("nosuggestClk",{inputKw:i}),n.group!==s&&LogHub.search("query",{query:i})}),t.on("cleanHistory",function(t){r.cleanHistory(function(t){e.refresh()}),LogHub.reci("clean",t.params)}),t.on("closeHistory",function(t){r.closeHistory(function(t){e.refresh()}),LogHub.reci("closeHistory")}),t.on("openHistory",function(t){r.openHistory(function(t){e.refresh()}),LogHub.reci("openHistory")}),t.on("itemDelete",function(t){var n=t.params;r.delHistory(n.text,function(t){e.refresh()}),LogHub.reci("delete",n)}),t.on("customClose",function(e){LogHub.reci("close",e.params)}),t.on("show",function(e){var t=e.params,n=t.refresh;n||LogHub.reci("show",t)}),t.on("resetPos",function(e){t.adjustPosition()}),t.on("change",function(e){W("#search-kw").tweet("query-change",{query:e.params.query})}),t.on("denyAutoShow",function(e){var t=e.params,n=t.close;n?qboot.cookie.set("reciDenyAutoShow",1,{expires:31536e6}):qboot.cookie.remove("reciDenyAutoShow"),LogHub.reci("denyAutoShow",t)})},m.prototype.prepare=function(e){var t=this.model,e=e||this.search.getCate(),n=this.view,r=t.isShowDiwen;t.reloadHotwordData(e,function(e){var t=0,r=QW.ArrayH.some(e.list,function(e){return e.newCls==="new"&&t++,e.src!=="hot"&&e.src!=="ad"});!r&&t&&n.setNewHotwordCount(t)},!1),r()&&t.filterDiwenWord(function(){n.placeHolderText=t.searchDiwenWord,n.renderPlaceHolder()})},window.QuerySystem=m}(),qboot.load(function(){document.getElementById("suggest-container")||QW.W("#doc-view-front").insertAdjacentHTML("beforeend",'<div id="suggest-container" style="visibility: hidden;"><div class="suggest-bd"></div></div>')},function(){(new QuerySystem).prepare()});(function(){function e(e,t){t=t||{},this.el=e,this.namespace=t.namespace,this.targetSelector=t.targetSelector,this.selectedValue=t.selectedValue,this.trigger=t.trigger||"click",this.menus=t.menus||this.model.menus,this.offsetX=t.offsetX||0,this.offsetY=t.offsetY||0,this.onClick=t.onClick||this.onClick,this.afterClick=t.afterClick||function(){},this.init()}e.prototype.model={dropdownInsertWrap:"#doc-view-front",dropdownTriggerClass:"dropdown-trigger",dropdownClass:"defaul-dropdown",dropdownIndex:"dropdown-index",dropdownValue:"dropdown-value",dropdownStyle:"            .{ns}{position:absolute;top:-999em;left:-999em;background:#fff;border:solid 1px #cfd1d4;text-align:center;z-index:430;}            .{ns} li{height:32px;line-height:32px;cursor:pointer;_width:88px;}            .{ns} li a{display:block;height:100%;white-space:nowrap;padding:0 10px;text-decoration:none;color:#666;_height:auto;_padding:8px 10px;}            .{ns} li a:hover{color:#e30b20;_text-decoration:none;}",menus:[{title:'<span class="icon-express">&#xe605;</span> <em>\u67e5\u5feb\u9012</em>',attr:{href:"https://www.so.com/s?q=%E5%BF%AB%E9%80%92%E6%9F%A5%E8%AF%A2&src=hao_360so_express","dropdown-value":"a"},onClick:function(e,t){}}]},e.prototype.onClick=function(e,t){this.buildSelectedView(W(t).attr(this.model.dropdownValue)),this.removeView()},e.prototype.loadStyle=function(){if(!e.prototype._styleLoaded){var t=this.model.dropdownStyle;t=R.tmpl(t,{ns:this.model.dropdownClass}),qboot.load.css(t,this.model.dropdownClass),e.prototype._styleLoaded=!0}},e.prototype.insertView=function(){W(this.model.dropdownInsertWrap).appendChild(this.view),W(this.el).addClass("active")},e.prototype.removeView=function(){this.view&&(W(this.view).removeNode(),this.view=null,W(this.el).removeClass("active"))},e.prototype.buildView=function(){var e=document.createElement("ul"),t,n,r;e.className=this.model.dropdownClass;for(var i=0;i<this.menus.length;i++){t=document.createElement("li"),n=document.createElement("a"),r=this.menus[i].attr,n.setAttribute(this.model.dropdownIndex,i);for(var s in r)n.setAttribute(s,r[s]);n.innerHTML=this.menus[i].title,t.appendChild(n),e.appendChild(t)}this.view=e},e.prototype.buildSelectedView=function(e){var t,n,r,i=W(this.targetSelector);for(var s=0;s<this.menus.length;s++){r=this.menus[s].attr[this.model.dropdownValue];if(r===e){t=document.createElement("a"),n=this.menus[s].attr,t.setAttribute(this.model.dropdownIndex,s);for(var o in n)t.setAttribute(o,n[o]);t.innerHTML=this.menus[s].title,i&&i.length&&(t.className=i[0].className,i.replaceNode(t));break}}},e.prototype.getRect=function(){this.rect||(this.rect=W(this.view).getSize())},e.prototype.computeStyle=function(e){var t=Dom.getDocRect(),n=W(this.model.dropdownInsertWrap).getRect(),r=W(e.target).getRect(),i=r.left-n.left+r.width+this.offsetX-this.rect.width,s=r.top-n.top+r.height+this.offsetY;W(this.view).setXY(i,s)},e.prototype.buildEvent=function(){if(!this._eventBuilded){var e=this;this._scrollHandler=function(){W(window).un("scroll",e._scrollHandler),e.removeView()},this._resizeHandler=function(){W(window).un("resize",e._resizeHandler),e.removeView()},this._clickHandler=function(t){t.stopPropagation(),W(document).un("click",e._docClickHandler);var n=parseInt(W(this).attr(e.model.dropdownIndex),10),r=W(this).attr(e.model.dropdownValue);e.menus[n].onClick&&e.menus[n].onClick.call(e,t,this),e.onClick.call(e,t,this),e.afterClick.call(e,r),e.namespace&&r&&LogHub&&LogHub.behavior(e.namespace,"click-dropdown-"+r)},this._docClickHandler=function(){W(document).un("click",e._docClickHandler),e.removeView()},this._eventBuilded=!0,this._mouseLeaveHandler=function(){e.trigger==="hover"&&e.removeView()}}},e.prototype.bindEvent=function(){var e=this;W(e.view).delegate("["+e.model.dropdownIndex+"]","click",e._clickHandler),W(window).on("scroll",e._scrollHandler),W(window).on("resize",e._resizeHandler),W(document).on("click",e._docClickHandler),W(e.view).on("mouseleave",e._mouseLeaveHandler)},e.prototype.controller=function(e){this.removeView(),this.loadStyle(),this.buildView(),this.insertView(),this.getRect(),this.computeStyle(e),this.buildEvent(),this.bindEvent()},e.prototype.init=function(){this.el._dropdown=this,W(this.el).addClass(this.model.dropdownTriggerClass),this.selectedValue&&this.buildSelectedView(this.selectedValue);if(!e.prototype._isDelegated){var t=this.trigger==="hover"?"mouseenter":"click";W(document).delegate("."+this.model.dropdownTriggerClass,t,function(e){e.preventDefault(),this._dropdown.controller(e)}),e.prototype._isDelegated=!0}},QW.NodeW.pluginHelper({dropdown:function(t,n){if(Dom.isElement(t))return new e(t,n)}},"opreator")})();(function(){function s(e){return Math.floor(Math.random()*Math.floor(e))}var e="search_tool",t=new AppData("api.hao.360.cn"),n="search-tools",r=t.get(e),i=[{title:'<span class="icon-express">&#xe606;</span> <em>\u67e5\u90ae\u7bb1</em>',attr:{href:"https://www.so.com/s?ie=utf-8&src=hao_360so_mail&shb=1&q=%E9%82%AE%E7%AE%B1%E7%99%BB%E5%BD%95","dropdown-value":"email",target:"_blank"}},{title:'<span class="icon-express">&#xe605;</span> <em>\u67e5\u5feb\u9012</em>',attr:{href:"https://www.so.com/s?q=%E5%BF%AB%E9%80%92%E6%9F%A5%E8%AF%A2&src=hao_360so_express","dropdown-value":"express",target:"_blank"}},{title:'<span class="icon-express">&#xe608;</span> <em>\u67e5\u5f69\u7968</em>',attr:{href:"https://www.so.com/s?q=%E5%BD%A9%E7%A5%A8&src=hao_360so_lottery","dropdown-value":"lottery",target:"_blank"}},{title:'<span class="icon-express">&#xe60B;</span> <em>\u67e5\u8fdd\u7ae0</em>',attr:{href:"https://www.so.com/s?q=%E8%BF%9D%E7%AB%A0%E6%9F%A5%E8%AF%A2&src=hao_360so_trafficViolation","dropdown-value":"violation",target:"_blank"}},{title:'<span class="icon-express">&#xe609;</span> <em>\u67e5\u8f66\u7968</em>',attr:{href:"https://www.so.com/s?q=%E7%81%AB%E8%BD%A6%E7%A5%A8%E6%9F%A5%E8%AF%A2&src=hao_360so_ticket","dropdown-value":"ticket",target:"_blank"}},{title:'<span class="icon-express">&#xe60C;</span> <em>\u67e5\u9650\u53f7</em>',attr:{href:"https://www.so.com/s?q=%E4%BB%8A%E6%97%A5%E9%99%90%E8%A1%8C&src=hao_360so_numberLimit","dropdown-value":"carLimit",target:"_blank"}},{title:'<span class="icon-express">&#xe60D;</span> <em>\u67e5\u4e2a\u7a0e</em>',attr:{href:"https://www.so.com/s?q=%E4%B8%AA%E7%A8%8E%E8%AE%A1%E7%AE%97%E5%99%A8&src=hao_360so_incomeCalculate","dropdown-value":"tax",target:"_blank"}},{title:'<span class="icon-express">&#xe60A;</span> <em>\u67e5\u6c47\u7387</em>',attr:{href:"https://www.so.com/s?q=%E8%B4%A7%E5%B8%81%E6%8D%A2%E7%AE%97&src=hao_360so_exchange","dropdown-value":"exchange",target:"_blank"}},{title:'<span class="icon-copyright">&#xe900;</span> <em>\u67e5\u7248\u6743</em>',attr:{href:"https://chacha.so.com/home?src=daohang","dropdown-value":"copyright",target:"_blank"}}];r||(r=i[s(i.length)].attr["dropdown-value"]),W("#daily-tools-toggle").dropdown({targetSelector:".daily-tools-last",selectedValue:r,namespace:n,trigger:"hover",offsetX:-4,offsetY:-27,afterClick:function(n){t.set(e,n);for(var r=0;r<i.length;r++)if(n===i[r].attr["dropdown-value"]){window.moniter&&window.moniter.sendClklog(n,i[r].attr.href,"search-tools");break}},menus:i}),W(document).delegate(".daily-tools-last","click",function(){var e=W(this).attr("dropdown-value");LogHub&&LogHub.behavior(n,"click-default-"+e)})})();(function(){var e=window.newGuide,t="        html,body{scroll-behavior: smooth}        #new2020-floor.floor-wrap{width: 66px;color:#666;visibility:hidden;transition:all .3s;}        #new2020-floor.floor-wrap.active{visibility: visible;}        #new2020-floor.floor-wrap li{width: 66px; height: 39px;}        #new2020-floor.floor-wrap a{display:block;width:34px;height:32px;line-height:32px;text-align:left;font-size:12px;color:#666;border:solid 1px #e3e3e3;text-decoration:none;overflow:hidden;background:#fff;position:relative;padding-left:30px;}        #new2020-floor.floor-wrap a:hover{border-color:#00c13c;color:#00c13c;background:#fff;}        #new2020-floor.floor-wrap i{display:block;width:14px;height:12px;position:absolute;top:8px;left:8px;background-color: #666; background-repeat: no-repeat; background-position: 0 0;}        #new2020-floor.floor-wrap i.guide{background-image:url(https://p3.ssl.qhimg.com/t019a71b185f9e9155a.png);height:14px;}        #new2020-floor.floor-wrap .back{background-position:0 0;}        #new2020-floor.floor-wrap .top{background-position:0 -32px;}        #new2020-floor.floor-wrap .guide{background-position:0 -35px;}        #new2020-floor.floor-wrap a:hover i{background-color: #00c13c;}        #new2020-floor.floor-wrap a.text{width:64px;padding-left:0;text-align:center}        #new2020-floor.floor-wrap li.show{visibility: visible}        #new2020-floor.floor-wrap li.activity a{color:red}        #new2020-floor.floor-wrap li.activity a:hover{color:#00c13c;}    ",n={guide2020:function(){window.guideEl?window.guideEl._zeroGuide():window.guideEl=new e},backTo2019:function(){window.DEBUG?(qboot.cookie.set("new2020",2),window.location.reload()):(qboot.cookie.set("new2020",2,{domain:".hao.360.com",expires:31536e6,secure:!0,path:"/"}),window.location.href="/")},scrollToTop:function(){document.body.scrollTop=document.documentElement.scrollTop=0}},r={data:[{text:"\u8fd4\u56de\u65e7\u7248",classname:"show",action:n.backTo2019},{icon:"top",text:"\u9876\u90e8",action:n.scrollToTop}],container:"plane-footer","class":"floor-wrap",tpl:function(e){return e.icon?'<li class="{classname}"><a href="{href}" data-index="{index}"><i class="{icon}"></i>{text}</a></li>':'<li class="{classname}"><a class="text" href="{href}" data-index="{index}">{text}</a></li>'},css:function(){var e="https://hao1.qhimg.com/t01eca3f5f7d9f16cc0.png",n="https://hao1.qhimg.com/t016322b10b5c99e268.png",r=hao360.clipImage(e,{whq:"14_44_75",webp:!0}),i=hao360.clipImage(n,{whq:"28_88_75",webp:!0}),s="#new2020-floor.floor-wrap i{background-image: url("+r+"); background-image: -webkit-image-set(url("+r+") 1x, url("+i+") 2x); background-image: image-set(url("+r+") 1x, url("+i+") 2x);}";return t+s}(),init:function(){qboot.load.css(this.css,this.class+"-style");var e=document.createElement("ul");e.setAttribute("id","new2020-floor"),e.className=this.class,e.innerHTML=this.makeHMTL(this.data),this.$wrap=W(e);var t=document.getElementById(this.container);t&&t.appendChild(e),moniter.setId(["new2020-floor"]),this.bindEvent()},makeHMTL:function(e){var t=[];for(var n=0,r=e.length;n<r;n++)e[n].href=e[n].href||"###",e[n].classname=e[n].classname||"normal",e[n].index=n,t.push(R.tmpl(this.tpl(e[n]),e[n]));return t.join("")},bindEvent:function(){var e=this.data,t=W(window),n=this.$wrap;n.delegate("a","click",function(t){var n=parseInt(W(this).attr("data-index"),10),r=e[n].action;r&&(t.preventDefault(),r())});var r=null,i="active";t.on("scroll",function(){clearTimeout(r),r=setTimeout(function(){var e=document.body.scrollTop||document.documentElement.scrollTop;e>300?n.addClass(i):n.removeClass(i)},100)})}};r.init()})();(function(){function e(e,t,n){var s=i[e]?i[e]:null;return s?(r[e]=r[e]||{},r[e][t]=n,{check:function(){return s.check(t)},onClose:function(){return s.onClose(t)},remove:function(){return delete r[e][t],s.remove(t)},resetRule:function(e){return s.resetRule&&s.resetRule(t,e)}}):!1}function t(e){var e=parseInt(e,10)?parseInt(e,10)-1:0,t=new Date,n=t.getHours(),r=t.getMinutes(),i=t.getSeconds(),s=86400-(n*3600+r*60+i);return(s+e*3600*24)*1e3}var n="api.hao.360.cn",r={},i={forever:{cacheKey:"close-forever",check:function(e){var t=new AppData(n),r=this.cacheKey,i=t.get(r)||[];return i.indexOf(e)===-1?!0:!1},onClose:function(e){var t=new AppData(n),r=this.cacheKey,i=t.get(r)||[];i.indexOf(e)===-1&&(i.push(e),t.set(r,i))},remove:function(e){var t=new AppData(n),r=this.cacheKey,i=t.get(r)||[],s=i.indexOf(e);s!==-1&&(i.splice(s,1),t.set(r,i))}},showTimes:{cacheKey:"close-by-show-times",check:function(e){var t=[e,0],n=this._getCache(e)||t,i=n[1],s=r.showTimes[e];return i<s?(n[1]++,this._setCache(e,n),!0):!1},onClose:function(e){var t=r.showTimes[e];this._setCache(e,[e,t])},remove:function(e){var t=new AppData(n),r=this.cacheKey,i=t.get(r)||[],s=this._indexOf(i,e);s>-1&&(i.splice(s,1),t.set(r,i))},_setCache:function(e,t){var r=new AppData(n),i=this.cacheKey,s=r.get(i)||[],o=this._indexOf(s,e);o>-1?s[o]=t:s.push(t),r.set(i,s)},_getCache:function(e){var t=new AppData(n),r=this.cacheKey,i=t.get(r)||[];return index=this._indexOf(i,e),index>-1?i[index]:null},_indexOf:function(e,t){var n=-1;for(var r=0;r<e.length;r++)if(e[r][0]===t){n=r;break}return n}},closeTimesRange:{cacheKey:"close-count",check:function(e){var t=this.cacheKey+"-"+e,n=qboot.cookie.get(t),r=hao360.queryUrl(location.href,"previewTime"),i=(r?new Date(r):new Date).getTime(),s;return n&&n.indexOf("_")>-1?(s=parseInt(n.split("_")[1],10),i>s?!0:!1):!0},onClose:function(e){var t=r.closeTimesRange[e]||this._defaultRule,n=this.cacheKey+"-"+e,i=qboot.cookie.get(n)||"_",s=i.split("_"),o=parseInt(s[0],10)||0,u=(new Date).getTime(),a=t[0].range[0],f=t[t.length-1].range[1],l,c,h;o++,o>=f&&(o=a+1);for(var p=0;p<t.length;p++){l=t[p],c=l.range;if(o>=c[0]&&o<c[1]){u+=l.expires,h=l.expires+864e5;break}}h&&qboot.cookie.set(n,o+"_"+u,{expires:h}),LogHub&&LogHub.behavior(e,this.cacheKey+"-"+o)},remove:function(e){var t=this.cacheKey+"-"+e;qboot.cookie.remove(t)},resetRule:function(e,t){this._defaultRule=t},_defaultRule:[{range:[0,3],expires:t(1)},{range:[3,6],expires:t(7)},{range:[6,7],expires:t(30)}]}};e.getCookieExpiresByDays=t,window.CloseStrategy=e})();M("#activity",function(e,t){var n=e("#activity-imgs-switch"),r=n.query(".slide-item"),i=r.length,s=1e4,o=function(){function f(n){if(!n){var i=e(".act-topic-list>li").first();t.appendChild(i)}e(".act-topic-list").animate({top:{from:0,to:-r+"px"}}),s=setTimeout(function(){f()},a)}var t=e(".act-topic-list"),n=e(".act-topic-list>li").length,r=e(".act-topic-list>li").first().getSize().height,i=0,s=0,o=0,u=1e4,a=1e4;n>1&&setTimeout(function(){e(".act-topic-list").delegate("li","mouseenter",function(){clearTimeout(s),clearTimeout(o)}).delegate("li","mouseleave",function(){o=setTimeout(f,a/2)}),f(!0)},u)},u=function(){if(e("[data-face]").length<=1)return;var t=function(){var t=e(".action-a"),n=e(".action-b"),r=e(".btn-tucao"),i=32,s=57,o=128,u=30,a=0,f=null,l={init:function(){var e=this;e.actionAAnim(),t.on("click",function(n){n.preventDefault(),t.css({"background-position":"0 0"}),e.actionBAnim()})},actionAAnim:function(){var e=this;e.frameAnim(t,i)},actionBAnim:function(){var e=this;n.css("top","0"),e.frameAnim(n,s)},frameAnim:function(e,t){var n=this;f&&(a=0,clearInterval(f)),f=setInterval(function(){if(a>=t){a=0,clearInterval(f),e.hasClass("action-a")&&n.actionAAnim(),e.hasClass("action-b")&&r.css({display:"block"});return}a++,e.css("background-position","0 -"+a*o+"px")},u)},reset:function(){clearInterval(f),n.css({"background-position":"0 0",top:"128px"}),r.hide()}};return l}(),n=function(t,n){var i,s=function(e){clearTimeout(i)},o=function(u){i=setTimeout(function(){r(n),e("[data-face="+t+"]").un("mouseenter",s).un("mouseleave",o)},1e4)};e("[data-face="+t+"]").on("mouseenter",s).on("mouseleave",o)},r=function(r){var i=e("[data-face="+r+"]");if(i[0]){e("[data-face]").fadeOut(200),i.fadeIn(100);var s=i.attr("data-autoTurnFace");s&&e("[data-face="+s+"]")[0]&&n(r,s),r=="a"?t.reset():r=="b"&&t.init()}};e("[data-face]").delegate("[data-clickTurnFace]","click",function(){r(e(this).attr("data-clickTurnFace"))})},a,f=function(){a=new QW.Slide(g("activity-imgs-switch"),{animType:"fade",autoPlayTime:s,viewSelector:".slide-content div",autoPlay:!0,supportMouseenter:!0,mouseenterSwitchTime:300,selectedIndex:0,onbeforeswitch:function(t){var n=e(t.toView).query("img"),r=n.attr("data-src");!n.attr("src")&&r&&n.attr("src",r)}}),n.hover(function(t){t.type=="mouseover"?e(".slide-btn").show():e(".slide-btn").hide()})},l=function(){var e=function(e){var t=200,n;return function(r){n=setTimeout(function(){clearTimeout(n),n=null,e.apply(this,[r])},t)}};QW.W(window).on("scroll",e(function(){c()&&p()})),QW.W(window).on("resize",e(function(){c()&&p()}))},c=function(){var e=Dom.getDocRect(),n=t.getRect();return t.isVisible()&&n.top<e.height+e.scrollY},h=null,p=function(){if(h)return;h=!0;var t=r.item(1),n=hao360.project==="cube"?"wasaiImagePMPNEW":"wasaiImagePMP";t.loadMediav(n,{aContainer:".act-toppic",imgSelector:"img",textSelector:".txt",directPv:0,directOnceRender:!0,afterRenderData:function(t,n,r){var i=e(t);i.query(".ad")[0]||i.appendChild(e('<span class="ad"></span>')),n.ldtype&&n.ldtype===6&&(i.query("span").toArray()[0].className="ad-minipro-long")},onSuccessEnd:function(t){a&&(a.onafterswitch=function(n){var r=e(n.toView).query("a").toArray().slice(0,1);t.view.sendJointPv(r)})}});var i=hao360.project==="cube"?"wasaiTextCPCNew":"wasaiTextCPC";t.query(".g-list").loadMediav(i,{aContainer:"a",imgSelector:"img",textSelector:"span",directPv:0,directOnceRender:!0})},d=function(){var n="activity_me_hide";e("#acti-me").delegate(".ad-close-btn","click",function(e){e.preventDefault(),t.removeNode(),QW.W("#bangbang-l").tweet("page-height-resize"),qboot.cookie.set(n,1,{expires:864e5}),LogHub.behavior("activity","close")})};e(".act-topic-list")[0]&&o(),e("[data-face]")[0]&&u(),i>1&&f(),e("#acti-me").length>0&&d();var v=hao360.queryUrl(location.href,"test");if(v||t.hasClass("backup")&&i==3)l(),c()&&p()});M({container:"#top_activity"},function(e,t){t.query("a").hover(function(t){var n=e(this).query("img"),r=n.attr("src"),i=n.attr("data-hover");i&&(n.attr("data-origin",r),n.attr("src",n.attr("data-hover")))},function(t){var n=e(this).query("img"),r=n.attr("data-origin");r&&n.attr("src",n.attr("data-origin"))})});var Plane=function(){var e={},t=W("#plane"),n=W("#goBottom"),r=W("#goTop"),i=Dom.getDocRect().scrollHeight,s=navigator.userAgent.indexOf("MSIE 6.0")!==-1,o=function(){TweetH.receive(document,"page-size-changed",function(e){e.data.spaceWidth<=68?t.hide():(t.show(),h())})},u=function(){if(W("#plane .plane-hd.plane-majia img").length){W("#plane .plane-hd").show();var e=W("#plane .plane-hd img")[0].src,t=new Image;t.onload=function(){var e=t.width;e&&(W("#plane .plane-hd").css({width:e+"px"}),W("#plane .close-btn").css({left:e+"px"}))},t.src=e}W("#plane").delegate(".close-btn","click",function(e){e.preventDefault(),W("#plane .plane-hd").removeNode();var t=new Date;t.setDate(t.getDate()+1),qboot.cookie.set("planeImageClose",1,{expires:new Date(t.format("YYYY/MM/dd"))}),LogHub&&LogHub.behavior("planeImage","close")}),W("#plane .plane-hd").hover(function(e){W("#plane .card").addClass("card-show")},function(e){W("#plane .card").removeClass("card-show")})},a=function(){if(window.planePMPConfig.isOn==0)return!1;var e=new Date(planePMPConfig.startTime),t=new Date(planePMPConfig.endTime),n=hao360.queryUrl(location.href,"previewTime")||hao360.todayObj;return e>new Date(n)||new Date(n)>t?!1:!0}(),f=function(){var e=W(".plane-priming");e.length&&(W("#plane .plane-hd").show(),W("#plane .plane-priming-content").show())},l=function(){var e='<div class="plane-hd plane-adsvc"><a href="##" class="close-btn"></a><a href="" class="plane-ad" rel="noopener"><img src="" width="74" height="82"/><span class="ad"></span></a></div>';W("#plane").insertBefore(W(e)[0],W("#plane").firstChild()[0]),W("#plane").loadMediav("planePMPNEW",{aContainer:".plane-ad",imgSelector:"img",textSelector:".txt",directPv:1,directOnceRender:!0,afterRenderData:function(e,t,n){var r=W(e);t.ldtype&&t.ldtype===6&&(r.query("span").toArray()[0].className="ad-minipro-mini"),r.attr("title","")},onSuccessEnd:function(e){W("#plane .plane-ad").attr("data-monitor")&&(W("#plane .plane-hd").css({width:"74px"}),W("#plane .close-btn").css({left:"74px"}),W("#plane .plane-hd").show())},onError:function(){W("#plane").removeChild(W(".plane-adsvc")[0]),f()}})},c=!1,h=function(){var e=hao360.queryUrl(location.href,"pmp")==="plane";if(W("#plane .plane-majia")[0]){if(!e)return;W("#plane").removeChild(W(".plane-majia")[0])}if(qboot.cookie.get("planeImageClose"))return;if(c)return;c=!0;if(!a)f();else{if(window.adOnOff&&window.adOnOff.plane_home_2020==="off")return;l()}};return e.init=function(){o(),u(),window.isCloseLicai==="close"&&W("#licaiTab").hide()},e}();Plane.init();M({container:"#hotbottom_littlenav"},function(e,t){function n(t,n){var r=e(t).query("img")[0],i=e(t).query("img")[1];r&&i&&(n==="mouseover"?(r.style.display="none",i.style.display="inline-block"):n==="mouseout"&&(r.style.display="inline-block",i.style.display="none"))}function r(e,t,r){e.delegate(t,r,function(e){n(e.target.parentNode,r)})}function i(){var e=[{el:"a",event:"mouseover"},{el:"a",event:"mouseout"}];for(var n=0,i=e.length;n<i;n++)r(t,e[n].el,e[n].event)}i()});(function(){var e=function(e){if(e=="")return e;var t=0,n="",r=+(new Date),i="qiho3600com",s=Math.floor(Math.random()*15),o;while(t<2)n+=i.charAt(Math.floor(Math.random()*8)),t++;return o=e.substr(s,r.length),e=e.replace(o,r),e=n+e+o+"."+s,e},t=function(){return window.PROJECT_SIGN==="extra_wide"};W("#my-follow").click(function(n){n.preventDefault();var r="https://www.360kuai.com/pc/zmt/following?",i={sign:"360_36e79513",refer_scene:0},s="";hao360.mid?i.sc_id=e(hao360.mid):i.uid=qboot.cookie.get("__guid")||qboot.cookie.get("__huid")||"",t()&&(i.type="browse",s="#zmt");var o=r+qboot.encodeURIJson(i)+s;window.open(o)})})();(function(){function o(e){t.isReadyFast?f(t.userInfo):t.userInfo?a(t.userInfo):u(r),c()}function u(e){n.html(e)}function a(e){var t=i.tmpl();u(t(e.nickname||e.username))}function f(e){var t=s.tmpl();u(t(e))}function l(){n.query(".fast-tips").hide()}function c(e){t.on("FastReady",function(e){f(e)}),t.on("UserInfo",function(e){a(e)}),t.on("NoLog",function(){u(r)}),t.on("Logout",function(){u(r)}),n.delegate(".login-btn","click",function(e){e.preventDefault(),t.login()}),n.delegate(".fastlogin-btn","click",function(e){e.preventDefault();var t=n.query(".fast-tips");t.show()}),n.delegate(".logout-btn","click",function(e){e.preventDefault(),t.logout()}),n.delegate(".btn-fast-login","click",function(e){e.preventDefault(),t.fastLogin()}),n.delegate(".btn-login","click",function(e){e.preventDefault(),t.login(),l()}),n.delegate(".btn-reg","click",function(e){e.preventDefault(),t.signUp(),l()}),n.delegate(".user-info","mouseenter",function(e){e.preventDefault();var t=W(this),n=t.getRect().width,r=t.query(".nickname").getRect().width,i=n-r>30?"hover":"fix-hover";t.addClass(i)}),n.delegate(".user-info","mouseleave",function(e){e.preventDefault();var t=W(this);t.removeClass("hover").removeClass("fix-hover")}),W("body").on("click",function(e){if(W(e.target).parentNode(".fast-tips").length===1||e.target===n.query(".fast-tips")[0]||e.target===n.query(".fastlogin-btn")[0])return;l()})}var t=window.haoUser,n=W("#user-login"),r='<a href="javascript:void(0)" class="login-btn">\u767b\u5f55/\u6ce8\u518c</a>',i=['<div class="user-info gclearfix">','<span class="nickname">{opts}</span>','<a href="javascript:void(0)" class="logout-btn">\u9000\u51fa</a>',"</div>"].join(""),s=["<div>",'<a href="javascript:void(0)" class="fastlogin-btn">\u4e00\u952e\u767b\u5f55</a>','<div class="fast-tips">','<div class="avatar"><img src="{$avatar}" alt="" /></div>','<div class="nickname">{$nickname||$username}</div>','<div class="">','<a href="javascript:void(0)" class="btn-fast-login">\u7528\u8be5\u8d26\u53f7\u4e00\u952e\u767b\u5f55</a>',"</div>",'<div class="opt">','<a href="javascript:void(0)" class="btn-login">\u7528\u5176\u4ed6\u8d26\u53f7</a>','<span class="hr">|</span>','<a href="javascript:void(0)" class="btn-reg">\u6ce8\u518c\u65b0\u8d26\u53f7</a>',"</div>","</div>","</div>"].join("");o()})();(function(){function r(e){this.init(e),this.initEvt()}var e=W("#cube-feedback"),t=W("#cubefeedback-name"),n=window.loadJs;r.prototype.init=function(n){this.cubeId=n.id,this.cubeName=n.name,this.cubeQueue=n.where,this.sendScreenShot=!1,this.postdata=!1,this.screenshot="",this.cateId="",t.html(this.cubeName),window.innerHeight<=650?e.query(".dialog-form").addClass("dialog-form-auto"):e.query(".dialog-form").removeClass("dialog-form-auto"),e.show(),this.loadScreenPlugin()},r.prototype.isSupportScreenShot=function(){return!!document.createElement("canvas").getContext&&window.Promise},r.prototype.loadScreenPlugin=function(){var e=this;this.isSupportScreenShot()?(W("#cube-feedback .checkbox").hasClass("checked")&&(this.sendScreenShot=!0),window.html2canvas?setTimeout(function(){e.getScreenShot()},0):n("https://s2.ssl.qhimg.com/static/2f666395db2a56f4.js",function(){e.getScreenShot()})):W(".cube-feedback-mask .screenshot").hide()},r.prototype.cloneNode=function(e){var t=e.cloneNode(!0);return W(t).setStyle({position:"relative",left:0,top:window.innerHeight+"px",width:"400px"}),document.body.appendChild(t),t},r.prototype.getScreenShot=function(){var e=this,t=this.cubeQueue,n=W("#cube-mod-"+t+"-"+this.cubeId)[0],r=function(){return window.devicePixelRatio===1&&/win64|win32/i.test(navigator.userAgent)?-document.documentElement.scrollLeft-9:-document.documentElement.scrollLeft},i=this.cloneNode(n);html2canvas(i,{useCORS:!0,scrollY:-document.documentElement.scrollTop,scrollX:r(),imageTimeout:200,ignoreElements:function(e){var t=e.tagName.toLowerCase();return t==="iframe"}}).then(function(t){e.screenshot=t.toDataURL("image/jpeg",.75),W(".screenshot-img img")[0].src=e.screenshot,document.body.removeChild(i)})},r.prototype.getNickname=function(){return haoUser&&haoUser.userInfo?haoUser.userInfo.nickname||haoUser.userInfo.username:""},r.prototype.sendFeedback=function(){if(this.postdata)return;this.postdata=!0;var e=this,t={nickname:this.getNickname(),cate_id:parseInt(this.cateId,10),content:W("#cube-feedback-msg")[0].value,img:this.sendScreenShot?this.screenshot:"",cube_id:this.cubeId};QW.Ajax.post("/api/feedback/add",JSON.stringify(t),function(t){try{t=JSON.parse(t),t.errno===0&&(e.close(),e.postdata=!1,LogHub&&LogHub.behavior("cube","feedback-success-"+e.cubeId))}catch(n){e.close(),e.postdata=!1}})},r.prototype.close=function(){e.hide(),W(".screenshot-img img").attr("src","https://hao2.qhimg.com/t0133f25778df020d4e.png"),e.query(".is-active").removeClass("is-active"),W("#cube-feedback-msg")[0].value="",W(".dialog-form .feedback-tips").hide(),W(".dialog-form .feedback-reason").hide(),W("#cube-feedback-msg").removeClass("cube-reason-border")},r.prototype.initEvt=function(){var t=this;e.delegate(".close","click",function(e){t.close()}),e.delegate(".feedback-type li","click",function(n){if(W(this).hasClass("is-active"))return;t.cateId=W(this).attr("cate-id"),e.query(".is-active").removeClass("is-active"),W(this).addClass("is-active")}),e.delegate(".screenshot .checkbox","click",function(e){e.preventDefault(),W(this).hasClass("checked")?(t.sendScreenShot=!1,W(this).removeClass("checked"),W(".screenshot-img").hide()):(t.sendScreenShot=!0,W(this).addClass("checked"),W(".screenshot-img").show())}),e.delegate(".dialog-submit","click",function(e){e.preventDefault();if(!t.cateId){W(".dialog-form .feedback-tips").setStyle({display:"inline-block"});return}if(!W("#cube-feedback-msg")[0].value){W(".dialog-form .feedback-tips").hide(),W(".dialog-form .feedback-reason").setStyle({display:"inline-block"}),W("#cube-feedback-msg").addClass("cube-reason-border");return}t.sendFeedback()})},window.CubeFeedBack=function(e){r.el?r.el.init(e):r.el=new r(e)}})();(function(){function e(e,t){this.tpl=e||"",this.replaceParams=t||[]}e.prototype={createThemeHtml:function(e){function r(e){var r={};return n.forEach(function(t){r[t]=e[t]}),t.tmpl(r)}if(!e)return;var t=this.tpl,n=this.replaceParams;if(Array.isArray(e)){var i=[];return e.forEach(function(e){i.push(r(e))}),i.join("")}return r(e)}},window.themeController?"":window.themeController={},window.themeController.HTMLMaker=e})();(function(){function e(e){this.options={},this.toggleProject=e.toggleProject,Object.defineProperty(this.options,"html",{configurable:!0,enumerable:!0,set:e.htmlSetFunction}),Object.defineProperty(this.options,"countHtml",{configurable:!0,enumerable:!0,set:e.countHtmlSetFunction}),this.options.html=e.html,this.options.countHtml=e.countHtml,e.fn&&e.fn()}e.prototype={togglePanel:function(){W(this.toggleProject.w).toggleClass(this.toggleProject.toggleClass[0],this.toggleProject.toggleClass[1]),qboot.events.fire("skin:panel:toggle",{$container:W(this.toggleProject.w),unExpandClass:this.toggleProject.toggleClass[0],expandClass:this.toggleProject.toggleClass[1],offsetHeight:242})}},window.themeController?"":window.themeController={},window.themeController.Panel=e})();(function(){function e(e){function r(){var e=[],t=Math.ceil(this.page_total/this.page_count);for(var r=0;r<t;r++)e.push(n.createThemeHtml({className:this.page===r?"list_active":"",index:r}));return e.join("")}this.html=e.main_data,this.countHtml="",this.page_total=e.page_total,this.page_count=e.page_count,this.page=e.page;var t=this;Object.defineProperty(this,"main_data",{enumerable:!0,get:function(){return e.html},set:function(n){e.html=n,t.html=n}}),Object.defineProperty(this,"page_count",{enumerable:!0,get:function(){return e.page_count},set:function(n){e.page_count=n,t.countHtml=r.call(t)}}),Object.defineProperty(this,"page",{enumerable:!0,get:function(){return e.page},set:function(n){e.page=n,t.countHtml=r.call(t)}}),Object.defineProperty(this,"page_total",{enumerable:!0,get:function(){return e.page_total},set:function(t){e.page_total=t}});var n=new window.themeController.HTMLMaker(e.countTpl,e.replaceParams);this.countHtml=r.call(this)}e.prototype={prev:function(){return this.page===0?!1:(this.page=this.page-1,!0)},next:function(){return this.page===Math.ceil(this.page_total/this.page_count)-1?!1:(this.page=this.page+1,!0)},jump:function(e,t){return t===this.page&&e===this.page_count?!1:(this.page=t,this.page_count=e,!0)}},window.themeController?"":window.themeController={},window.themeController.Slider=e})();(function(){function e(e){this.urls=[],this.current=e.current||"",this.container={},this.callback=e.callback||"",this.current&&this.load(this.current)}e.prototype={load:function(e){var t=this.urls.indexOf(e);if(t>-1)this.container[this.current].disabled=!0,this.container[e].disabled=!1,this.current=e;else{this.container[this.current]?this.container[this.current].disabled=!0:"";var n=document.createElement("link");n.href=e,n.setAttribute("rel","stylesheet"),n.setAttribute("type","text/css"),n.setAttribute("class","cssLoaderLink"),document.getElementsByTagName("head")[0].appendChild(n),this.urls.push(e),this.container[e]=n,this.current=e}this.callback&&this.callback(e)}},window.themeController?"":window.themeController={},window.themeController.CssLoader=e})();(function(){function e(e){this.address=e}e.prototype.log=function(e,t){var n={type:t,act:"settheme",tname:e,guid:qboot.cookie.get("__guid")},r=this.address+"?"+qboot.encodeURIJson(n);window.LogSender&&window.LogSender(r)},window.themeController?"":window.themeController={},window.themeController.ThemeMonitor=e})();(function(){function e(e){function s(e){function t(e){n&&(n=!1,W(".theme_panel .theme_cover").delegate("li","click",function(t){var n=t.target.parentNode.getAttribute("data-key");e.changeClass(n),e.chooseTheme(n)}))}this.data=e,t(this)}function o(e){this.themeTpls=[]}function u(e,t){var n=!1,r=qboot.when.defer();i.forEach(function(r,i){r.page===t&&r.page_count===e&&(n=i.toString())});if(n)return r.resolve(i[n].info),r.promise;var s={start:e*t,end:e*(t+1),page:t,page_count:e},o={c:"theme",a:"index",tag:"yulemingxing",bgn:s.start,cnt:s.end-s.start,ver:HAO_CONFIG.themeConfig.v,fmt:"jsonp",dst_ver:THEME_CONF.DSTVER};DEBUG&&(o.debug=1);var u=HAO_CONFIG.themeConfig.cdn_host+"index.php?"+qboot.encodeURIJson(o);return qboot.jsonp(u,function(n){i.push({page:t,page_count:e,info:n}),r.resolve(n)}),r.promise}function a(e){return e?HAO_CONFIG.themeConfig.cdn_host+"index.php?"+qboot.encodeURIJson({c:"theme",a:"css",key:e,ver:HAO_CONFIG.themeConfig.v,dst_ver:THEME_CONF.DSTVER}):""}function f(e,t,n){var r=Math.ceil(n/t)-1;if(e===0)return r;if(e===r)return 0}function l(e){var t=new Date(e.startTime.replace(/-/g,"/")),n=new Date(e.endTime.replace(/-/g,"/")),r=location.href.queryUrl("previewTime"),i=r?new Date(r):hao360.todayObj;if(t>i||n<i)return;var s=new AppData("api.hao.360.cn");if(s.get("forceThemeClose")===e.themeName)return;return e.themeName}function S(){this.lock=!1}this.themeStatus={isUsed:!1};var t=this,n=!0,r=[],i=[];s.prototype={changeClass:function(e){W(".theme_panel .theme_cover .is-active").removeClass("is-active");var t=W(".theme_panel li [data-key="+e+"]");e===(new AppData("api.hao.360.cn")).get("cubeUserTheme")?t.removeClass("is-active"):t.addClass("is-active")},chooseTheme:function(e){var t=(new AppData("api.hao.360.cn")).get("cubeUserTheme"),n=t===e,r=e;n?r="":b.log(r,"panel"),(new AppData("api.hao.360.cn")).set("cubeUserTheme",r),m.load(a(r))}},o.prototype.getSingleThemeList=function(e,t,n){var e=e||[],r=e.length||n,i=t*n,o=(new AppData("api.hao.360.cn")).get("cubeUserTheme"),u=[];for(var a=0+i;a<r+i;a++)this.themeTpls[a]||(this.themeTpls[a]=new s(e[a-i])),this.themeTpls[a].data.className=o===this.themeTpls[a].data.keyword?"is-active":"",u.push(g.createThemeHtml(this.themeTpls[a].data));return u.join("")};var c=window.themeController,h=new AppData("api.hao.360.cn"),p=h.get("cubeUserTheme")||l(forceThemeConfig),d=["<li>",'<a class="theme_item {$className}" title="{$author}" id="{$keyword}" data-key="{$keyword}">','<img src="{$cover}">','<p class="theme_cover_bg">{$hot_weight}\u4e07\u4eba\u4f7f\u7528</p>','<p class="theme_title">{$name}</p>',"</a>","</li>"].join(""),v=["cover","hot_weight","name","author","className","keyword"],m=new c.CssLoader({current:a(p),callback:function(n){n?(t.themeStatus.isUsed=!0,e.turnon&&e.turnon()):(t.themeStatus.isUsed=!1,e.turnoff&&e.turnoff())}}),g=new c.HTMLMaker(d,v),y=new o,b=new c.ThemeMonitor("https://s.360.cn/wzdh/theme2013.html"),w,E=new c.Panel({html:"",countHtml:"",toggleProject:{w:".theme_panel",toggleClass:["theme_col","theme_expand"]},htmlSetFunction:function(e){if(e){var t=W(".theme_panel .theme_cover [data-isActive=true]").html(),n=e.replace("is-active","");HtmlIndexOf=r.indexOf(n),t&&W(".theme_panel .theme_cover [data-isActive=true]").attr("data-isActive","false").fadeOut(200),HtmlIndexOf>-1?W(".theme_panel .theme_cover #PanelHtmlArray"+HtmlIndexOf+"").attr("data-isActive","true").fadeIn(200):(W(".theme_panel .theme_cover").appendChild(W('<div style="display:none;" id="PanelHtmlArray'+r.length+'">'+e+"</div>").attr("data-isActive","true").fadeIn(200)[0]),r.push(n))}},countHtmlSetFunction:function(e){W(".theme_panel .theme_list_count").html(e)}});p&&b.log(p,"use"),S.prototype.FirstFetchRender=function(){this.lock=!0;var e=hao360.screen.wide?9:7;u(e,0).then(function(t){w=new c.Slider({page:0,page_count:e,page_total:parseInt(t.data.theme_total)||0,main_data:"",countTpl:'<li class="{$className}" data-index="{$index}"></li>',replaceParams:["className","index"]}),E.options.countHtml=w.countHtml,E.options.html=y.getSingleThemeList(t.data.theme_data,0,w.page_count)})};var x=new S,T=function(){x.lock||(x.FirstFetchRender(),W("#toolbar-themetrigger").un("mouseenter",T).un("focus",T))};W("#toolbar-themetrigger").on("mouseenter",T).on("focus",T),W("#toolbar-themetrigger").on("click",function(){E.togglePanel()}),W(".theme_panel .theme_prev").on("click",function(e){var t=w.prev(),n=w.page,r=w.page_count,i=w.page_total;t||(w.page=f(n,r,i),n=w.page),E.options.countHtml=w.countHtml,u(r,n).then(function(e){E.options.html=y.getSingleThemeList(e.data.theme_data,n,r)})}),W(".theme_panel .theme_next").on("click",function(e){var t=w.next(),n=w.page,r=w.page_count,i=w.page_total;t||(w.page=f(n,r,i),n=w.page),E.options.countHtml=w.countHtml,u(r,n).then(function(e){E.options.html=y.getSingleThemeList(e.data.theme_data,n,r)})}),W(".theme_panel .theme_list_count").delegate("li","click",function(e){var t=parseInt(W(e.target).attr("data-index")),n=w.page_count,r=w.jump(n,t);r&&(E.options.countHtml=w.countHtml,u(n,t).then(function(e){E.options.html=y.getSingleThemeList(e.data.theme_data,t,n)}))}),W(window).on("resize",function(){var e=hao360.screen.wide?9:7;if(w&&e!==w.page_count){var t=w.jump(e,0);if(t){var n=w.page,r=w.page_count;E.options.countHtml=w.countHtml,u(r,0).then(function(e){E.options.html=y.getSingleThemeList(e.data.theme_data,n,r)})}}}),W(".theme_panel .theme_no").on("click",function(e){W(".theme_panel .theme_cover .is-active").removeClass("is-active");var t=new AppData("api.hao.360.cn");t.remove("cubeUserTheme"),l(forceThemeConfig)&&t.set("forceThemeClose",forceThemeConfig.themeName),m.load(a())}),W(".theme_panel .theme_collapse").on("click",function(){E.togglePanel()})}function t(){var t=new e({turnon:function(){qboot.events.fire("cubeThemeChange::use")},turnoff:function(){qboot.events.fire("cubeThemeChange::none")}});window.themeController.getStatus=function(){return t.themeStatus}}window.themeController.getStatus=function(){return{isUsed:!!(new AppData("api.hao.360.cn")).get("cubeUserTheme")}},t()})();(function(e){var t=new AppData("api.hao.360.cn");if(!e||t.get("left-float-animation"))return;var n,r=0,i=100,s=null,o=function(){var t=new Date(e.startTime.replace(/-/g,"/")),n=new Date(e.endTime.replace(/-/g,"/")),r=location.href.queryUrl("previewTime"),i=r?new Date(r):hao360.todayObj;if(t>i||n<i)return;c(),p()},u=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},a=function(){if(e.popover&&e.popover.length){var t=e.popover[r];r===e.popover.length-1?r=0:r+=1,e.popover.length>1&&!s&&d(),t.random=u(1,5);var n='<div class="popover type{random}"><div class="main-container"><img class="emoji" src={emoji} width="20" height="20" /><span class="overtext">{text}</span></div></div>';return R.tmpl(n,t)}},f=function(){return'<div class="catbox"><img class="cat" src="https://hao1.qhimg.com/t01f8ac527f8afc1f6f.png" width="90" height="70" /><img class="box" src="https://hao1.qhimg.com/t012c32d9538757160c.png" width="150" height="107" /></div>'},l=function(){setTimeout(function(){W("#left-float-animation .normal .popover").removeNode()},1e4)},c=function(){var t=e.top?e.top:231,r=["#left-float-animation{top:"+t+"px;display:block;position:fixed;right:50%;margin-right:500px;width:150px;height:210px;}.w-lg #left-float-animation{margin-right:585px;}#left-float-animation .hover{display:none;}#left-float-animation .animation-box:hover .hover{display:block;height:210px;}#left-float-animation .animation-box:hover .normal{display:none;}","#left-float-animation .popover{margin:0 auto;position:relative;width:144px;height:60px;background-size:144px 65px;background-repeat:no-repeat;animation: 0.5s linear alternate popslide;}","@keyframes popslide{from{transform:scale(0)}to{transform:scale(1)}}@-webkit-keyframes popslide{from{transform:scale(0)}to{transform:scale(1)}}","#left-float-animation .popover .main-container{width:124px;height:36px;position:absolute;top:5px;left:10px;line-height:36px;text-align:center;font-size:13px;overflow:hidden;}","#left-float-animation .popover .main-container .emoji{margin-bottom:2px;}","#left-float-animation .popover .main-container .overtext{color:#fff;margin-left:3px;}",'#left-float-animation .popover.type1{background-image:url("https://hao1.qhimg.com/t01db91bd19fd6a5fa6.png");}','#left-float-animation .popover.type2{background-image:url("https://hao1.qhimg.com/t017b4baab4aff68102.png");}','#left-float-animation .popover.type3{background-image:url("https://hao1.qhimg.com/t0181f86b15748dcd2c.png");}','#left-float-animation .popover.type4{background-image:url("https://hao1.qhimg.com/t01f205619bd7edb69c.png");}','#left-float-animation .popover.type5{background-image:url("https://hao1.qhimg.com/t01d672b8bae4c12b26.png");}',"#left-float-animation .catbox{width:150px;height:150px;position:absolute;top:60px;}","#left-float-animation .catbox .cat,#left-float-animation .catbox .box{position:absolute;}","#left-float-animation .catbox .cat{left:50%;transform:translate(-50%,0);top:-3px;animation:5s linear alternate infinite -3s catslide;}","@keyframes catslide{0%, 80%{top:-3px;}90%, 100%{top:-12px;}}@-webkit-keyframes catslide{0%, 80%{top:-3px;}90%, 100%{top:-12px;}}","#left-float-animation .catbox .box{bottom:0;left:4px;}","#left-float-animation .close-btn{position:absolute;right:0px;top:-15px;width:15px;height:15px;background:url(//hao3.qhimg.com/t01cb9d0a423affa804.png) no-repeat;}#left-float-animation .close-btn:hover{background-position:0 -15px;}"].join(""),i='<div id="left-float-animation"><a href="##" class="close-btn"></a><div class="animation-box"><a href="{link}" class="normal">'+a()+f()+'</a><a href="{link}" class="hover"><img src="https://hao1.qhimg.com/t016241270dd00cab2e.gif" width="150" height="200" /></a></div></div>';qboot.load.css(r),n=W(R.tmpl(i,e)),W("#doc-main-front").appendChild(n),l()},h=function(){LogHub.behavior("left_topfloat","show")},p=function(){W(document).receive("page-size-changed",function(e){var t=e.data.spaceWidth;t>i?(n.show(),h()):n.hide()}),Page.spaceWidth()>i?(n.show(),h()):n.hide(),W("#left-float-animation .hover").on("click",function(e){LogHub.behavior("left_topfloat","click")}),W("#left-float-animation .close-btn").on("click",function(e){e.preventDefault(),W("#left-float-animation").removeNode();var n=(new Date).format("YYYY-MM-dd")+" 23:59:59";t.set("left-float-animation",!0,(new Date(n)).getTime()),LogHub.behavior("left_topfloat","close")})},d=function(){s=setInterval(function(){W("#left-float-animation .normal").insertBefore(W(a()),W("#left-float-animation .normal .catbox")),l()},6e4)};o()})(leftTopFloatConfig);(function(e){var t,n=120,r=function(){if(!e)return;var t=new Date(e.startTime.replace(/-/g,"/")),n=new Date(e.endTime.replace(/-/g,"/")),r=location.href.queryUrl("previewTime"),i=r?new Date(r):hao360.todayObj;if(t>i||n<i)return;if(qboot.cookie.get("leftfloatclose"))return;o(),s()},i=function(){LogHub.behavior("left_float","show"),i=function(){}},s=function(){W(document).receive("page-size-changed",function(e){var r=e.data.spaceWidth;r>n?(t.show(),i()):t.hide()}),Page.spaceWidth()>n?(t.show(),i()):t.hide(),W("#left_float .link").on("click",function(e){LogHub.behavior("left_float","click")}),W("#left_float .close-btn").on("click",function(e){e.preventDefault(),W("#left_float").removeNode();var t=new Date;t.setDate(t.getDate()+1),qboot.cookie.set("leftfloatclose",1,{expires:new Date(t.format("YYYY/MM/dd"))}),LogHub.behavior("left_float","close")})},o=function(){var n="bottom: 35%; _top: 328px;";if(e.top)var n="top:"+e.top+"px;";var r="#left_float {display: block; position: fixed; _position: absolute; "+n+" right: 50%; margin-right: 500px; width: 90px}.w-lg #left_float{margin-right:585px;}#left_float .close-btn{position: absolute; right: 0px; top: -15px; width: 15px; height: 15px; background:url(//hao3.qhimg.com/t01cb9d0a423affa804.png) no-repeat; }#left_float .close-btn:hover{background-position:0 -15px;}";qboot.load.css(r);var i='<div id="left_float"><a href="##" class="close-btn"></a><a class="link" href="{link}"><img src="{img}" height="146" width="90" /></a></div>';t=W(R.tmpl(i,e)),W("#doc-main-front").appendChild(t)};r()})(leftFestivalConfig);(function(){function t(){var e=!1;if(hao360.is360ee()&&window.browser360eeFestivalControl&&browser360eeFestivalControl.isOn){var t=browser360eeFestivalControl,n=new Date(t.startTime.replace(/-/g,"/")),r=new Date(t.endTime.replace(/-/g,"/")),i=location.href.queryUrl("previewTime"),s=i?new Date(i):hao360.todayObj;s>=n&&s<r&&(e=!0)}return e}var e="festival_360ee_close";window.festival360ee={isClosed:t}})();(function(){if(window.festival360ee&&window.festival360ee.isClosed())return;var e={isOn:0,startTime:"",endTime:""},t={configs:Object.mix(topActivitySpreadConfig||{},e),$body:W("body"),$items:W("#top_activity_animate_spread .activity-item"),init:function(){return this.hitTest()?(this.renderHTML(),this.bindEvent(),this.hasInit=!0,!0):!1},hitTest:function(){var e=new Date(this.configs.startTime),t=new Date(this.configs.endTime),n=hao360.queryUrl(location.href,"previewTime")||hao360.todayObj;return this.hit=e<=new Date(n)&&t>=new Date(n)&&this.configs.isOn,this.hit},img2Webp:function(e){function i(e,t){var n=t.replace(r,".webp");return e.replace(t,n)}var t=hao360.webpSupport,n=[];t.lossless&&n.push("jpg","png"),t.animation&&n.push("gif");var r=new RegExp("\\.("+n.join("|")+")$","i");return e.replace(/<img.*?src="(.*?)".*?\/?>/g,i)},renderHTML:function(){var e=W("#top_activity_animate_spread"),t=W("#lazyload_top_activity_animate_spread").getValue();e.html(this.img2Webp(t))},bindEvent:function(){window.moniter&&moniter.setId(["top_activity_animate_spread"]);var e=W(".activity-main .button");e.hover(function(){e.css({transform:"translateY(-3px)"})},function(){e.css({transform:"translateY(0)"})}),this.onResize()},onResize:function(){var e=this,t=e.$body,n=t.hasClass("w-lg");W(window).on("resize",function(){if(t.hasClass("w-lg")===n)return;t.hasClass("w-lg")!==n&&(n=t.hasClass("w-lg"),n||(W(".activity-item img.small").css({display:"inline-block"}),W(".activity-item img.big").css({display:"none"})))})},wideScreenHandle:function(){var e=this;setTimeout(function(){W(".activity-item img.big").addClass("animated").css({display:"inline-block"}),W("#top_activity_animate_spread a.activity-main img.big").css({transition:"transform .2s ease"})},300)},pettyScreenHandle:function(){var e=this;setTimeout(function(){W(".activity-item img.small").addClass("animated").css({display:"inline-block"}),W("#top_activity_animate_spread a.activity-main img.small").css({transition:"transform .2s ease"})},300)},start:function(){var e=this;setTimeout(function(){W("#top_activity_animate_spread").css({height:"105px"}),W(".activity-main img").css({transform:"translateY(0)"}),e.$body.hasClass("w-lg")?e.wideScreenHandle():e.pettyScreenHandle()},0)},show:function(){var e=this;W("#top_activity_animate_spread").removeClass("transition").css({height:"105px"}),W(".activity-main img").removeClass("transition").css({transform:"translateY(0)"}),e.$body.hasClass("w-lg")?e.wideScreenShow():e.pettyScreenShow()},wideScreenShow:function(){W(".activity-item img.big").css({display:"inline-block"}),setTimeout(function(){W("#top_activity_animate_spread a.activity-main img.big").css({transition:"transform .2s ease"})},0)},pettyScreenShow:function(){W(".activity-item img.small").css({display:"inline-block"}),setTimeout(function(){W("#top_activity_animate_spread a.activity-main img.small").css({transition:"transform .2s ease"})},0)}},n=["openscreen:close","openscreen:hitclosed","openscreen:miss"];if(t.init())if(topActivitySpreadConfig.isChain)qboot.events.on(topActivitySpreadConfig.eventName+":start",function(e){t.start(),e.returnValue=!1});else for(var r=0,i=n.length;r<i;r++)(function(e){qboot.events.on(n[e],function(){t.start()})})(r)})();(function(){function t(){var t=function(){return Browser.ie==6};if(t()||!window.logoSkinConfig||!logoSkinConfig.isOn||!logoSkinConfig.options)return!1;var n=logoSkinConfig.options,r=hao360.queryUrl(location.href,"previewTime")||hao360.todayObj;for(var i=0;i<n.length;i++){var s=new Date(n[i].startTime),o=new Date(n[i].endTime);if(s<=new Date(r)&&new Date(r)<=o){e=n[i];break}}return e.url?!0:!1}function f(e){var t=e%2==0?"odd":"even";return['<div class="logoskin-item '+t+'">','<a class="ff logoskin-link" href="'+s+'"></a>','<span class="ff empty"></span>','<a class="ff logoskin-link" href="'+s+'"></a>','<span class="ff empty"></span>','<a class="ff logoskin-link" href="'+s+'"></a>',"</div>"].join("")}function l(){var e=['<div id="festival-logoskin">','<div id="logoskin-left" class="logoskin"></div>','<div id="logoskin-right" class="logoskin"></div>','<a class="close"></a>',"</div>"].join("");W(e).appendTo(W("#doc-bd-behind")[0])}function c(){var e=W("#logoskin-left"),t=W("#logoskin-right"),n="",r=Math.floor(Dom.getDocRect().scrollHeight/a);for(var i=0;i<r;i++)n+=f(i);W(n).appendTo(e[0]),W(n).appendTo(t[0])}function h(){l(),c()}function d(){var t=["#festival-logoskin{display:none;}",".logoskin{","position:absolute;","z-index:1;","overflow:hidden;","margin-top:40px;","}","#logoskin-left{left:0;}","#logoskin-right{right:0;}",".logoskin-item{","width:100%;","height:"+a+"px;","overflow:hidden;","min-width:160px;","}",".logoskin-item .ff{","display:block;","height:"+a+"px;","}",".logoskin-item .empty{","width:90px;","}",".logoskin-link{",'background-image:url("'+o+'");',"}","#logoskin-left .logoskin-item.odd .logoskin-link{","width:"+e.bigWidth+"px;","background-position:0 0;","}","#logoskin-left .logoskin-item.even .logoskin-link{","width:"+e.smallWidth+"px;","background-position:-"+e.bigWidth+"px 0;","}","#logoskin-right .logoskin-item.odd .logoskin-link{","width:"+e.bigWidth+"px;","background-position:0 -"+a*2+"px;","}","#logoskin-right .logoskin-item.even .logoskin-link{","width:"+e.smallWidth+"px;","background-position:-"+e.bigWidth+"px -"+a*2+"px;","}","#logoskin-left .logoskin-item.odd .logoskin-link:hover{","background-position:0 -"+a+"px;","}","#logoskin-left .logoskin-item.even .logoskin-link:hover{","background-position:-"+e.bigWidth+"px -"+a+"px;","}","#logoskin-right .logoskin-item.odd .logoskin-link:hover{","background-position:0 -"+a*3+"px;","}","#logoskin-right .logoskin-item.even .logoskin-link:hover{","background-position:-"+e.bigWidth+"px -"+a*3+"px;","}","#logoskin-left .ff{float:right;}","#logoskin-right .ff{float:left;}","#logoskin-left .malposition2{margin-right:0px;}","#logoskin-left .malposition1{display:none;}","#logoskin-left .malposition1+span{margin-right:-20px;}","#logoskin-right .malposition2{margin-left:0px;}","#logoskin-right .malposition1{display:none;}","#logoskin-right .malposition1+span{margin-left:-20px;}","#festival-logoskin .close{","position:fixed;","z-index:20;","width:32px;","height:32px;","top:230px;","right:20px;",'background-image:url("'+u+'");',"background-position:0 0;","}","#festival-logoskin .close:hover{","background-position:0 -32px;","}"].join("");p||(qboot.load.css(t),p=!0)}function v(){var e=W("#logoskin-left"),t=W("#logoskin-right"),n=Dom.getDocRect(),r=W("#doc-main-bd").getRect();e.css("width",r.left+"px"),t.css("width",n.width-r.right+"px"),W(".logoskin .logoskin-item.odd .logoskin-link:first-child").addClass("malposition1"),W(".logoskin .logoskin-item.even .logoskin-link:first-child").addClass("malposition2")}function m(){W("#festival-logoskin").show(),LogHub.behavior("festival-logoskin","show")}function g(){W("#festival-logoskin").hide()}function y(){try{qboot.events.on("cubeThemeChange::none",function(){m()}),qboot.events.on("cubeThemeChange::use",function(){g()})}catch(e){}W(document).delegate("#festival-logoskin .logoskin-link","click",function(e){LogHub.behavior("festival-logoskin","click")}),W(document).delegate("#festival-logoskin .close","click",function(e){e.preventDefault(),W("#festival-logoskin").hide(),LogHub.behavior("festival-logoskin","close"),n()}),W(window).on("resize",function(){v()})}function b(){d(),h(),v(),y()}var e={};if(!t())return;var n=function(){qboot.cookie.set(e.cookie,1,{expires:864e5})},r=function(){return qboot.cookie.get(e.cookie)};if(r())return;var i=function(e){return hao360.isHttps()?hao360.convertHttpToHttps(e):e},s=e.url,o=hao360.clipImage(i(e.imgUrl),{whq:"160_340_75",webp:!0}),u=hao360.clipImage(i("http://hao1.qhimg.com/t01e2fe9cb22dd63bfd.png"),{whq:"32_64_75",webp:!0}),a=e.imgHeight,p=!1;b(),themeController&&themeController.getStatus().isUsed===!1&&m()})();(function(){if(!window.festivalBalloonConfig||!festivalBalloonConfig.isOn)return;if(window.festival360ee&&window.festival360ee.isClosed())return;var e=festivalBalloonConfig.cookie,t=function(){qboot.cookie.set(e,1,{expires:864e5})},n=function(){return qboot.cookie.get(e)},r=function(){qboot.cookie.set(e+"_close",1,{expires:864e5})},i=function(){return qboot.cookie.get(e+"_close")},s=function(){var e=function(){var e=["","webkit-","Moz-","ms-","o-"];for(var t in e){var n=e[t]+"animation";if(n in document.documentElement.style)return!0}return!1}();if(!e)return!1;if(i())return!1;var t=new Date(festivalBalloonConfig.startTime),n=new Date(festivalBalloonConfig.endTime),r=hao360.queryUrl(location.href,"previewTime")||hao360.todayObj;return t>new Date(r)||new Date(r)>n?!1:!0};if(!s())return;var o=function(){return{closeBig:function(){LogHub.behavior("festival_balloon","close-big")},closeMini:function(){LogHub.behavior("festival_balloon","close-mini")},click:function(){LogHub.behavior("festival_balloon","click")},show:function(){LogHub.behavior("festival_balloon","show")}}}(),u=!1,a=function(){var e=Dom.getDocRect().height,t=[".festival_balloon{","visibility:hidden;","position:fixed;","top:0;","left:0;","z-index:310;","}",".festival_balloon .balloons li{","position:absolute;","cursor:pointer;","top:"+e+"px;","}",".festival_balloon .balloons li{","animation-name:flyUp;","animation-timing-function:linear;","animation-fill-mode:forwards;","animation-play-state:paused;","}",".festival_balloon .balloons li.spec_ball{","animation-name:specflyUp;","animation-delay:3.5s;","animation-duration:4s;","}",".festival_balloon.fly .balloons li{","animation-play-state:running;","}","@keyframes flyUp {","0% {","transform: translateY(0px);","}","100% {","transform: translateY(-"+(e+350)+"px);","}","}","@keyframes specflyUp {","0% {","transform: translateY(0px);","}","100% {","transform: translateY(-"+(e-200)+"px);","}","}",".festival_balloon .custom_ball .ball{","cursor:pointer;","transform: translateX(-10px);","animation: move 3s infinite;","}","@keyframes move {","0% {","transform: translateX(-10px);","}","50% {","transform: translateX(10px);","}","100% {","transform: translateX(-10px);","}","}",".festival_balloon .close{","position:fixed;","z-index:20;","width:32px;","height:32px;","top:230px;","right:20px;",'background-image:url("https://hao2.qhimg.com/t01e2fe9cb22dd63bfd.png");',"background-position:0 0;","}",".festival_balloon .close:hover{","background-position:0 -32px;","}",".festival_balloon .mini_close{","display:none;","position:absolute;","width:19px;","height:19px;","top:-10px;","left:110px;",'background-image:url("https://hao2.qhimg.com/t01c6e65fc09054ecfd.png");',"background-position:-19px 0;","}",".festival_balloon .mini_close:hover{","background-position:0 0;","}",".festival_balloon .spec_ball.act .ball{animation:hoverMove 3s ease-in-out infinite;}",".festival_balloon .spec_ball.act .pao,.festival_balloon .spec_ball.act .tao{animation:hoverRotate 3s ease-in-out infinite;}",".festival_balloon .spec_ball.act .pao{transform-origin:70px 126px;}",".festival_balloon .spec_ball.act .tao{transform-origin:62px 11px;}",".festival_balloon .spec_ball .pao{width:100px;position:absolute;top:0;left:0;}",".festival_balloon .spec_ball .rope{position:absolute;top:126px;left:45px;}",".festival_balloon .spec_ball .tao{position:absolute;top:246px;left:6px;}","@keyframes hoverMove {","0%,100%{transform:translateY(0);}","50%{transform:translateY(-20px);}","}","@keyframes hoverRotate {","0%,100%{transform:rotate(0deg);}","50%{transform:rotate(10deg);}","}"].join(""),n=['<div class="festival_balloon" id="festival_balloon">','<ul class="balloons"></ul>','<a class="close"></a>',"</div>"].join(""),r=['<li class="spec_ball">','<a class="ball" href="'+festivalBalloonConfig.url+'">','<img class="pao" src="'+festivalBalloonConfig.fixBalloon+'"></>',"</a>",'<a class="mini_close"></a>',"</li>"].join(""),i=W(n),s=i.query(".balloons"),o="",a=festivalBalloonConfig.ballImages;u||(qboot.load.css(t),u=!0);for(var f=0;f<a.length;f++)o+='<li class="custom_ball"><a href="'+festivalBalloonConfig.url+'"><img class="ball" src="'+hao360.convertHttpToHttps(a[f])+'"></a></li>';W(o).appendTo(s),W(r).appendTo(s),i.appendTo(W("#doc-view-front")[0])},f=function(){var e=W(".festival_balloon .custom_ball"),t=e.length,n=festivalBalloonConfig.duration/t,r=festivalBalloonConfig.style;for(var i=0;i<t;i++)e.item(i).css({"animation-delay":n*r[i].delay+"s","animation-duration":(Math.random()*.4+.6)*festivalBalloonConfig.duration+"s"}).query(".ball").css({width:r[i].width+"px","animation-delay":Math.random()*3+"s"})},l=function(){var e=festivalBalloonConfig.dense||!1,t=Dom.getDocRect().width-100,n=Dom.getDocRect().width-1170,r=W(".festival_balloon li"),i=r.length,s=parseInt(t/i),o=parseInt(1170/i);for(var u=0;u<i;u++){var a=e&&u<i-1?parseInt(o*u)+n/2:parseInt(s*u)+50;r.item(u).css({left:a+"px"})}},c=function(){var e=W(".festival_balloon");e.query(".custom_ball").hover(function(){W(this).css({"animation-play-state":"paused"})},function(){W(this).css({"animation-play-state":"running"})}),window.moniter&&moniter.setId(["festival_balloon"]),e.query(".ball").click(function(e){W(this).css({"animation-play-state":"running"}),o.click()}),e.query("li.spec_ball").on("animationend",function(){e.query(".close").hide(),e.query(".mini_close").show(),h&&qboot.events.fire("balloon:end")}).hover(function(){W(this).addClass("act")},function(){W(this).removeClass("act")}),e.query(".close").click(function(t){t.preventDefault(),e.hide(),o.closeBig(),r()}),e.query(".mini_close").click(function(t){t.preventDefault(),e.query(".spec_ball").hide(),o.closeMini(),r()}),W(window).on("resize",function(){l()})},h,p=!1,d=function(e){if(p)return;p=!0,setTimeout(function(){n()?(h=!1,W(".festival_balloon").query(".custom_ball").hide(),W(".festival_balloon").query(".close").hide(),W(".festival_balloon").query(".spec_ball").css({"animation-delay":"0s"})):(h=!0,t()),W(".festival_balloon").css("visibility","visible").addClass("fly"),o.show()},e)},v=function(){a(),f(),l(),c(),qboot.events.on("openscreen:close",function(){d(0)}),qboot.events.on("openscreen:hitclosed",function(){d(0)}),qboot.events.on("openscreen:miss",function(){d(0)})};v()})();(function(){if(!window.cangbaoRedbagConfig||!cangbaoRedbagConfig.isOn){qboot.events.fire("cangbaoredbag:miss");return}if(window.festival360ee&&window.festival360ee.isClosed())return;var e=function(e,t){var n=new Date(e),r=new Date(t),i=hao360.queryUrl(location.href,"previewTime")||hao360.todayObj;return n>new Date(i)||new Date(i)>r?!1:!0},t=function(){var t=function(){var e=["","webkit-","Moz-","ms-","o-"];for(var t in e){var n=e[t]+"animation";if(n in document.documentElement.style)return!0}return!1}();return t?e(cangbaoRedbagConfig.startTime,cangbaoRedbagConfig.endTime):!1};if(!t()){qboot.events.fire("cangbaoredbag:miss");return}var n=function(){var e=cangbaoRedbagConfig.cookie;return{markShow:function(){var t=(new Date).getTime(),n=(new Date(cangbaoRedbagConfig.rainEndTime)).getTime(),r=n-t;qboot.cookie.set(e+"_show",1,{expires:r})},checkShow:function(){return qboot.cookie.get(e+"_show")},markClick:function(t){qboot.cookie.set(e+"_click_"+t,1,{expires:864e5})},checkClick:function(t){return qboot.cookie.get(e+"_click_"+t)}}}(),r=function(){return{closeMain:function(){LogHub.behavior("cangbao_redbag","close-main")},clickMain:function(){LogHub.behavior("cangbao_redbag","click_main")},show:function(){LogHub.behavior("cangbao_redbag","show")}}}();(function(){var e=0,t=["webkit","moz"];for(var n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t){var n=(new Date).getTime(),r=Math.max(0,16-(n-e)),i=window.setTimeout(function(){t(n+r)},r);return e=n+r,i},window.cancelAnimationFrame=function(e){clearTimeout(e)})})();var i=function(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return!0;return!1},s=function(e){return qboot.createEvents(this),this.options=e||{},this.key=this.options.key,this.cid=this.options.cid,this.type=this.options.type,this.url=this.options.url,this.rainRedbag=this.options.rainRedbag,this.fixRedbag=this.options.fixRedbag,this.position=this.options.position,this.initScale=this.options.initScale,this.fixScale=this.options.fixScale,this.fixRotate=this.options.fixRotate||"-30deg",this.duration=this.options.duration,this.delay=this.options.delay,this.positionEffect=this.options.positionEffect||!1,this.effectTarget=this.options.effectTarget||"",this.stopTimeout=this.options.stopTimeout,this.stopTime=this.options.stopTime,this.container=W(this.options.container),this.refContainer=W("#"+this.cid),this.refContainerEffectRect=this.refContainer.getRect(),this.effectContainerMap={},this.$dom=null,this.init(),this};s.prototype.constructor=s,s.prototype.init=function(){if(this.type!=1&&!this.refContainer[0])return;if(n.checkClick(this.cid))return;this.insert(),this.setLog(),this.adjustFixPosition(),this.bindEvt()},s.prototype.buildFragment=function(){var e=o.isRainy,t=this.type==1||this.type==2,n=this.type==1,r=this.fixScale>.7?"big":"small",i=this.cid?' id="redbag-'+this.cid+'"':"";return['<div class="cangbao-item '+this.key+'"'+i+">",t&&e?'<a class="rain-redbag" href="'+this.url+'">':"",t&&e?'<div class="ani-box"><img src="'+this.rainRedbag+'"></div>':"",t&&e?"</a>":"",n?"":'<a class="fix-redbag pos-'+this.position+" "+r+'" href="'+this.url+'">',n?"":'<div class="ani-box"><img src="'+this.fixRedbag+'"></div>',n?"":"</a>","</div>"].join("")},s.prototype.insert=function(){var e=this.buildFragment();this.$dom=W(e),this.$dom.appendTo(this.container)},s.prototype.fixPosition=function(e,t,n){if(!e[0])return;var r=W("#browser360-tips").getRect(),i=r?r.height:0;switch(this.position){case"right":e.css({padding:"25px 0",left:t.left+t.width+"px",top:t.top-i+n+300+"px"}),e.query("img").css({"transform-origin":"0 0"});break;case"left":e.css({padding:"25px 0",left:t.left+"px",top:t.top-i+n+"px",transform:"translateX(-100%)"}),e.query("img").css({"transform-origin":"0 0"});break;case"topleft":e.css({"padding-right":"30px",left:t.left-5+"px",top:t.top-i+n+"px",transform:"translateY(-100%)"}),e.query("img").css({"transform-origin":"100% 0"});break;case"topright":e.css({"padding-right":"30px",left:t.left+t.width-100+"px",top:t.top-i+n+"px",transform:"translateY(-100%)"}),e.query("img").css({"transform-origin":"100% 0"})}e.query("img").css({transform:"scale("+this.fixScale+") rotate("+this.fixRotate+")"})},s.prototype.adjustFixPosition=function(){var e=this.$dom.query(".fix-redbag"),t=this.refContainer.getRect();this.fixPosition(e,t,0)},s.prototype.effectAdjustFixPosition=function(e){function c(e){var n=r.getRect(),i=0;for(var s in t.effectContainerMap)i+=t.effectContainerMap[s].getRect().height;t.fixPosition(u,a,i),f&&n.height>=o||!f&&n.height<=0?window.cancelAnimationFrame(l):window.requestAnimationFrame(c)}var t=this,n=e.eventName,r=e.$container,s=e.expandClass,o=e.offsetHeight,u=t.$dom.query(".fix-redbag"),a=this.refContainer.getRect(),f=e.isExpand||r.hasClass(s);if(!t.positionEffect||t.effectTarget&&!i(t.effectTarget,n))return;t.effectContainerMap[n]=r,a.top=t.refContainerEffectRect.top;var l=window.requestAnimationFrame(c)},s.prototype.closeRain=function(){var e=this.$dom.query(".rain-redbag");e&&e.css("animation-play-state","paused").hide(),W("#cangbao_redbags .close").hide(),this.type==2&&this.showFix()},s.prototype.bindEvt=function(){var e=this.$dom.query(".fix-redbag"),t=this.$dom.query(".rain-redbag"),r=this;t[0]&&t.on("animationend",function(){t.addClass("hide"),r.showFix(1e3)}),t[0]&&t.hover(function(){r.rainRedbagAnimationPause(t)},function(){r.rainRedbagAnimationRunning(t)}),e[0]&&e.once("click",function(){e.hide(),n.markClick(r.cid)}),W(window).on("scroll",function(n){if(e[0]){var i=70,s=90,o=Dom.getDocRect().scrollY;if(o>i){var u=e.getRect().top-o-s;e.css("opacity",u<0?"0":"1")}else e.css("opacity","1")}r.type==2&&t[0]&&t[0].style.display!="none"&&r.computeRainToFix()}),e[0]&&qboot.events.on("skin:panel:toggle",function(e){r.effectAdjustFixPosition({eventName:"skin:panel:toggle",$container:e.$container,unExpandClass:e.unExpandClass,expandClass:e.expandClass,offsetHeight:e.offsetHeight})}),e[0]&&qboot.events.on("topActivityNav:animate:start",function(e){r.effectAdjustFixPosition({eventName:"topActivityNav:animate:start",$container:e.$container,unExpandClass:e.unExpandClass,expandClass:e.expandClass,offsetHeight:e.offsetHeight})}),e[0]&&qboot.events.on("sohotword:close",function(){r.adjustFixPosition()}),W(window).on("resize",function(){r.adjustFixPosition()}),this.type==3&&new visibleDetector(this.refContainer[0],{threshold:-Dom.getDocRect().height/10,onentervisible:function(){r.showFix()}}),qboot.events.on("cangbaoredbag:rain",function(){setTimeout(function(){r.initRainAnimation()},500)}),qboot.events.on("cangbaoredbag:norain",function(){r.closeRain()}),qboot.events.on("cangbaoredbag:close",function(){r.closeRain()}),qboot.events.on("topfullcolumn:done",function(){W("#cangbao_redbags").css({top:"-50px"}),r.adjustFixPosition()}),qboot.events.on("topfullcolumn:close",function(){W("#cangbao_redbags").css({top:"0"}),r.adjustFixPosition()}),qboot.events.on("topnav:done",function(){W("#cangbao_redbags").css({top:"-60px"}),r.effectAdjustFixPosition({eventName:"topnav:done",$container:W("#top-nav"),isExpand:!0,offsetHeight:60})}),qboot.events.on("topnav:close",function(){W("#cangbao_redbags").css({top:"0"}),r.effectAdjustFixPosition({eventName:"topnav:close",$container:W("#top-nav"),isExpand:!1,offsetHeight:60})}),qboot.events.on("cangbaoredbag:end",function(){W("#cangbao_redbags .close").hide()})},s.prototype.setLog=function(){window.moniter&&this.cid&&moniter.setId(["redbag-"+this.cid])},s.prototype.showFix=function(e){var t=this.$dom.query(".fix-redbag"),n=this.$dom.query(".rain-redbag"),r=function(){t[0]&&t.css("visibility","visible").addClass("show"),n[0]&&n.hide()};e?setTimeout(r,e):r()},s.prototype.computeRainToFix=function(){var e=this.$dom.query(".rain-redbag"),t=this.$dom.query(".fix-redbag").getRect(),n="rainDown"+this.key,r,i,s=.2;this.position=="left"?(r=t.top+7,i=t.left+t.width):(r=t.top+t.height+7,i=t.left);var o=["@keyframes "+n+"{","0% {transform: translate(0, 0) scale(1)}","100% {transform: translate(0, "+r+"px) scale("+s+")}","}"].join("");qboot.load.css(o),e[0]&&e.css({left:i+"px","animation-name":n,"animation-delay":this.delay+"s","animation-duration":this.duration+"s"})},s.prototype.initRainAnimation=function(){var e=this,t=this.$dom.query(".rain-redbag"),n=this.$dom.query(".fix-redbag").getRect();if(this.type==1){t.css({left:this.options.left+"px","animation-name":"rainDown","animation-delay":this.delay+"s","animation-duration":this.duration+"s"}),this.rain(),e.stopTimeout&&e.stopTime&&(e.rainRedbagStopTimeoutId=setTimeout(function(){e.rainRedbagAnimationPause(t),e.rainRedbagStopTimeId=setTimeout(function(){e.rainRedbagAnimationRunning(t)},e.stopTime)},e.stopTimeout));return}this.computeRainToFix(),this.rain()},s.prototype.rain=function(){var e=this.$dom.query(".rain-redbag");e.query(".ani-box").css({"animation-duration":Math.random()+3.5+"s"}),e.show().addClass("fly")},s.prototype.rainRedbagAnimationPause=function(e){clearTimeout(this.rainRedbagStopTimeoutId),clearTimeout(this.rainRedbagStopTimeId),e.css({"animation-play-state":"paused"})},s.prototype.rainRedbagAnimationRunning=function(e){e.css({"animation-play-state":"running"})};var o={rainClick:0,isRainy:function(){return e(cangbaoRedbagConfig.rainStartTime,cangbaoRedbagConfig.rainEndTime)?n.checkShow()?!1:!0:!1}(),init:function(){this.configImg2Webp();var e=Dom.getDocRect().height,t=['<div class="cangbao_redbags" id="cangbao_redbags">','<div class="redbags-list"></div>','<a class="close"></a>',"</div>"].join(""),n=hao360.clipImage("https://hao2.qhimg.com/t01ca1ab255b464561b.png",{whq:"150_95_75",webp:!0}),r=["#cangbao_redbags{","visibility:hidden;","position:absolute;","top:0;","left:0;","width:100%;","z-index:98;","}","#cangbao_redbags .rain-redbag{","display:none;","position:absolute;","cursor:pointer;","top:-250px;","transform-origin:0 100%;","animation-name: rainDown;","animation-timing-function:linear;","animation-fill-mode:both;","}","#cangbao_redbags .rain-redbag.fly .ani-box{","overflow:hidden;","cursor:pointer;","transform: translateX(-10px);","animation: move 3s ease-in-out infinite;","}","#cangbao_redbags .rain-redbag img{","cursor:pointer;","transform: translateY(0) scale(0.8);","}","#cangbao_redbags .rain-redbag.fly.hide img{","transition:all 1.3s;","transform: translateY(100%) scale(0.8);","}","@keyframes rainDown {","0% {","transform: translateY(0px);","}","100% {","transform: translateY("+(e+350)+"px);","}","}","@keyframes move {","0% {","transform: translateX(-10px);","}","50% {","transform: translateX(10px);","}","100% {","transform: translateX(-10px);","}","}","#cangbao_redbags .fix-redbag{","position:absolute;","visibility:hidden;","overflow:hidden;","cursor:pointer;","}","#cangbao_redbags .fix-redbag.show{","transition:width 1s,height 1s;","}","#cangbao_redbags .fix-redbag.pos-topleft,#cangbao_redbags .fix-redbag.pos-topright{","height:30px;","}","#cangbao_redbags .fix-redbag.pos-left, #cangbao_redbags .fix-redbag.pos-right{","width:30px;","}","#cangbao_redbags .fix-redbag.small.pos-topleft,#cangbao_redbags .fix-redbag.small.pos-topright{","height:20px;","}","#cangbao_redbags .fix-redbag.small.pos-left, #cangbao_redbags .fix-redbag.small.pos-right{","width:20px;","}","#cangbao_redbags .fix-redbag.pos-topleft .ani-box,#cangbao_redbags .fix-redbag.pos-topright .ani-box{","transform: translate(0,120%);","transition: all 1.5s ease;","}","#cangbao_redbags .fix-redbag.pos-left .ani-box{","transform: translate(120%,0);","transition: all 1.5s ease;","}","#cangbao_redbags .fix-redbag.pos-right .ani-box{","transform: translate(-220%,0);","transition: all 1.5s ease;","}","#cangbao_redbags .fix-redbag.show .ani-box{","transform: translate(0,0);","}","#cangbao_redbags .fix-redbag.show.pos-topleft:hover,#cangbao_redbags .fix-redbag.show.pos-topright:hover{","height:55px;","}","#cangbao_redbags .fix-redbag.show.pos-left:hover, #cangbao_redbags .fix-redbag.show.pos-right:hover{","width:55px;","}","#cangbao_redbags .fix-redbag.show.small.pos-topleft:hover,#cangbao_redbags .fix-redbag.show.small.pos-topright:hover{","height:40px;","}","#cangbao_redbags .fix-redbag.show.small.pos-left:hover, #cangbao_redbags .fix-redbag.show.small.pos-right:hover{","width:40px;","}","#cangbao_redbags .fix-redbag.show.pos-right:hover .ani-box{","transform: translate(50%,0);","}","#cangbao_redbags .close{","display:none;","position:fixed;","z-index:20;","width:150px;","height:40px;","left:50%;","transform:translate(-50%, 0);","bottom:40px;",'background-image:url("'+n+'");',"background-position:0 -55px;","}","#cangbao_redbags .close:hover{","background-position:0 0;","}"].join("");qboot.load.css(r),W(t).appendTo(W("#doc-view-front")[0])},insert:function(){var e=cangbaoRedbagConfig.positions,t=cangbaoRedbagConfig.rainRedbag,n=t.length,r=cangbaoRedbagConfig.count,i=7/r,u=[3,2,1,2.7,1.5,0,2.3,1.6],a=0;for(var f=0;f<e.length;f++)e[f].animate&&a++,new s({key:"cangbao_redbag"+f,cid:e[f].cid||"",container:"#cangbao_redbags .redbags-list",type:e[f].animate?2:3,url:cangbaoRedbagConfig.url,rainRedbag:t[f%n],initScale:.8,fixRedbag:cangbaoRedbagConfig.fixRedbag,position:e[f].position||"left",fixScale:e[f].scale||1,fixRotate:e[f].rotate||"-30deg",duration:(Math.random()*.4+.6)*cangbaoRedbagConfig.duration,delay:i*u[f%u.length],positionEffect:e[f].positionEffect,effectTarget:e[f].effectTarget});if(!o.isRainy)return;var l=W(W(".rain-redbag")[0]).getRect().left,c=Dom.getDocRect().width,h=parseInt(c/r);for(var p=0;p<r-a;p++)new s({key:"cangbao_rainbag"+p,container:"#cangbao_redbags .redbags-list",type:1,left:l+h,url:cangbaoRedbagConfig.url,rainRedbag:t[p%n],initScale:Math.random()*.5+.5,fixRedbag:cangbaoRedbagConfig.fixRedbag,duration:(Math.random()*.4+.6)*cangbaoRedbagConfig.duration,delay:i*u[p%u.length]}),l+=h},bindEvt:function(){var e=W("#cangbao_redbags");e.query(".close").click(function(e){e.preventDefault(),r.closeMain(),qboot.events.fire("cangbaoredbag:close")}),e.delegate(".rain-redbag","click",function(){o.rainClick++,r.clickMain()});var t=5,n=e.query("div[class*=cangbao_rainbag]");n.on("animationend",function(){t++,!o.rainClick&&t===n.length?(o.rainClick=1,o.appendOne(Dom.getDocRect().width/2-100,cangbaoRedbagConfig.lastRedbag||cangbaoRedbagConfig.rainRedbag[0],1)):t===n.length&&qboot.events.fire("cangbaoredbag:end")}),W("#cangbao_redbags").delegate("#redbag-last","animationend",function(){qboot.events.fire("cangbaoredbag:end")})},show:function(e){W("#cangbao_redbags").css("visibility","visible"),e?(W("#cangbao_redbags .close").show(),qboot.events.fire("cangbaoredbag:rain")):qboot.events.fire("cangbaoredbag:norain")},appendOne:function(e,t,n){var r=W("#cangbao_redbags").query("div[class*=cangbao_rainbag]").length;(new s({key:"cangbao_rainbag"+r,container:"#cangbao_redbags .redbags-list",type:1,cid:"last",left:e,url:cangbaoRedbagConfig.url,rainRedbag:t,initScale:Math.random()*.5+.5,duration:8,delay:0,stopTimeout:cangbaoRedbagConfig.lastRedbagStopTimeout,stopTime:cangbaoRedbagConfig.lastRedbagStopTime})).initRainAnimation()},configImg2Webp:function(){for(var e=0,t=cangbaoRedbagConfig.rainRedbag.length;e<t;e++)cangbaoRedbagConfig.rainRedbag[e]=hao360.clipImage(cangbaoRedbagConfig.rainRedbag[e],{whq:"173_243_75",webp:!0});cangbaoRedbagConfig.fixRedbag=hao360.clipImage(cangbaoRedbagConfig.fixRedbag,{whq:"46_64_75",webp:!0}),cangbaoRedbagConfig.lastRedbag=hao360.clipImage(cangbaoRedbagConfig.lastRedbag,{whq:"220_320_75",webp:!0})}},u=function(){o.init(),o.insert(),o.bindEvt();var e=function(e){setTimeout(function(){o.isRainy?(n.markShow(),r.show(),o.show(!0)):o.show(!1)},e)};qboot.events.on("openscreen:close",function(){e(0)}),qboot.events.on("openscreen:hitclosed",function(){e(0)}),qboot.events.on("openscreen:miss",function(){e(0)})};u()})();(function(){function n(e){return e===0?0:e===1?1:Math.pow(2,-10*e)*Math.sin((e*10-.75)*2*Math.PI/3)+1}function r(e,t,n){var r=Date.now();(function i(){var s=(Date.now()-r)/t;s>1?e(1):(requestAnimationFrame(i),e(n(s)))})()}function i(e){var t=e.length;for(var n=t-1;n>=0;n--){var r=Math.floor(Math.random()*(n+1)),i=e[r];e[r]=e[n],e[n]=i}return e}function s(e,t){return Math.floor(Math.random()*(t-e))+e}if(window.festival360ee&&window.festival360ee.isClosed())return;(function(){var e=0,t=["webkit","moz"];for(var n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t){var n=(new Date).getTime(),r=Math.max(0,16-(n-e)),i=window.setTimeout(function(){t(n+r)},r);return e=n+r,i},window.cancelAnimationFrame=function(e){clearTimeout(e)})})();var e=function(){function u(e,t){return 1-3*t+3*e}function a(e,t){return 3*t-6*e}function f(e){return 3*e}function l(e,t,n){return((u(t,n)*e+a(t,n))*e+f(t))*e}function c(e,t,n){return 3*u(t,n)*e*e+2*a(t,n)*e+f(t)}function h(e,t,i,s,o){var u,a,f=0;do a=t+(i-t)/2,u=l(a,s,o)-e,u>0?i=a:t=a;while(Math.abs(u)>n&&++f<r);return a}function p(t,n,r,i){for(var s=0;s<e;++s){var o=c(n,r,i);if(o===0)return n;var u=l(n,r,i)-t;n-=u/o}return n}function d(e){return e}function v(e,n,r,u){function v(n){var o=0,u=1,f=i-1;for(;u!==f&&a[u]<=n;++u)o+=s;--u;var l=(n-a[u])/(a[u+1]-a[u]),d=o+l*s,v=c(d,e,r);return v>=t?p(n,d,e,r):v===0?d:h(n,o,o+s,e,r)}if(0<=e&&e<=1&&0<=r&&r<=1){if(e===n&&r===u)return d;var a=o?new Float32Array(i):new Array(i);for(var f=0;f<i;++f)a[f]=l(f*s,e,r);return function(t){return t===0?0:t===1?1:l(v(t),n,u)}}throw new Error("bezier x values must be in [0, 1] range")}var e=4,t=.001,n=1e-7,r=10,i=11,s=1/(i-1),o=typeof Float32Array=="function";return v}(),t=function(){var e,t=!0,n=1;return{start:function(r,i,s,o){var u=this;if(!t)return;e=setInterval(function(){n>=r||t?(u.reset(),o&&o(n)):(s&&s(n),n++)},i),t=!1},abort:function(){t=!0},reset:function(){t=!0,n=1,clearInterval(e)}}}(),o=function(){function f(e){var t=this;t.stopFireworks=!1,t.hasInit=!1,t.configs=Object.mix(e||{},a)}var o="low",u="high",a={linkId:"#tmall-full-screen-link",containerId:"#tmall-full-screen",isOn:0,startTime:"",endTime:"",countDownSecond:8,link:"",level:Browser.ie&&Browser.ie<=9?o:u,closeCookie:"festival_tmall_full_screen"};return f.prototype.init=function(){var e=this.hitTest(),t=this.checkClose();if(e){qboot.events.fire("tmallFullScreen:hitTest");if(!t){var n=this.generateChainHandle();return this.attachContent(),this.getDOMHandle(),this.chain(n),this.bindEvent(),this.hasInit=!0,!0}return qboot.events.fire("tmallFullScreen:closed"),!1}return!1},f.prototype.hitTest=function(){var e=new Date(this.configs.startTime),t=new Date(this.configs.endTime),n=hao360.queryUrl(location.href,"previewTime")||hao360.todayObj;return this.hit=e<=new Date(n)&&t>=new Date(n)&&this.configs.isOn,this.hit},f.prototype.attachContent=function(){var e=['<a href="'+this.configs.link+'" id="tmall-full-screen-link" target="_blank">','<div class="mask"></div>','<img class="curtain animated animate-time-300 slideInUp" src="'+this.configs.bottomBanner+'"/>','<img class="cat animated animate-time-500 slideInLeft" src="'+this.configs.bottomleftImg+'"/>','<img class="cart animated animate-time-500 slideInRight" src="'+this.configs.bottomRightImg+'"/>','<div class="red-packet">','<img class="big-packet" src="'+this.configs.bigPacket+'"/>','<img class="open animated pulse infinite" src="'+this.configs.bigPacketButton+'"/>',"</div>",'<object><a href="javascript: void(0);" class="close animated fadeIn"></a></object>',"</a>"].join();W(this.configs.containerId).appendChild(W(e))},f.prototype.getDOMHandle=function(){var e=this;e.DOM=function(){var t=W(e.configs.containerId),n=W(e.configs.linkId);return{$container:t,$link:n,$cart:t.query(".cart"),$cat:t.query(".cat"),$redPacket:t.query(".red-packet"),$closeButton:t.query(".close")}}()},f.prototype.makeClose=function(){qboot.cookie.set(this.configs.closeCookie,1,{expires:864e5})},f.prototype.checkClose=function(){return qboot.cookie.get(this.configs.closeCookie)},f.prototype.generateHandle=function(e,t){var n=this;return{handle:function(){t&&t.call(n)},duration:e}},f.prototype.generateChainHandle=function(){var e=this.generateHandle(500,function(){this.DOM.$container.show(),this.DOM.$closeButton.show()}),t=this.generateHandle(500,function(){this.fireCatAndCartAnimate(),this.fireRedPacketFallAnimate()}),n=this.generateHandle(2e3,function(){this.fireworksAnimate()}),r=this.generateHandle(2500,function(){this.fireRedPacketRotateAnimate(),this.fireRandomFirework()}),i=this.generateHandle(0,function(){var e=this;e.countDown(e.configs.countDownSecond,function(e){},function(){e.clean()})}),s=this.configs.level,a={};return a[o]=[e,t,n,r,i],a[u]=[e,t,n,r,i],a[s]},f.prototype.start=function(){if(this.hasInit){this.execute(this.animateQueue);return}},f.prototype.bindEvent=function(){var e=this;e.DOM.$closeButton.on("click",function(t){t.preventDefault(),e.clean()}),e.DOM.$link.on("click",function(t){e.makeClose()})},f.prototype.chain=function(e){this.animateQueue=e,this.cacheDurationTime=0,this.queueCeased=!1},f.prototype.execute=function(e){if(e.length<=0)return;var t=this,n=e.shift(),r=t.cacheDurationTime;t.taskTimer=setTimeout(function(){t.queueCeased||(n.handle.call(t),t.cacheDurationTime=n.duration,t.execute(e))},r)},f.prototype.stop=function(e){this.queueCeased=!0,clearTimeout(this.taskTimer)},f.prototype.clean=function(e){if(this.hasCleaned)return;this.hasCleaned=!0,this.DOM.$container.removeNode(),this.stop(),this.makeClose(),qboot.events.fire("tmallFullScreen:close"),qboot.events.fire(tmallFullScreenConfig.eventName+":end"),t.abort()},f.prototype.transformCompatible=function(e){var t=e.transform;return{transform:t,webkitTransform:t,msTransform:t,MozTransform:t,OTransform:t}},f.prototype.fireRedPacketFallAnimate=function(){var t=this,n=164;t.DOM.$redPacket.show(),r(function(e){t.DOM.$redPacket.css(t.transformCompatible({transform:"translate(0, -"+100*(1-e)+"px) rotate("+n+"deg)"}))},300,e(1,1,0,0))},f.prototype.fireCatAndCartAnimate=function(){this.DOM.$cart.show(),this.DOM.$cat.show()},f.prototype.fireRedPacketRotateAnimate=function(){var e=this,t=164;r(function(n){e.DOM.$redPacket.css(e.transformCompatible({transform:"rotate("+t*(1-n)+"deg)"})),n===1&&(e.stopFireworks=!0)},2e3,n)},f.prototype.addSmallPacketProps=function(e,t){for(var n=0,r=e.length;n<r;n++)e[n].redPacketImage=t[n];return e},f.prototype.createFireworksAndRedPacketList=function(){var e=this.configs.link,t=this.addSmallPacketProps([{animateTime:"animate-time-800",top:26,left:30,width:121,height:120,image:"//hao3.qhimg.com/t018b7ae76ecc4c008e.png",href:e},{animateTime:"animate-time-800",top:13,left:20,width:111,height:111,image:"//hao3.qhimg.com/t014a3b869320ee519e.png",href:e},{animateTime:"animate-time-800",top:1,left:71,width:164,height:155,image:"//hao3.qhimg.com/t01e57dfd4eedc2660b.png",href:e},{animateTime:"animate-time-800",top:18,left:84,width:96,height:98,image:"//hao3.qhimg.com/t01915534338de7e4e1.png",href:e},{animateTime:"animate-time-800",top:30,left:61,width:293,height:291,image:"//hao3.qhimg.com/t01e3cd1822ccb90913.png",href:e},{animateTime:"animate-time-800",top:50,left:12,width:96,height:98,image:"//hao3.qhimg.com/t01915534338de7e4e1.png",href:e}],this.configs.smallPacket),n=['<a class="y1 animated {animateTime} zoomIn" href="{href}" style="top: {top}%;left: {left}%;width: {width}px;height: {height}px;background: url({image});z-index: 2;">','<img class="small-red-packet animated zoomIn" src="{redPacketImage}"/>',"</a>"].join(""),r=[];for(var i=0;i<t.length;i++)r.push(W(R.tmpl(n,t[i])));return r},f.prototype.fireworksAnimate=function(){var e=this,t=300,n=800,r=i(e.createFireworksAndRedPacketList());for(var s=0;s<r.length;s++)(function(i){var s=r[i];setTimeout(function(){e.DOM.$container.appendChild(s),s.show(),setTimeout(function(){s.css({background:"transparent"}),s.query(".small-red-packet").show()},n)},i*t)})(s)},f.prototype.createRandomFirework=function(){var e=[{width:293,height:273,image:"//hao3.qhimg.com/t01c281cb189d8f327b.png"},{width:162,height:161,image:"//hao3.qhimg.com/t01adf40fbe1e4cb672.png"},{width:96,height:98,image:"//hao3.qhimg.com/t01915534338de7e4e1.png"},{width:164,height:155,image:"//hao3.qhimg.com/t01f590dcdaf623f0be.png"},{width:292,height:291,image:"//hao3.qhimg.com/t015fde6a65da6e4e4b.png"}],t='<a class="y1 animated animate-time-800 zoomIn" style="position: absolute;top: {top}%;left: {left}%;width: {width}px;height: {height}px;background: url({image});background-repeat: no-repeat;"></a>',n=Object.mix({top:s(20,50),left:s(10,90)},e[s(0,4)]);return W(R.tmpl(t,n))},f.prototype.fireRandomFirework=function(){var e=this,t=800;if(e.stopFireworks)return;var n=e.createRandomFirework();e.DOM.$container.appendChild(n),n.show(),setTimeout(function(){n.removeNode(),e.fireRandomFirework()},t)},f.prototype.countDown=function(e,n,r){t.start(e,1e3,function(e){n&&n(e)},function(e){r&&r()})},f}(),u=["openscreen:close","openscreen:hitclosed","openscreen:miss"],a=new o(tmallFullScreenConfig);if(a.init())if(tmallFullScreenConfig.isChain)qboot.events.on(tmallFullScreenConfig.eventName+":start",function(e){a.start(),e.returnValue=!1});else for(var f=0,l=u.length;f<l;f++)qboot.events.on(u[f],function(){a.start()})})();(function(){function e(e,t,n){var e=new Date(e),t=new Date(t),r=hao360.queryUrl(location.href,"previewTime")||new Date;return e<=new Date(r)&&t>=new Date(r)&&n}function t(e,t){var n=null;return function(){var r=this,i=arguments;n&&clearTimeout(n),n=setTimeout(function(){e.apply(r,i)},t)}}function r(e,t){var n={},r=Object.getOwnPropertyNames(e).length,i=0;for(var s in e)(function(s){var o=new Image;o.src=e[s],o.onload=function(){n[s]=o,i++,i===r&&t(n)}})(s)}function i(e,t,n){this.element=e,this.canvas=t,this.ctx=n,this.offsetY=0,this.speed=6,this.a=.12,this.opacity=0}function s(e,t,n){this.element=e,this.canvas=t,this.ctx=n,this.opacity=0}function o(e,t,n,r,i){this.percentX=e,this.percentY=t,this.element=n,this.canvas=r,this.ctx=i}function u(e,t,n,r,i){this.percentX=e,this.percentY=t,this.offsetY=0,this.speed=10,this.a=.02,this.element=n,this.canvas=r,this.ctx=i,this.random=Math.floor(Math.random()*100)}function a(e,t,n){this.element=e,this.canvas=t,this.ctx=n,this.offsetY=0,this.speed=2,this.a=.06,this.animateCompleted=!1,this.hasShow=!1}function f(e,t,n){this.element=e,this.canvas=t,this.ctx=n,this.rotate=180}function l(e,t,n){this.element=e,this.canvas=t,this.ctx=n}function c(e,t,n,r){this.percentX=e,this.percentY=t,this.canvas=n,this.ctx=r,this.offsetY=0,this.speed=Math.floor(Math.random()*6)+4}function h(e,t,n,r){this.offsetY=0,this.element=e,this.button=t,this.canvas=n,this.ctx=r,this.animateCompleted=!1,this.buttonScale=1,this.isScale=!0}function p(e,t,n,r){this.percentX=e,this.percentY=t,this.radius=Math.random()*12,this.canvas=n,this.ctx=r}function d(e,t,n,r){var i=this;i.element=e,i.canvas=t,i.ctx=n,i.rainbowCat=r,i.opacity=1,i.bindEvent()}function v(e){this.config=e||{},this.$container=W("#rainbow-cat-screen"),this.completed=!1,this.running=!1}if(window.festival360ee&&window.festival360ee.isClosed())return;(function(){var e=0,t=["webkit","moz"];for(var n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t){var n=(new Date).getTime(),r=Math.max(0,16-(n-e)),i=window.setTimeout(function(){t(n+r)},r);return e=n+r,i},window.cancelAnimationFrame=function(e){clearTimeout(e)})})();var n=function(){var e={"bottom-cloud":"https://hao2.qhimg.com/t0147ef6d542822a00a.png",cat:"https://hao2.qhimg.com/t019f503bff5c70ed35.png","text-1":"https://hao3.qhimg.com/t01bba8457a561331ef.png","text-2":"https://hao1.qhimg.com/t01d860a66b71e604fb.png","cloud-left-1":"https://hao2.qhimg.com/t01620190e84dfff23f.png","cloud-left-2":"https://hao2.qhimg.com/t013c66c6ec8491cee6.png","cloud-left-3":"https://hao2.qhimg.com/t0125474449918c4bd4.png","cloud-left-4":"https://hao2.qhimg.com/t01620190e84dfff23f.png","cloud-right-1":"https://hao2.qhimg.com/t01e1087eca9cd697c2.png","cloud-right-2":"https://hao2.qhimg.com/t018b9b9b8a301af446.png","cloud-right-3":"https://hao2.qhimg.com/t0128cc283cbe9d4d0a.png","red-packet-1":"https://hao2.qhimg.com/t0122f668f2ba5d9b90.png","red-packet-2":"https://hao2.qhimg.com/t014cbb985cf471b8ca.png","red-packet-3":"https://hao2.qhimg.com/t015d8037699bc1a508.png","red-packet-4":"https://hao2.qhimg.com/t019acb631efe2527b0.png","red-packet-5":"https://hao2.qhimg.com/t0143f411d6aa8a5013.png","red-packet-6":"https://hao2.qhimg.com/t01a9e75dff41f0955a.png","red-packet-7":"https://hao2.qhimg.com/t01a9e75dff41f0955a.png","red-packet-8":"https://hao2.qhimg.com/t019acb631efe2527b0.png","red-packet-9":"https://hao2.qhimg.com/t015d8037699bc1a508.png","red-packet-10":"https://hao2.qhimg.com/t014cbb985cf471b8ca.png","red-packet-11":"https://hao2.qhimg.com/t0143f411d6aa8a5013.png",rainbow:"https://hao2.qhimg.com/t01e9f774c9bb21d4f5.png","big-packet":"https://hao2.qhimg.com/t0192575da2b9ff15ba.png","big-packet-button":"https://hao2.qhimg.com/t01c1c334b14ae55671.png","close-button":"https://hao2.qhimg.com/t01432dc6a08ce6e4c4.png"},t=hao360.webpSupport,n=[];t.lossless&&n.push("jpg","png"),t.animation&&n.push("gif");var r=new RegExp("\\.("+n.join("|")+")$","i");for(var i in e)e[i]=e[i].replace(r,".webp");return e}();i.prototype.getRect=function(e){return{width:this.canvasWidth*.2,height:this.canvasWidth*.2*e.height/e.width}},i.prototype.draw=function(){this.canvasWidth=this.canvas.width,this.canvasHeight=this.canvas.height,this.rect=this.getRect(this.element),this.x=(this.canvasWidth-this.rect.width)/2,this.y=this.canvasHeight*.3+this.offsetY,this.ctx.save(),this.ctx.globalAlpha=this.opacity,this.ctx.drawImage(this.element,this.x,this.y,this.rect.width,this.rect.height),this.ctx.restore()},i.prototype.show=function(){this.opacity<1&&(this.opacity+=.04),this.draw()},i.prototype.move=function(){this.y>-this.rect.height&&(this.offsetY-=this.speed,this.speed+=this.a,this.draw())},s.prototype.getRect=function(e){return{width:this.canvasWidth*.4,height:this.canvasWidth*.4*e.height/e.width}},s.prototype.draw=function(){this.canvasWidth=this.canvas.width,this.canvasHeight=this.canvas.height,this.rect=this.getRect(this.element),this.x=(this.canvasWidth-this.rect.width)/2,this.y=this.canvasHeight*.8,this.ctx.save(),this.ctx.globalAlpha=this.opacity,this.ctx.drawImage(this.element,this.x,this.y,this.rect.width,this.rect.height),this.ctx.restore()},s.prototype.show=function(){this.opacity<1&&(this.opacity+=.01),this.draw()},o.prototype.getRect=function(e){return{width:this.canvasWidth*.14,height:this.canvasWidth*.14*e.height/e.width}},o.prototype.draw=function(){this.canvasWidth=this.canvas.width,this.canvasHeight=this.canvas.height,this.rect=this.getRect(this.element),this.x=this.canvasWidth*this.percentX,this.y=this.canvasHeight*this.percentY,this.ctx.drawImage(this.element,this.x,this.y,this.rect.width,this.rect.height)},o.prototype.move=function(){this.draw()},u.prototype.getRect=function(e){return{width:this.canvasWidth*.07,height:this.canvasWidth*.07*e.height/e.width}},u.prototype.draw=function(){this.canvasWidth=this.canvas.width,this.canvasHeight=this.canvas.height,this.rect=this.getRect(this.element),this.x=this.canvasWidth*this.percentX,this.y=-this.rect.height-this.random+this.offsetY,this.maxY=this.canvasHeight*this.percentY,this.ctx.drawImage(this.element,this.x,this.y,this.rect.width,this.rect.height)},u.prototype.move=function(){this.y<this.maxY&&(this.offsetY+=this.speed,this.speed-=this.a),this.draw()},a.prototype.getRect=function(e){return{width:this.canvasWidth*.24,height:this.canvasWidth*.24*e.height/e.width}},a.prototype.draw=function(){this.canvasWidth=this.canvas.width,this.canvasHeight=this.canvas.height,this.rect=this.getRect(this.element),this.x=(this.canvasWidth-this.rect.width)/2,this.y=this.canvas.height+this.offsetY,this.ctx.drawImage(this.element,this.x,this.y,this.rect.width,this.rect.height)},a.prototype.move=function(){if(this.animateCompleted)return;this.y>-this.rect.height?(this.offsetY-=this.speed,this.speed+=this.a,this.draw(),this.offsetY<-(this.canvasHeight*.58)&&(this.hasShow=!0)):this.animateCompleted=!0},f.prototype.getRect=function(e){return{width:this.canvasWidth*.8,height:this.canvasWidth*.8*e.height/e.width}},f.prototype.draw=function(){this.canvasWidth=this.canvas.width,this.canvasHeight=this.canvas.height,this.rect=this.getRect(this.element),this.x=(this.canvasWidth-this.rect.width)/2,this.y=this.canvasHeight-this.rect.height,this.ctx.save(),this.ctx.translate(this.x+this.rect.width/2,this.y+this.rect.height*1.4),this.ctx.rotate(this.rotate*Math.PI/180),this.ctx.translate(-(this.x+this.rect.width/2),-(this.y+this.rect.height*1.4)),this.ctx.drawImage(this.element,this.x,this.y,this.rect.width,this.rect.height),this.ctx.restore()},f.prototype.move=function(){this.rotate<360&&(this.rotate+=2),this.draw()},l.prototype.getRect=function(e){return{width:this.canvasWidth,height:this.canvasWidth*e.height/e.width}},l.prototype.draw=function(){this.canvasWidth=this.canvas.width,this.canvasHeight=this.canvas.height,this.rect=this.getRect(this.element),this.ctx.drawImage(this.element,0,this.canvasHeight-this.rect.height,this.rect.width,this.rect.height)},c.prototype.draw=function(){this.canvasWidth=this.canvas.width,this.canvasHeight=this.canvas.height,this.x=this.canvasWidth*this.percentX,this.y=this.canvasHeight*this.percentY+this.offsetY;var e=this.ctx.createLinearGradient(this.x,this.y,this.x,this.y+50);e.addColorStop(1,"rgba(254, 239, 53, 1)"),e.addColorStop(0,"rgba(254, 239, 53, .2)"),this.ctx.beginPath(),this.ctx.strokeStyle=e,this.ctx.moveTo(this.x,this.y),this.ctx.lineTo(this.x,this.y+150),this.ctx.lineWidth=4,this.ctx.lineCap="round",this.ctx.stroke()},c.prototype.move=function(){this.y<this.canvasHeight&&(this.offsetY+=this.speed,this.draw())},h.prototype.getRect=function(e){return{width:this.canvasWidth*.24,height:this.canvasWidth*.24*e.height/e.width}},h.prototype.draw=function(){this.canvasWidth=this.canvas.width,this.canvasHeight=this.canvas.height,this.rect=this.getRect(this.element),this.x=(this.canvasWidth-this.rect.width)/2,this.y=-this.rect.height+this.offsetY,this.buttonX=(this.canvasWidth-this.rect.width*this.buttonScale)/2,this.buttonY=-(this.rect.height*this.buttonScale)+this.offsetY,this.maxY=this.canvasHeight*.16,this.ctx.drawImage(this.element,this.x,this.y,this.rect.width,this.rect.height),this.ctx.drawImage(this.button,this.buttonX,this.buttonY*this.buttonScale,this.rect.width*this.buttonScale,this.rect.height*this.buttonScale)},h.prototype.move=function(){if(this.y<this.maxY)this.offsetY+=6;else{this.animateCompleted=!0,this.isScale?this.buttonScale+=.003:this.buttonScale-=.003;if(this.buttonScale<1||this.buttonScale>1.08)this.isScale=!this.isScale}this.draw()},p.prototype.draw=function(){this.canvasWidth=this.canvas.width,this.canvasHeight=this.canvas.height,this.x=this.canvasWidth*this.percentX,this.y=this.canvasHeight*this.percentY,this.ctx.beginPath(),this.ctx.fillStyle="#ffffff",this.ctx.arc(this.x-this.radius,this.y-this.radius,this.radius,0,Math.PI/2),this.ctx.arc(this.x-this.radius,this.y+this.radius,this.radius,3*Math.PI/2,2*Math.PI),this.ctx.arc(this.x+this.radius,this.y+this.radius,this.radius,Math.PI,3*Math.PI/2),this.ctx.arc(this.x+this.radius,this.y-this.radius,this.radius,Math.PI/2,Math.PI),this.ctx.fill()},p.prototype.move=function(){this.radius>12&&(this.radius=1),this.radius+=.2,this.draw()},d.prototype.bindEvent=function(){var e=this;W(e.canvas).on("click",function(t){var n=e.getEventPosition(t);n.x>=e.x&&n.x<=e.x+e.element.width&&n.y>=e.y&&n.y<=e.y+e.element.height&&(t.preventDefault(),t.stopPropagation(),e.rainbowCat.close(),LogHub&&LogHub.behavior("festival_rainbowcat","close"))})},d.prototype.getEventPosition=function(e){var t,n;if(e.layerX||e.layerX==0)t=e.layerX,n=e.layerY;else if(e.offsetX||e.offsetX==0)t=e.offsetX,n=e.offsetY;return{x:t,y:n}},d.prototype.getRect=function(e){return{width:48,height:48*e.height/e.width}},d.prototype.draw=function(){this.canvasWidth=this.canvas.width,this.canvasHeight=this.canvas.height,this.rect=this.getRect(this.element),this.x=this.canvasWidth*.62,this.y=this.canvasHeight*.18,this.ctx.save(),this.ctx.globalAlpha=this.opacity,this.ctx.drawImage(this.element,this.x,this.y,this.rect.width,this.rect.height),this.ctx.restore()},d.prototype.show=function(){this.opacity<1&&(this.opacity+=.01),this.draw()},v.prototype.init=function(){var t=qboot.cookie.get(this.config.closeCookie);!t&&e(this.config.startTime,this.config.endTime,this.config.isOn)&&(this.insertDOM(),this.canvas=this.$container.query("#rainbow-cat-canvas")[0],this.ctx=this.canvas.getContext("2d"),this.canvasWidth=document.documentElement.clientWidth,this.canvasHeight=document.documentElement.clientHeight,this.canvas.width=this.canvasWidth,this.canvas.height=this.canvasHeight,this.bindEvent())},v.prototype.insertDOM=function(){var e=['<a id="rainbow-cat-link" href="'+this.config.url+'">','<div class="mask"></div>','<canvas id="rainbow-cat-canvas"></canvas>',"</a>"].join("");this.$container.appendChild(W(e))},v.prototype.bindEvent=function(){var e=this,n=this.config;n.isChain?qboot.events.on(n.eventName+":start",function(t){e.start(),t.returnValue=!1}):(qboot.events.on("openscreen:close",function(){e.start()}),qboot.events.on("openscreen:hitclosed",function(){e.start()}),qboot.events.on("openscreen:miss",function(){e.start()})),e.resize=t(e.resize,500),W(window).on("resize",function(){cancelAnimationFrame(e.timer),e.resize()})},v.prototype.resize=function(){var e=this;e.canvasWidth=document.documentElement.clientWidth,e.canvasHeight=document.documentElement.clientHeight,e.canvas.width=e.canvasWidth,e.canvas.height=e.canvasHeight,e.loop()},v.prototype.close=function(){this.$container.removeNode(),cancelAnimationFrame(this.timer),clearTimeout(this.countDownTimer),qboot.cookie.set(this.config.closeCookie,1,{expires:864e5}),qboot.events.fire(this.config.eventName+":end")},v.prototype.finish=function(){var e=this;if(e.completed)return;e.completed=!0,e.countDownTimer=setTimeout(function(){e.close()},e.config.countDownSecond*1e3)},v.prototype.start=function(){var e=this;if(e.running)return;e.running=!0,r(n,function(t){e.resources=t,e.text1=new i(t["text-1"],e.canvas,e.ctx),e.text1.draw(),e.meteorHandle(t),e.cat=new a(t.cat,e.canvas,e.ctx),e.cat.draw(),e.rainbow=new f(t.rainbow,e.canvas,e.ctx),e.rainbow.draw(),e.bottomCloud=new l(t["bottom-cloud"],e.canvas,e.ctx),e.bottomCloud.draw(),e.cloudHandle(t),e.redPacketHandle(t),e.starHandle(t),e.bigPacket=new h(t["big-packet"],t["big-packet-button"],e.canvas,e.ctx),e.bigPacket.draw(),e.text2=new s(t["text-2"],e.canvas,e.ctx),e.closeButton=new d(t["close-button"],e.canvas,e.ctx,e),e.$container.show(),e.loop()})},v.prototype.loop=function(){var e=this;e.timer=requestAnimationFrame(function t(n){e.ctx.clearRect(0,0,e.canvasWidth,e.canvasHeight),e.closeButton.show(),e.meteorList.forEach(function(e){e.move()}),e.cat.hasShow?e.text1.move():e.text1.show(),e.cat.move(),e.cat.animateCompleted&&e.rainbow.move(),e.cloudList.forEach(function(e){e.move()}),e.bottomCloud.draw(),e.cat.animateCompleted&&(e.redPacketList.forEach(function(e){e.move()}),e.bigPacket.move(),e.text2.show(),e.starList.forEach(function(e){e.move()})),e.bigPacket.animateCompleted&&e.finish(),e.timer=requestAnimationFrame(t)})},v.prototype.meteorHandle=function(e){var t=this,n=[{percentX:.3,percentY:.2},{percentX:.32,percentY:.22},{percentX:.36,percentY:.18},{percentX:.62,percentY:.3},{percentX:.64,percentY:.2},{percentX:.68,percentY:.24}];t.meteorList=n.map(function(e){var n=new c(e.percentX,e.percentY,t.canvas,t.ctx);return n.draw(),n})},v.prototype.starHandle=function(e){var t=this,n=[{percentX:.34,percentY:.34},{percentX:.38,percentY:.4},{percentX:.32,percentY:.46},{percentX:.36,percentY:.5},{percentX:.33,percentY:.52},{percentX:.68,percentY:.36},{percentX:.64,percentY:.4},{percentX:.7,percentY:.5},{percentX:.68,percentY:.6}];t.starList=n.map(function(e){var n=new p(e.percentX,e.percentY,t.canvas,t.ctx);return n.draw(),n})},v.prototype.cloudHandle=function(e){var t=this,n=[{percentX:.08,percentY:.34,res:e["cloud-left-2"]},{percentX:.2,percentY:.48,res:e["cloud-left-3"]},{percentX:.1,percentY:.7,res:e["cloud-left-4"]},{percentX:.7,percentY:.2,res:e["cloud-right-1"]},{percentX:.8,percentY:.34,res:e["cloud-right-2"]},{percentX:.8,percentY:.7,res:e["cloud-right-3"]}];t.cloudList=n.map(function(e){var n=new o(e.percentX,e.percentY,e.res,t.canvas,t.ctx);return n.draw(),n})},v.prototype.redPacketHandle=function(e){var t=this,n=[{percentX:.11,percentY:.24,res:e["red-packet-2"]},{percentX:.24,percentY:.38,res:e["red-packet-3"]},{percentX:.14,percentY:.6,res:e["red-packet-4"]},{percentX:.73,percentY:.1,res:e["red-packet-5"]},{percentX:.83,percentY:.24,res:e["red-packet-6"]},{percentX:.83,percentY:.6,res:e["red-packet-7"]},{percentX:.04,percentY:.8,res:e["red-packet-8"]},{percentX:.12,percentY:.78,res:e["red-packet-9"]},{percentX:.76,percentY:.78,res:e["red-packet-10"]},{percentX:.92,percentY:.8,res:e["red-packet-11"]}];t.redPacketList=n.map(function(e){var n=new u(e.percentX,e.percentY,e.res,t.canvas,t.ctx);return n.draw(),n})};var m=new v(rainbowCatConfig);m.init()})();"use strict";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly){symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable})}keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key])})}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))})}}return target}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _classCallCheck2(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass3(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _createForOfIteratorHelper(o,allowArrayLike){var it=typeof Symbol!=="undefined"&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length==="number"){if(it)o=it;var i=0;var F=function F(){};return{s:F,n:function n(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]}},e:function e(_e){throw _e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var normalCompletion=true,didErr=false,err;return{s:function s(){it=it.call(o)},n:function n(){var step=it.next();normalCompletion=step.done;return step},e:function e(_e2){didErr=true;err=_e2},f:function f(){try{if(!normalCompletion&&it.return!=null)it.return()}finally{if(didErr)throw err}}}}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}(function(){var __create=Object.create;var __defProp=Object.defineProperty;var __getOwnPropDesc=Object.getOwnPropertyDescriptor;var __getOwnPropNames=Object.getOwnPropertyNames;var __getProtoOf=Object.getPrototypeOf;var __hasOwnProp=Object.prototype.hasOwnProperty;var __markAsModule=function __markAsModule(target){return __defProp(target,"__esModule",{value:true})};var __commonJS=function __commonJS(cb,mod){return function __require(){return mod||(0,cb[Object.keys(cb)[0]])((mod={exports:{}}).exports,mod),mod.exports}};var __export=function __export(target,all){__markAsModule(target);for(var name in all){__defProp(target,name,{get:all[name],enumerable:true})}};var __reExport=function __reExport(target,module,desc){if(module&&_typeof(module)==="object"||typeof module==="function"){var _iterator=_createForOfIteratorHelper(__getOwnPropNames(module)),_step;try{var _loop=function _loop(){var key=_step.value;if(!__hasOwnProp.call(target,key)&&key!=="default")__defProp(target,key,{get:function get(){return module[key]},enumerable:!(desc=__getOwnPropDesc(module,key))||desc.enumerable})};for(_iterator.s();!(_step=_iterator.n()).done;){_loop()}}catch(err){_iterator.e(err)}finally{_iterator.f()}}return target};var __toModule=function __toModule(module){return __reExport(__markAsModule(__defProp(module!=null?__create(__getProtoOf(module)):{},"default",module&&module.__esModule&&"default"in module?{get:function get(){return module.default},enumerable:true}:{value:module,enumerable:true})),module)};var require_promise=__commonJS({"node_modules/es6-promise-polyfill/promise.js":function node_modulesEs6PromisePolyfillPromiseJs(exports){(function(global2){var NativePromise=global2["Promise"];var nativePromiseSupported=NativePromise&&"resolve"in NativePromise&&"reject"in NativePromise&&"all"in NativePromise&&"race"in NativePromise&&function(){var resolve2;new NativePromise(function(r){resolve2=r});return typeof resolve2==="function"}();if(typeof exports!=="undefined"&&exports){exports.Promise=nativePromiseSupported?NativePromise:Promise2;exports.Polyfill=Promise2}else{if(typeof define=="function"&&define.amd){define(function(){return nativePromiseSupported?NativePromise:Promise2})}else{if(!nativePromiseSupported)global2["Promise"]=Promise2}}var PENDING="pending";var SEALED="sealed";var FULFILLED="fulfilled";var REJECTED="rejected";var NOOP=function NOOP(){};function isArray(value){return Object.prototype.toString.call(value)==="[object Array]"}var asyncSetTimer=typeof setImmediate!=="undefined"?setImmediate:setTimeout;var asyncQueue=[];var asyncTimer;function asyncFlush(){for(var i=0;i<asyncQueue.length;i++){asyncQueue[i][0](asyncQueue[i][1])}asyncQueue=[];asyncTimer=false}function asyncCall(callback,arg){asyncQueue.push([callback,arg]);if(!asyncTimer){asyncTimer=true;asyncSetTimer(asyncFlush,0)}}function invokeResolver(resolver,promise){function resolvePromise(value){resolve(promise,value)}function rejectPromise(reason){reject(promise,reason)}try{resolver(resolvePromise,rejectPromise)}catch(e){rejectPromise(e)}}function invokeCallback(subscriber){var owner=subscriber.owner;var settled=owner.state_;var value=owner.data_;var callback=subscriber[settled];var promise=subscriber.then;if(typeof callback==="function"){settled=FULFILLED;try{value=callback(value)}catch(e){reject(promise,e)}}if(!handleThenable(promise,value)){if(settled===FULFILLED)resolve(promise,value);if(settled===REJECTED)reject(promise,value)}}function handleThenable(promise,value){var resolved;try{if(promise===value)throw new TypeError("A promises callback cannot return that same promise.");if(value&&(typeof value==="function"||_typeof(value)==="object")){var then=value.then;if(typeof then==="function"){then.call(value,function(val){if(!resolved){resolved=true;if(value!==val)resolve(promise,val);else fulfill(promise,val)}},function(reason){if(!resolved){resolved=true;reject(promise,reason)}});return true}}}catch(e){if(!resolved)reject(promise,e);return true}return false}function resolve(promise,value){if(promise===value||!handleThenable(promise,value))fulfill(promise,value)}function fulfill(promise,value){if(promise.state_===PENDING){promise.state_=SEALED;promise.data_=value;asyncCall(publishFulfillment,promise)}}function reject(promise,reason){if(promise.state_===PENDING){promise.state_=SEALED;promise.data_=reason;asyncCall(publishRejection,promise)}}function publish(promise){var callbacks=promise.then_;promise.then_=void 0;for(var i=0;i<callbacks.length;i++){invokeCallback(callbacks[i])}}function publishFulfillment(promise){promise.state_=FULFILLED;publish(promise)}function publishRejection(promise){promise.state_=REJECTED;publish(promise)}function Promise2(resolver){if(typeof resolver!=="function")throw new TypeError("Promise constructor takes a function argument");if(this instanceof Promise2===false)throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this.then_=[];invokeResolver(resolver,this)}Promise2.prototype={constructor:Promise2,state_:PENDING,then_:null,data_:void 0,then:function then(onFulfillment,onRejection){var subscriber={owner:this,then:new this.constructor(NOOP),fulfilled:onFulfillment,rejected:onRejection};if(this.state_===FULFILLED||this.state_===REJECTED){asyncCall(invokeCallback,subscriber)}else{this.then_.push(subscriber)}return subscriber.then},"catch":function _catch(onRejection){return this.then(null,onRejection)}};Promise2.all=function(promises){var Class=this;if(!isArray(promises))throw new TypeError("You must pass an array to Promise.all().");return new Class(function(resolve2,reject2){var results=[];var remaining=0;function resolver(index3){remaining++;return function(value){results[index3]=value;if(! --remaining)resolve2(results)}}for(var i=0,promise;i<promises.length;i++){promise=promises[i];if(promise&&typeof promise.then==="function")promise.then(resolver(i),reject2);else results[i]=promise}if(!remaining)resolve2(results)})};Promise2.race=function(promises){var Class=this;if(!isArray(promises))throw new TypeError("You must pass an array to Promise.race().");return new Class(function(resolve2,reject2){for(var i=0,promise;i<promises.length;i++){promise=promises[i];if(promise&&typeof promise.then==="function")promise.then(resolve2,reject2);else resolve2(promise)}})};Promise2.resolve=function(value){var Class=this;if(value&&_typeof(value)==="object"&&value.constructor===Class)return value;return new Class(function(resolve2){resolve2(value)})};Promise2.reject=function(reason){var Class=this;return new Class(function(resolve2,reject2){reject2(reason)})}})(typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:exports)}});var require_object_assign=__commonJS({"node_modules/object-assign/index.js":function node_modulesObjectAssignIndexJs(exports,module){"use strict";var getOwnPropertySymbols=Object.getOwnPropertySymbols;var hasOwnProperty=Object.prototype.hasOwnProperty;var propIsEnumerable=Object.prototype.propertyIsEnumerable;function toObject(val){if(val===null||val===void 0){throw new TypeError("Object.assign cannot be called with null or undefined")}return Object(val)}function shouldUseNative(){try{if(!Object.assign){return false}var test1=new String("abc");test1[5]="de";if(Object.getOwnPropertyNames(test1)[0]==="5"){return false}var test2={};for(var i=0;i<10;i++){test2["_"+String.fromCharCode(i)]=i}var order2=Object.getOwnPropertyNames(test2).map(function(n){return test2[n]});if(order2.join("")!=="0123456789"){return false}var test3={};"abcdefghijklmnopqrst".split("").forEach(function(letter){test3[letter]=letter});if(Object.keys(Object.assign({},test3)).join("")!=="abcdefghijklmnopqrst"){return false}return true}catch(err){return false}}module.exports=shouldUseNative()?Object.assign:function(target,source){var from6;var to=toObject(target);var symbols;for(var s=1;s<arguments.length;s++){from6=Object(arguments[s]);for(var key in from6){if(hasOwnProperty.call(from6,key)){to[key]=from6[key]}}if(getOwnPropertySymbols){symbols=getOwnPropertySymbols(from6);for(var i=0;i<symbols.length;i++){if(propIsEnumerable.call(from6,symbols[i])){to[symbols[i]]=from6[symbols[i]]}}}}return to}}});var require_eventemitter3=__commonJS({"node_modules/@pixi/utils/node_modules/eventemitter3/index.js":function node_modulesPixiUtilsNode_modulesEventemitter3IndexJs(exports,module){"use strict";var has=Object.prototype.hasOwnProperty;var prefix="~";function Events(){}if(Object.create){Events.prototype=Object.create(null);if(!new Events().__proto__)prefix=false}function EE(fn,context2,once){this.fn=fn;this.context=context2;this.once=once||false}function addListener(emitter,event2,fn,context2,once){if(typeof fn!=="function"){throw new TypeError("The listener must be a function")}var listener=new EE(fn,context2||emitter,once),evt=prefix?prefix+event2:event2;if(!emitter._events[evt])emitter._events[evt]=listener,emitter._eventsCount++;else if(!emitter._events[evt].fn)emitter._events[evt].push(listener);else emitter._events[evt]=[emitter._events[evt],listener];return emitter}function clearEvent(emitter,evt){if(--emitter._eventsCount===0)emitter._events=new Events;else delete emitter._events[evt]}function EventEmitter(){this._events=new Events;this._eventsCount=0}EventEmitter.prototype.eventNames=function eventNames(){var names=[],events,name;if(this._eventsCount===0)return names;for(name in events=this._events){if(has.call(events,name))names.push(prefix?name.slice(1):name)}if(Object.getOwnPropertySymbols){return names.concat(Object.getOwnPropertySymbols(events))}return names};EventEmitter.prototype.listeners=function listeners(event2){var evt=prefix?prefix+event2:event2,handlers=this._events[evt];if(!handlers)return[];if(handlers.fn)return[handlers.fn];for(var i=0,l=handlers.length,ee=new Array(l);i<l;i++){ee[i]=handlers[i].fn}return ee};EventEmitter.prototype.listenerCount=function listenerCount(event2){var evt=prefix?prefix+event2:event2,listeners=this._events[evt];if(!listeners)return 0;if(listeners.fn)return 1;return listeners.length};EventEmitter.prototype.emit=function emit(event2,a1,a2,a3,a4,a5){var evt=prefix?prefix+event2:event2;if(!this._events[evt])return false;var listeners=this._events[evt],len=arguments.length,args,i;if(listeners.fn){if(listeners.once)this.removeListener(event2,listeners.fn,void 0,true);switch(len){case 1:return listeners.fn.call(listeners.context),true;case 2:return listeners.fn.call(listeners.context,a1),true;case 3:return listeners.fn.call(listeners.context,a1,a2),true;case 4:return listeners.fn.call(listeners.context,a1,a2,a3),true;case 5:return listeners.fn.call(listeners.context,a1,a2,a3,a4),true;case 6:return listeners.fn.call(listeners.context,a1,a2,a3,a4,a5),true;}for(i=1,args=new Array(len-1);i<len;i++){args[i-1]=arguments[i]}listeners.fn.apply(listeners.context,args)}else{var length=listeners.length,j;for(i=0;i<length;i++){if(listeners[i].once)this.removeListener(event2,listeners[i].fn,void 0,true);switch(len){case 1:listeners[i].fn.call(listeners[i].context);break;case 2:listeners[i].fn.call(listeners[i].context,a1);break;case 3:listeners[i].fn.call(listeners[i].context,a1,a2);break;case 4:listeners[i].fn.call(listeners[i].context,a1,a2,a3);break;default:if(!args)for(j=1,args=new Array(len-1);j<len;j++){args[j-1]=arguments[j]}listeners[i].fn.apply(listeners[i].context,args);}}}return true};EventEmitter.prototype.on=function on(event2,fn,context2){return addListener(this,event2,fn,context2,false)};EventEmitter.prototype.once=function once(event2,fn,context2){return addListener(this,event2,fn,context2,true)};EventEmitter.prototype.removeListener=function removeListener(event2,fn,context2,once){var evt=prefix?prefix+event2:event2;if(!this._events[evt])return this;if(!fn){clearEvent(this,evt);return this}var listeners=this._events[evt];if(listeners.fn){if(listeners.fn===fn&&(!once||listeners.once)&&(!context2||listeners.context===context2)){clearEvent(this,evt)}}else{for(var i=0,events=[],length=listeners.length;i<length;i++){if(listeners[i].fn!==fn||once&&!listeners[i].once||context2&&listeners[i].context!==context2){events.push(listeners[i])}}if(events.length)this._events[evt]=events.length===1?events[0]:events;else clearEvent(this,evt)}return this};EventEmitter.prototype.removeAllListeners=function removeAllListeners(event2){var evt;if(event2){evt=prefix?prefix+event2:event2;if(this._events[evt])clearEvent(this,evt)}else{this._events=new Events;this._eventsCount=0}return this};EventEmitter.prototype.off=EventEmitter.prototype.removeListener;EventEmitter.prototype.addListener=EventEmitter.prototype.on;EventEmitter.prefixed=prefix;EventEmitter.EventEmitter=EventEmitter;if(typeof module!=="undefined"){module.exports=EventEmitter}}});var require_earcut=__commonJS({"node_modules/earcut/src/earcut.js":function node_modulesEarcutSrcEarcutJs(exports,module){"use strict";module.exports=earcut;module.exports.default=earcut;function earcut(data,holeIndices,dim){dim=dim||2;var hasHoles=holeIndices&&holeIndices.length,outerLen=hasHoles?holeIndices[0]*dim:data.length,outerNode=linkedList(data,0,outerLen,dim,true),triangles=[];if(!outerNode||outerNode.next===outerNode.prev)return triangles;var minX,minY,maxX,maxY,x,y,invSize;if(hasHoles)outerNode=eliminateHoles(data,holeIndices,outerNode,dim);if(data.length>80*dim){minX=maxX=data[0];minY=maxY=data[1];for(var i=dim;i<outerLen;i+=dim){x=data[i];y=data[i+1];if(x<minX)minX=x;if(y<minY)minY=y;if(x>maxX)maxX=x;if(y>maxY)maxY=y}invSize=Math.max(maxX-minX,maxY-minY);invSize=invSize!==0?1/invSize:0}earcutLinked(outerNode,triangles,dim,minX,minY,invSize);return triangles}function linkedList(data,start2,end2,dim,clockwise){var i,last;if(clockwise===signedArea(data,start2,end2,dim)>0){for(i=start2;i<end2;i+=dim){last=insertNode(i,data[i],data[i+1],last)}}else{for(i=end2-dim;i>=start2;i-=dim){last=insertNode(i,data[i],data[i+1],last)}}if(last&&equals(last,last.next)){removeNode(last);last=last.next}return last}function filterPoints(start2,end2){if(!start2)return start2;if(!end2)end2=start2;var p=start2,again;do{again=false;if(!p.steiner&&(equals(p,p.next)||area(p.prev,p,p.next)===0)){removeNode(p);p=end2=p.prev;if(p===p.next)break;again=true}else{p=p.next}}while(again||p!==end2);return end2}function earcutLinked(ear,triangles,dim,minX,minY,invSize,pass){if(!ear)return;if(!pass&&invSize)indexCurve(ear,minX,minY,invSize);var stop2=ear,prev,next;while(ear.prev!==ear.next){prev=ear.prev;next=ear.next;if(invSize?isEarHashed(ear,minX,minY,invSize):isEar(ear)){triangles.push(prev.i/dim);triangles.push(ear.i/dim);triangles.push(next.i/dim);removeNode(ear);ear=next.next;stop2=next.next;continue}ear=next;if(ear===stop2){if(!pass){earcutLinked(filterPoints(ear),triangles,dim,minX,minY,invSize,1)}else if(pass===1){ear=cureLocalIntersections(filterPoints(ear),triangles,dim);earcutLinked(ear,triangles,dim,minX,minY,invSize,2)}else if(pass===2){splitEarcut(ear,triangles,dim,minX,minY,invSize)}break}}}function isEar(ear){var a=ear.prev,b=ear,c=ear.next;if(area(a,b,c)>=0)return false;var p=ear.next.next;while(p!==ear.prev){if(pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return false;p=p.next}return true}function isEarHashed(ear,minX,minY,invSize){var a=ear.prev,b=ear,c=ear.next;if(area(a,b,c)>=0)return false;var minTX=a.x<b.x?a.x<c.x?a.x:c.x:b.x<c.x?b.x:c.x,minTY=a.y<b.y?a.y<c.y?a.y:c.y:b.y<c.y?b.y:c.y,maxTX=a.x>b.x?a.x>c.x?a.x:c.x:b.x>c.x?b.x:c.x,maxTY=a.y>b.y?a.y>c.y?a.y:c.y:b.y>c.y?b.y:c.y;var minZ=zOrder(minTX,minTY,minX,minY,invSize),maxZ=zOrder(maxTX,maxTY,minX,minY,invSize);var p=ear.prevZ,n=ear.nextZ;while(p&&p.z>=minZ&&n&&n.z<=maxZ){if(p!==ear.prev&&p!==ear.next&&pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return false;p=p.prevZ;if(n!==ear.prev&&n!==ear.next&&pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,n.x,n.y)&&area(n.prev,n,n.next)>=0)return false;n=n.nextZ}while(p&&p.z>=minZ){if(p!==ear.prev&&p!==ear.next&&pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return false;p=p.prevZ}while(n&&n.z<=maxZ){if(n!==ear.prev&&n!==ear.next&&pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,n.x,n.y)&&area(n.prev,n,n.next)>=0)return false;n=n.nextZ}return true}function cureLocalIntersections(start2,triangles,dim){var p=start2;do{var a=p.prev,b=p.next.next;if(!equals(a,b)&&intersects(a,p,p.next,b)&&locallyInside(a,b)&&locallyInside(b,a)){triangles.push(a.i/dim);triangles.push(p.i/dim);triangles.push(b.i/dim);removeNode(p);removeNode(p.next);p=start2=b}p=p.next}while(p!==start2);return filterPoints(p)}function splitEarcut(start2,triangles,dim,minX,minY,invSize){var a=start2;do{var b=a.next.next;while(b!==a.prev){if(a.i!==b.i&&isValidDiagonal(a,b)){var c=splitPolygon(a,b);a=filterPoints(a,a.next);c=filterPoints(c,c.next);earcutLinked(a,triangles,dim,minX,minY,invSize);earcutLinked(c,triangles,dim,minX,minY,invSize);return}b=b.next}a=a.next}while(a!==start2)}function eliminateHoles(data,holeIndices,outerNode,dim){var queue2=[],i,len,start2,end2,list;for(i=0,len=holeIndices.length;i<len;i++){start2=holeIndices[i]*dim;end2=i<len-1?holeIndices[i+1]*dim:data.length;list=linkedList(data,start2,end2,dim,false);if(list===list.next)list.steiner=true;queue2.push(getLeftmost(list))}queue2.sort(compareX);for(i=0;i<queue2.length;i++){outerNode=eliminateHole(queue2[i],outerNode);outerNode=filterPoints(outerNode,outerNode.next)}return outerNode}function compareX(a,b){return a.x-b.x}function eliminateHole(hole,outerNode){var bridge=findHoleBridge(hole,outerNode);if(!bridge){return outerNode}var bridgeReverse=splitPolygon(bridge,hole);var filteredBridge=filterPoints(bridge,bridge.next);filterPoints(bridgeReverse,bridgeReverse.next);return outerNode===bridge?filteredBridge:outerNode}function findHoleBridge(hole,outerNode){var p=outerNode,hx=hole.x,hy=hole.y,qx=-Infinity,m;do{if(hy<=p.y&&hy>=p.next.y&&p.next.y!==p.y){var x=p.x+(hy-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(x<=hx&&x>qx){qx=x;if(x===hx){if(hy===p.y)return p;if(hy===p.next.y)return p.next}m=p.x<p.next.x?p:p.next}}p=p.next}while(p!==outerNode);if(!m)return null;if(hx===qx)return m;var stop2=m,mx=m.x,my=m.y,tanMin=Infinity,tan;p=m;do{if(hx>=p.x&&p.x>=mx&&hx!==p.x&&pointInTriangle(hy<my?hx:qx,hy,mx,my,hy<my?qx:hx,hy,p.x,p.y)){tan=Math.abs(hy-p.y)/(hx-p.x);if(locallyInside(p,hole)&&(tan<tanMin||tan===tanMin&&(p.x>m.x||p.x===m.x&&sectorContainsSector(m,p)))){m=p;tanMin=tan}}p=p.next}while(p!==stop2);return m}function sectorContainsSector(m,p){return area(m.prev,m,p.prev)<0&&area(p.next,m,m.next)<0}function indexCurve(start2,minX,minY,invSize){var p=start2;do{if(p.z===null)p.z=zOrder(p.x,p.y,minX,minY,invSize);p.prevZ=p.prev;p.nextZ=p.next;p=p.next}while(p!==start2);p.prevZ.nextZ=null;p.prevZ=null;sortLinked(p)}function sortLinked(list){var i,p,q,e,tail,numMerges,pSize,qSize,inSize=1;do{p=list;list=null;tail=null;numMerges=0;while(p){numMerges++;q=p;pSize=0;for(i=0;i<inSize;i++){pSize++;q=q.nextZ;if(!q)break}qSize=inSize;while(pSize>0||qSize>0&&q){if(pSize!==0&&(qSize===0||!q||p.z<=q.z)){e=p;p=p.nextZ;pSize--}else{e=q;q=q.nextZ;qSize--}if(tail)tail.nextZ=e;else list=e;e.prevZ=tail;tail=e}p=q}tail.nextZ=null;inSize*=2}while(numMerges>1);return list}function zOrder(x,y,minX,minY,invSize){x=32767*(x-minX)*invSize;y=32767*(y-minY)*invSize;x=(x|x<<8)&16711935;x=(x|x<<4)&252645135;x=(x|x<<2)&858993459;x=(x|x<<1)&1431655765;y=(y|y<<8)&16711935;y=(y|y<<4)&252645135;y=(y|y<<2)&858993459;y=(y|y<<1)&1431655765;return x|y<<1}function getLeftmost(start2){var p=start2,leftmost=start2;do{if(p.x<leftmost.x||p.x===leftmost.x&&p.y<leftmost.y)leftmost=p;p=p.next}while(p!==start2);return leftmost}function pointInTriangle(ax,ay,bx,by,cx,cy,px,py){return(cx-px)*(ay-py)-(ax-px)*(cy-py)>=0&&(ax-px)*(by-py)-(bx-px)*(ay-py)>=0&&(bx-px)*(cy-py)-(cx-px)*(by-py)>=0}function isValidDiagonal(a,b){return a.next.i!==b.i&&a.prev.i!==b.i&&!intersectsPolygon(a,b)&&(locallyInside(a,b)&&locallyInside(b,a)&&middleInside(a,b)&&(area(a.prev,a,b.prev)||area(a,b.prev,b))||equals(a,b)&&area(a.prev,a,a.next)>0&&area(b.prev,b,b.next)>0)}function area(p,q,r){return(q.y-p.y)*(r.x-q.x)-(q.x-p.x)*(r.y-q.y)}function equals(p1,p2){return p1.x===p2.x&&p1.y===p2.y}function intersects(p1,q1,p2,q2){var o1=sign2(area(p1,q1,p2));var o2=sign2(area(p1,q1,q2));var o3=sign2(area(p2,q2,p1));var o4=sign2(area(p2,q2,q1));if(o1!==o2&&o3!==o4)return true;if(o1===0&&onSegment(p1,p2,q1))return true;if(o2===0&&onSegment(p1,q2,q1))return true;if(o3===0&&onSegment(p2,p1,q2))return true;if(o4===0&&onSegment(p2,q1,q2))return true;return false}function onSegment(p,q,r){return q.x<=Math.max(p.x,r.x)&&q.x>=Math.min(p.x,r.x)&&q.y<=Math.max(p.y,r.y)&&q.y>=Math.min(p.y,r.y)}function sign2(num){return num>0?1:num<0?-1:0}function intersectsPolygon(a,b){var p=a;do{if(p.i!==a.i&&p.next.i!==a.i&&p.i!==b.i&&p.next.i!==b.i&&intersects(p,p.next,a,b))return true;p=p.next}while(p!==a);return false}function locallyInside(a,b){return area(a.prev,a,a.next)<0?area(a,b,a.next)>=0&&area(a,a.prev,b)>=0:area(a,b,a.prev)<0||area(a,a.next,b)<0}function middleInside(a,b){var p=a,inside=false,px=(a.x+b.x)/2,py=(a.y+b.y)/2;do{if(p.y>py!==p.next.y>py&&p.next.y!==p.y&&px<(p.next.x-p.x)*(py-p.y)/(p.next.y-p.y)+p.x)inside=!inside;p=p.next}while(p!==a);return inside}function splitPolygon(a,b){var a2=new Node(a.i,a.x,a.y),b2=new Node(b.i,b.x,b.y),an=a.next,bp=b.prev;a.next=b;b.prev=a;a2.next=an;an.prev=a2;b2.next=a2;a2.prev=b2;bp.next=b2;b2.prev=bp;return b2}function insertNode(i,x,y,last){var p=new Node(i,x,y);if(!last){p.prev=p;p.next=p}else{p.next=last.next;p.prev=last;last.next.prev=p;last.next=p}return p}function removeNode(p){p.next.prev=p.prev;p.prev.next=p.next;if(p.prevZ)p.prevZ.nextZ=p.nextZ;if(p.nextZ)p.nextZ.prevZ=p.prevZ}function Node(i,x,y){this.i=i;this.x=x;this.y=y;this.prev=null;this.next=null;this.z=null;this.prevZ=null;this.nextZ=null;this.steiner=false}earcut.deviation=function(data,holeIndices,dim,triangles){var hasHoles=holeIndices&&holeIndices.length;var outerLen=hasHoles?holeIndices[0]*dim:data.length;var polygonArea=Math.abs(signedArea(data,0,outerLen,dim));if(hasHoles){for(var i=0,len=holeIndices.length;i<len;i++){var start2=holeIndices[i]*dim;var end2=i<len-1?holeIndices[i+1]*dim:data.length;polygonArea-=Math.abs(signedArea(data,start2,end2,dim))}}var trianglesArea=0;for(i=0;i<triangles.length;i+=3){var a=triangles[i]*dim;var b=triangles[i+1]*dim;var c=triangles[i+2]*dim;trianglesArea+=Math.abs((data[a]-data[c])*(data[b+1]-data[a+1])-(data[a]-data[b])*(data[c+1]-data[a+1]))}return polygonArea===0&&trianglesArea===0?0:Math.abs((trianglesArea-polygonArea)/polygonArea)};function signedArea(data,start2,end2,dim){var sum=0;for(var i=start2,j=end2-dim;i<end2;i+=dim){sum+=(data[j]-data[i])*(data[i+1]+data[j+1]);j=i}return sum}earcut.flatten=function(data){var dim=data[0][0].length,result={vertices:[],holes:[],dimensions:dim},holeIndex=0;for(var i=0;i<data.length;i++){for(var j=0;j<data[i].length;j++){for(var d=0;d<dim;d++){result.vertices.push(data[i][j][d])}}if(i>0){holeIndex+=data[i-1].length;result.holes.push(holeIndex)}}return result}}});var require_punycode=__commonJS({"node_modules/punycode/punycode.js":function node_modulesPunycodePunycodeJs(exports,module){(function(root){var freeExports=_typeof(exports)=="object"&&exports&&!exports.nodeType&&exports;var freeModule=_typeof(module)=="object"&&module&&!module.nodeType&&module;var freeGlobal=(typeof global==="undefined"?"undefined":_typeof(global))=="object"&&global;if(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal||freeGlobal.self===freeGlobal){root=freeGlobal}var punycode,maxInt=2147483647,base=36,tMin=1,tMax=26,skew=38,damp=700,initialBias=72,initialN=128,delimiter="-",regexPunycode=/^xn--/,regexNonASCII=/[^\x20-\x7E]/,regexSeparators=/[\x2E\u3002\uFF0E\uFF61]/g,errors={"overflow":"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},baseMinusTMin=base-tMin,floor=Math.floor,stringFromCharCode=String.fromCharCode,key;function error(type){throw RangeError(errors[type])}function map3(array,fn){var length=array.length;var result=[];while(length--){result[length]=fn(array[length])}return result}function mapDomain(string,fn){var parts=string.split("@");var result="";if(parts.length>1){result=parts[0]+"@";string=parts[1]}string=string.replace(regexSeparators,".");var labels=string.split(".");var encoded=map3(labels,fn).join(".");return result+encoded}function ucs2decode(string){var output=[],counter=0,length=string.length,value,extra;while(counter<length){value=string.charCodeAt(counter++);if(value>=55296&&value<=56319&&counter<length){extra=string.charCodeAt(counter++);if((extra&64512)==56320){output.push(((value&1023)<<10)+(extra&1023)+65536)}else{output.push(value);counter--}}else{output.push(value)}}return output}function ucs2encode(array){return map3(array,function(value){var output="";if(value>65535){value-=65536;output+=stringFromCharCode(value>>>10&1023|55296);value=56320|value&1023}output+=stringFromCharCode(value);return output}).join("")}function basicToDigit(codePoint){if(codePoint-48<10){return codePoint-22}if(codePoint-65<26){return codePoint-65}if(codePoint-97<26){return codePoint-97}return base}function digitToBasic(digit,flag){return digit+22+75*(digit<26)-((flag!=0)<<5)}function adapt(delta,numPoints,firstTime){var k=0;delta=firstTime?floor(delta/damp):delta>>1;delta+=floor(delta/numPoints);for(;delta>baseMinusTMin*tMax>>1;k+=base){delta=floor(delta/baseMinusTMin)}return floor(k+(baseMinusTMin+1)*delta/(delta+skew))}function decode(input){var output=[],inputLength=input.length,out,i=0,n=initialN,bias=initialBias,basic,j,index3,oldi,w,k,digit,t,baseMinusT;basic=input.lastIndexOf(delimiter);if(basic<0){basic=0}for(j=0;j<basic;++j){if(input.charCodeAt(j)>=128){error("not-basic")}output.push(input.charCodeAt(j))}for(index3=basic>0?basic+1:0;index3<inputLength;){for(oldi=i,w=1,k=base;;k+=base){if(index3>=inputLength){error("invalid-input")}digit=basicToDigit(input.charCodeAt(index3++));if(digit>=base||digit>floor((maxInt-i)/w)){error("overflow")}i+=digit*w;t=k<=bias?tMin:k>=bias+tMax?tMax:k-bias;if(digit<t){break}baseMinusT=base-t;if(w>floor(maxInt/baseMinusT)){error("overflow")}w*=baseMinusT}out=output.length+1;bias=adapt(i-oldi,out,oldi==0);if(floor(i/out)>maxInt-n){error("overflow")}n+=floor(i/out);i%=out;output.splice(i++,0,n)}return ucs2encode(output)}function encode(input){var n,delta,handledCPCount,basicLength,bias,j,m,q,k,t,currentValue,output=[],inputLength,handledCPCountPlusOne,baseMinusT,qMinusT;input=ucs2decode(input);inputLength=input.length;n=initialN;delta=0;bias=initialBias;for(j=0;j<inputLength;++j){currentValue=input[j];if(currentValue<128){output.push(stringFromCharCode(currentValue))}}handledCPCount=basicLength=output.length;if(basicLength){output.push(delimiter)}while(handledCPCount<inputLength){for(m=maxInt,j=0;j<inputLength;++j){currentValue=input[j];if(currentValue>=n&&currentValue<m){m=currentValue}}handledCPCountPlusOne=handledCPCount+1;if(m-n>floor((maxInt-delta)/handledCPCountPlusOne)){error("overflow")}delta+=(m-n)*handledCPCountPlusOne;n=m;for(j=0;j<inputLength;++j){currentValue=input[j];if(currentValue<n&&++delta>maxInt){error("overflow")}if(currentValue==n){for(q=delta,k=base;;k+=base){t=k<=bias?tMin:k>=bias+tMax?tMax:k-bias;if(q<t){break}qMinusT=q-t;baseMinusT=base-t;output.push(stringFromCharCode(digitToBasic(t+qMinusT%baseMinusT,0)));q=floor(qMinusT/baseMinusT)}output.push(stringFromCharCode(digitToBasic(q,0)));bias=adapt(delta,handledCPCountPlusOne,handledCPCount==basicLength);delta=0;++handledCPCount}}++delta;++n}return output.join("")}function toUnicode(input){return mapDomain(input,function(string){return regexPunycode.test(string)?decode(string.slice(4).toLowerCase()):string})}function toASCII(input){return mapDomain(input,function(string){return regexNonASCII.test(string)?"xn--"+encode(string):string})}punycode={"version":"1.3.2","ucs2":{"decode":ucs2decode,"encode":ucs2encode},"decode":decode,"encode":encode,"toASCII":toASCII,"toUnicode":toUnicode};if(typeof define=="function"&&_typeof(define.amd)=="object"&&define.amd){define("punycode",function(){return punycode})}else if(freeExports&&freeModule){if(module.exports==freeExports){freeModule.exports=punycode}else{for(key in punycode){punycode.hasOwnProperty(key)&&(freeExports[key]=punycode[key])}}}else{root.punycode=punycode}})(exports)}});var require_util=__commonJS({"node_modules/url/util.js":function node_modulesUrlUtilJs(exports,module){"use strict";module.exports={isString:function isString(arg){return typeof arg==="string"},isObject:function isObject(arg){return _typeof(arg)==="object"&&arg!==null},isNull:function isNull(arg){return arg===null},isNullOrUndefined:function isNullOrUndefined(arg){return arg==null}}}});var require_decode=__commonJS({"node_modules/querystring/decode.js":function node_modulesQuerystringDecodeJs(exports,module){"use strict";function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}module.exports=function(qs,sep,eq,options){sep=sep||"&";eq=eq||"=";var obj={};if(typeof qs!=="string"||qs.length===0){return obj}var regexp=/\+/g;qs=qs.split(sep);var maxKeys=1e3;if(options&&typeof options.maxKeys==="number"){maxKeys=options.maxKeys}var len=qs.length;if(maxKeys>0&&len>maxKeys){len=maxKeys}for(var i=0;i<len;++i){var x=qs[i].replace(regexp,"%20"),idx=x.indexOf(eq),kstr,vstr,k,v;if(idx>=0){kstr=x.substr(0,idx);vstr=x.substr(idx+1)}else{kstr=x;vstr=""}k=decodeURIComponent(kstr);v=decodeURIComponent(vstr);if(!hasOwnProperty(obj,k)){obj[k]=v}else if(Array.isArray(obj[k])){obj[k].push(v)}else{obj[k]=[obj[k],v]}}return obj}}});var require_encode=__commonJS({"node_modules/querystring/encode.js":function node_modulesQuerystringEncodeJs(exports,module){"use strict";var stringifyPrimitive=function stringifyPrimitive(v){switch(_typeof(v)){case"string":return v;case"boolean":return v?"true":"false";case"number":return isFinite(v)?v:"";default:return"";}};module.exports=function(obj,sep,eq,name){sep=sep||"&";eq=eq||"=";if(obj===null){obj=void 0}if(_typeof(obj)==="object"){return Object.keys(obj).map(function(k){var ks=encodeURIComponent(stringifyPrimitive(k))+eq;if(Array.isArray(obj[k])){return obj[k].map(function(v){return ks+encodeURIComponent(stringifyPrimitive(v))}).join(sep)}else{return ks+encodeURIComponent(stringifyPrimitive(obj[k]))}}).join(sep)}if(!name)return"";return encodeURIComponent(stringifyPrimitive(name))+eq+encodeURIComponent(stringifyPrimitive(obj))}}});var require_querystring=__commonJS({"node_modules/querystring/index.js":function node_modulesQuerystringIndexJs(exports){"use strict";exports.decode=exports.parse=require_decode();exports.encode=exports.stringify=require_encode()}});var require_url=__commonJS({"node_modules/url/url.js":function node_modulesUrlUrlJs(exports){"use strict";var punycode=require_punycode();var util=require_util();exports.parse=urlParse;exports.resolve=urlResolve;exports.resolveObject=urlResolveObject;exports.format=urlFormat;exports.Url=Url2;function Url2(){this.protocol=null;this.slashes=null;this.auth=null;this.host=null;this.port=null;this.hostname=null;this.hash=null;this.search=null;this.query=null;this.pathname=null;this.path=null;this.href=null}var protocolPattern=/^([a-z0-9.+-]+:)/i;var portPattern=/:[0-9]*$/;var simplePathPattern=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/;var delims=["<",">","\"","`"," ","\r","\n","\t"];var unwise=["{","}","|","\\","^","`"].concat(delims);var autoEscape=["'"].concat(unwise);var nonHostChars=["%","/","?",";","#"].concat(autoEscape);var hostEndingChars=["/","?","#"];var hostnameMaxLen=255;var hostnamePartPattern=/^[+a-z0-9A-Z_-]{0,63}$/;var hostnamePartStart=/^([+a-z0-9A-Z_-]{0,63})(.*)$/;var unsafeProtocol={"javascript":true,"javascript:":true};var hostlessProtocol={"javascript":true,"javascript:":true};var slashedProtocol={"http":true,"https":true,"ftp":true,"gopher":true,"file":true,"http:":true,"https:":true,"ftp:":true,"gopher:":true,"file:":true};var querystring=require_querystring();function urlParse(url,parseQueryString,slashesDenoteHost){if(url&&util.isObject(url)&&url instanceof Url2)return url;var u=new Url2;u.parse(url,parseQueryString,slashesDenoteHost);return u}Url2.prototype.parse=function(url,parseQueryString,slashesDenoteHost){if(!util.isString(url)){throw new TypeError("Parameter 'url' must be a string, not "+_typeof(url))}var queryIndex=url.indexOf("?"),splitter=queryIndex!==-1&&queryIndex<url.indexOf("#")?"?":"#",uSplit=url.split(splitter),slashRegex=/\\/g;uSplit[0]=uSplit[0].replace(slashRegex,"/");url=uSplit.join(splitter);var rest=url;rest=rest.trim();if(!slashesDenoteHost&&url.split("#").length===1){var simplePath=simplePathPattern.exec(rest);if(simplePath){this.path=rest;this.href=rest;this.pathname=simplePath[1];if(simplePath[2]){this.search=simplePath[2];if(parseQueryString){this.query=querystring.parse(this.search.substr(1))}else{this.query=this.search.substr(1)}}else if(parseQueryString){this.search="";this.query={}}return this}}var proto=protocolPattern.exec(rest);if(proto){proto=proto[0];var lowerProto=proto.toLowerCase();this.protocol=lowerProto;rest=rest.substr(proto.length)}if(slashesDenoteHost||proto||rest.match(/^\/\/[^@\/]+@[^@\/]+/)){var slashes=rest.substr(0,2)==="//";if(slashes&&!(proto&&hostlessProtocol[proto])){rest=rest.substr(2);this.slashes=true}}if(!hostlessProtocol[proto]&&(slashes||proto&&!slashedProtocol[proto])){var hostEnd=-1;for(var i=0;i<hostEndingChars.length;i++){var hec=rest.indexOf(hostEndingChars[i]);if(hec!==-1&&(hostEnd===-1||hec<hostEnd))hostEnd=hec}var auth,atSign;if(hostEnd===-1){atSign=rest.lastIndexOf("@")}else{atSign=rest.lastIndexOf("@",hostEnd)}if(atSign!==-1){auth=rest.slice(0,atSign);rest=rest.slice(atSign+1);this.auth=decodeURIComponent(auth)}hostEnd=-1;for(var i=0;i<nonHostChars.length;i++){var hec=rest.indexOf(nonHostChars[i]);if(hec!==-1&&(hostEnd===-1||hec<hostEnd))hostEnd=hec}if(hostEnd===-1)hostEnd=rest.length;this.host=rest.slice(0,hostEnd);rest=rest.slice(hostEnd);this.parseHost();this.hostname=this.hostname||"";var ipv6Hostname=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!ipv6Hostname){var hostparts=this.hostname.split(/\./);for(var i=0,l=hostparts.length;i<l;i++){var part=hostparts[i];if(!part)continue;if(!part.match(hostnamePartPattern)){var newpart="";for(var j=0,k=part.length;j<k;j++){if(part.charCodeAt(j)>127){newpart+="x"}else{newpart+=part[j]}}if(!newpart.match(hostnamePartPattern)){var validParts=hostparts.slice(0,i);var notHost=hostparts.slice(i+1);var bit=part.match(hostnamePartStart);if(bit){validParts.push(bit[1]);notHost.unshift(bit[2])}if(notHost.length){rest="/"+notHost.join(".")+rest}this.hostname=validParts.join(".");break}}}}if(this.hostname.length>hostnameMaxLen){this.hostname=""}else{this.hostname=this.hostname.toLowerCase()}if(!ipv6Hostname){this.hostname=punycode.toASCII(this.hostname)}var p=this.port?":"+this.port:"";var h=this.hostname||"";this.host=h+p;this.href+=this.host;if(ipv6Hostname){this.hostname=this.hostname.substr(1,this.hostname.length-2);if(rest[0]!=="/"){rest="/"+rest}}}if(!unsafeProtocol[lowerProto]){for(var i=0,l=autoEscape.length;i<l;i++){var ae=autoEscape[i];if(rest.indexOf(ae)===-1)continue;var esc=encodeURIComponent(ae);if(esc===ae){esc=escape(ae)}rest=rest.split(ae).join(esc)}}var hash=rest.indexOf("#");if(hash!==-1){this.hash=rest.substr(hash);rest=rest.slice(0,hash)}var qm=rest.indexOf("?");if(qm!==-1){this.search=rest.substr(qm);this.query=rest.substr(qm+1);if(parseQueryString){this.query=querystring.parse(this.query)}rest=rest.slice(0,qm)}else if(parseQueryString){this.search="";this.query={}}if(rest)this.pathname=rest;if(slashedProtocol[lowerProto]&&this.hostname&&!this.pathname){this.pathname="/"}if(this.pathname||this.search){var p=this.pathname||"";var s=this.search||"";this.path=p+s}this.href=this.format();return this};function urlFormat(obj){if(util.isString(obj))obj=urlParse(obj);if(!(obj instanceof Url2))return Url2.prototype.format.call(obj);return obj.format()}Url2.prototype.format=function(){var auth=this.auth||"";if(auth){auth=encodeURIComponent(auth);auth=auth.replace(/%3A/i,":");auth+="@"}var protocol=this.protocol||"",pathname=this.pathname||"",hash=this.hash||"",host=false,query="";if(this.host){host=auth+this.host}else if(this.hostname){host=auth+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]");if(this.port){host+=":"+this.port}}if(this.query&&util.isObject(this.query)&&Object.keys(this.query).length){query=querystring.stringify(this.query)}var search=this.search||query&&"?"+query||"";if(protocol&&protocol.substr(-1)!==":")protocol+=":";if(this.slashes||(!protocol||slashedProtocol[protocol])&&host!==false){host="//"+(host||"");if(pathname&&pathname.charAt(0)!=="/")pathname="/"+pathname}else if(!host){host=""}if(hash&&hash.charAt(0)!=="#")hash="#"+hash;if(search&&search.charAt(0)!=="?")search="?"+search;pathname=pathname.replace(/[?#]/g,function(match){return encodeURIComponent(match)});search=search.replace("#","%23");return protocol+host+pathname+search+hash};function urlResolve(source,relative){return urlParse(source,false,true).resolve(relative)}Url2.prototype.resolve=function(relative){return this.resolveObject(urlParse(relative,false,true)).format()};function urlResolveObject(source,relative){if(!source)return relative;return urlParse(source,false,true).resolveObject(relative)}Url2.prototype.resolveObject=function(relative){if(util.isString(relative)){var rel=new Url2;rel.parse(relative,false,true);relative=rel}var result=new Url2;var tkeys=Object.keys(this);for(var tk=0;tk<tkeys.length;tk++){var tkey=tkeys[tk];result[tkey]=this[tkey]}result.hash=relative.hash;if(relative.href===""){result.href=result.format();return result}if(relative.slashes&&!relative.protocol){var rkeys=Object.keys(relative);for(var rk=0;rk<rkeys.length;rk++){var rkey=rkeys[rk];if(rkey!=="protocol")result[rkey]=relative[rkey]}if(slashedProtocol[result.protocol]&&result.hostname&&!result.pathname){result.path=result.pathname="/"}result.href=result.format();return result}if(relative.protocol&&relative.protocol!==result.protocol){if(!slashedProtocol[relative.protocol]){var keys=Object.keys(relative);for(var v=0;v<keys.length;v++){var k=keys[v];result[k]=relative[k]}result.href=result.format();return result}result.protocol=relative.protocol;if(!relative.host&&!hostlessProtocol[relative.protocol]){var relPath=(relative.pathname||"").split("/");while(relPath.length&&!(relative.host=relPath.shift())){;}if(!relative.host)relative.host="";if(!relative.hostname)relative.hostname="";if(relPath[0]!=="")relPath.unshift("");if(relPath.length<2)relPath.unshift("");result.pathname=relPath.join("/")}else{result.pathname=relative.pathname}result.search=relative.search;result.query=relative.query;result.host=relative.host||"";result.auth=relative.auth;result.hostname=relative.hostname||relative.host;result.port=relative.port;if(result.pathname||result.search){var p=result.pathname||"";var s=result.search||"";result.path=p+s}result.slashes=result.slashes||relative.slashes;result.href=result.format();return result}var isSourceAbs=result.pathname&&result.pathname.charAt(0)==="/",isRelAbs=relative.host||relative.pathname&&relative.pathname.charAt(0)==="/",mustEndAbs=isRelAbs||isSourceAbs||result.host&&relative.pathname,removeAllDots=mustEndAbs,srcPath=result.pathname&&result.pathname.split("/")||[],relPath=relative.pathname&&relative.pathname.split("/")||[],psychotic=result.protocol&&!slashedProtocol[result.protocol];if(psychotic){result.hostname="";result.port=null;if(result.host){if(srcPath[0]==="")srcPath[0]=result.host;else srcPath.unshift(result.host)}result.host="";if(relative.protocol){relative.hostname=null;relative.port=null;if(relative.host){if(relPath[0]==="")relPath[0]=relative.host;else relPath.unshift(relative.host)}relative.host=null}mustEndAbs=mustEndAbs&&(relPath[0]===""||srcPath[0]==="")}if(isRelAbs){result.host=relative.host||relative.host===""?relative.host:result.host;result.hostname=relative.hostname||relative.hostname===""?relative.hostname:result.hostname;result.search=relative.search;result.query=relative.query;srcPath=relPath}else if(relPath.length){if(!srcPath)srcPath=[];srcPath.pop();srcPath=srcPath.concat(relPath);result.search=relative.search;result.query=relative.query}else if(!util.isNullOrUndefined(relative.search)){if(psychotic){result.hostname=result.host=srcPath.shift();var authInHost=result.host&&result.host.indexOf("@")>0?result.host.split("@"):false;if(authInHost){result.auth=authInHost.shift();result.host=result.hostname=authInHost.shift()}}result.search=relative.search;result.query=relative.query;if(!util.isNull(result.pathname)||!util.isNull(result.search)){result.path=(result.pathname?result.pathname:"")+(result.search?result.search:"")}result.href=result.format();return result}if(!srcPath.length){result.pathname=null;if(result.search){result.path="/"+result.search}else{result.path=null}result.href=result.format();return result}var last=srcPath.slice(-1)[0];var hasTrailingSlash=(result.host||relative.host||srcPath.length>1)&&(last==="."||last==="..")||last==="";var up=0;for(var i=srcPath.length;i>=0;i--){last=srcPath[i];if(last==="."){srcPath.splice(i,1)}else if(last===".."){srcPath.splice(i,1);up++}else if(up){srcPath.splice(i,1);up--}}if(!mustEndAbs&&!removeAllDots){for(;up--;up){srcPath.unshift("..")}}if(mustEndAbs&&srcPath[0]!==""&&(!srcPath[0]||srcPath[0].charAt(0)!=="/")){srcPath.unshift("")}if(hasTrailingSlash&&srcPath.join("/").substr(-1)!=="/"){srcPath.push("")}var isAbsolute=srcPath[0]===""||srcPath[0]&&srcPath[0].charAt(0)==="/";if(psychotic){result.hostname=result.host=isAbsolute?"":srcPath.length?srcPath.shift():"";var authInHost=result.host&&result.host.indexOf("@")>0?result.host.split("@"):false;if(authInHost){result.auth=authInHost.shift();result.host=result.hostname=authInHost.shift()}}mustEndAbs=mustEndAbs||result.host&&srcPath.length;if(mustEndAbs&&!isAbsolute){srcPath.unshift("")}if(!srcPath.length){result.pathname=null;result.path=null}else{result.pathname=srcPath.join("/")}if(!util.isNull(result.pathname)||!util.isNull(result.search)){result.path=(result.pathname?result.pathname:"")+(result.search?result.search:"")}result.auth=relative.auth||result.auth;result.slashes=result.slashes||relative.slashes;result.href=result.format();return result};Url2.prototype.parseHost=function(){var host=this.host;var port=portPattern.exec(host);if(port){port=port[0];if(port!==":"){this.port=port.substr(1)}host=host.substr(0,host.length-port.length)}if(host)this.hostname=host}}});var require_parse_uri=__commonJS({"node_modules/parse-uri/index.js":function node_modulesParseUriIndexJs(exports,module){"use strict";function parseURI(str,opts){if(!str)return void 0;opts=opts||{};var o={key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};var m=o.parser[opts.strictMode?"strict":"loose"].exec(str);var uri={};var i=14;while(i--){uri[o.key[i]]=m[i]||""}uri[o.q.name]={};uri[o.key[12]].replace(o.q.parser,function($0,$1,$2){if($1)uri[o.q.name][$1]=$2});return uri}module.exports=parseURI}});var require_mini_signals=__commonJS({"node_modules/mini-signals/lib/mini-signals.js":function node_modulesMiniSignalsLibMiniSignalsJs(exports,module){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass2=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var MiniSignalBinding=function(){function MiniSignalBinding2(fn,once,thisArg){if(once===void 0)once=false;_classCallCheck(this,MiniSignalBinding2);this._fn=fn;this._once=once;this._thisArg=thisArg;this._next=this._prev=this._owner=null}_createClass2(MiniSignalBinding2,[{key:"detach",value:function detach(){if(this._owner===null)return false;this._owner.detach(this);return true}}]);return MiniSignalBinding2}();function _addMiniSignalBinding(self2,node){if(!self2._head){self2._head=node;self2._tail=node}else{self2._tail._next=node;node._prev=self2._tail;self2._tail=node}node._owner=self2;return node}var MiniSignal=function(){function MiniSignal2(){_classCallCheck(this,MiniSignal2);this._head=this._tail=void 0}_createClass2(MiniSignal2,[{key:"handlers",value:function handlers(){var exists=arguments.length<=0||arguments[0]===void 0?false:arguments[0];var node=this._head;if(exists)return!!node;var ee=[];while(node){ee.push(node);node=node._next}return ee}},{key:"has",value:function has(node){if(!(node instanceof MiniSignalBinding)){throw new Error("MiniSignal#has(): First arg must be a MiniSignalBinding object.")}return node._owner===this}},{key:"dispatch",value:function dispatch(){var node=this._head;if(!node)return false;while(node){if(node._once)this.detach(node);node._fn.apply(node._thisArg,arguments);node=node._next}return true}},{key:"add",value:function add4(fn){var thisArg=arguments.length<=1||arguments[1]===void 0?null:arguments[1];if(typeof fn!=="function"){throw new Error("MiniSignal#add(): First arg must be a Function.")}return _addMiniSignalBinding(this,new MiniSignalBinding(fn,false,thisArg))}},{key:"once",value:function once(fn){var thisArg=arguments.length<=1||arguments[1]===void 0?null:arguments[1];if(typeof fn!=="function"){throw new Error("MiniSignal#once(): First arg must be a Function.")}return _addMiniSignalBinding(this,new MiniSignalBinding(fn,true,thisArg))}},{key:"detach",value:function detach(node){if(!(node instanceof MiniSignalBinding)){throw new Error("MiniSignal#detach(): First arg must be a MiniSignalBinding object.")}if(node._owner!==this)return this;if(node._prev)node._prev._next=node._next;if(node._next)node._next._prev=node._prev;if(node===this._head){this._head=node._next;if(node._next===null){this._tail=null}}else if(node===this._tail){this._tail=node._prev;this._tail._next=null}node._owner=null;return this}},{key:"detachAll",value:function detachAll(){var node=this._head;if(!node)return this;this._head=this._tail=null;while(node){node._owner=null;node=node._next}return this}}]);return MiniSignal2}();MiniSignal.MiniSignalBinding=MiniSignalBinding;exports["default"]=MiniSignal;module.exports=exports["default"]}});var require_pixi_tweener=__commonJS({"node_modules/pixi-tweener/dist/pixi-tweener.js":function node_modulesPixiTweenerDistPixiTweenerJs(exports,module){!function(t,e){_typeof(exports)=="object"&&_typeof(module)=="object"?module.exports=e():typeof define=="function"&&define.amd?define([],e):_typeof(exports)=="object"?exports.pixiTweener=e():t.pixiTweener=e()}(self,function(){return function(){"use strict";var t={679:function _(t2,e2){e2.__esModule=true,e2.Easing=void 0;var n=function(){function t3(){}return t3.linear=function(t4){return t4},t3.easeInQuad=function(t4){return Math.pow(t4,2)},t3.easeOutQuad=function(t4){return-(Math.pow(t4-1,2)-1)},t3.easeInOutQuad=function(t4){return(t4/=0.5)<1?0.5*Math.pow(t4,2):-0.5*((t4-=2)*t4-2)},t3.easeInCubic=function(t4){return Math.pow(t4,3)},t3.easeOutCubic=function(t4){return Math.pow(t4-1,3)+1},t3.easeInOutCubic=function(t4){return(t4/=0.5)<1?0.5*Math.pow(t4,3):0.5*(Math.pow(t4-2,3)+2)},t3.easeInQuart=function(t4){return Math.pow(t4,4)},t3.easeOutQuart=function(t4){return-(Math.pow(t4-1,4)-1)},t3.easeInOutQuart=function(t4){return(t4/=0.5)<1?0.5*Math.pow(t4,4):-0.5*((t4-=2)*Math.pow(t4,3)-2)},t3.easeInQuint=function(t4){return Math.pow(t4,5)},t3.easeOutQuint=function(t4){return Math.pow(t4-1,5)+1},t3.easeInOutQuint=function(t4){return(t4/=0.5)<1?0.5*Math.pow(t4,5):0.5*(Math.pow(t4-2,5)+2)},t3.easeInSine=function(t4){return 1-Math.cos(t4*(Math.PI/2))},t3.easeOutSine=function(t4){return Math.sin(t4*(Math.PI/2))},t3.easeInOutSine=function(t4){return-0.5*(Math.cos(Math.PI*t4)-1)},t3.easeInExpo=function(t4){return t4===0?0:Math.pow(2,10*(t4-1))},t3.easeOutExpo=function(t4){return t4===1?1:1-Math.pow(2,-10*t4)},t3.easeInOutExpo=function(t4){return t4===0?0:t4===1?1:(t4/=0.5)<1?0.5*Math.pow(2,10*(t4-1)):0.5*(2-Math.pow(2,-10*--t4))},t3.easeInCirc=function(t4){return-(Math.sqrt(1-t4*t4)-1)},t3.easeOutCirc=function(t4){return Math.sqrt(1-Math.pow(t4-1,2))},t3.easeInOutCirc=function(t4){return(t4/=0.5)<1?-0.5*(Math.sqrt(1-t4*t4)-1):0.5*(Math.sqrt(1-(t4-=2)*t4)+1)},t3.easeOutBounce=function(t4){return t4<1/2.75?7.5625*t4*t4:t4<2/2.75?7.5625*(t4-=1.5/2.75)*t4+0.75:t4<2.5/2.75?7.5625*(t4-=2.25/2.75)*t4+0.9375:7.5625*(t4-=2.625/2.75)*t4+0.984375},t3.easeInBack=function(t4){var e3=1.70158;return t4*t4*((e3+1)*t4-e3)},t3.easeOutBack=function(t4){var e3=1.70158;return(t4-=1)*t4*((e3+1)*t4+e3)+1},t3.easeInOutBack=function(t4){var e3=1.70158;return(t4/=0.5)<1?t4*t4*((1+(e3*=1.525))*t4-e3)*0.5:0.5*((t4-=2)*t4*((1+(e3*=1.525))*t4+e3)+2)},t3.elastic=function(t4){return-1*Math.pow(4,-8*t4)*Math.sin((6*t4-1)*(2*Math.PI)/2)+1},t3.swingFromTo=function(t4){var e3=1.70158;return(t4/=0.5)<1?t4*t4*((1+(e3*=1.525))*t4-e3)*0.5:0.5*((t4-=2)*t4*((1+(e3*=1.525))*t4+e3)+2)},t3.swingFrom=function(t4){var e3=1.70158;return t4*t4*((e3+1)*t4-e3)},t3.swingTo=function(t4){var e3=1.70158;return(t4-=1)*t4*((e3+1)*t4+e3)+1},t3.bounce=function(t4){return t4<1/2.75?7.5625*t4*t4:t4<2/2.75?7.5625*(t4-=1.5/2.75)*t4+0.75:t4<2.5/2.75?7.5625*(t4-=2.25/2.75)*t4+0.9375:7.5625*(t4-=2.625/2.75)*t4+0.984375},t3.bouncePast=function(t4){return t4<1/2.75?7.5625*t4*t4:t4<2/2.75?2-(7.5625*(t4-=1.5/2.75)*t4+0.75):t4<2.5/2.75?2-(7.5625*(t4-=2.25/2.75)*t4+0.9375):2-(7.5625*(t4-=2.625/2.75)*t4+0.984375)},t3.easeFromTo=function(t4){return(t4/=0.5)<1?0.5*Math.pow(t4,4):-0.5*((t4-=2)*Math.pow(t4,3)-2)},t3.easeFrom=function(t4){return Math.pow(t4,4)},t3.easeTo=function(t4){return Math.pow(t4,0.25)},t3}();e2.Easing=n},919:function _(t2,e2,n){var r=this&&this.__createBinding||(Object.create?function(t3,e3,n2,r2){r2===void 0&&(r2=n2),Object.defineProperty(t3,r2,{enumerable:true,get:function get(){return e3[n2]}})}:function(t3,e3,n2,r2){r2===void 0&&(r2=n2),t3[r2]=e3[n2]}),o=this&&this.__exportStar||function(t3,e3){for(var n2 in t3){n2==="default"||Object.prototype.hasOwnProperty.call(e3,n2)||r(e3,t3,n2)}};e2.__esModule=true,o(n(679),e2),o(n(60),e2)},60:function _(t2,e2,n){var r=this&&this.__spreadArrays||function(){for(var t3=0,e3=0,n2=arguments.length;e3<n2;e3++){t3+=arguments[e3].length}var r2=Array(t3),o2=0;for(e3=0;e3<n2;e3++){for(var u2=arguments[e3],a=0,i=u2.length;a<i;a++,o2++){r2[o2]=u2[a]}}return r2};e2.__esModule=true,e2.Tweener=void 0;var o=n(679),u=function(){function t3(){}return t3.init=function(e3){t3.ticker||(t3.ticker=e3,t3.ticker.add(t3.update))},t3.tweening=function(){return t3.tweens.length>0},t3.dispose=function(){t3.ticker&&(t3.ticker.remove(t3.update),t3.ticker=void 0,t3.tweens=[])},t3.add=function(e3,n2){var u2=e3.target,a=Object.assign.apply(Object,r([{}],Object.keys(n2).map(function(t4){var e4;return(e4={})[t4]=u2[t4],e4}))),i=Object.assign.apply(Object,r([{}],Object.keys(n2).map(function(t4){var e4;return(e4={})[t4]=n2[t4]-a[t4],e4}))),c=e3.useTickForDuration?e3.duration:1e3*e3.duration;return new Promise(function(r2){var s={duration:c,useTickForDuration:!!e3.useTickForDuration,ease:e3.ease||o.Easing.linear,target:e3.target,delay:e3.delay?1e3*e3.delay:0,currentTime:0,props:n2,propDeltas:i,startingProps:a,onComplete:r2,onUpdate:e3.onUpdate||void 0,context:e3.context||u2};t3.tweens.push(s)})},t3.killTweensOf=function(e3,n2){var r2=[];t3.tweens.forEach(function(t4){t4.context===e3||t4.target===e3?!n2&&t4.onComplete():r2.push(t4)}),t3.tweens=r2},t3.advance=function(e3){for(var n2=false,r2=0,o2=t3.tweens;r2<o2.length;r2++){var u2=o2[r2],a=u2.useTickForDuration?1:e3;if(u2.delay>0){if(u2.delay-=a,!(u2.delay<=0))continue;a=-u2.delay}u2.currentTime+=a;for(var i=Math.min(1,u2.currentTime/u2.duration),c=u2.ease(i),s=0,f=Object.keys(u2.props);s<f.length;s++){var p=f[s];u2.target[p]=u2.startingProps[p]+c*u2.propDeltas[p]}u2.onUpdate&&u2.onUpdate(i),u2.currentTime>=u2.duration&&(u2.onComplete(),n2=true)}n2&&(t3.tweens=t3.tweens.filter(function(t4){return t4.currentTime<t4.duration}))},t3.tweens=[],t3.update=function(){return t3.advance(t3.ticker.elapsedMS)},t3}();e2.Tweener=u}},e={};return function n(r){if(e[r])return e[r].exports;var o=e[r]={exports:{}};return t[r].call(o.exports,o,o.exports,n),o.exports}(919)}()})}});var import_es6_promise_polyfill=__toModule(require_promise());var import_object_assign=__toModule(require_object_assign());if(!window.Promise){window.Promise=import_es6_promise_polyfill.Polyfill}if(!Object.assign){Object.assign=import_object_assign.default}var commonjsGlobal=typeof globalThis!=="undefined"?globalThis:typeof window!=="undefined"?window:typeof global!=="undefined"?global:typeof self!=="undefined"?self:{};var ONE_FRAME_TIME=16;if(!(Date.now&&Date.prototype.getTime)){Date.now=function now(){return new Date().getTime()}}if(!(commonjsGlobal.performance&&commonjsGlobal.performance.now)){startTime=Date.now();if(!commonjsGlobal.performance){commonjsGlobal.performance={}}commonjsGlobal.performance.now=function(){return Date.now()-startTime}}var startTime;var lastTime=Date.now();var vendors=["ms","moz","webkit","o"];for(x=0;x<vendors.length&&!commonjsGlobal.requestAnimationFrame;++x){p=vendors[x];commonjsGlobal.requestAnimationFrame=commonjsGlobal[p+"RequestAnimationFrame"];commonjsGlobal.cancelAnimationFrame=commonjsGlobal[p+"CancelAnimationFrame"]||commonjsGlobal[p+"CancelRequestAnimationFrame"]}var p;var x;if(!commonjsGlobal.requestAnimationFrame){commonjsGlobal.requestAnimationFrame=function(callback){if(typeof callback!=="function"){throw new TypeError(callback+"is not a function")}var currentTime=Date.now();var delay=ONE_FRAME_TIME+lastTime-currentTime;if(delay<0){delay=0}lastTime=currentTime;return setTimeout(function(){lastTime=Date.now();callback(performance.now())},delay)}}if(!commonjsGlobal.cancelAnimationFrame){commonjsGlobal.cancelAnimationFrame=function(id){return clearTimeout(id)}}if(!Math.sign){Math.sign=function mathSign(x){x=Number(x);if(x===0||isNaN(x)){return x}return x>0?1:-1}}if(!Number.isInteger){Number.isInteger=function numberIsInteger(value){return typeof value==="number"&&isFinite(value)&&Math.floor(value)===value}}if(!window.ArrayBuffer){window.ArrayBuffer=Array}if(!window.Float32Array){window.Float32Array=Array}if(!window.Uint32Array){window.Uint32Array=Array}if(!window.Uint16Array){window.Uint16Array=Array}if(!window.Uint8Array){window.Uint8Array=Array}if(!window.Int32Array){window.Int32Array=Array}var accessibility_es_exports={};__export(accessibility_es_exports,{AccessibilityManager:function AccessibilityManager(){return _AccessibilityManager},accessibleTarget:function accessibleTarget(){return _accessibleTarget}});var utils_es_exports={};__export(utils_es_exports,{BaseTextureCache:function BaseTextureCache(){return _BaseTextureCache},CanvasRenderTarget:function CanvasRenderTarget(){return _CanvasRenderTarget},DATA_URI:function DATA_URI(){return _DATA_URI},EventEmitter:function EventEmitter(){return import_eventemitter3.default},ProgramCache:function ProgramCache(){return _ProgramCache},TextureCache:function TextureCache(){return _TextureCache},clearTextureCache:function clearTextureCache(){return _clearTextureCache},correctBlendMode:function correctBlendMode(){return _correctBlendMode},createIndicesForQuads:function createIndicesForQuads(){return _createIndicesForQuads},decomposeDataUri:function decomposeDataUri(){return _decomposeDataUri},deprecation:function deprecation(){return _deprecation},destroyTextureCache:function destroyTextureCache(){return _destroyTextureCache},determineCrossOrigin:function determineCrossOrigin(){return _determineCrossOrigin2},earcut:function earcut(){return import_earcut.default},getBufferType:function getBufferType(){return _getBufferType},getResolutionOfUrl:function getResolutionOfUrl(){return _getResolutionOfUrl},hex2rgb:function hex2rgb(){return _hex2rgb},hex2string:function hex2string(){return _hex2string},interleaveTypedArrays:function interleaveTypedArrays(){return _interleaveTypedArrays},isMobile:function isMobile(){return isMobile2},isPow2:function isPow2(){return _isPow},isWebGLSupported:function isWebGLSupported(){return _isWebGLSupported},log2:function log2(){return _log},nextPow2:function nextPow2(){return _nextPow},premultiplyBlendMode:function premultiplyBlendMode(){return _premultiplyBlendMode},premultiplyRgba:function premultiplyRgba(){return _premultiplyRgba},premultiplyTint:function premultiplyTint(){return _premultiplyTint},premultiplyTintToRgba:function premultiplyTintToRgba(){return _premultiplyTintToRgba},removeItems:function removeItems(){return _removeItems},rgb2hex:function rgb2hex(){return _rgb2hex},sayHello:function sayHello(){return _sayHello},sign:function sign(){return _sign},skipHello:function skipHello(){return _skipHello},string2hex:function string2hex(){return _string2hex},trimCanvas:function trimCanvas(){return _trimCanvas},uid:function uid(){return _uid},url:function url(){return import_url2.default}});var appleIphone=/iPhone/i;var appleIpod=/iPod/i;var appleTablet=/iPad/i;var appleUniversal=/\biOS-universal(?:.+)Mac\b/i;var androidPhone=/\bAndroid(?:.+)Mobile\b/i;var androidTablet=/Android/i;var amazonPhone=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i;var amazonTablet=/Silk/i;var windowsPhone=/Windows Phone/i;var windowsTablet=/\bWindows(?:.+)ARM\b/i;var otherBlackBerry=/BlackBerry/i;var otherBlackBerry10=/BB10/i;var otherOpera=/Opera Mini/i;var otherChrome=/\b(CriOS|Chrome)(?:.+)Mobile/i;var otherFirefox=/Mobile(?:.+)Firefox\b/i;var isAppleTabletOnIos13=function isAppleTabletOnIos13(navigator2){return typeof navigator2!=="undefined"&&navigator2.platform==="MacIntel"&&typeof navigator2.maxTouchPoints==="number"&&navigator2.maxTouchPoints>1&&typeof MSStream==="undefined"};function createMatch(userAgent){return function(regex){return regex.test(userAgent)}}function isMobile(param){var nav={userAgent:"",platform:"",maxTouchPoints:0};if(!param&&typeof navigator!=="undefined"){nav={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}}else if(typeof param==="string"){nav.userAgent=param}else if(param&&param.userAgent){nav={userAgent:param.userAgent,platform:param.platform,maxTouchPoints:param.maxTouchPoints||0}}var userAgent=nav.userAgent;var tmp=userAgent.split("[FBAN");if(typeof tmp[1]!=="undefined"){userAgent=tmp[0]}tmp=userAgent.split("Twitter");if(typeof tmp[1]!=="undefined"){userAgent=tmp[0]}var match=createMatch(userAgent);var result={apple:{phone:match(appleIphone)&&!match(windowsPhone),ipod:match(appleIpod),tablet:!match(appleIphone)&&(match(appleTablet)||isAppleTabletOnIos13(nav))&&!match(windowsPhone),universal:match(appleUniversal),device:(match(appleIphone)||match(appleIpod)||match(appleTablet)||match(appleUniversal)||isAppleTabletOnIos13(nav))&&!match(windowsPhone)},amazon:{phone:match(amazonPhone),tablet:!match(amazonPhone)&&match(amazonTablet),device:match(amazonPhone)||match(amazonTablet)},android:{phone:!match(windowsPhone)&&match(amazonPhone)||!match(windowsPhone)&&match(androidPhone),tablet:!match(windowsPhone)&&!match(amazonPhone)&&!match(androidPhone)&&(match(amazonTablet)||match(androidTablet)),device:!match(windowsPhone)&&(match(amazonPhone)||match(amazonTablet)||match(androidPhone)||match(androidTablet))||match(/\bokhttp\b/i)},windows:{phone:match(windowsPhone),tablet:match(windowsTablet),device:match(windowsPhone)||match(windowsTablet)},other:{blackberry:match(otherBlackBerry),blackberry10:match(otherBlackBerry10),opera:match(otherOpera),firefox:match(otherFirefox),chrome:match(otherChrome),device:match(otherBlackBerry)||match(otherBlackBerry10)||match(otherOpera)||match(otherFirefox)||match(otherChrome)},any:false,phone:false,tablet:false};result.any=result.apple.device||result.android.device||result.windows.device||result.other.device;result.phone=result.apple.phone||result.android.phone||result.windows.phone;result.tablet=result.apple.tablet||result.android.tablet||result.windows.tablet;return result}var isMobile2=isMobile(window.navigator);function maxRecommendedTextures(max){var allowMax=true;if(isMobile2.tablet||isMobile2.phone){allowMax=false;if(isMobile2.apple.device){var match=navigator.userAgent.match(/OS (\d+)_(\d+)?/);if(match){var majorVersion=parseInt(match[1],10);if(majorVersion>=11){allowMax=true}}}if(isMobile2.android.device){var match$1=navigator.userAgent.match(/Android\s([0-9.]*)/);if(match$1){var majorVersion$1=parseInt(match$1[1],10);if(majorVersion$1>=7){allowMax=true}}}}return allowMax?max:4}function canUploadSameBuffer(){return!isMobile2.apple.device}var settings={MIPMAP_TEXTURES:1,ANISOTROPIC_LEVEL:0,RESOLUTION:1,FILTER_RESOLUTION:1,SPRITE_MAX_TEXTURES:maxRecommendedTextures(32),SPRITE_BATCH_SIZE:4096,RENDER_OPTIONS:{view:null,antialias:false,forceFXAA:false,autoDensity:false,transparent:false,backgroundColor:0,clearBeforeRender:true,preserveDrawingBuffer:false,width:800,height:600,legacy:false},GC_MODE:0,GC_MAX_IDLE:60*60,GC_MAX_CHECK_COUNT:60*10,WRAP_MODE:33071,SCALE_MODE:1,PRECISION_VERTEX:"highp",PRECISION_FRAGMENT:isMobile2.apple.device?"highp":"mediump",CAN_UPLOAD_SAME_BUFFER:canUploadSameBuffer(),CREATE_IMAGE_BITMAP:false,ROUND_PIXELS:false};var import_eventemitter3=__toModule(require_eventemitter3());var import_earcut=__toModule(require_earcut());var import_url=__toModule(require_url());var import_url2=__toModule(require_url());var ENV;(function(ENV2){ENV2[ENV2["WEBGL_LEGACY"]=0]="WEBGL_LEGACY";ENV2[ENV2["WEBGL"]=1]="WEBGL";ENV2[ENV2["WEBGL2"]=2]="WEBGL2"})(ENV||(ENV={}));var RENDERER_TYPE;(function(RENDERER_TYPE2){RENDERER_TYPE2[RENDERER_TYPE2["UNKNOWN"]=0]="UNKNOWN";RENDERER_TYPE2[RENDERER_TYPE2["WEBGL"]=1]="WEBGL";RENDERER_TYPE2[RENDERER_TYPE2["CANVAS"]=2]="CANVAS"})(RENDERER_TYPE||(RENDERER_TYPE={}));var BLEND_MODES;(function(BLEND_MODES2){BLEND_MODES2[BLEND_MODES2["NORMAL"]=0]="NORMAL";BLEND_MODES2[BLEND_MODES2["ADD"]=1]="ADD";BLEND_MODES2[BLEND_MODES2["MULTIPLY"]=2]="MULTIPLY";BLEND_MODES2[BLEND_MODES2["SCREEN"]=3]="SCREEN";BLEND_MODES2[BLEND_MODES2["OVERLAY"]=4]="OVERLAY";BLEND_MODES2[BLEND_MODES2["DARKEN"]=5]="DARKEN";BLEND_MODES2[BLEND_MODES2["LIGHTEN"]=6]="LIGHTEN";BLEND_MODES2[BLEND_MODES2["COLOR_DODGE"]=7]="COLOR_DODGE";BLEND_MODES2[BLEND_MODES2["COLOR_BURN"]=8]="COLOR_BURN";BLEND_MODES2[BLEND_MODES2["HARD_LIGHT"]=9]="HARD_LIGHT";BLEND_MODES2[BLEND_MODES2["SOFT_LIGHT"]=10]="SOFT_LIGHT";BLEND_MODES2[BLEND_MODES2["DIFFERENCE"]=11]="DIFFERENCE";BLEND_MODES2[BLEND_MODES2["EXCLUSION"]=12]="EXCLUSION";BLEND_MODES2[BLEND_MODES2["HUE"]=13]="HUE";BLEND_MODES2[BLEND_MODES2["SATURATION"]=14]="SATURATION";BLEND_MODES2[BLEND_MODES2["COLOR"]=15]="COLOR";BLEND_MODES2[BLEND_MODES2["LUMINOSITY"]=16]="LUMINOSITY";BLEND_MODES2[BLEND_MODES2["NORMAL_NPM"]=17]="NORMAL_NPM";BLEND_MODES2[BLEND_MODES2["ADD_NPM"]=18]="ADD_NPM";BLEND_MODES2[BLEND_MODES2["SCREEN_NPM"]=19]="SCREEN_NPM";BLEND_MODES2[BLEND_MODES2["NONE"]=20]="NONE";BLEND_MODES2[BLEND_MODES2["SRC_OVER"]=0]="SRC_OVER";BLEND_MODES2[BLEND_MODES2["SRC_IN"]=21]="SRC_IN";BLEND_MODES2[BLEND_MODES2["SRC_OUT"]=22]="SRC_OUT";BLEND_MODES2[BLEND_MODES2["SRC_ATOP"]=23]="SRC_ATOP";BLEND_MODES2[BLEND_MODES2["DST_OVER"]=24]="DST_OVER";BLEND_MODES2[BLEND_MODES2["DST_IN"]=25]="DST_IN";BLEND_MODES2[BLEND_MODES2["DST_OUT"]=26]="DST_OUT";BLEND_MODES2[BLEND_MODES2["DST_ATOP"]=27]="DST_ATOP";BLEND_MODES2[BLEND_MODES2["ERASE"]=26]="ERASE";BLEND_MODES2[BLEND_MODES2["SUBTRACT"]=28]="SUBTRACT";BLEND_MODES2[BLEND_MODES2["XOR"]=29]="XOR"})(BLEND_MODES||(BLEND_MODES={}));var DRAW_MODES;(function(DRAW_MODES2){DRAW_MODES2[DRAW_MODES2["POINTS"]=0]="POINTS";DRAW_MODES2[DRAW_MODES2["LINES"]=1]="LINES";DRAW_MODES2[DRAW_MODES2["LINE_LOOP"]=2]="LINE_LOOP";DRAW_MODES2[DRAW_MODES2["LINE_STRIP"]=3]="LINE_STRIP";DRAW_MODES2[DRAW_MODES2["TRIANGLES"]=4]="TRIANGLES";DRAW_MODES2[DRAW_MODES2["TRIANGLE_STRIP"]=5]="TRIANGLE_STRIP";DRAW_MODES2[DRAW_MODES2["TRIANGLE_FAN"]=6]="TRIANGLE_FAN"})(DRAW_MODES||(DRAW_MODES={}));var FORMATS;(function(FORMATS2){FORMATS2[FORMATS2["RGBA"]=6408]="RGBA";FORMATS2[FORMATS2["RGB"]=6407]="RGB";FORMATS2[FORMATS2["ALPHA"]=6406]="ALPHA";FORMATS2[FORMATS2["LUMINANCE"]=6409]="LUMINANCE";FORMATS2[FORMATS2["LUMINANCE_ALPHA"]=6410]="LUMINANCE_ALPHA";FORMATS2[FORMATS2["DEPTH_COMPONENT"]=6402]="DEPTH_COMPONENT";FORMATS2[FORMATS2["DEPTH_STENCIL"]=34041]="DEPTH_STENCIL"})(FORMATS||(FORMATS={}));var TARGETS;(function(TARGETS2){TARGETS2[TARGETS2["TEXTURE_2D"]=3553]="TEXTURE_2D";TARGETS2[TARGETS2["TEXTURE_CUBE_MAP"]=34067]="TEXTURE_CUBE_MAP";TARGETS2[TARGETS2["TEXTURE_2D_ARRAY"]=35866]="TEXTURE_2D_ARRAY";TARGETS2[TARGETS2["TEXTURE_CUBE_MAP_POSITIVE_X"]=34069]="TEXTURE_CUBE_MAP_POSITIVE_X";TARGETS2[TARGETS2["TEXTURE_CUBE_MAP_NEGATIVE_X"]=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X";TARGETS2[TARGETS2["TEXTURE_CUBE_MAP_POSITIVE_Y"]=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y";TARGETS2[TARGETS2["TEXTURE_CUBE_MAP_NEGATIVE_Y"]=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y";TARGETS2[TARGETS2["TEXTURE_CUBE_MAP_POSITIVE_Z"]=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z";TARGETS2[TARGETS2["TEXTURE_CUBE_MAP_NEGATIVE_Z"]=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z"})(TARGETS||(TARGETS={}));var TYPES;(function(TYPES2){TYPES2[TYPES2["UNSIGNED_BYTE"]=5121]="UNSIGNED_BYTE";TYPES2[TYPES2["UNSIGNED_SHORT"]=5123]="UNSIGNED_SHORT";TYPES2[TYPES2["UNSIGNED_SHORT_5_6_5"]=33635]="UNSIGNED_SHORT_5_6_5";TYPES2[TYPES2["UNSIGNED_SHORT_4_4_4_4"]=32819]="UNSIGNED_SHORT_4_4_4_4";TYPES2[TYPES2["UNSIGNED_SHORT_5_5_5_1"]=32820]="UNSIGNED_SHORT_5_5_5_1";TYPES2[TYPES2["FLOAT"]=5126]="FLOAT";TYPES2[TYPES2["HALF_FLOAT"]=36193]="HALF_FLOAT"})(TYPES||(TYPES={}));var SCALE_MODES;(function(SCALE_MODES2){SCALE_MODES2[SCALE_MODES2["NEAREST"]=0]="NEAREST";SCALE_MODES2[SCALE_MODES2["LINEAR"]=1]="LINEAR"})(SCALE_MODES||(SCALE_MODES={}));var WRAP_MODES;(function(WRAP_MODES2){WRAP_MODES2[WRAP_MODES2["CLAMP"]=33071]="CLAMP";WRAP_MODES2[WRAP_MODES2["REPEAT"]=10497]="REPEAT";WRAP_MODES2[WRAP_MODES2["MIRRORED_REPEAT"]=33648]="MIRRORED_REPEAT"})(WRAP_MODES||(WRAP_MODES={}));var MIPMAP_MODES;(function(MIPMAP_MODES2){MIPMAP_MODES2[MIPMAP_MODES2["OFF"]=0]="OFF";MIPMAP_MODES2[MIPMAP_MODES2["POW2"]=1]="POW2";MIPMAP_MODES2[MIPMAP_MODES2["ON"]=2]="ON"})(MIPMAP_MODES||(MIPMAP_MODES={}));var ALPHA_MODES;(function(ALPHA_MODES2){ALPHA_MODES2[ALPHA_MODES2["NPM"]=0]="NPM";ALPHA_MODES2[ALPHA_MODES2["UNPACK"]=1]="UNPACK";ALPHA_MODES2[ALPHA_MODES2["PMA"]=2]="PMA";ALPHA_MODES2[ALPHA_MODES2["NO_PREMULTIPLIED_ALPHA"]=0]="NO_PREMULTIPLIED_ALPHA";ALPHA_MODES2[ALPHA_MODES2["PREMULTIPLY_ON_UPLOAD"]=1]="PREMULTIPLY_ON_UPLOAD";ALPHA_MODES2[ALPHA_MODES2["PREMULTIPLY_ALPHA"]=2]="PREMULTIPLY_ALPHA"})(ALPHA_MODES||(ALPHA_MODES={}));var GC_MODES;(function(GC_MODES2){GC_MODES2[GC_MODES2["AUTO"]=0]="AUTO";GC_MODES2[GC_MODES2["MANUAL"]=1]="MANUAL"})(GC_MODES||(GC_MODES={}));var PRECISION;(function(PRECISION2){PRECISION2["LOW"]="lowp";PRECISION2["MEDIUM"]="mediump";PRECISION2["HIGH"]="highp"})(PRECISION||(PRECISION={}));var MASK_TYPES;(function(MASK_TYPES2){MASK_TYPES2[MASK_TYPES2["NONE"]=0]="NONE";MASK_TYPES2[MASK_TYPES2["SCISSOR"]=1]="SCISSOR";MASK_TYPES2[MASK_TYPES2["STENCIL"]=2]="STENCIL";MASK_TYPES2[MASK_TYPES2["SPRITE"]=3]="SPRITE"})(MASK_TYPES||(MASK_TYPES={}));settings.RETINA_PREFIX=/@([0-9\.]+)x/;settings.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=true;var saidHello=false;var VERSION="5.2.5";function _skipHello(){saidHello=true}function _sayHello(type){var _a;if(saidHello){return}if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var args=["\n %c %c %c PixiJS "+VERSION+" - \u2730 "+type+" \u2730  %c  %c  http://www.pixijs.com/  %c %c \u2665%c\u2665%c\u2665 \n\n","background: #ff66a5; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff66a5; background: #030307; padding:5px 0;","background: #ff66a5; padding:5px 0;","background: #ffc3dc; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;"];(_a=window.console).log.apply(_a,args)}else if(window.console){window.console.log("PixiJS "+VERSION+" - "+type+" - http://www.pixijs.com/")}saidHello=true}var supported;function _isWebGLSupported(){if(typeof supported==="undefined"){supported=function supported2(){var contextOptions={stencil:true,failIfMajorPerformanceCaveat:settings.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!window.WebGLRenderingContext){return false}var canvas4=document.createElement("canvas");var gl=canvas4.getContext("webgl",contextOptions)||canvas4.getContext("experimental-webgl",contextOptions);var success=!!(gl&&gl.getContextAttributes().stencil);if(gl){var loseContext=gl.getExtension("WEBGL_lose_context");if(loseContext){loseContext.loseContext()}}gl=null;return success}catch(e){return false}}()}return supported}function _hex2rgb(hex,out){out=out||[];out[0]=(hex>>16&255)/255;out[1]=(hex>>8&255)/255;out[2]=(hex&255)/255;return out}function _hex2string(hex){var hexString=hex.toString(16);hexString="000000".substr(0,6-hexString.length)+hexString;return"#"+hexString}function _string2hex(string){if(typeof string==="string"&&string[0]==="#"){string=string.substr(1)}return parseInt(string,16)}function _rgb2hex(rgb){return(rgb[0]*255<<16)+(rgb[1]*255<<8)+(rgb[2]*255|0)}function mapPremultipliedBlendModes(){var pm=[];var npm=[];for(var i=0;i<32;i++){pm[i]=i;npm[i]=i}pm[BLEND_MODES.NORMAL_NPM]=BLEND_MODES.NORMAL;pm[BLEND_MODES.ADD_NPM]=BLEND_MODES.ADD;pm[BLEND_MODES.SCREEN_NPM]=BLEND_MODES.SCREEN;npm[BLEND_MODES.NORMAL]=BLEND_MODES.NORMAL_NPM;npm[BLEND_MODES.ADD]=BLEND_MODES.ADD_NPM;npm[BLEND_MODES.SCREEN]=BLEND_MODES.SCREEN_NPM;var array=[];array.push(npm);array.push(pm);return array}var _premultiplyBlendMode=mapPremultipliedBlendModes();function _correctBlendMode(blendMode,premultiplied){return _premultiplyBlendMode[premultiplied?1:0][blendMode]}function _premultiplyRgba(rgb,alpha,out,premultiply){out=out||new Float32Array(4);if(premultiply||premultiply===void 0){out[0]=rgb[0]*alpha;out[1]=rgb[1]*alpha;out[2]=rgb[2]*alpha}else{out[0]=rgb[0];out[1]=rgb[1];out[2]=rgb[2]}out[3]=alpha;return out}function _premultiplyTint(tint,alpha){if(alpha===1){return(alpha*255<<24)+tint}if(alpha===0){return 0}var R=tint>>16&255;var G=tint>>8&255;var B=tint&255;R=R*alpha+0.5|0;G=G*alpha+0.5|0;B=B*alpha+0.5|0;return(alpha*255<<24)+(R<<16)+(G<<8)+B}function _premultiplyTintToRgba(tint,alpha,out,premultiply){out=out||new Float32Array(4);out[0]=(tint>>16&255)/255;out[1]=(tint>>8&255)/255;out[2]=(tint&255)/255;if(premultiply||premultiply===void 0){out[0]*=alpha;out[1]*=alpha;out[2]*=alpha}out[3]=alpha;return out}function _createIndicesForQuads(size,outBuffer){if(outBuffer===void 0){outBuffer=null}var totalIndices=size*6;outBuffer=outBuffer||new Uint16Array(totalIndices);if(outBuffer.length!==totalIndices){throw new Error("Out buffer length is incorrect, got "+outBuffer.length+" and expected "+totalIndices)}for(var i=0,j=0;i<totalIndices;i+=6,j+=4){outBuffer[i+0]=j+0;outBuffer[i+1]=j+1;outBuffer[i+2]=j+2;outBuffer[i+3]=j+0;outBuffer[i+4]=j+2;outBuffer[i+5]=j+3}return outBuffer}function _getBufferType(array){if(array.BYTES_PER_ELEMENT===4){if(array instanceof Float32Array){return"Float32Array"}else if(array instanceof Uint32Array){return"Uint32Array"}return"Int32Array"}else if(array.BYTES_PER_ELEMENT===2){if(array instanceof Uint16Array){return"Uint16Array"}}else if(array.BYTES_PER_ELEMENT===1){if(array instanceof Uint8Array){return"Uint8Array"}}return null}var map={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array};function _interleaveTypedArrays(arrays,sizes){var outSize=0;var stride=0;var views={};for(var i=0;i<arrays.length;i++){stride+=sizes[i];outSize+=arrays[i].length}var buffer=new ArrayBuffer(outSize*4);var out=null;var littleOffset=0;for(var i=0;i<arrays.length;i++){var size=sizes[i];var array=arrays[i];var type=_getBufferType(array);if(!views[type]){views[type]=new map[type](buffer)}out=views[type];for(var j=0;j<array.length;j++){var indexStart=(j/size|0)*stride+littleOffset;var index3=j%size;out[indexStart+index3]=array[j]}littleOffset+=size}return new Float32Array(buffer)}function _nextPow(v){v+=v===0?1:0;--v;v|=v>>>1;v|=v>>>2;v|=v>>>4;v|=v>>>8;v|=v>>>16;return v+1}function _isPow(v){return!(v&v-1)&&!!v}function _log(v){var r=(v>65535?1:0)<<4;v>>>=r;var shift=(v>255?1:0)<<3;v>>>=shift;r|=shift;shift=(v>15?1:0)<<2;v>>>=shift;r|=shift;shift=(v>3?1:0)<<1;v>>>=shift;r|=shift;return r|v>>1}function _removeItems(arr,startIdx,removeCount){var length=arr.length;var i;if(startIdx>=length||removeCount===0){return}removeCount=startIdx+removeCount>length?length-startIdx:removeCount;var len=length-removeCount;for(i=startIdx;i<len;++i){arr[i]=arr[i+removeCount]}arr.length=len}function _sign(n){if(n===0){return 0}return n<0?-1:1}var nextUid=0;function _uid(){return++nextUid}var warnings={};function _deprecation(version,message,ignoreDepth){if(ignoreDepth===void 0){ignoreDepth=3}if(warnings[message]){return}var stack=new Error().stack;if(typeof stack==="undefined"){console.warn("PixiJS Deprecation Warning: ",message+"\nDeprecated since v"+version)}else{stack=stack.split("\n").splice(ignoreDepth).join("\n");if(console.groupCollapsed){console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",message+"\nDeprecated since v"+version);console.warn(stack);console.groupEnd()}else{console.warn("PixiJS Deprecation Warning: ",message+"\nDeprecated since v"+version);console.warn(stack)}}warnings[message]=true}var _ProgramCache={};var _TextureCache=Object.create(null);var _BaseTextureCache=Object.create(null);function _destroyTextureCache(){var key;for(key in _TextureCache){_TextureCache[key].destroy()}for(key in _BaseTextureCache){_BaseTextureCache[key].destroy()}}function _clearTextureCache(){var key;for(key in _TextureCache){delete _TextureCache[key]}for(key in _BaseTextureCache){delete _BaseTextureCache[key]}}var _CanvasRenderTarget=function(){function CanvasRenderTarget2(width,height,resolution){this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d");this.resolution=resolution||settings.RESOLUTION;this.resize(width,height)}CanvasRenderTarget2.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0);this.context.clearRect(0,0,this.canvas.width,this.canvas.height)};CanvasRenderTarget2.prototype.resize=function(width,height){this.canvas.width=width*this.resolution;this.canvas.height=height*this.resolution};CanvasRenderTarget2.prototype.destroy=function(){this.context=null;this.canvas=null};Object.defineProperty(CanvasRenderTarget2.prototype,"width",{get:function get(){return this.canvas.width},set:function set(val){this.canvas.width=val},enumerable:true,configurable:true});Object.defineProperty(CanvasRenderTarget2.prototype,"height",{get:function get(){return this.canvas.height},set:function set(val){this.canvas.height=val},enumerable:true,configurable:true});return CanvasRenderTarget2}();function _trimCanvas(canvas4){var width=canvas4.width;var height=canvas4.height;var context2=canvas4.getContext("2d");var imageData=context2.getImageData(0,0,width,height);var pixels3=imageData.data;var len=pixels3.length;var bound={top:null,left:null,right:null,bottom:null};var data=null;var i;var x;var y;for(i=0;i<len;i+=4){if(pixels3[i+3]!==0){x=i/4%width;y=~~(i/4/width);if(bound.top===null){bound.top=y}if(bound.left===null){bound.left=x}else if(x<bound.left){bound.left=x}if(bound.right===null){bound.right=x+1}else if(bound.right<x){bound.right=x+1}if(bound.bottom===null){bound.bottom=y}else if(bound.bottom<y){bound.bottom=y}}}if(bound.top!==null){width=bound.right-bound.left;height=bound.bottom-bound.top+1;data=context2.getImageData(bound.left,bound.top,width,height)}return{height:height,width:width,data:data}}var _DATA_URI=/^\s*data:(?:([\w-]+)\/([\w+.-]+))?(?:;charset=([\w-]+))?(?:;(base64))?,(.*)/i;function _decomposeDataUri(dataUri){var dataUriMatch=_DATA_URI.exec(dataUri);if(dataUriMatch){return{mediaType:dataUriMatch[1]?dataUriMatch[1].toLowerCase():void 0,subType:dataUriMatch[2]?dataUriMatch[2].toLowerCase():void 0,charset:dataUriMatch[3]?dataUriMatch[3].toLowerCase():void 0,encoding:dataUriMatch[4]?dataUriMatch[4].toLowerCase():void 0,data:dataUriMatch[5]}}return void 0}var tempAnchor;function _determineCrossOrigin2(url,loc){if(loc===void 0){loc=window.location}if(url.indexOf("data:")===0){return""}loc=loc||window.location;if(!tempAnchor){tempAnchor=document.createElement("a")}tempAnchor.href=url;var parsedUrl=(0,import_url.parse)(tempAnchor.href);var samePort=!parsedUrl.port&&loc.port===""||parsedUrl.port===loc.port;if(parsedUrl.hostname!==loc.hostname||!samePort||parsedUrl.protocol!==loc.protocol){return"anonymous"}return""}function _getResolutionOfUrl(url,defaultValue2){var resolution=settings.RETINA_PREFIX.exec(url);if(resolution){return parseFloat(resolution[1])}return defaultValue2!==void 0?defaultValue2:1}var Point=function(){function Point2(x,y){if(x===void 0){x=0}if(y===void 0){y=0}this.x=x;this.y=y}Point2.prototype.clone=function(){return new Point2(this.x,this.y)};Point2.prototype.copyFrom=function(p){this.set(p.x,p.y);return this};Point2.prototype.copyTo=function(p){p.set(this.x,this.y);return p};Point2.prototype.equals=function(p){return p.x===this.x&&p.y===this.y};Point2.prototype.set=function(x,y){if(x===void 0){x=0}if(y===void 0){y=x}this.x=x;this.y=y;return this};return Point2}();var ObservablePoint=function(){function ObservablePoint2(cb,scope,x,y){if(x===void 0){x=0}if(y===void 0){y=0}this._x=x;this._y=y;this.cb=cb;this.scope=scope}ObservablePoint2.prototype.clone=function(cb,scope){if(cb===void 0){cb=this.cb}if(scope===void 0){scope=this.scope}return new ObservablePoint2(cb,scope,this._x,this._y)};ObservablePoint2.prototype.set=function(x,y){if(x===void 0){x=0}if(y===void 0){y=x}if(this._x!==x||this._y!==y){this._x=x;this._y=y;this.cb.call(this.scope)}return this};ObservablePoint2.prototype.copyFrom=function(p){if(this._x!==p.x||this._y!==p.y){this._x=p.x;this._y=p.y;this.cb.call(this.scope)}return this};ObservablePoint2.prototype.copyTo=function(p){p.set(this._x,this._y);return p};ObservablePoint2.prototype.equals=function(p){return p.x===this._x&&p.y===this._y};Object.defineProperty(ObservablePoint2.prototype,"x",{get:function get(){return this._x},set:function set(value){if(this._x!==value){this._x=value;this.cb.call(this.scope)}},enumerable:true,configurable:true});Object.defineProperty(ObservablePoint2.prototype,"y",{get:function get(){return this._y},set:function set(value){if(this._y!==value){this._y=value;this.cb.call(this.scope)}},enumerable:true,configurable:true});return ObservablePoint2}();var PI_2=Math.PI*2;var RAD_TO_DEG=180/Math.PI;var DEG_TO_RAD=Math.PI/180;var SHAPES;(function(SHAPES2){SHAPES2[SHAPES2["POLY"]=0]="POLY";SHAPES2[SHAPES2["RECT"]=1]="RECT";SHAPES2[SHAPES2["CIRC"]=2]="CIRC";SHAPES2[SHAPES2["ELIP"]=3]="ELIP";SHAPES2[SHAPES2["RREC"]=4]="RREC"})(SHAPES||(SHAPES={}));var Matrix=function(){function Matrix2(a,b,c,d,tx,ty){if(a===void 0){a=1}if(b===void 0){b=0}if(c===void 0){c=0}if(d===void 0){d=1}if(tx===void 0){tx=0}if(ty===void 0){ty=0}this.array=null;this.a=a;this.b=b;this.c=c;this.d=d;this.tx=tx;this.ty=ty}Matrix2.prototype.fromArray=function(array){this.a=array[0];this.b=array[1];this.c=array[3];this.d=array[4];this.tx=array[2];this.ty=array[5]};Matrix2.prototype.set=function(a,b,c,d,tx,ty){this.a=a;this.b=b;this.c=c;this.d=d;this.tx=tx;this.ty=ty;return this};Matrix2.prototype.toArray=function(transpose,out){if(!this.array){this.array=new Float32Array(9)}var array=out||this.array;if(transpose){array[0]=this.a;array[1]=this.b;array[2]=0;array[3]=this.c;array[4]=this.d;array[5]=0;array[6]=this.tx;array[7]=this.ty;array[8]=1}else{array[0]=this.a;array[1]=this.c;array[2]=this.tx;array[3]=this.b;array[4]=this.d;array[5]=this.ty;array[6]=0;array[7]=0;array[8]=1}return array};Matrix2.prototype.apply=function(pos,newPos){newPos=newPos||new Point;var x=pos.x;var y=pos.y;newPos.x=this.a*x+this.c*y+this.tx;newPos.y=this.b*x+this.d*y+this.ty;return newPos};Matrix2.prototype.applyInverse=function(pos,newPos){newPos=newPos||new Point;var id=1/(this.a*this.d+this.c*-this.b);var x=pos.x;var y=pos.y;newPos.x=this.d*id*x+-this.c*id*y+(this.ty*this.c-this.tx*this.d)*id;newPos.y=this.a*id*y+-this.b*id*x+(-this.ty*this.a+this.tx*this.b)*id;return newPos};Matrix2.prototype.translate=function(x,y){this.tx+=x;this.ty+=y;return this};Matrix2.prototype.scale=function(x,y){this.a*=x;this.d*=y;this.c*=x;this.b*=y;this.tx*=x;this.ty*=y;return this};Matrix2.prototype.rotate=function(angle){var cos=Math.cos(angle);var sin=Math.sin(angle);var a1=this.a;var c1=this.c;var tx1=this.tx;this.a=a1*cos-this.b*sin;this.b=a1*sin+this.b*cos;this.c=c1*cos-this.d*sin;this.d=c1*sin+this.d*cos;this.tx=tx1*cos-this.ty*sin;this.ty=tx1*sin+this.ty*cos;return this};Matrix2.prototype.append=function(matrix){var a1=this.a;var b1=this.b;var c1=this.c;var d1=this.d;this.a=matrix.a*a1+matrix.b*c1;this.b=matrix.a*b1+matrix.b*d1;this.c=matrix.c*a1+matrix.d*c1;this.d=matrix.c*b1+matrix.d*d1;this.tx=matrix.tx*a1+matrix.ty*c1+this.tx;this.ty=matrix.tx*b1+matrix.ty*d1+this.ty;return this};Matrix2.prototype.setTransform=function(x,y,pivotX,pivotY,scaleX,scaleY,rotation,skewX,skewY){this.a=Math.cos(rotation+skewY)*scaleX;this.b=Math.sin(rotation+skewY)*scaleX;this.c=-Math.sin(rotation-skewX)*scaleY;this.d=Math.cos(rotation-skewX)*scaleY;this.tx=x-(pivotX*this.a+pivotY*this.c);this.ty=y-(pivotX*this.b+pivotY*this.d);return this};Matrix2.prototype.prepend=function(matrix){var tx1=this.tx;if(matrix.a!==1||matrix.b!==0||matrix.c!==0||matrix.d!==1){var a1=this.a;var c1=this.c;this.a=a1*matrix.a+this.b*matrix.c;this.b=a1*matrix.b+this.b*matrix.d;this.c=c1*matrix.a+this.d*matrix.c;this.d=c1*matrix.b+this.d*matrix.d}this.tx=tx1*matrix.a+this.ty*matrix.c+matrix.tx;this.ty=tx1*matrix.b+this.ty*matrix.d+matrix.ty;return this};Matrix2.prototype.decompose=function(transform){var a=this.a;var b=this.b;var c=this.c;var d=this.d;var skewX=-Math.atan2(-c,d);var skewY=Math.atan2(b,a);var delta=Math.abs(skewX+skewY);if(delta<1e-5||Math.abs(PI_2-delta)<1e-5){transform.rotation=skewY;transform.skew.x=transform.skew.y=0}else{transform.rotation=0;transform.skew.x=skewX;transform.skew.y=skewY}transform.scale.x=Math.sqrt(a*a+b*b);transform.scale.y=Math.sqrt(c*c+d*d);transform.position.x=this.tx;transform.position.y=this.ty;return transform};Matrix2.prototype.invert=function(){var a1=this.a;var b1=this.b;var c1=this.c;var d1=this.d;var tx1=this.tx;var n=a1*d1-b1*c1;this.a=d1/n;this.b=-b1/n;this.c=-c1/n;this.d=a1/n;this.tx=(c1*this.ty-d1*tx1)/n;this.ty=-(a1*this.ty-b1*tx1)/n;return this};Matrix2.prototype.identity=function(){this.a=1;this.b=0;this.c=0;this.d=1;this.tx=0;this.ty=0;return this};Matrix2.prototype.clone=function(){var matrix=new Matrix2;matrix.a=this.a;matrix.b=this.b;matrix.c=this.c;matrix.d=this.d;matrix.tx=this.tx;matrix.ty=this.ty;return matrix};Matrix2.prototype.copyTo=function(matrix){matrix.a=this.a;matrix.b=this.b;matrix.c=this.c;matrix.d=this.d;matrix.tx=this.tx;matrix.ty=this.ty;return matrix};Matrix2.prototype.copyFrom=function(matrix){this.a=matrix.a;this.b=matrix.b;this.c=matrix.c;this.d=matrix.d;this.tx=matrix.tx;this.ty=matrix.ty;return this};Object.defineProperty(Matrix2,"IDENTITY",{get:function get(){return new Matrix2},enumerable:true,configurable:true});Object.defineProperty(Matrix2,"TEMP_MATRIX",{get:function get(){return new Matrix2},enumerable:true,configurable:true});return Matrix2}();var ux=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1];var uy=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1];var vx=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1];var vy=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1];var rotationCayley=[];var rotationMatrices=[];var signum=Math.sign;function init(){for(var i=0;i<16;i++){var row=[];rotationCayley.push(row);for(var j=0;j<16;j++){var _ux=signum(ux[i]*ux[j]+vx[i]*uy[j]);var _uy=signum(uy[i]*ux[j]+vy[i]*uy[j]);var _vx=signum(ux[i]*vx[j]+vx[i]*vy[j]);var _vy=signum(uy[i]*vx[j]+vy[i]*vy[j]);for(var k=0;k<16;k++){if(ux[k]===_ux&&uy[k]===_uy&&vx[k]===_vx&&vy[k]===_vy){row.push(k);break}}}}for(var i=0;i<16;i++){var mat=new Matrix;mat.set(ux[i],uy[i],vx[i],vy[i],0,0);rotationMatrices.push(mat)}}init();var groupD8={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:function uX(ind){return ux[ind]},uY:function uY(ind){return uy[ind]},vX:function vX(ind){return vx[ind]},vY:function vY(ind){return vy[ind]},inv:function inv(rotation){if(rotation&8){return rotation&15}return-rotation&7},add:function add(rotationSecond,rotationFirst){return rotationCayley[rotationSecond][rotationFirst]},sub:function sub(rotationSecond,rotationFirst){return rotationCayley[rotationSecond][groupD8.inv(rotationFirst)]},rotate180:function rotate180(rotation){return rotation^4},isVertical:function isVertical(rotation){return(rotation&3)===2},byDirection:function byDirection(dx,dy){if(Math.abs(dx)*2<=Math.abs(dy)){if(dy>=0){return groupD8.S}return groupD8.N}else if(Math.abs(dy)*2<=Math.abs(dx)){if(dx>0){return groupD8.E}return groupD8.W}else if(dy>0){if(dx>0){return groupD8.SE}return groupD8.SW}else if(dx>0){return groupD8.NE}return groupD8.NW},matrixAppendRotationInv:function matrixAppendRotationInv(matrix,rotation,tx,ty){if(tx===void 0){tx=0}if(ty===void 0){ty=0}var mat=rotationMatrices[groupD8.inv(rotation)];mat.tx=tx;mat.ty=ty;matrix.append(mat)}};var Transform=function(){function Transform2(){this.worldTransform=new Matrix;this.localTransform=new Matrix;this.position=new ObservablePoint(this.onChange,this,0,0);this.scale=new ObservablePoint(this.onChange,this,1,1);this.pivot=new ObservablePoint(this.onChange,this,0,0);this.skew=new ObservablePoint(this.updateSkew,this,0,0);this._rotation=0;this._cx=1;this._sx=0;this._cy=0;this._sy=1;this._localID=0;this._currentLocalID=0;this._worldID=0;this._parentID=0}Transform2.prototype.onChange=function(){this._localID++};Transform2.prototype.updateSkew=function(){this._cx=Math.cos(this._rotation+this.skew.y);this._sx=Math.sin(this._rotation+this.skew.y);this._cy=-Math.sin(this._rotation-this.skew.x);this._sy=Math.cos(this._rotation-this.skew.x);this._localID++};Transform2.prototype.updateLocalTransform=function(){var lt=this.localTransform;if(this._localID!==this._currentLocalID){lt.a=this._cx*this.scale.x;lt.b=this._sx*this.scale.x;lt.c=this._cy*this.scale.y;lt.d=this._sy*this.scale.y;lt.tx=this.position.x-(this.pivot.x*lt.a+this.pivot.y*lt.c);lt.ty=this.position.y-(this.pivot.x*lt.b+this.pivot.y*lt.d);this._currentLocalID=this._localID;this._parentID=-1}};Transform2.prototype.updateTransform=function(parentTransform){var lt=this.localTransform;if(this._localID!==this._currentLocalID){lt.a=this._cx*this.scale.x;lt.b=this._sx*this.scale.x;lt.c=this._cy*this.scale.y;lt.d=this._sy*this.scale.y;lt.tx=this.position.x-(this.pivot.x*lt.a+this.pivot.y*lt.c);lt.ty=this.position.y-(this.pivot.x*lt.b+this.pivot.y*lt.d);this._currentLocalID=this._localID;this._parentID=-1}if(this._parentID!==parentTransform._worldID){var pt=parentTransform.worldTransform;var wt=this.worldTransform;wt.a=lt.a*pt.a+lt.b*pt.c;wt.b=lt.a*pt.b+lt.b*pt.d;wt.c=lt.c*pt.a+lt.d*pt.c;wt.d=lt.c*pt.b+lt.d*pt.d;wt.tx=lt.tx*pt.a+lt.ty*pt.c+pt.tx;wt.ty=lt.tx*pt.b+lt.ty*pt.d+pt.ty;this._parentID=parentTransform._worldID;this._worldID++}};Transform2.prototype.setFromMatrix=function(matrix){matrix.decompose(this);this._localID++};Object.defineProperty(Transform2.prototype,"rotation",{get:function get(){return this._rotation},set:function set(value){if(this._rotation!==value){this._rotation=value;this.updateSkew()}},enumerable:true,configurable:true});Transform2.IDENTITY=new Transform2;return Transform2}();var Rectangle=function(){function Rectangle2(x,y,width,height){if(x===void 0){x=0}if(y===void 0){y=0}if(width===void 0){width=0}if(height===void 0){height=0}this.x=Number(x);this.y=Number(y);this.width=Number(width);this.height=Number(height);this.type=SHAPES.RECT}Object.defineProperty(Rectangle2.prototype,"left",{get:function get(){return this.x},enumerable:true,configurable:true});Object.defineProperty(Rectangle2.prototype,"right",{get:function get(){return this.x+this.width},enumerable:true,configurable:true});Object.defineProperty(Rectangle2.prototype,"top",{get:function get(){return this.y},enumerable:true,configurable:true});Object.defineProperty(Rectangle2.prototype,"bottom",{get:function get(){return this.y+this.height},enumerable:true,configurable:true});Object.defineProperty(Rectangle2,"EMPTY",{get:function get(){return new Rectangle2(0,0,0,0)},enumerable:true,configurable:true});Rectangle2.prototype.clone=function(){return new Rectangle2(this.x,this.y,this.width,this.height)};Rectangle2.prototype.copyFrom=function(rectangle){this.x=rectangle.x;this.y=rectangle.y;this.width=rectangle.width;this.height=rectangle.height;return this};Rectangle2.prototype.copyTo=function(rectangle){rectangle.x=this.x;rectangle.y=this.y;rectangle.width=this.width;rectangle.height=this.height;return rectangle};Rectangle2.prototype.contains=function(x,y){if(this.width<=0||this.height<=0){return false}if(x>=this.x&&x<this.x+this.width){if(y>=this.y&&y<this.y+this.height){return true}}return false};Rectangle2.prototype.pad=function(paddingX,paddingY){if(paddingX===void 0){paddingX=0}if(paddingY===void 0){paddingY=paddingX}this.x-=paddingX;this.y-=paddingY;this.width+=paddingX*2;this.height+=paddingY*2;return this};Rectangle2.prototype.fit=function(rectangle){var x1=Math.max(this.x,rectangle.x);var x2=Math.min(this.x+this.width,rectangle.x+rectangle.width);var y1=Math.max(this.y,rectangle.y);var y2=Math.min(this.y+this.height,rectangle.y+rectangle.height);this.x=x1;this.width=Math.max(x2-x1,0);this.y=y1;this.height=Math.max(y2-y1,0);return this};Rectangle2.prototype.ceil=function(resolution,eps){if(resolution===void 0){resolution=1}if(eps===void 0){eps=1e-3}var x2=Math.ceil((this.x+this.width-eps)*resolution)/resolution;var y2=Math.ceil((this.y+this.height-eps)*resolution)/resolution;this.x=Math.floor((this.x+eps)*resolution)/resolution;this.y=Math.floor((this.y+eps)*resolution)/resolution;this.width=x2-this.x;this.height=y2-this.y;return this};Rectangle2.prototype.enlarge=function(rectangle){var x1=Math.min(this.x,rectangle.x);var x2=Math.max(this.x+this.width,rectangle.x+rectangle.width);var y1=Math.min(this.y,rectangle.y);var y2=Math.max(this.y+this.height,rectangle.y+rectangle.height);this.x=x1;this.width=x2-x1;this.y=y1;this.height=y2-y1;return this};return Rectangle2}();var Circle=function(){function Circle2(x,y,radius){if(x===void 0){x=0}if(y===void 0){y=0}if(radius===void 0){radius=0}this.x=x;this.y=y;this.radius=radius;this.type=SHAPES.CIRC}Circle2.prototype.clone=function(){return new Circle2(this.x,this.y,this.radius)};Circle2.prototype.contains=function(x,y){if(this.radius<=0){return false}var r2=this.radius*this.radius;var dx=this.x-x;var dy=this.y-y;dx*=dx;dy*=dy;return dx+dy<=r2};Circle2.prototype.getBounds=function(){return new Rectangle(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)};return Circle2}();var Ellipse=function(){function Ellipse2(x,y,halfWidth,halfHeight){if(x===void 0){x=0}if(y===void 0){y=0}if(halfWidth===void 0){halfWidth=0}if(halfHeight===void 0){halfHeight=0}this.x=x;this.y=y;this.width=halfWidth;this.height=halfHeight;this.type=SHAPES.ELIP}Ellipse2.prototype.clone=function(){return new Ellipse2(this.x,this.y,this.width,this.height)};Ellipse2.prototype.contains=function(x,y){if(this.width<=0||this.height<=0){return false}var normx=(x-this.x)/this.width;var normy=(y-this.y)/this.height;normx*=normx;normy*=normy;return normx+normy<=1};Ellipse2.prototype.getBounds=function(){return new Rectangle(this.x-this.width,this.y-this.height,this.width,this.height)};return Ellipse2}();var Polygon=function(){function Polygon2(){var arguments$1=arguments;var points=[];for(var _i=0;_i<arguments.length;_i++){points[_i]=arguments$1[_i]}if(Array.isArray(points[0])){points=points[0]}if(points[0]instanceof Point){points=points;var p=[];for(var i=0,il=points.length;i<il;i++){p.push(points[i].x,points[i].y)}points=p}this.points=points;this.type=SHAPES.POLY;this.closeStroke=true}Polygon2.prototype.clone=function(){var points=this.points.slice();var polygon=new Polygon2(points);polygon.closeStroke=this.closeStroke;return polygon};Polygon2.prototype.contains=function(x,y){var inside=false;var length=this.points.length/2;for(var i=0,j=length-1;i<length;j=i++){var xi=this.points[i*2];var yi=this.points[i*2+1];var xj=this.points[j*2];var yj=this.points[j*2+1];var intersect=yi>y!==yj>y&&x<(xj-xi)*((y-yi)/(yj-yi))+xi;if(intersect){inside=!inside}}return inside};return Polygon2}();var RoundedRectangle=function(){function RoundedRectangle2(x,y,width,height,radius){if(x===void 0){x=0}if(y===void 0){y=0}if(width===void 0){width=0}if(height===void 0){height=0}if(radius===void 0){radius=20}this.x=x;this.y=y;this.width=width;this.height=height;this.radius=radius;this.type=SHAPES.RREC}RoundedRectangle2.prototype.clone=function(){return new RoundedRectangle2(this.x,this.y,this.width,this.height,this.radius)};RoundedRectangle2.prototype.contains=function(x,y){if(this.width<=0||this.height<=0){return false}if(x>=this.x&&x<=this.x+this.width){if(y>=this.y&&y<=this.y+this.height){if(y>=this.y+this.radius&&y<=this.y+this.height-this.radius||x>=this.x+this.radius&&x<=this.x+this.width-this.radius){return true}var dx=x-(this.x+this.radius);var dy=y-(this.y+this.radius);var radius2=this.radius*this.radius;if(dx*dx+dy*dy<=radius2){return true}dx=x-(this.x+this.width-this.radius);if(dx*dx+dy*dy<=radius2){return true}dy=y-(this.y+this.height-this.radius);if(dx*dx+dy*dy<=radius2){return true}dx=x-(this.x+this.radius);if(dx*dx+dy*dy<=radius2){return true}}}return false};return RoundedRectangle2}();settings.SORTABLE_CHILDREN=false;var Bounds=function Bounds2(){this.minX=Infinity;this.minY=Infinity;this.maxX=-Infinity;this.maxY=-Infinity;this.rect=null};Bounds.prototype.isEmpty=function isEmpty(){return this.minX>this.maxX||this.minY>this.maxY};Bounds.prototype.clear=function clear(){this.minX=Infinity;this.minY=Infinity;this.maxX=-Infinity;this.maxY=-Infinity};Bounds.prototype.getRectangle=function getRectangle(rect){if(this.minX>this.maxX||this.minY>this.maxY){return Rectangle.EMPTY}rect=rect||new Rectangle(0,0,1,1);rect.x=this.minX;rect.y=this.minY;rect.width=this.maxX-this.minX;rect.height=this.maxY-this.minY;return rect};Bounds.prototype.addPoint=function addPoint(point){this.minX=Math.min(this.minX,point.x);this.maxX=Math.max(this.maxX,point.x);this.minY=Math.min(this.minY,point.y);this.maxY=Math.max(this.maxY,point.y)};Bounds.prototype.addQuad=function addQuad(vertices){var minX=this.minX;var minY=this.minY;var maxX=this.maxX;var maxY=this.maxY;var x=vertices[0];var y=vertices[1];minX=x<minX?x:minX;minY=y<minY?y:minY;maxX=x>maxX?x:maxX;maxY=y>maxY?y:maxY;x=vertices[2];y=vertices[3];minX=x<minX?x:minX;minY=y<minY?y:minY;maxX=x>maxX?x:maxX;maxY=y>maxY?y:maxY;x=vertices[4];y=vertices[5];minX=x<minX?x:minX;minY=y<minY?y:minY;maxX=x>maxX?x:maxX;maxY=y>maxY?y:maxY;x=vertices[6];y=vertices[7];minX=x<minX?x:minX;minY=y<minY?y:minY;maxX=x>maxX?x:maxX;maxY=y>maxY?y:maxY;this.minX=minX;this.minY=minY;this.maxX=maxX;this.maxY=maxY};Bounds.prototype.addFrame=function addFrame(transform,x0,y0,x1,y1){this.addFrameMatrix(transform.worldTransform,x0,y0,x1,y1)};Bounds.prototype.addFrameMatrix=function addFrameMatrix(matrix,x0,y0,x1,y1){var a=matrix.a;var b=matrix.b;var c=matrix.c;var d=matrix.d;var tx=matrix.tx;var ty=matrix.ty;var minX=this.minX;var minY=this.minY;var maxX=this.maxX;var maxY=this.maxY;var x=a*x0+c*y0+tx;var y=b*x0+d*y0+ty;minX=x<minX?x:minX;minY=y<minY?y:minY;maxX=x>maxX?x:maxX;maxY=y>maxY?y:maxY;x=a*x1+c*y0+tx;y=b*x1+d*y0+ty;minX=x<minX?x:minX;minY=y<minY?y:minY;maxX=x>maxX?x:maxX;maxY=y>maxY?y:maxY;x=a*x0+c*y1+tx;y=b*x0+d*y1+ty;minX=x<minX?x:minX;minY=y<minY?y:minY;maxX=x>maxX?x:maxX;maxY=y>maxY?y:maxY;x=a*x1+c*y1+tx;y=b*x1+d*y1+ty;minX=x<minX?x:minX;minY=y<minY?y:minY;maxX=x>maxX?x:maxX;maxY=y>maxY?y:maxY;this.minX=minX;this.minY=minY;this.maxX=maxX;this.maxY=maxY};Bounds.prototype.addVertexData=function addVertexData(vertexData,beginOffset,endOffset){var minX=this.minX;var minY=this.minY;var maxX=this.maxX;var maxY=this.maxY;for(var i=beginOffset;i<endOffset;i+=2){var x=vertexData[i];var y=vertexData[i+1];minX=x<minX?x:minX;minY=y<minY?y:minY;maxX=x>maxX?x:maxX;maxY=y>maxY?y:maxY}this.minX=minX;this.minY=minY;this.maxX=maxX;this.maxY=maxY};Bounds.prototype.addVertices=function addVertices(transform,vertices,beginOffset,endOffset){this.addVerticesMatrix(transform.worldTransform,vertices,beginOffset,endOffset)};Bounds.prototype.addVerticesMatrix=function addVerticesMatrix(matrix,vertices,beginOffset,endOffset,padX,padY){var a=matrix.a;var b=matrix.b;var c=matrix.c;var d=matrix.d;var tx=matrix.tx;var ty=matrix.ty;padX=padX||0;padY=padY||0;var minX=this.minX;var minY=this.minY;var maxX=this.maxX;var maxY=this.maxY;for(var i=beginOffset;i<endOffset;i+=2){var rawX=vertices[i];var rawY=vertices[i+1];var x=a*rawX+c*rawY+tx;var y=d*rawY+b*rawX+ty;minX=Math.min(minX,x-padX);maxX=Math.max(maxX,x+padX);minY=Math.min(minY,y-padY);maxY=Math.max(maxY,y+padY)}this.minX=minX;this.minY=minY;this.maxX=maxX;this.maxY=maxY};Bounds.prototype.addBounds=function addBounds(bounds){var minX=this.minX;var minY=this.minY;var maxX=this.maxX;var maxY=this.maxY;this.minX=bounds.minX<minX?bounds.minX:minX;this.minY=bounds.minY<minY?bounds.minY:minY;this.maxX=bounds.maxX>maxX?bounds.maxX:maxX;this.maxY=bounds.maxY>maxY?bounds.maxY:maxY};Bounds.prototype.addBoundsMask=function addBoundsMask(bounds,mask){var _minX=bounds.minX>mask.minX?bounds.minX:mask.minX;var _minY=bounds.minY>mask.minY?bounds.minY:mask.minY;var _maxX=bounds.maxX<mask.maxX?bounds.maxX:mask.maxX;var _maxY=bounds.maxY<mask.maxY?bounds.maxY:mask.maxY;if(_minX<=_maxX&&_minY<=_maxY){var minX=this.minX;var minY=this.minY;var maxX=this.maxX;var maxY=this.maxY;this.minX=_minX<minX?_minX:minX;this.minY=_minY<minY?_minY:minY;this.maxX=_maxX>maxX?_maxX:maxX;this.maxY=_maxY>maxY?_maxY:maxY}};Bounds.prototype.addBoundsMatrix=function addBoundsMatrix(bounds,matrix){this.addFrameMatrix(matrix,bounds.minX,bounds.minY,bounds.maxX,bounds.maxY)};Bounds.prototype.addBoundsArea=function addBoundsArea(bounds,area){var _minX=bounds.minX>area.x?bounds.minX:area.x;var _minY=bounds.minY>area.y?bounds.minY:area.y;var _maxX=bounds.maxX<area.x+area.width?bounds.maxX:area.x+area.width;var _maxY=bounds.maxY<area.y+area.height?bounds.maxY:area.y+area.height;if(_minX<=_maxX&&_minY<=_maxY){var minX=this.minX;var minY=this.minY;var maxX=this.maxX;var maxY=this.maxY;this.minX=_minX<minX?_minX:minX;this.minY=_minY<minY?_minY:minY;this.maxX=_maxX>maxX?_maxX:maxX;this.maxY=_maxY>maxY?_maxY:maxY}};Bounds.prototype.pad=function pad(paddingX,paddingY){paddingX=paddingX||0;paddingY=paddingY||(paddingY!==0?paddingX:0);if(!this.isEmpty()){this.minX-=paddingX;this.maxX+=paddingX;this.minY-=paddingY;this.maxY+=paddingY}};Bounds.prototype.addFramePad=function addFramePad(x0,y0,x1,y1,padX,padY){x0-=padX;y0-=padY;x1+=padX;y1+=padY;this.minX=this.minX<x0?this.minX:x0;this.maxX=this.maxX>x1?this.maxX:x1;this.minY=this.minY<y0?this.minY:y0;this.maxY=this.maxY>y1?this.maxY:y1};var DisplayObject=function(EventEmitter){function DisplayObject2(){EventEmitter.call(this);this.tempDisplayObjectParent=null;this.transform=new Transform;this.alpha=1;this.visible=true;this.renderable=true;this.parent=null;this.worldAlpha=1;this._lastSortedIndex=0;this._zIndex=0;this.filterArea=null;this.filters=null;this._enabledFilters=null;this._bounds=new Bounds;this._boundsID=0;this._lastBoundsID=-1;this._boundsRect=null;this._localBoundsRect=null;this._mask=null;this._destroyed=false;this.isSprite=false;this.isMask=false}if(EventEmitter)DisplayObject2.__proto__=EventEmitter;DisplayObject2.prototype=Object.create(EventEmitter&&EventEmitter.prototype);DisplayObject2.prototype.constructor=DisplayObject2;var prototypeAccessors5={_tempDisplayObjectParent:{configurable:true},x:{configurable:true},y:{configurable:true},worldTransform:{configurable:true},localTransform:{configurable:true},position:{configurable:true},scale:{configurable:true},pivot:{configurable:true},skew:{configurable:true},rotation:{configurable:true},angle:{configurable:true},zIndex:{configurable:true},worldVisible:{configurable:true},mask:{configurable:true}};DisplayObject2.mixin=function mixin(source){var keys=Object.keys(source);for(var i=0;i<keys.length;++i){var propertyName=keys[i];Object.defineProperty(DisplayObject2.prototype,propertyName,Object.getOwnPropertyDescriptor(source,propertyName))}};prototypeAccessors5._tempDisplayObjectParent.get=function(){if(this.tempDisplayObjectParent===null){this.tempDisplayObjectParent=new DisplayObject2}return this.tempDisplayObjectParent};DisplayObject2.prototype.updateTransform=function updateTransform(){this._boundsID++;this.transform.updateTransform(this.parent.transform);this.worldAlpha=this.alpha*this.parent.worldAlpha};DisplayObject2.prototype.calculateBounds=function calculateBounds(){};DisplayObject2.prototype._recursivePostUpdateTransform=function _recursivePostUpdateTransform(){if(this.parent){this.parent._recursivePostUpdateTransform();this.transform.updateTransform(this.parent.transform)}else{this.transform.updateTransform(this._tempDisplayObjectParent.transform)}};DisplayObject2.prototype.getBounds=function getBounds(skipUpdate,rect){if(!skipUpdate){if(!this.parent){this.parent=this._tempDisplayObjectParent;this.updateTransform();this.parent=null}else{this._recursivePostUpdateTransform();this.updateTransform()}}if(this._boundsID!==this._lastBoundsID){this.calculateBounds();this._lastBoundsID=this._boundsID}if(!rect){if(!this._boundsRect){this._boundsRect=new Rectangle}rect=this._boundsRect}return this._bounds.getRectangle(rect)};DisplayObject2.prototype.getLocalBounds=function getLocalBounds(rect){var transformRef=this.transform;var parentRef=this.parent;this.parent=null;this.transform=this._tempDisplayObjectParent.transform;if(!rect){if(!this._localBoundsRect){this._localBoundsRect=new Rectangle}rect=this._localBoundsRect}var bounds=this.getBounds(false,rect);this.parent=parentRef;this.transform=transformRef;return bounds};DisplayObject2.prototype.toGlobal=function toGlobal(position,point,skipUpdate){if(skipUpdate===void 0)skipUpdate=false;if(!skipUpdate){this._recursivePostUpdateTransform();if(!this.parent){this.parent=this._tempDisplayObjectParent;this.displayObjectUpdateTransform();this.parent=null}else{this.displayObjectUpdateTransform()}}return this.worldTransform.apply(position,point)};DisplayObject2.prototype.toLocal=function toLocal(position,from6,point,skipUpdate){if(from6){position=from6.toGlobal(position,point,skipUpdate)}if(!skipUpdate){this._recursivePostUpdateTransform();if(!this.parent){this.parent=this._tempDisplayObjectParent;this.displayObjectUpdateTransform();this.parent=null}else{this.displayObjectUpdateTransform()}}return this.worldTransform.applyInverse(position,point)};DisplayObject2.prototype.render=function render6(renderer){};DisplayObject2.prototype.setParent=function setParent(container){if(!container||!container.addChild){throw new Error("setParent: Argument must be a Container")}container.addChild(this);return container};DisplayObject2.prototype.setTransform=function setTransform(x,y,scaleX,scaleY,rotation,skewX,skewY,pivotX,pivotY){if(x===void 0)x=0;if(y===void 0)y=0;if(scaleX===void 0)scaleX=1;if(scaleY===void 0)scaleY=1;if(rotation===void 0)rotation=0;if(skewX===void 0)skewX=0;if(skewY===void 0)skewY=0;if(pivotX===void 0)pivotX=0;if(pivotY===void 0)pivotY=0;this.position.x=x;this.position.y=y;this.scale.x=!scaleX?1:scaleX;this.scale.y=!scaleY?1:scaleY;this.rotation=rotation;this.skew.x=skewX;this.skew.y=skewY;this.pivot.x=pivotX;this.pivot.y=pivotY;return this};DisplayObject2.prototype.destroy=function destroy25(){if(this.parent){this.parent.removeChild(this)}this.removeAllListeners();this.transform=null;this.parent=null;this._bounds=null;this._currentBounds=null;this._mask=null;this.filters=null;this.filterArea=null;this.hitArea=null;this.interactive=false;this.interactiveChildren=false;this._destroyed=true};prototypeAccessors5.x.get=function(){return this.position.x};prototypeAccessors5.x.set=function(value){this.transform.position.x=value};prototypeAccessors5.y.get=function(){return this.position.y};prototypeAccessors5.y.set=function(value){this.transform.position.y=value};prototypeAccessors5.worldTransform.get=function(){return this.transform.worldTransform};prototypeAccessors5.localTransform.get=function(){return this.transform.localTransform};prototypeAccessors5.position.get=function(){return this.transform.position};prototypeAccessors5.position.set=function(value){this.transform.position.copyFrom(value)};prototypeAccessors5.scale.get=function(){return this.transform.scale};prototypeAccessors5.scale.set=function(value){this.transform.scale.copyFrom(value)};prototypeAccessors5.pivot.get=function(){return this.transform.pivot};prototypeAccessors5.pivot.set=function(value){this.transform.pivot.copyFrom(value)};prototypeAccessors5.skew.get=function(){return this.transform.skew};prototypeAccessors5.skew.set=function(value){this.transform.skew.copyFrom(value)};prototypeAccessors5.rotation.get=function(){return this.transform.rotation};prototypeAccessors5.rotation.set=function(value){this.transform.rotation=value};prototypeAccessors5.angle.get=function(){return this.transform.rotation*RAD_TO_DEG};prototypeAccessors5.angle.set=function(value){this.transform.rotation=value*DEG_TO_RAD};prototypeAccessors5.zIndex.get=function(){return this._zIndex};prototypeAccessors5.zIndex.set=function(value){this._zIndex=value;if(this.parent){this.parent.sortDirty=true}};prototypeAccessors5.worldVisible.get=function(){var item=this;do{if(!item.visible){return false}item=item.parent}while(item);return true};prototypeAccessors5.mask.get=function(){return this._mask};prototypeAccessors5.mask.set=function(value){if(this._mask){var maskObject=this._mask.maskObject||this._mask;maskObject.renderable=true;maskObject.isMask=false}this._mask=value;if(this._mask){var maskObject$1=this._mask.maskObject||this._mask;maskObject$1.renderable=false;maskObject$1.isMask=true}};Object.defineProperties(DisplayObject2.prototype,prototypeAccessors5);return DisplayObject2}(import_eventemitter3.default);DisplayObject.prototype.displayObjectUpdateTransform=DisplayObject.prototype.updateTransform;function sortChildren(a,b){if(a.zIndex===b.zIndex){return a._lastSortedIndex-b._lastSortedIndex}return a.zIndex-b.zIndex}var Container=function(DisplayObject2){function Container2(){DisplayObject2.call(this);this.children=[];this.sortableChildren=settings.SORTABLE_CHILDREN;this.sortDirty=false}if(DisplayObject2)Container2.__proto__=DisplayObject2;Container2.prototype=Object.create(DisplayObject2&&DisplayObject2.prototype);Container2.prototype.constructor=Container2;var prototypeAccessors5={width:{configurable:true},height:{configurable:true}};Container2.prototype.onChildrenChange=function onChildrenChange(){};Container2.prototype.addChild=function addChild2(child){var arguments$1=arguments;var argumentsLength=arguments.length;if(argumentsLength>1){for(var i=0;i<argumentsLength;i++){this.addChild(arguments$1[i])}}else{if(child.parent){child.parent.removeChild(child)}child.parent=this;this.sortDirty=true;child.transform._parentID=-1;this.children.push(child);this._boundsID++;this.onChildrenChange(this.children.length-1);this.emit("childAdded",child,this,this.children.length-1);child.emit("added",this)}return child};Container2.prototype.addChildAt=function addChildAt(child,index3){if(index3<0||index3>this.children.length){throw new Error(child+"addChildAt: The index "+index3+" supplied is out of bounds "+this.children.length)}if(child.parent){child.parent.removeChild(child)}child.parent=this;this.sortDirty=true;child.transform._parentID=-1;this.children.splice(index3,0,child);this._boundsID++;this.onChildrenChange(index3);child.emit("added",this);this.emit("childAdded",child,this,index3);return child};Container2.prototype.swapChildren=function swapChildren(child,child2){if(child===child2){return}var index1=this.getChildIndex(child);var index22=this.getChildIndex(child2);this.children[index1]=child2;this.children[index22]=child;this.onChildrenChange(index1<index22?index1:index22)};Container2.prototype.getChildIndex=function getChildIndex(child){var index3=this.children.indexOf(child);if(index3===-1){throw new Error("The supplied DisplayObject must be a child of the caller")}return index3};Container2.prototype.setChildIndex=function setChildIndex(child,index3){if(index3<0||index3>=this.children.length){throw new Error("The index "+index3+" supplied is out of bounds "+this.children.length)}var currentIndex=this.getChildIndex(child);_removeItems(this.children,currentIndex,1);this.children.splice(index3,0,child);this.onChildrenChange(index3)};Container2.prototype.getChildAt=function getChildAt(index3){if(index3<0||index3>=this.children.length){throw new Error("getChildAt: Index ("+index3+") does not exist.")}return this.children[index3]};Container2.prototype.removeChild=function removeChild(child){var arguments$1=arguments;var argumentsLength=arguments.length;if(argumentsLength>1){for(var i=0;i<argumentsLength;i++){this.removeChild(arguments$1[i])}}else{var index3=this.children.indexOf(child);if(index3===-1){return null}child.parent=null;child.transform._parentID=-1;_removeItems(this.children,index3,1);this._boundsID++;this.onChildrenChange(index3);child.emit("removed",this);this.emit("childRemoved",child,this,index3)}return child};Container2.prototype.removeChildAt=function removeChildAt(index3){var child=this.getChildAt(index3);child.parent=null;child.transform._parentID=-1;_removeItems(this.children,index3,1);this._boundsID++;this.onChildrenChange(index3);child.emit("removed",this);this.emit("childRemoved",child,this,index3);return child};Container2.prototype.removeChildren=function removeChildren(beginIndex,endIndex){if(beginIndex===void 0)beginIndex=0;var begin2=beginIndex;var end2=typeof endIndex==="number"?endIndex:this.children.length;var range=end2-begin2;var removed;if(range>0&&range<=end2){removed=this.children.splice(begin2,range);for(var i=0;i<removed.length;++i){removed[i].parent=null;if(removed[i].transform){removed[i].transform._parentID=-1}}this._boundsID++;this.onChildrenChange(beginIndex);for(var i$1=0;i$1<removed.length;++i$1){removed[i$1].emit("removed",this);this.emit("childRemoved",removed[i$1],this,i$1)}return removed}else if(range===0&&this.children.length===0){return[]}throw new RangeError("removeChildren: numeric values are outside the acceptable range.")};Container2.prototype.sortChildren=function sortChildren$1(){var sortRequired=false;for(var i=0,j=this.children.length;i<j;++i){var child=this.children[i];child._lastSortedIndex=i;if(!sortRequired&&child.zIndex!==0){sortRequired=true}}if(sortRequired&&this.children.length>1){this.children.sort(sortChildren)}this.sortDirty=false};Container2.prototype.updateTransform=function updateTransform(){if(this.sortableChildren&&this.sortDirty){this.sortChildren()}this._boundsID++;this.transform.updateTransform(this.parent.transform);this.worldAlpha=this.alpha*this.parent.worldAlpha;for(var i=0,j=this.children.length;i<j;++i){var child=this.children[i];if(child.visible){child.updateTransform()}}};Container2.prototype.calculateBounds=function calculateBounds(){this._bounds.clear();this._calculateBounds();for(var i=0;i<this.children.length;i++){var child=this.children[i];if(!child.visible||!child.renderable){continue}child.calculateBounds();if(child._mask){var maskObject=child._mask.maskObject||child._mask;maskObject.calculateBounds();this._bounds.addBoundsMask(child._bounds,maskObject._bounds)}else if(child.filterArea){this._bounds.addBoundsArea(child._bounds,child.filterArea)}else{this._bounds.addBounds(child._bounds)}}this._lastBoundsID=this._boundsID};Container2.prototype._calculateBounds=function _calculateBounds(){};Container2.prototype.render=function render6(renderer){if(!this.visible||this.worldAlpha<=0||!this.renderable){return}if(this._mask||this.filters&&this.filters.length){this.renderAdvanced(renderer)}else{this._render(renderer);for(var i=0,j=this.children.length;i<j;++i){this.children[i].render(renderer)}}};Container2.prototype.renderAdvanced=function renderAdvanced(renderer){renderer.batch.flush();var filters=this.filters;var mask=this._mask;if(filters){if(!this._enabledFilters){this._enabledFilters=[]}this._enabledFilters.length=0;for(var i=0;i<filters.length;i++){if(filters[i].enabled){this._enabledFilters.push(filters[i])}}if(this._enabledFilters.length){renderer.filter.push(this,this._enabledFilters)}}if(mask){renderer.mask.push(this,this._mask)}this._render(renderer);for(var i$1=0,j=this.children.length;i$1<j;i$1++){this.children[i$1].render(renderer)}renderer.batch.flush();if(mask){renderer.mask.pop(this,this._mask)}if(filters&&this._enabledFilters&&this._enabledFilters.length){renderer.filter.pop()}};Container2.prototype._render=function _render(renderer){};Container2.prototype.destroy=function destroy25(options){DisplayObject2.prototype.destroy.call(this);this.sortDirty=false;var destroyChildren=typeof options==="boolean"?options:options&&options.children;var oldChildren=this.removeChildren(0,this.children.length);if(destroyChildren){for(var i=0;i<oldChildren.length;++i){oldChildren[i].destroy(options)}}};prototypeAccessors5.width.get=function(){return this.scale.x*this.getLocalBounds().width};prototypeAccessors5.width.set=function(value){var width=this.getLocalBounds().width;if(width!==0){this.scale.x=value/width}else{this.scale.x=1}this._width=value};prototypeAccessors5.height.get=function(){return this.scale.y*this.getLocalBounds().height};prototypeAccessors5.height.set=function(value){var height=this.getLocalBounds().height;if(height!==0){this.scale.y=value/height}else{this.scale.y=1}this._height=value};Object.defineProperties(Container2.prototype,prototypeAccessors5);return Container2}(DisplayObject);Container.prototype.containerUpdateTransform=Container.prototype.updateTransform;var _accessibleTarget={accessible:false,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:false,_accessibleDiv:false,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:true};DisplayObject.mixin(_accessibleTarget);var KEY_CODE_TAB=9;var DIV_TOUCH_SIZE=100;var DIV_TOUCH_POS_X=0;var DIV_TOUCH_POS_Y=0;var DIV_TOUCH_ZINDEX=2;var DIV_HOOK_SIZE=1;var DIV_HOOK_POS_X=-1e3;var DIV_HOOK_POS_Y=-1e3;var DIV_HOOK_ZINDEX=2;var _AccessibilityManager=function AccessibilityManager2(renderer){this._hookDiv=null;if(isMobile2.tablet||isMobile2.phone){this.createTouchHook()}var div=document.createElement("div");div.style.width=DIV_TOUCH_SIZE+"px";div.style.height=DIV_TOUCH_SIZE+"px";div.style.position="absolute";div.style.top=DIV_TOUCH_POS_X+"px";div.style.left=DIV_TOUCH_POS_Y+"px";div.style.zIndex=DIV_TOUCH_ZINDEX;this.div=div;this.pool=[];this.renderId=0;this.debug=false;this.renderer=renderer;this.children=[];this._onKeyDown=this._onKeyDown.bind(this);this._onMouseMove=this._onMouseMove.bind(this);this.isActive=false;this.isMobileAccessibility=false;this.androidUpdateCount=0;this.androidUpdateFrequency=500;window.addEventListener("keydown",this._onKeyDown,false)};_AccessibilityManager.prototype.createTouchHook=function createTouchHook(){var this$1=this;var hookDiv=document.createElement("button");hookDiv.style.width=DIV_HOOK_SIZE+"px";hookDiv.style.height=DIV_HOOK_SIZE+"px";hookDiv.style.position="absolute";hookDiv.style.top=DIV_HOOK_POS_X+"px";hookDiv.style.left=DIV_HOOK_POS_Y+"px";hookDiv.style.zIndex=DIV_HOOK_ZINDEX;hookDiv.style.backgroundColor="#FF0000";hookDiv.title="select to enable accessability for this content";hookDiv.addEventListener("focus",function(){this$1.isMobileAccessibility=true;this$1.activate();this$1.destroyTouchHook()});document.body.appendChild(hookDiv);this._hookDiv=hookDiv};_AccessibilityManager.prototype.destroyTouchHook=function destroyTouchHook(){if(!this._hookDiv){return}document.body.removeChild(this._hookDiv);this._hookDiv=null};_AccessibilityManager.prototype.activate=function activate(){if(this.isActive){return}this.isActive=true;window.document.addEventListener("mousemove",this._onMouseMove,true);window.removeEventListener("keydown",this._onKeyDown,false);this.renderer.on("postrender",this.update,this);if(this.renderer.view.parentNode){this.renderer.view.parentNode.appendChild(this.div)}};_AccessibilityManager.prototype.deactivate=function deactivate(){if(!this.isActive||this.isMobileAccessibility){return}this.isActive=false;window.document.removeEventListener("mousemove",this._onMouseMove,true);window.addEventListener("keydown",this._onKeyDown,false);this.renderer.off("postrender",this.update);if(this.div.parentNode){this.div.parentNode.removeChild(this.div)}};_AccessibilityManager.prototype.updateAccessibleObjects=function updateAccessibleObjects(displayObject){if(!displayObject.visible||!displayObject.accessibleChildren){return}if(displayObject.accessible&&displayObject.interactive){if(!displayObject._accessibleActive){this.addChild(displayObject)}displayObject.renderId=this.renderId}var children=displayObject.children;for(var i=0;i<children.length;i++){this.updateAccessibleObjects(children[i])}};_AccessibilityManager.prototype.update=function update(){var now=performance.now();if(isMobile2.android.device&&now<this.androidUpdateCount){return}this.androidUpdateCount=now+this.androidUpdateFrequency;if(!this.renderer.renderingToScreen){return}this.updateAccessibleObjects(this.renderer._lastObjectRendered);var rect=this.renderer.view.getBoundingClientRect();var resolution=this.renderer.resolution;var sx=rect.width/this.renderer.width*resolution;var sy=rect.height/this.renderer.height*resolution;var div=this.div;div.style.left=rect.left+"px";div.style.top=rect.top+"px";div.style.width=this.renderer.width+"px";div.style.height=this.renderer.height+"px";for(var i=0;i<this.children.length;i++){var child=this.children[i];if(child.renderId!==this.renderId){child._accessibleActive=false;_removeItems(this.children,i,1);this.div.removeChild(child._accessibleDiv);this.pool.push(child._accessibleDiv);child._accessibleDiv=null;i--}else{div=child._accessibleDiv;var hitArea=child.hitArea;var wt=child.worldTransform;if(child.hitArea){div.style.left=(wt.tx+hitArea.x*wt.a)*sx+"px";div.style.top=(wt.ty+hitArea.y*wt.d)*sy+"px";div.style.width=hitArea.width*wt.a*sx+"px";div.style.height=hitArea.height*wt.d*sy+"px"}else{hitArea=child.getBounds();this.capHitArea(hitArea);div.style.left=hitArea.x*sx+"px";div.style.top=hitArea.y*sy+"px";div.style.width=hitArea.width*sx+"px";div.style.height=hitArea.height*sy+"px";if(div.title!==child.accessibleTitle&&child.accessibleTitle!==null){div.title=child.accessibleTitle}if(div.getAttribute("aria-label")!==child.accessibleHint&&child.accessibleHint!==null){div.setAttribute("aria-label",child.accessibleHint)}}if(child.accessibleTitle!==div.title||child.tabIndex!==div.tabIndex){div.title=child.accessibleTitle;div.tabIndex=child.tabIndex;if(this.debug){this.updateDebugHTML(div)}}}}this.renderId++};_AccessibilityManager.prototype.updateDebugHTML=function updateDebugHTML(div){div.innerHTML="type: "+div.type+"</br> title : "+div.title+"</br> tabIndex: "+div.tabIndex};_AccessibilityManager.prototype.capHitArea=function capHitArea(hitArea){if(hitArea.x<0){hitArea.width+=hitArea.x;hitArea.x=0}if(hitArea.y<0){hitArea.height+=hitArea.y;hitArea.y=0}if(hitArea.x+hitArea.width>this.renderer.width){hitArea.width=this.renderer.width-hitArea.x}if(hitArea.y+hitArea.height>this.renderer.height){hitArea.height=this.renderer.height-hitArea.y}};_AccessibilityManager.prototype.addChild=function addChild(displayObject){var div=this.pool.pop();if(!div){div=document.createElement("button");div.style.width=DIV_TOUCH_SIZE+"px";div.style.height=DIV_TOUCH_SIZE+"px";div.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent";div.style.position="absolute";div.style.zIndex=DIV_TOUCH_ZINDEX;div.style.borderStyle="none";if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){div.setAttribute("aria-live","off")}else{div.setAttribute("aria-live","polite")}if(navigator.userAgent.match(/rv:.*Gecko\//)){div.setAttribute("aria-relevant","additions")}else{div.setAttribute("aria-relevant","text")}div.addEventListener("click",this._onClick.bind(this));div.addEventListener("focus",this._onFocus.bind(this));div.addEventListener("focusout",this._onFocusOut.bind(this))}div.style.pointerEvents=displayObject.accessiblePointerEvents;div.type=displayObject.accessibleType;if(displayObject.accessibleTitle&&displayObject.accessibleTitle!==null){div.title=displayObject.accessibleTitle}else if(!displayObject.accessibleHint||displayObject.accessibleHint===null){div.title="displayObject "+displayObject.tabIndex}if(displayObject.accessibleHint&&displayObject.accessibleHint!==null){div.setAttribute("aria-label",displayObject.accessibleHint)}if(this.debug){this.updateDebugHTML(div)}displayObject._accessibleActive=true;displayObject._accessibleDiv=div;div.displayObject=displayObject;this.children.push(displayObject);this.div.appendChild(displayObject._accessibleDiv);displayObject._accessibleDiv.tabIndex=displayObject.tabIndex};_AccessibilityManager.prototype._onClick=function _onClick(e){var interactionManager=this.renderer.plugins.interaction;interactionManager.dispatchEvent(e.target.displayObject,"click",interactionManager.eventData);interactionManager.dispatchEvent(e.target.displayObject,"pointertap",interactionManager.eventData);interactionManager.dispatchEvent(e.target.displayObject,"tap",interactionManager.eventData)};_AccessibilityManager.prototype._onFocus=function _onFocus(e){if(!e.target.getAttribute("aria-live","off")){e.target.setAttribute("aria-live","assertive")}var interactionManager=this.renderer.plugins.interaction;interactionManager.dispatchEvent(e.target.displayObject,"mouseover",interactionManager.eventData)};_AccessibilityManager.prototype._onFocusOut=function _onFocusOut(e){if(!e.target.getAttribute("aria-live","off")){e.target.setAttribute("aria-live","polite")}var interactionManager=this.renderer.plugins.interaction;interactionManager.dispatchEvent(e.target.displayObject,"mouseout",interactionManager.eventData)};_AccessibilityManager.prototype._onKeyDown=function _onKeyDown(e){if(e.keyCode!==KEY_CODE_TAB){return}this.activate()};_AccessibilityManager.prototype._onMouseMove=function _onMouseMove(e){if(e.movementX===0&&e.movementY===0){return}this.deactivate()};_AccessibilityManager.prototype.destroy=function destroy(){this.destroyTouchHook();this.div=null;for(var i=0;i<this.children.length;i++){this.children[i].div=null}window.document.removeEventListener("mousemove",this._onMouseMove,true);window.removeEventListener("keydown",this._onKeyDown);this.pool=null;this.children=null;this.renderer=null};var interaction_es_exports={};__export(interaction_es_exports,{InteractionData:function InteractionData(){return _InteractionData},InteractionEvent:function InteractionEvent(){return _InteractionEvent},InteractionManager:function InteractionManager(){return _InteractionManager},InteractionTrackingData:function InteractionTrackingData(){return _InteractionTrackingData},interactiveTarget:function interactiveTarget(){return _interactiveTarget}});settings.TARGET_FPMS=0.06;var UPDATE_PRIORITY;(function(UPDATE_PRIORITY2){UPDATE_PRIORITY2[UPDATE_PRIORITY2["INTERACTION"]=50]="INTERACTION";UPDATE_PRIORITY2[UPDATE_PRIORITY2["HIGH"]=25]="HIGH";UPDATE_PRIORITY2[UPDATE_PRIORITY2["NORMAL"]=0]="NORMAL";UPDATE_PRIORITY2[UPDATE_PRIORITY2["LOW"]=-25]="LOW";UPDATE_PRIORITY2[UPDATE_PRIORITY2["UTILITY"]=-50]="UTILITY"})(UPDATE_PRIORITY||(UPDATE_PRIORITY={}));var TickerListener=function(){function TickerListener2(fn,context2,priority,once){if(context2===void 0){context2=null}if(priority===void 0){priority=0}if(once===void 0){once=false}this.fn=fn;this.context=context2;this.priority=priority;this.once=once;this.next=null;this.previous=null;this._destroyed=false}TickerListener2.prototype.match=function(fn,context2){if(context2===void 0){context2=null}return this.fn===fn&&this.context===context2};TickerListener2.prototype.emit=function(deltaTime){if(this.fn){if(this.context){this.fn.call(this.context,deltaTime)}else{this.fn(deltaTime)}}var redirect=this.next;if(this.once){this.destroy(true)}if(this._destroyed){this.next=null}return redirect};TickerListener2.prototype.connect=function(previous){this.previous=previous;if(previous.next){previous.next.previous=this}this.next=previous.next;previous.next=this};TickerListener2.prototype.destroy=function(hard){if(hard===void 0){hard=false}this._destroyed=true;this.fn=null;this.context=null;if(this.previous){this.previous.next=this.next}if(this.next){this.next.previous=this.previous}var redirect=this.next;this.next=hard?null:redirect;this.previous=null;return redirect};return TickerListener2}();var Ticker=function(){function Ticker2(){var _this=this;this._head=new TickerListener(null,null,Infinity);this._requestId=null;this._maxElapsedMS=100;this._minElapsedMS=0;this.autoStart=false;this.deltaTime=1;this.deltaMS=1/settings.TARGET_FPMS;this.elapsedMS=1/settings.TARGET_FPMS;this.lastTime=-1;this.speed=1;this.started=false;this._protected=false;this._lastFrame=-1;this._tick=function(time){_this._requestId=null;if(_this.started){_this.update(time);if(_this.started&&_this._requestId===null&&_this._head.next){_this._requestId=requestAnimationFrame(_this._tick)}}}}Ticker2.prototype._requestIfNeeded=function(){if(this._requestId===null&&this._head.next){this.lastTime=performance.now();this._lastFrame=this.lastTime;this._requestId=requestAnimationFrame(this._tick)}};Ticker2.prototype._cancelIfNeeded=function(){if(this._requestId!==null){cancelAnimationFrame(this._requestId);this._requestId=null}};Ticker2.prototype._startIfPossible=function(){if(this.started){this._requestIfNeeded()}else if(this.autoStart){this.start()}};Ticker2.prototype.add=function(fn,context2,priority){if(priority===void 0){priority=UPDATE_PRIORITY.NORMAL}return this._addListener(new TickerListener(fn,context2,priority))};Ticker2.prototype.addOnce=function(fn,context2,priority){if(priority===void 0){priority=UPDATE_PRIORITY.NORMAL}return this._addListener(new TickerListener(fn,context2,priority,true))};Ticker2.prototype._addListener=function(listener){var current=this._head.next;var previous=this._head;if(!current){listener.connect(previous)}else{while(current){if(listener.priority>current.priority){listener.connect(previous);break}previous=current;current=current.next}if(!listener.previous){listener.connect(previous)}}this._startIfPossible();return this};Ticker2.prototype.remove=function(fn,context2){var listener=this._head.next;while(listener){if(listener.match(fn,context2)){listener=listener.destroy()}else{listener=listener.next}}if(!this._head.next){this._cancelIfNeeded()}return this};Object.defineProperty(Ticker2.prototype,"count",{get:function get(){if(!this._head){return 0}var count=0;var current=this._head;while(current=current.next){count++}return count},enumerable:true,configurable:true});Ticker2.prototype.start=function(){if(!this.started){this.started=true;this._requestIfNeeded()}};Ticker2.prototype.stop=function(){if(this.started){this.started=false;this._cancelIfNeeded()}};Ticker2.prototype.destroy=function(){if(!this._protected){this.stop();var listener=this._head.next;while(listener){listener=listener.destroy(true)}this._head.destroy();this._head=null}};Ticker2.prototype.update=function(currentTime){if(currentTime===void 0){currentTime=performance.now()}var elapsedMS;if(currentTime>this.lastTime){elapsedMS=this.elapsedMS=currentTime-this.lastTime;if(elapsedMS>this._maxElapsedMS){elapsedMS=this._maxElapsedMS}elapsedMS*=this.speed;if(this._minElapsedMS){var delta=currentTime-this._lastFrame|0;if(delta<this._minElapsedMS){return}this._lastFrame=currentTime-delta%this._minElapsedMS}this.deltaMS=elapsedMS;this.deltaTime=this.deltaMS*settings.TARGET_FPMS;var head=this._head;var listener=head.next;while(listener){listener=listener.emit(this.deltaTime)}if(!head.next){this._cancelIfNeeded()}}else{this.deltaTime=this.deltaMS=this.elapsedMS=0}this.lastTime=currentTime};Object.defineProperty(Ticker2.prototype,"FPS",{get:function get(){return 1e3/this.elapsedMS},enumerable:true,configurable:true});Object.defineProperty(Ticker2.prototype,"minFPS",{get:function get(){return 1e3/this._maxElapsedMS},set:function set(fps){var minFPS=Math.min(this.maxFPS,fps);var minFPMS=Math.min(Math.max(0,minFPS)/1e3,settings.TARGET_FPMS);this._maxElapsedMS=1/minFPMS},enumerable:true,configurable:true});Object.defineProperty(Ticker2.prototype,"maxFPS",{get:function get(){if(this._minElapsedMS){return Math.round(1e3/this._minElapsedMS)}return 0},set:function set(fps){if(fps===0){this._minElapsedMS=0}else{var maxFPS=Math.max(this.minFPS,fps);this._minElapsedMS=1/(maxFPS/1e3)}},enumerable:true,configurable:true});Object.defineProperty(Ticker2,"shared",{get:function get(){if(!Ticker2._shared){var shared=Ticker2._shared=new Ticker2;shared.autoStart=true;shared._protected=true}return Ticker2._shared},enumerable:true,configurable:true});Object.defineProperty(Ticker2,"system",{get:function get(){if(!Ticker2._system){var system=Ticker2._system=new Ticker2;system.autoStart=true;system._protected=true}return Ticker2._system},enumerable:true,configurable:true});return Ticker2}();var TickerPlugin=function(){function TickerPlugin2(){}TickerPlugin2.init=function(options){var _this=this;options=Object.assign({autoStart:true,sharedTicker:false},options);Object.defineProperty(this,"ticker",{set:function set(ticker){if(this._ticker){this._ticker.remove(this.render,this)}this._ticker=ticker;if(ticker){ticker.add(this.render,this,UPDATE_PRIORITY.LOW)}},get:function get(){return this._ticker}});this.stop=function(){_this._ticker.stop()};this.start=function(){_this._ticker.start()};this._ticker=null;this.ticker=options.sharedTicker?Ticker.shared:new Ticker;if(options.autoStart){this.start()}};TickerPlugin2.destroy=function(){if(this._ticker){var oldTicker=this._ticker;this.ticker=null;oldTicker.destroy()}};return TickerPlugin2}();var _InteractionData=function InteractionData2(){this.global=new Point;this.target=null;this.originalEvent=null;this.identifier=null;this.isPrimary=false;this.button=0;this.buttons=0;this.width=0;this.height=0;this.tiltX=0;this.tiltY=0;this.pointerType=null;this.pressure=0;this.rotationAngle=0;this.twist=0;this.tangentialPressure=0};var prototypeAccessors={pointerId:{configurable:true}};prototypeAccessors.pointerId.get=function(){return this.identifier};_InteractionData.prototype.getLocalPosition=function getLocalPosition(displayObject,point,globalPos){return displayObject.worldTransform.applyInverse(globalPos||this.global,point)};_InteractionData.prototype.copyEvent=function copyEvent(event2){if(event2.isPrimary){this.isPrimary=true}this.button=event2.button;this.buttons=Number.isInteger(event2.buttons)?event2.buttons:event2.which;this.width=event2.width;this.height=event2.height;this.tiltX=event2.tiltX;this.tiltY=event2.tiltY;this.pointerType=event2.pointerType;this.pressure=event2.pressure;this.rotationAngle=event2.rotationAngle;this.twist=event2.twist||0;this.tangentialPressure=event2.tangentialPressure||0};_InteractionData.prototype.reset=function reset(){this.isPrimary=false};Object.defineProperties(_InteractionData.prototype,prototypeAccessors);var _InteractionEvent=function InteractionEvent2(){this.stopped=false;this.stopsPropagatingAt=null;this.stopPropagationHint=false;this.target=null;this.currentTarget=null;this.type=null;this.data=null};_InteractionEvent.prototype.stopPropagation=function stopPropagation(){this.stopped=true;this.stopPropagationHint=true;this.stopsPropagatingAt=this.currentTarget};_InteractionEvent.prototype.reset=function reset2(){this.stopped=false;this.stopsPropagatingAt=null;this.stopPropagationHint=false;this.currentTarget=null;this.target=null};var _InteractionTrackingData=function InteractionTrackingData2(pointerId){this._pointerId=pointerId;this._flags=InteractionTrackingData2.FLAGS.NONE};var prototypeAccessors$1={pointerId:{configurable:true},flags:{configurable:true},none:{configurable:true},over:{configurable:true},rightDown:{configurable:true},leftDown:{configurable:true}};_InteractionTrackingData.prototype._doSet=function _doSet(flag,yn){if(yn){this._flags=this._flags|flag}else{this._flags=this._flags&~flag}};prototypeAccessors$1.pointerId.get=function(){return this._pointerId};prototypeAccessors$1.flags.get=function(){return this._flags};prototypeAccessors$1.flags.set=function(flags){this._flags=flags};prototypeAccessors$1.none.get=function(){return this._flags===this.constructor.FLAGS.NONE};prototypeAccessors$1.over.get=function(){return(this._flags&this.constructor.FLAGS.OVER)!==0};prototypeAccessors$1.over.set=function(yn){this._doSet(this.constructor.FLAGS.OVER,yn)};prototypeAccessors$1.rightDown.get=function(){return(this._flags&this.constructor.FLAGS.RIGHT_DOWN)!==0};prototypeAccessors$1.rightDown.set=function(yn){this._doSet(this.constructor.FLAGS.RIGHT_DOWN,yn)};prototypeAccessors$1.leftDown.get=function(){return(this._flags&this.constructor.FLAGS.LEFT_DOWN)!==0};prototypeAccessors$1.leftDown.set=function(yn){this._doSet(this.constructor.FLAGS.LEFT_DOWN,yn)};Object.defineProperties(_InteractionTrackingData.prototype,prototypeAccessors$1);_InteractionTrackingData.FLAGS=Object.freeze({NONE:0,OVER:1<<0,LEFT_DOWN:1<<1,RIGHT_DOWN:1<<2});var TreeSearch=function TreeSearch2(){this._tempPoint=new Point};TreeSearch.prototype.recursiveFindHit=function recursiveFindHit(interactionEvent,displayObject,func,hitTest2,interactive){if(!displayObject||!displayObject.visible){return false}var point=interactionEvent.data.global;interactive=displayObject.interactive||interactive;var hit=false;var interactiveParent=interactive;var hitTestChildren=true;if(displayObject.hitArea){if(hitTest2){displayObject.worldTransform.applyInverse(point,this._tempPoint);if(!displayObject.hitArea.contains(this._tempPoint.x,this._tempPoint.y)){hitTest2=false;hitTestChildren=false}else{hit=true}}interactiveParent=false}else if(displayObject._mask){if(hitTest2){if(!(displayObject._mask.containsPoint&&displayObject._mask.containsPoint(point))){hitTest2=false}}}if(hitTestChildren&&displayObject.interactiveChildren&&displayObject.children){var children=displayObject.children;for(var i=children.length-1;i>=0;i--){var child=children[i];var childHit=this.recursiveFindHit(interactionEvent,child,func,hitTest2,interactiveParent);if(childHit){if(!child.parent){continue}interactiveParent=false;if(childHit){if(interactionEvent.target){hitTest2=false}hit=true}}}}if(interactive){if(hitTest2&&!interactionEvent.target){if(!displayObject.hitArea&&displayObject.containsPoint){if(displayObject.containsPoint(point)){hit=true}}}if(displayObject.interactive){if(hit&&!interactionEvent.target){interactionEvent.target=displayObject}if(func){func(interactionEvent,displayObject,!!hit)}}}return hit};TreeSearch.prototype.findHit=function findHit(interactionEvent,displayObject,func,hitTest2){this.recursiveFindHit(interactionEvent,displayObject,func,hitTest2,false)};var _interactiveTarget={interactive:false,interactiveChildren:true,hitArea:null,get buttonMode(){return this.cursor==="pointer"},set buttonMode(value){if(value){this.cursor="pointer"}else if(this.cursor==="pointer"){this.cursor=null}},cursor:null,get trackedPointers(){if(this._trackedPointers===void 0){this._trackedPointers={}}return this._trackedPointers},_trackedPointers:void 0};DisplayObject.mixin(_interactiveTarget);var MOUSE_POINTER_ID=1;var hitTestEvent={target:null,data:{global:null}};var _InteractionManager=function(EventEmitter){function InteractionManager2(renderer,options){EventEmitter.call(this);options=options||{};this.renderer=renderer;this.autoPreventDefault=options.autoPreventDefault!==void 0?options.autoPreventDefault:true;this.interactionFrequency=options.interactionFrequency||10;this.mouse=new _InteractionData;this.mouse.identifier=MOUSE_POINTER_ID;this.mouse.global.set(-999999);this.activeInteractionData={};this.activeInteractionData[MOUSE_POINTER_ID]=this.mouse;this.interactionDataPool=[];this.eventData=new _InteractionEvent;this.interactionDOMElement=null;this.moveWhenInside=false;this.eventsAdded=false;this.tickerAdded=false;this.mouseOverRenderer=false;this.supportsTouchEvents="ontouchstart"in window;this.supportsPointerEvents=!!window.PointerEvent;this.onPointerUp=this.onPointerUp.bind(this);this.processPointerUp=this.processPointerUp.bind(this);this.onPointerCancel=this.onPointerCancel.bind(this);this.processPointerCancel=this.processPointerCancel.bind(this);this.onPointerDown=this.onPointerDown.bind(this);this.processPointerDown=this.processPointerDown.bind(this);this.onPointerMove=this.onPointerMove.bind(this);this.processPointerMove=this.processPointerMove.bind(this);this.onPointerOut=this.onPointerOut.bind(this);this.processPointerOverOut=this.processPointerOverOut.bind(this);this.onPointerOver=this.onPointerOver.bind(this);this.cursorStyles={default:"inherit",pointer:"pointer"};this.currentCursorMode=null;this.cursor=null;this.resolution=1;this.delayedEvents=[];this.search=new TreeSearch;this._useSystemTicker=options.useSystemTicker!==void 0?options.useSystemTicker:true;this.setTargetElement(this.renderer.view,this.renderer.resolution)}if(EventEmitter)InteractionManager2.__proto__=EventEmitter;InteractionManager2.prototype=Object.create(EventEmitter&&EventEmitter.prototype);InteractionManager2.prototype.constructor=InteractionManager2;var prototypeAccessors5={useSystemTicker:{configurable:true}};prototypeAccessors5.useSystemTicker.get=function(){return this._useSystemTicker};prototypeAccessors5.useSystemTicker.set=function(useSystemTicker){this._useSystemTicker=useSystemTicker;if(useSystemTicker){this.addTickerListener()}else{this.removeTickerListener()}};InteractionManager2.prototype.hitTest=function hitTest2(globalPoint,root){hitTestEvent.target=null;hitTestEvent.data.global=globalPoint;if(!root){root=this.renderer._lastObjectRendered}this.processInteractive(hitTestEvent,root,null,true);return hitTestEvent.target};InteractionManager2.prototype.setTargetElement=function setTargetElement(element,resolution){if(resolution===void 0)resolution=1;this.removeTickerListener();this.removeEvents();this.interactionDOMElement=element;this.resolution=resolution;this.addEvents();this.addTickerListener()};InteractionManager2.prototype.addTickerListener=function addTickerListener(){if(this.tickerAdded||!this.interactionDOMElement||!this._useSystemTicker){return}Ticker.system.add(this.tickerUpdate,this,UPDATE_PRIORITY.INTERACTION);this.tickerAdded=true};InteractionManager2.prototype.removeTickerListener=function removeTickerListener(){if(!this.tickerAdded){return}Ticker.system.remove(this.tickerUpdate,this);this.tickerAdded=false};InteractionManager2.prototype.addEvents=function addEvents(){if(this.eventsAdded||!this.interactionDOMElement){return}if(window.navigator.msPointerEnabled){this.interactionDOMElement.style["-ms-content-zooming"]="none";this.interactionDOMElement.style["-ms-touch-action"]="none"}else if(this.supportsPointerEvents){this.interactionDOMElement.style["touch-action"]="none"}if(this.supportsPointerEvents){window.document.addEventListener("pointermove",this.onPointerMove,true);this.interactionDOMElement.addEventListener("pointerdown",this.onPointerDown,true);this.interactionDOMElement.addEventListener("pointerleave",this.onPointerOut,true);this.interactionDOMElement.addEventListener("pointerover",this.onPointerOver,true);window.addEventListener("pointercancel",this.onPointerCancel,true);window.addEventListener("pointerup",this.onPointerUp,true)}else{window.document.addEventListener("mousemove",this.onPointerMove,true);this.interactionDOMElement.addEventListener("mousedown",this.onPointerDown,true);this.interactionDOMElement.addEventListener("mouseout",this.onPointerOut,true);this.interactionDOMElement.addEventListener("mouseover",this.onPointerOver,true);window.addEventListener("mouseup",this.onPointerUp,true)}if(this.supportsTouchEvents){this.interactionDOMElement.addEventListener("touchstart",this.onPointerDown,true);this.interactionDOMElement.addEventListener("touchcancel",this.onPointerCancel,true);this.interactionDOMElement.addEventListener("touchend",this.onPointerUp,true);this.interactionDOMElement.addEventListener("touchmove",this.onPointerMove,true)}this.eventsAdded=true};InteractionManager2.prototype.removeEvents=function removeEvents(){if(!this.eventsAdded||!this.interactionDOMElement){return}if(window.navigator.msPointerEnabled){this.interactionDOMElement.style["-ms-content-zooming"]="";this.interactionDOMElement.style["-ms-touch-action"]=""}else if(this.supportsPointerEvents){this.interactionDOMElement.style["touch-action"]=""}if(this.supportsPointerEvents){window.document.removeEventListener("pointermove",this.onPointerMove,true);this.interactionDOMElement.removeEventListener("pointerdown",this.onPointerDown,true);this.interactionDOMElement.removeEventListener("pointerleave",this.onPointerOut,true);this.interactionDOMElement.removeEventListener("pointerover",this.onPointerOver,true);window.removeEventListener("pointercancel",this.onPointerCancel,true);window.removeEventListener("pointerup",this.onPointerUp,true)}else{window.document.removeEventListener("mousemove",this.onPointerMove,true);this.interactionDOMElement.removeEventListener("mousedown",this.onPointerDown,true);this.interactionDOMElement.removeEventListener("mouseout",this.onPointerOut,true);this.interactionDOMElement.removeEventListener("mouseover",this.onPointerOver,true);window.removeEventListener("mouseup",this.onPointerUp,true)}if(this.supportsTouchEvents){this.interactionDOMElement.removeEventListener("touchstart",this.onPointerDown,true);this.interactionDOMElement.removeEventListener("touchcancel",this.onPointerCancel,true);this.interactionDOMElement.removeEventListener("touchend",this.onPointerUp,true);this.interactionDOMElement.removeEventListener("touchmove",this.onPointerMove,true)}this.interactionDOMElement=null;this.eventsAdded=false};InteractionManager2.prototype.tickerUpdate=function tickerUpdate(deltaTime){this._deltaTime+=deltaTime;if(this._deltaTime<this.interactionFrequency){return}this._deltaTime=0;this.update()};InteractionManager2.prototype.update=function update7(){if(!this.interactionDOMElement){return}if(this.didMove){this.didMove=false;return}this.cursor=null;for(var k in this.activeInteractionData){if(this.activeInteractionData.hasOwnProperty(k)){var interactionData=this.activeInteractionData[k];if(interactionData.originalEvent&&interactionData.pointerType!=="touch"){var interactionEvent=this.configureInteractionEventForDOMEvent(this.eventData,interactionData.originalEvent,interactionData);this.processInteractive(interactionEvent,this.renderer._lastObjectRendered,this.processPointerOverOut,true)}}}this.setCursorMode(this.cursor)};InteractionManager2.prototype.setCursorMode=function setCursorMode(mode){mode=mode||"default";if(this.currentCursorMode===mode){return}this.currentCursorMode=mode;var style2=this.cursorStyles[mode];if(style2){switch(_typeof(style2)){case"string":this.interactionDOMElement.style.cursor=style2;break;case"function":style2(mode);break;case"object":Object.assign(this.interactionDOMElement.style,style2);break;}}else if(typeof mode==="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,mode)){this.interactionDOMElement.style.cursor=mode}};InteractionManager2.prototype.dispatchEvent=function dispatchEvent(displayObject,eventString,eventData){if(!eventData.stopPropagationHint||displayObject===eventData.stopsPropagatingAt){eventData.currentTarget=displayObject;eventData.type=eventString;displayObject.emit(eventString,eventData);if(displayObject[eventString]){displayObject[eventString](eventData)}}};InteractionManager2.prototype.delayDispatchEvent=function delayDispatchEvent(displayObject,eventString,eventData){this.delayedEvents.push({displayObject:displayObject,eventString:eventString,eventData:eventData})};InteractionManager2.prototype.mapPositionToPoint=function mapPositionToPoint(point,x,y){var rect;if(!this.interactionDOMElement.parentElement){rect={x:0,y:0,width:0,height:0}}else{rect=this.interactionDOMElement.getBoundingClientRect()}var resolutionMultiplier=1/this.resolution;point.x=(x-rect.left)*(this.interactionDOMElement.width/rect.width)*resolutionMultiplier;point.y=(y-rect.top)*(this.interactionDOMElement.height/rect.height)*resolutionMultiplier};InteractionManager2.prototype.processInteractive=function processInteractive(interactionEvent,displayObject,func,hitTest2){var hit=this.search.findHit(interactionEvent,displayObject,func,hitTest2);var delayedEvents=this.delayedEvents;if(!delayedEvents.length){return hit}interactionEvent.stopPropagationHint=false;var delayedLen=delayedEvents.length;this.delayedEvents=[];for(var i=0;i<delayedLen;i++){var ref=delayedEvents[i];var displayObject$1=ref.displayObject;var eventString=ref.eventString;var eventData=ref.eventData;if(eventData.stopsPropagatingAt===displayObject$1){eventData.stopPropagationHint=true}this.dispatchEvent(displayObject$1,eventString,eventData)}return hit};InteractionManager2.prototype.onPointerDown=function onPointerDown(originalEvent){if(this.supportsTouchEvents&&originalEvent.pointerType==="touch"){return}var events=this.normalizeToPointerData(originalEvent);if(this.autoPreventDefault&&events[0].isNormalized){var cancelable=originalEvent.cancelable||!("cancelable"in originalEvent);if(cancelable){originalEvent.preventDefault()}}var eventLen=events.length;for(var i=0;i<eventLen;i++){var event2=events[i];var interactionData=this.getInteractionDataForPointerId(event2);var interactionEvent=this.configureInteractionEventForDOMEvent(this.eventData,event2,interactionData);interactionEvent.data.originalEvent=originalEvent;this.processInteractive(interactionEvent,this.renderer._lastObjectRendered,this.processPointerDown,true);this.emit("pointerdown",interactionEvent);if(event2.pointerType==="touch"){this.emit("touchstart",interactionEvent)}else if(event2.pointerType==="mouse"||event2.pointerType==="pen"){var isRightButton=event2.button===2;this.emit(isRightButton?"rightdown":"mousedown",this.eventData)}}};InteractionManager2.prototype.processPointerDown=function processPointerDown(interactionEvent,displayObject,hit){var data=interactionEvent.data;var id=interactionEvent.data.identifier;if(hit){if(!displayObject.trackedPointers[id]){displayObject.trackedPointers[id]=new _InteractionTrackingData(id)}this.dispatchEvent(displayObject,"pointerdown",interactionEvent);if(data.pointerType==="touch"){this.dispatchEvent(displayObject,"touchstart",interactionEvent)}else if(data.pointerType==="mouse"||data.pointerType==="pen"){var isRightButton=data.button===2;if(isRightButton){displayObject.trackedPointers[id].rightDown=true}else{displayObject.trackedPointers[id].leftDown=true}this.dispatchEvent(displayObject,isRightButton?"rightdown":"mousedown",interactionEvent)}}};InteractionManager2.prototype.onPointerComplete=function onPointerComplete(originalEvent,cancelled,func){var events=this.normalizeToPointerData(originalEvent);var eventLen=events.length;var eventAppend=originalEvent.target!==this.interactionDOMElement?"outside":"";for(var i=0;i<eventLen;i++){var event2=events[i];var interactionData=this.getInteractionDataForPointerId(event2);var interactionEvent=this.configureInteractionEventForDOMEvent(this.eventData,event2,interactionData);interactionEvent.data.originalEvent=originalEvent;this.processInteractive(interactionEvent,this.renderer._lastObjectRendered,func,cancelled||!eventAppend);this.emit(cancelled?"pointercancel":"pointerup"+eventAppend,interactionEvent);if(event2.pointerType==="mouse"||event2.pointerType==="pen"){var isRightButton=event2.button===2;this.emit(isRightButton?"rightup"+eventAppend:"mouseup"+eventAppend,interactionEvent)}else if(event2.pointerType==="touch"){this.emit(cancelled?"touchcancel":"touchend"+eventAppend,interactionEvent);this.releaseInteractionDataForPointerId(event2.pointerId,interactionData)}}};InteractionManager2.prototype.onPointerCancel=function onPointerCancel(event2){if(this.supportsTouchEvents&&event2.pointerType==="touch"){return}this.onPointerComplete(event2,true,this.processPointerCancel)};InteractionManager2.prototype.processPointerCancel=function processPointerCancel(interactionEvent,displayObject){var data=interactionEvent.data;var id=interactionEvent.data.identifier;if(displayObject.trackedPointers[id]!==void 0){delete displayObject.trackedPointers[id];this.dispatchEvent(displayObject,"pointercancel",interactionEvent);if(data.pointerType==="touch"){this.dispatchEvent(displayObject,"touchcancel",interactionEvent)}}};InteractionManager2.prototype.onPointerUp=function onPointerUp(event2){if(this.supportsTouchEvents&&event2.pointerType==="touch"){return}this.onPointerComplete(event2,false,this.processPointerUp)};InteractionManager2.prototype.processPointerUp=function processPointerUp(interactionEvent,displayObject,hit){var data=interactionEvent.data;var id=interactionEvent.data.identifier;var trackingData=displayObject.trackedPointers[id];var isTouch=data.pointerType==="touch";var isMouse=data.pointerType==="mouse"||data.pointerType==="pen";var isMouseTap=false;if(isMouse){var isRightButton=data.button===2;var flags=_InteractionTrackingData.FLAGS;var test=isRightButton?flags.RIGHT_DOWN:flags.LEFT_DOWN;var isDown=trackingData!==void 0&&trackingData.flags&test;if(hit){this.dispatchEvent(displayObject,isRightButton?"rightup":"mouseup",interactionEvent);if(isDown){this.dispatchEvent(displayObject,isRightButton?"rightclick":"click",interactionEvent);isMouseTap=true}}else if(isDown){this.dispatchEvent(displayObject,isRightButton?"rightupoutside":"mouseupoutside",interactionEvent)}if(trackingData){if(isRightButton){trackingData.rightDown=false}else{trackingData.leftDown=false}}}if(hit){this.dispatchEvent(displayObject,"pointerup",interactionEvent);if(isTouch){this.dispatchEvent(displayObject,"touchend",interactionEvent)}if(trackingData){if(!isMouse||isMouseTap){this.dispatchEvent(displayObject,"pointertap",interactionEvent)}if(isTouch){this.dispatchEvent(displayObject,"tap",interactionEvent);trackingData.over=false}}}else if(trackingData){this.dispatchEvent(displayObject,"pointerupoutside",interactionEvent);if(isTouch){this.dispatchEvent(displayObject,"touchendoutside",interactionEvent)}}if(trackingData&&trackingData.none){delete displayObject.trackedPointers[id]}};InteractionManager2.prototype.onPointerMove=function onPointerMove(originalEvent){if(this.supportsTouchEvents&&originalEvent.pointerType==="touch"){return}var events=this.normalizeToPointerData(originalEvent);if(events[0].pointerType==="mouse"||events[0].pointerType==="pen"){this.didMove=true;this.cursor=null}var eventLen=events.length;for(var i=0;i<eventLen;i++){var event2=events[i];var interactionData=this.getInteractionDataForPointerId(event2);var interactionEvent=this.configureInteractionEventForDOMEvent(this.eventData,event2,interactionData);interactionEvent.data.originalEvent=originalEvent;this.processInteractive(interactionEvent,this.renderer._lastObjectRendered,this.processPointerMove,true);this.emit("pointermove",interactionEvent);if(event2.pointerType==="touch"){this.emit("touchmove",interactionEvent)}if(event2.pointerType==="mouse"||event2.pointerType==="pen"){this.emit("mousemove",interactionEvent)}}if(events[0].pointerType==="mouse"){this.setCursorMode(this.cursor)}};InteractionManager2.prototype.processPointerMove=function processPointerMove(interactionEvent,displayObject,hit){var data=interactionEvent.data;var isTouch=data.pointerType==="touch";var isMouse=data.pointerType==="mouse"||data.pointerType==="pen";if(isMouse){this.processPointerOverOut(interactionEvent,displayObject,hit)}if(!this.moveWhenInside||hit){this.dispatchEvent(displayObject,"pointermove",interactionEvent);if(isTouch){this.dispatchEvent(displayObject,"touchmove",interactionEvent)}if(isMouse){this.dispatchEvent(displayObject,"mousemove",interactionEvent)}}};InteractionManager2.prototype.onPointerOut=function onPointerOut(originalEvent){if(this.supportsTouchEvents&&originalEvent.pointerType==="touch"){return}var events=this.normalizeToPointerData(originalEvent);var event2=events[0];if(event2.pointerType==="mouse"){this.mouseOverRenderer=false;this.setCursorMode(null)}var interactionData=this.getInteractionDataForPointerId(event2);var interactionEvent=this.configureInteractionEventForDOMEvent(this.eventData,event2,interactionData);interactionEvent.data.originalEvent=event2;this.processInteractive(interactionEvent,this.renderer._lastObjectRendered,this.processPointerOverOut,false);this.emit("pointerout",interactionEvent);if(event2.pointerType==="mouse"||event2.pointerType==="pen"){this.emit("mouseout",interactionEvent)}else{this.releaseInteractionDataForPointerId(interactionData.identifier)}};InteractionManager2.prototype.processPointerOverOut=function processPointerOverOut(interactionEvent,displayObject,hit){var data=interactionEvent.data;var id=interactionEvent.data.identifier;var isMouse=data.pointerType==="mouse"||data.pointerType==="pen";var trackingData=displayObject.trackedPointers[id];if(hit&&!trackingData){trackingData=displayObject.trackedPointers[id]=new _InteractionTrackingData(id)}if(trackingData===void 0){return}if(hit&&this.mouseOverRenderer){if(!trackingData.over){trackingData.over=true;this.delayDispatchEvent(displayObject,"pointerover",interactionEvent);if(isMouse){this.delayDispatchEvent(displayObject,"mouseover",interactionEvent)}}if(isMouse&&this.cursor===null){this.cursor=displayObject.cursor}}else if(trackingData.over){trackingData.over=false;this.dispatchEvent(displayObject,"pointerout",this.eventData);if(isMouse){this.dispatchEvent(displayObject,"mouseout",interactionEvent)}if(trackingData.none){delete displayObject.trackedPointers[id]}}};InteractionManager2.prototype.onPointerOver=function onPointerOver(originalEvent){var events=this.normalizeToPointerData(originalEvent);var event2=events[0];var interactionData=this.getInteractionDataForPointerId(event2);var interactionEvent=this.configureInteractionEventForDOMEvent(this.eventData,event2,interactionData);interactionEvent.data.originalEvent=event2;if(event2.pointerType==="mouse"){this.mouseOverRenderer=true}this.emit("pointerover",interactionEvent);if(event2.pointerType==="mouse"||event2.pointerType==="pen"){this.emit("mouseover",interactionEvent)}};InteractionManager2.prototype.getInteractionDataForPointerId=function getInteractionDataForPointerId(event2){var pointerId=event2.pointerId;var interactionData;if(pointerId===MOUSE_POINTER_ID||event2.pointerType==="mouse"){interactionData=this.mouse}else if(this.activeInteractionData[pointerId]){interactionData=this.activeInteractionData[pointerId]}else{interactionData=this.interactionDataPool.pop()||new _InteractionData;interactionData.identifier=pointerId;this.activeInteractionData[pointerId]=interactionData}interactionData.copyEvent(event2);return interactionData};InteractionManager2.prototype.releaseInteractionDataForPointerId=function releaseInteractionDataForPointerId(pointerId){var interactionData=this.activeInteractionData[pointerId];if(interactionData){delete this.activeInteractionData[pointerId];interactionData.reset();this.interactionDataPool.push(interactionData)}};InteractionManager2.prototype.configureInteractionEventForDOMEvent=function configureInteractionEventForDOMEvent(interactionEvent,pointerEvent,interactionData){interactionEvent.data=interactionData;this.mapPositionToPoint(interactionData.global,pointerEvent.clientX,pointerEvent.clientY);if(pointerEvent.pointerType==="touch"){pointerEvent.globalX=interactionData.global.x;pointerEvent.globalY=interactionData.global.y}interactionData.originalEvent=pointerEvent;interactionEvent.reset();return interactionEvent};InteractionManager2.prototype.normalizeToPointerData=function normalizeToPointerData(event2){var normalizedEvents=[];if(this.supportsTouchEvents&&event2 instanceof TouchEvent){for(var i=0,li=event2.changedTouches.length;i<li;i++){var touch=event2.changedTouches[i];if(typeof touch.button==="undefined"){touch.button=event2.touches.length?1:0}if(typeof touch.buttons==="undefined"){touch.buttons=event2.touches.length?1:0}if(typeof touch.isPrimary==="undefined"){touch.isPrimary=event2.touches.length===1&&event2.type==="touchstart"}if(typeof touch.width==="undefined"){touch.width=touch.radiusX||1}if(typeof touch.height==="undefined"){touch.height=touch.radiusY||1}if(typeof touch.tiltX==="undefined"){touch.tiltX=0}if(typeof touch.tiltY==="undefined"){touch.tiltY=0}if(typeof touch.pointerType==="undefined"){touch.pointerType="touch"}if(typeof touch.pointerId==="undefined"){touch.pointerId=touch.identifier||0}if(typeof touch.pressure==="undefined"){touch.pressure=touch.force||0.5}if(typeof touch.twist==="undefined"){touch.twist=0}if(typeof touch.tangentialPressure==="undefined"){touch.tangentialPressure=0}if(typeof touch.layerX==="undefined"){touch.layerX=touch.offsetX=touch.clientX}if(typeof touch.layerY==="undefined"){touch.layerY=touch.offsetY=touch.clientY}touch.isNormalized=true;normalizedEvents.push(touch)}}else if(event2 instanceof MouseEvent&&(!this.supportsPointerEvents||!(event2 instanceof window.PointerEvent))){if(typeof event2.isPrimary==="undefined"){event2.isPrimary=true}if(typeof event2.width==="undefined"){event2.width=1}if(typeof event2.height==="undefined"){event2.height=1}if(typeof event2.tiltX==="undefined"){event2.tiltX=0}if(typeof event2.tiltY==="undefined"){event2.tiltY=0}if(typeof event2.pointerType==="undefined"){event2.pointerType="mouse"}if(typeof event2.pointerId==="undefined"){event2.pointerId=MOUSE_POINTER_ID}if(typeof event2.pressure==="undefined"){event2.pressure=0.5}if(typeof event2.twist==="undefined"){event2.twist=0}if(typeof event2.tangentialPressure==="undefined"){event2.tangentialPressure=0}event2.isNormalized=true;normalizedEvents.push(event2)}else{normalizedEvents.push(event2)}return normalizedEvents};InteractionManager2.prototype.destroy=function destroy25(){this.removeEvents();this.removeTickerListener();this.removeAllListeners();this.renderer=null;this.mouse=null;this.eventData=null;this.interactionDOMElement=null;this.onPointerDown=null;this.processPointerDown=null;this.onPointerUp=null;this.processPointerUp=null;this.onPointerCancel=null;this.processPointerCancel=null;this.onPointerMove=null;this.processPointerMove=null;this.onPointerOut=null;this.processPointerOverOut=null;this.onPointerOver=null;this.search=null};Object.defineProperties(InteractionManager2.prototype,prototypeAccessors5);return InteractionManager2}(import_eventemitter3.default);var Runner=function(){function Runner2(name){this.items=[];this._name=name;this._aliasCount=0}Runner2.prototype.emit=function(a0,a1,a2,a3,a4,a5,a6,a7){if(arguments.length>8){throw new Error("max arguments reached")}var _a=this,name=_a.name,items=_a.items;this._aliasCount++;for(var i=0,len=items.length;i<len;i++){items[i][name](a0,a1,a2,a3,a4,a5,a6,a7)}if(items===this.items){this._aliasCount--}return this};Runner2.prototype.ensureNonAliasedItems=function(){if(this._aliasCount>0&&this.items.length>1){this._aliasCount=0;this.items=this.items.slice(0)}};Runner2.prototype.add=function(item){if(item[this._name]){this.ensureNonAliasedItems();this.remove(item);this.items.push(item)}return this};Runner2.prototype.remove=function(item){var index3=this.items.indexOf(item);if(index3!==-1){this.ensureNonAliasedItems();this.items.splice(index3,1)}return this};Runner2.prototype.contains=function(item){return this.items.indexOf(item)!==-1};Runner2.prototype.removeAll=function(){this.ensureNonAliasedItems();this.items.length=0;return this};Runner2.prototype.destroy=function(){this.removeAll();this.items=null;this._name=null};Object.defineProperty(Runner2.prototype,"empty",{get:function get(){return this.items.length===0},enumerable:true,configurable:true});Object.defineProperty(Runner2.prototype,"name",{get:function get(){return this._name},enumerable:true,configurable:true});return Runner2}();Object.defineProperties(Runner.prototype,{dispatch:{value:Runner.prototype.emit},run:{value:Runner.prototype.emit}});var Resource=function Resource2(width,height){if(width===void 0)width=0;if(height===void 0)height=0;this._width=width;this._height=height;this.destroyed=false;this.internal=false;this.onResize=new Runner("setRealSize",2);this.onUpdate=new Runner("update");this.onError=new Runner("onError",1)};var prototypeAccessors2={valid:{configurable:true},width:{configurable:true},height:{configurable:true}};Resource.prototype.bind=function bind(baseTexture){this.onResize.add(baseTexture);this.onUpdate.add(baseTexture);this.onError.add(baseTexture);if(this._width||this._height){this.onResize.run(this._width,this._height)}};Resource.prototype.unbind=function unbind(baseTexture){this.onResize.remove(baseTexture);this.onUpdate.remove(baseTexture);this.onError.remove(baseTexture)};Resource.prototype.resize=function resize(width,height){if(width!==this._width||height!==this._height){this._width=width;this._height=height;this.onResize.run(width,height)}};prototypeAccessors2.valid.get=function(){return!!this._width&&!!this._height};Resource.prototype.update=function update2(){if(!this.destroyed){this.onUpdate.run()}};Resource.prototype.load=function load(){return Promise.resolve()};prototypeAccessors2.width.get=function(){return this._width};prototypeAccessors2.height.get=function(){return this._height};Resource.prototype.upload=function upload(renderer,baseTexture,glTexture){return false};Resource.prototype.style=function style(renderer,baseTexture,glTexture){return false};Resource.prototype.dispose=function dispose(){};Resource.prototype.destroy=function destroy2(){if(!this.destroyed){this.destroyed=true;this.dispose();this.onError.removeAll();this.onError=null;this.onResize.removeAll();this.onResize=null;this.onUpdate.removeAll();this.onUpdate=null}};Object.defineProperties(Resource.prototype,prototypeAccessors2);var BaseImageResource=function(Resource4){function BaseImageResource2(source){var width=source.naturalWidth||source.videoWidth||source.width;var height=source.naturalHeight||source.videoHeight||source.height;Resource4.call(this,width,height);this.source=source;this.noSubImage=false}if(Resource4)BaseImageResource2.__proto__=Resource4;BaseImageResource2.prototype=Object.create(Resource4&&Resource4.prototype);BaseImageResource2.prototype.constructor=BaseImageResource2;BaseImageResource2.crossOrigin=function crossOrigin(element,url,crossorigin){if(crossorigin===void 0&&url.indexOf("data:")!==0){element.crossOrigin=_determineCrossOrigin2(url)}else if(crossorigin!==false){element.crossOrigin=typeof crossorigin==="string"?crossorigin:"anonymous"}};BaseImageResource2.prototype.upload=function upload3(renderer,baseTexture,glTexture,source){var gl=renderer.gl;var width=baseTexture.realWidth;var height=baseTexture.realHeight;source=source||this.source;gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,baseTexture.alphaMode===ALPHA_MODES.UNPACK);if(!this.noSubImage&&baseTexture.target===gl.TEXTURE_2D&&glTexture.width===width&&glTexture.height===height){gl.texSubImage2D(gl.TEXTURE_2D,0,0,0,baseTexture.format,baseTexture.type,source)}else{glTexture.width=width;glTexture.height=height;gl.texImage2D(baseTexture.target,0,baseTexture.format,baseTexture.format,baseTexture.type,source)}return true};BaseImageResource2.prototype.update=function update7(){if(this.destroyed){return}var width=this.source.naturalWidth||this.source.videoWidth||this.source.width;var height=this.source.naturalHeight||this.source.videoHeight||this.source.height;this.resize(width,height);Resource4.prototype.update.call(this)};BaseImageResource2.prototype.dispose=function dispose5(){this.source=null};return BaseImageResource2}(Resource);var ImageResource=function(BaseImageResource2){function ImageResource2(source,options){options=options||{};if(!(source instanceof HTMLImageElement)){var imageElement=new Image;BaseImageResource2.crossOrigin(imageElement,source,options.crossorigin);imageElement.src=source;source=imageElement}BaseImageResource2.call(this,source);if(!source.complete&&!!this._width&&!!this._height){this._width=0;this._height=0}this.url=source.src;this._process=null;this.preserveBitmap=false;this.createBitmap=(options.createBitmap!==void 0?options.createBitmap:settings.CREATE_IMAGE_BITMAP)&&!!window.createImageBitmap;this.alphaMode=typeof options.alphaMode==="number"?options.alphaMode:null;if(options.premultiplyAlpha!==void 0){this.premultiplyAlpha=options.premultiplyAlpha}this.bitmap=null;this._load=null;if(options.autoLoad!==false){this.load()}}if(BaseImageResource2)ImageResource2.__proto__=BaseImageResource2;ImageResource2.prototype=Object.create(BaseImageResource2&&BaseImageResource2.prototype);ImageResource2.prototype.constructor=ImageResource2;ImageResource2.prototype.load=function load2(createBitmap){var this$1=this;if(this._load){return this._load}if(createBitmap!==void 0){this.createBitmap=createBitmap}this._load=new Promise(function(resolve,reject){this$1.url=this$1.source.src;var ref=this$1;var source=ref.source;var completed=function completed(){if(this$1.destroyed){return}source.onload=null;source.onerror=null;this$1.resize(source.width,source.height);this$1._load=null;if(this$1.createBitmap){resolve(this$1.process())}else{resolve(this$1)}};if(source.complete&&source.src){completed()}else{source.onload=completed;source.onerror=function(event2){reject(event2);this$1.onError.emit(event2)}}});return this._load};ImageResource2.prototype.process=function process(){var this$1=this;if(this._process!==null){return this._process}if(this.bitmap!==null||!window.createImageBitmap){return Promise.resolve(this)}this._process=window.createImageBitmap(this.source,0,0,this.source.width,this.source.height,{premultiplyAlpha:this.premultiplyAlpha===ALPHA_MODES.UNPACK?"premultiply":"none"}).then(function(bitmap){if(this$1.destroyed){return Promise.reject()}this$1.bitmap=bitmap;this$1.update();this$1._process=null;return Promise.resolve(this$1)});return this._process};ImageResource2.prototype.upload=function upload3(renderer,baseTexture,glTexture){if(typeof this.alphaMode==="number"){baseTexture.alphaMode=this.alphaMode}if(!this.createBitmap){return BaseImageResource2.prototype.upload.call(this,renderer,baseTexture,glTexture)}if(!this.bitmap){this.process();if(!this.bitmap){return false}}BaseImageResource2.prototype.upload.call(this,renderer,baseTexture,glTexture,this.bitmap);if(!this.preserveBitmap){var flag=true;for(var key in baseTexture._glTextures){var otherTex=baseTexture._glTextures[key];if(otherTex!==glTexture&&otherTex.dirtyId!==baseTexture.dirtyId){flag=false;break}}if(flag){if(this.bitmap.close){this.bitmap.close()}this.bitmap=null}}return true};ImageResource2.prototype.dispose=function dispose5(){this.source.onload=null;this.source.onerror=null;BaseImageResource2.prototype.dispose.call(this);if(this.bitmap){this.bitmap.close();this.bitmap=null}this._process=null;this._load=null};return ImageResource2}(BaseImageResource);var INSTALLED=[];function autoDetectResource(source,options){if(!source){return null}var extension="";if(typeof source==="string"){var result=/\.(\w{3,4})(?:$|\?|#)/i.exec(source);if(result){extension=result[1].toLowerCase()}}for(var i=INSTALLED.length-1;i>=0;--i){var ResourcePlugin=INSTALLED[i];if(ResourcePlugin.test&&ResourcePlugin.test(source,extension)){return new ResourcePlugin(source,options)}}return new ImageResource(source,options)}var BufferResource=function(Resource4){function BufferResource2(source,options){var ref=options||{};var width=ref.width;var height=ref.height;if(!width||!height){throw new Error("BufferResource width or height invalid")}Resource4.call(this,width,height);this.data=source}if(Resource4)BufferResource2.__proto__=Resource4;BufferResource2.prototype=Object.create(Resource4&&Resource4.prototype);BufferResource2.prototype.constructor=BufferResource2;BufferResource2.prototype.upload=function upload3(renderer,baseTexture,glTexture){var gl=renderer.gl;gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,baseTexture.alphaMode===ALPHA_MODES.UNPACK);if(glTexture.width===baseTexture.width&&glTexture.height===baseTexture.height){gl.texSubImage2D(baseTexture.target,0,0,0,baseTexture.width,baseTexture.height,baseTexture.format,baseTexture.type,this.data)}else{glTexture.width=baseTexture.width;glTexture.height=baseTexture.height;gl.texImage2D(baseTexture.target,0,glTexture.internalFormat,baseTexture.width,baseTexture.height,0,baseTexture.format,glTexture.type,this.data)}return true};BufferResource2.prototype.dispose=function dispose5(){this.data=null};BufferResource2.test=function test(source){return source instanceof Float32Array||source instanceof Uint8Array||source instanceof Uint32Array};return BufferResource2}(Resource);var defaultBufferOptions={scaleMode:SCALE_MODES.NEAREST,format:FORMATS.RGBA,alphaMode:ALPHA_MODES.NPM};var BaseTexture=function(EventEmitter){function BaseTexture2(resource,options){if(resource===void 0)resource=null;if(options===void 0)options=null;EventEmitter.call(this);options=options||{};var alphaMode=options.alphaMode;var mipmap=options.mipmap;var anisotropicLevel=options.anisotropicLevel;var scaleMode=options.scaleMode;var width=options.width;var height=options.height;var wrapMode=options.wrapMode;var format=options.format;var type=options.type;var target=options.target;var resolution=options.resolution;var resourceOptions=options.resourceOptions;if(resource&&!(resource instanceof Resource)){resource=autoDetectResource(resource,resourceOptions);resource.internal=true}this.width=width||0;this.height=height||0;this.resolution=resolution||settings.RESOLUTION;this.mipmap=mipmap!==void 0?mipmap:settings.MIPMAP_TEXTURES;this.anisotropicLevel=anisotropicLevel!==void 0?anisotropicLevel:settings.ANISOTROPIC_LEVEL;this.wrapMode=wrapMode||settings.WRAP_MODE;this.scaleMode=scaleMode!==void 0?scaleMode:settings.SCALE_MODE;this.format=format||FORMATS.RGBA;this.type=type||TYPES.UNSIGNED_BYTE;this.target=target||TARGETS.TEXTURE_2D;this.alphaMode=alphaMode!==void 0?alphaMode:ALPHA_MODES.UNPACK;if(options.premultiplyAlpha!==void 0){this.premultiplyAlpha=options.premultiplyAlpha}this.uid=_uid();this.touched=0;this.isPowerOfTwo=false;this._refreshPOT();this._glTextures={};this.dirtyId=0;this.dirtyStyleId=0;this.cacheId=null;this.valid=width>0&&height>0;this.textureCacheIds=[];this.destroyed=false;this.resource=null;this._batchEnabled=0;this._batchLocation=0;this.setResource(resource)}if(EventEmitter)BaseTexture2.__proto__=EventEmitter;BaseTexture2.prototype=Object.create(EventEmitter&&EventEmitter.prototype);BaseTexture2.prototype.constructor=BaseTexture2;var prototypeAccessors5={realWidth:{configurable:true},realHeight:{configurable:true}};prototypeAccessors5.realWidth.get=function(){return Math.ceil(this.width*this.resolution-1e-4)};prototypeAccessors5.realHeight.get=function(){return Math.ceil(this.height*this.resolution-1e-4)};BaseTexture2.prototype.setStyle=function setStyle(scaleMode,mipmap){var dirty;if(scaleMode!==void 0&&scaleMode!==this.scaleMode){this.scaleMode=scaleMode;dirty=true}if(mipmap!==void 0&&mipmap!==this.mipmap){this.mipmap=mipmap;dirty=true}if(dirty){this.dirtyStyleId++}return this};BaseTexture2.prototype.setSize=function setSize(width,height,resolution){this.resolution=resolution||this.resolution;this.width=width;this.height=height;this._refreshPOT();this.update();return this};BaseTexture2.prototype.setRealSize=function setRealSize(realWidth,realHeight,resolution){this.resolution=resolution||this.resolution;this.width=realWidth/this.resolution;this.height=realHeight/this.resolution;this._refreshPOT();this.update();return this};BaseTexture2.prototype._refreshPOT=function _refreshPOT(){this.isPowerOfTwo=_isPow(this.realWidth)&&_isPow(this.realHeight)};BaseTexture2.prototype.setResolution=function setResolution(resolution){var oldResolution=this.resolution;if(oldResolution===resolution){return this}this.resolution=resolution;if(this.valid){this.width=this.width*oldResolution/resolution;this.height=this.height*oldResolution/resolution;this.emit("update",this)}this._refreshPOT();return this};BaseTexture2.prototype.setResource=function setResource(resource){if(this.resource===resource){return this}if(this.resource){throw new Error("Resource can be set only once")}resource.bind(this);this.resource=resource;return this};BaseTexture2.prototype.update=function update7(){if(!this.valid){if(this.width>0&&this.height>0){this.valid=true;this.emit("loaded",this);this.emit("update",this)}}else{this.dirtyId++;this.dirtyStyleId++;this.emit("update",this)}};BaseTexture2.prototype.onError=function onError(event2){this.emit("error",this,event2)};BaseTexture2.prototype.destroy=function destroy25(){if(this.resource){this.resource.unbind(this);if(this.resource.internal){this.resource.destroy()}this.resource=null}if(this.cacheId){delete _BaseTextureCache[this.cacheId];delete _TextureCache[this.cacheId];this.cacheId=null}this.dispose();BaseTexture2.removeFromCache(this);this.textureCacheIds=null;this.destroyed=true};BaseTexture2.prototype.dispose=function dispose5(){this.emit("dispose",this)};BaseTexture2.from=function from6(source,options,strict){if(strict===void 0)strict=settings.STRICT_TEXTURE_CACHE;var isFrame=typeof source==="string";var cacheId=null;if(isFrame){cacheId=source}else{if(!source._pixiId){source._pixiId="pixiid_"+_uid()}cacheId=source._pixiId}var baseTexture=_BaseTextureCache[cacheId];if(isFrame&&strict&&!baseTexture){throw new Error("The cacheId \""+cacheId+"\" does not exist in BaseTextureCache.")}if(!baseTexture){baseTexture=new BaseTexture2(source,options);baseTexture.cacheId=cacheId;BaseTexture2.addToCache(baseTexture,cacheId)}return baseTexture};BaseTexture2.fromBuffer=function fromBuffer(buffer,width,height,options){buffer=buffer||new Float32Array(width*height*4);var resource=new BufferResource(buffer,{width:width,height:height});var type=buffer instanceof Float32Array?TYPES.FLOAT:TYPES.UNSIGNED_BYTE;return new BaseTexture2(resource,Object.assign(defaultBufferOptions,options||{width:width,height:height,type:type}))};BaseTexture2.addToCache=function addToCache(baseTexture,id){if(id){if(baseTexture.textureCacheIds.indexOf(id)===-1){baseTexture.textureCacheIds.push(id)}if(_BaseTextureCache[id]){console.warn("BaseTexture added to the cache with an id ["+id+"] that already had an entry")}_BaseTextureCache[id]=baseTexture}};BaseTexture2.removeFromCache=function removeFromCache(baseTexture){if(typeof baseTexture==="string"){var baseTextureFromCache=_BaseTextureCache[baseTexture];if(baseTextureFromCache){var index3=baseTextureFromCache.textureCacheIds.indexOf(baseTexture);if(index3>-1){baseTextureFromCache.textureCacheIds.splice(index3,1)}delete _BaseTextureCache[baseTexture];return baseTextureFromCache}}else if(baseTexture&&baseTexture.textureCacheIds){for(var i=0;i<baseTexture.textureCacheIds.length;++i){delete _BaseTextureCache[baseTexture.textureCacheIds[i]]}baseTexture.textureCacheIds.length=0;return baseTexture}return null};Object.defineProperties(BaseTexture2.prototype,prototypeAccessors5);return BaseTexture2}(import_eventemitter3.default);BaseTexture._globalBatch=0;var ArrayResource=function(Resource4){function ArrayResource2(source,options){options=options||{};var urls;var length=source;if(Array.isArray(source)){urls=source;length=source.length}Resource4.call(this,options.width,options.height);this.items=[];this.itemDirtyIds=[];for(var i=0;i<length;i++){var partTexture=new BaseTexture;this.items.push(partTexture);this.itemDirtyIds.push(-1)}this.length=length;this._load=null;if(urls){for(var i$1=0;i$1<length;i$1++){this.addResourceAt(autoDetectResource(urls[i$1],options),i$1)}}}if(Resource4)ArrayResource2.__proto__=Resource4;ArrayResource2.prototype=Object.create(Resource4&&Resource4.prototype);ArrayResource2.prototype.constructor=ArrayResource2;ArrayResource2.prototype.dispose=function dispose5(){for(var i=0,len=this.length;i<len;i++){this.items[i].destroy()}this.items=null;this.itemDirtyIds=null;this._load=null};ArrayResource2.prototype.addResourceAt=function addResourceAt(resource,index3){var baseTexture=this.items[index3];if(!baseTexture){throw new Error("Index "+index3+" is out of bounds")}if(resource.valid&&!this.valid){this.resize(resource.width,resource.height)}this.items[index3].setResource(resource);return this};ArrayResource2.prototype.bind=function bind2(baseTexture){Resource4.prototype.bind.call(this,baseTexture);baseTexture.target=TARGETS.TEXTURE_2D_ARRAY;for(var i=0;i<this.length;i++){this.items[i].on("update",baseTexture.update,baseTexture)}};ArrayResource2.prototype.unbind=function unbind2(baseTexture){Resource4.prototype.unbind.call(this,baseTexture);for(var i=0;i<this.length;i++){this.items[i].off("update",baseTexture.update,baseTexture)}};ArrayResource2.prototype.load=function load2(){var this$1=this;if(this._load){return this._load}var resources=this.items.map(function(item){return item.resource});var promises=resources.map(function(item){return item.load()});this._load=Promise.all(promises).then(function(){var ref=resources[0];var width=ref.width;var height=ref.height;this$1.resize(width,height);return Promise.resolve(this$1)});return this._load};ArrayResource2.prototype.upload=function upload3(renderer,texture,glTexture){var ref=this;var length=ref.length;var itemDirtyIds=ref.itemDirtyIds;var items=ref.items;var gl=renderer.gl;if(glTexture.dirtyId<0){gl.texImage3D(gl.TEXTURE_2D_ARRAY,0,texture.format,this._width,this._height,length,0,texture.format,texture.type,null)}for(var i=0;i<length;i++){var item=items[i];if(itemDirtyIds[i]<item.dirtyId){itemDirtyIds[i]=item.dirtyId;if(item.valid){gl.texSubImage3D(gl.TEXTURE_2D_ARRAY,0,0,0,i,item.resource.width,item.resource.height,1,texture.format,texture.type,item.resource.source)}}}return true};return ArrayResource2}(Resource);var CanvasResource=function(BaseImageResource2){function CanvasResource2(){BaseImageResource2.apply(this,arguments)}if(BaseImageResource2)CanvasResource2.__proto__=BaseImageResource2;CanvasResource2.prototype=Object.create(BaseImageResource2&&BaseImageResource2.prototype);CanvasResource2.prototype.constructor=CanvasResource2;CanvasResource2.test=function test(source){var OffscreenCanvas2=window.OffscreenCanvas;if(OffscreenCanvas2&&source instanceof OffscreenCanvas2){return true}return source instanceof HTMLCanvasElement};return CanvasResource2}(BaseImageResource);var CubeResource=function(ArrayResource2){function CubeResource2(source,options){options=options||{};ArrayResource2.call(this,source,options);if(this.length!==CubeResource2.SIDES){throw new Error("Invalid length. Got "+this.length+", expected 6")}for(var i=0;i<CubeResource2.SIDES;i++){this.items[i].target=TARGETS.TEXTURE_CUBE_MAP_POSITIVE_X+i}if(options.autoLoad!==false){this.load()}}if(ArrayResource2)CubeResource2.__proto__=ArrayResource2;CubeResource2.prototype=Object.create(ArrayResource2&&ArrayResource2.prototype);CubeResource2.prototype.constructor=CubeResource2;CubeResource2.prototype.bind=function bind2(baseTexture){ArrayResource2.prototype.bind.call(this,baseTexture);baseTexture.target=TARGETS.TEXTURE_CUBE_MAP};CubeResource2.prototype.upload=function upload3(renderer,baseTexture,glTexture){var dirty=this.itemDirtyIds;for(var i=0;i<CubeResource2.SIDES;i++){var side=this.items[i];if(dirty[i]<side.dirtyId){dirty[i]=side.dirtyId;if(side.valid){side.resource.upload(renderer,side,glTexture)}}}return true};return CubeResource2}(ArrayResource);CubeResource.SIDES=6;var SVGResource=function(BaseImageResource2){function SVGResource2(source,options){options=options||{};BaseImageResource2.call(this,document.createElement("canvas"));this._width=0;this._height=0;this.svg=source;this.scale=options.scale||1;this._overrideWidth=options.width;this._overrideHeight=options.height;this._resolve=null;this._crossorigin=options.crossorigin;this._load=null;if(options.autoLoad!==false){this.load()}}if(BaseImageResource2)SVGResource2.__proto__=BaseImageResource2;SVGResource2.prototype=Object.create(BaseImageResource2&&BaseImageResource2.prototype);SVGResource2.prototype.constructor=SVGResource2;SVGResource2.prototype.load=function load2(){var this$1=this;if(this._load){return this._load}this._load=new Promise(function(resolve){this$1._resolve=function(){this$1.resize(this$1.source.width,this$1.source.height);resolve(this$1)};if(/^\<svg/.test(this$1.svg.trim())){if(!btoa){throw new Error("Your browser doesn't support base64 conversions.")}this$1.svg="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(this$1.svg)))}this$1._loadSvg()});return this._load};SVGResource2.prototype._loadSvg=function _loadSvg(){var this$1=this;var tempImage=new Image;BaseImageResource2.crossOrigin(tempImage,this.svg,this._crossorigin);tempImage.src=this.svg;tempImage.onerror=function(event2){if(!this$1._resolve){return}tempImage.onerror=null;this$1.onError.run(event2)};tempImage.onload=function(){if(!this$1._resolve){return}var svgWidth=tempImage.width;var svgHeight=tempImage.height;if(!svgWidth||!svgHeight){throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.")}var width=svgWidth*this$1.scale;var height=svgHeight*this$1.scale;if(this$1._overrideWidth||this$1._overrideHeight){width=this$1._overrideWidth||this$1._overrideHeight/svgHeight*svgWidth;height=this$1._overrideHeight||this$1._overrideWidth/svgWidth*svgHeight}width=Math.round(width);height=Math.round(height);var canvas4=this$1.source;canvas4.width=width;canvas4.height=height;canvas4._pixiId="canvas_"+_uid();canvas4.getContext("2d").drawImage(tempImage,0,0,svgWidth,svgHeight,0,0,width,height);this$1._resolve();this$1._resolve=null}};SVGResource2.getSize=function getSize2(svgString){var sizeMatch=SVGResource2.SVG_SIZE.exec(svgString);var size={};if(sizeMatch){size[sizeMatch[1]]=Math.round(parseFloat(sizeMatch[3]));size[sizeMatch[5]]=Math.round(parseFloat(sizeMatch[7]))}return size};SVGResource2.prototype.dispose=function dispose5(){BaseImageResource2.prototype.dispose.call(this);this._resolve=null;this._crossorigin=null};SVGResource2.test=function test(source,extension){return extension==="svg"||typeof source==="string"&&source.indexOf("data:image/svg+xml;base64")===0||typeof source==="string"&&source.indexOf("<svg")===0};return SVGResource2}(BaseImageResource);SVGResource.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;var VideoResource=function(BaseImageResource2){function VideoResource2(source,options){options=options||{};if(!(source instanceof HTMLVideoElement)){var videoElement=document.createElement("video");videoElement.setAttribute("preload","auto");videoElement.setAttribute("webkit-playsinline","");videoElement.setAttribute("playsinline","");if(typeof source==="string"){source=[source]}BaseImageResource2.crossOrigin(videoElement,source[0].src||source[0],options.crossorigin);for(var i=0;i<source.length;++i){var sourceElement=document.createElement("source");var ref=source[i];var src=ref.src;var mime=ref.mime;src=src||source[i];var baseSrc=src.split("?").shift().toLowerCase();var ext=baseSrc.substr(baseSrc.lastIndexOf(".")+1);mime=mime||"video/"+ext;sourceElement.src=src;sourceElement.type=mime;videoElement.appendChild(sourceElement)}source=videoElement}BaseImageResource2.call(this,source);this.noSubImage=true;this._autoUpdate=true;this._isConnectedToTicker=false;this._updateFPS=options.updateFPS||0;this._msToNextUpdate=0;this.autoPlay=options.autoPlay!==false;this._load=null;this._resolve=null;this._onCanPlay=this._onCanPlay.bind(this);this._onError=this._onError.bind(this);if(options.autoLoad!==false){this.load()}}if(BaseImageResource2)VideoResource2.__proto__=BaseImageResource2;VideoResource2.prototype=Object.create(BaseImageResource2&&BaseImageResource2.prototype);VideoResource2.prototype.constructor=VideoResource2;var prototypeAccessors5={autoUpdate:{configurable:true},updateFPS:{configurable:true}};VideoResource2.prototype.update=function update7(deltaTime){if(deltaTime===void 0)deltaTime=0;if(!this.destroyed){var elapsedMS=Ticker.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-elapsedMS);if(!this._updateFPS||this._msToNextUpdate<=0){BaseImageResource2.prototype.update.call(this,deltaTime);this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0}}};VideoResource2.prototype.load=function load2(){var this$1=this;if(this._load){return this._load}var source=this.source;if((source.readyState===source.HAVE_ENOUGH_DATA||source.readyState===source.HAVE_FUTURE_DATA)&&source.width&&source.height){source.complete=true}source.addEventListener("play",this._onPlayStart.bind(this));source.addEventListener("pause",this._onPlayStop.bind(this));if(!this._isSourceReady()){source.addEventListener("canplay",this._onCanPlay);source.addEventListener("canplaythrough",this._onCanPlay);source.addEventListener("error",this._onError,true)}else{this._onCanPlay()}this._load=new Promise(function(resolve){if(this$1.valid){resolve(this$1)}else{this$1._resolve=resolve;source.load()}});return this._load};VideoResource2.prototype._onError=function _onError(){this.source.removeEventListener("error",this._onError,true);this.onError.run(event)};VideoResource2.prototype._isSourcePlaying=function _isSourcePlaying(){var source=this.source;return source.currentTime>0&&source.paused===false&&source.ended===false&&source.readyState>2};VideoResource2.prototype._isSourceReady=function _isSourceReady(){return this.source.readyState===3||this.source.readyState===4};VideoResource2.prototype._onPlayStart=function _onPlayStart(){if(!this.valid){this._onCanPlay()}if(this.autoUpdate&&!this._isConnectedToTicker){Ticker.shared.add(this.update,this);this._isConnectedToTicker=true}};VideoResource2.prototype._onPlayStop=function _onPlayStop(){if(this._isConnectedToTicker){Ticker.shared.remove(this.update,this);this._isConnectedToTicker=false}};VideoResource2.prototype._onCanPlay=function _onCanPlay(){var ref=this;var source=ref.source;source.removeEventListener("canplay",this._onCanPlay);source.removeEventListener("canplaythrough",this._onCanPlay);var valid=this.valid;this.resize(source.videoWidth,source.videoHeight);if(!valid&&this._resolve){this._resolve(this);this._resolve=null}if(this._isSourcePlaying()){this._onPlayStart()}else if(this.autoPlay){source.play()}};VideoResource2.prototype.dispose=function dispose5(){if(this._isConnectedToTicker){Ticker.shared.remove(this.update,this)}if(this.source){this.source.removeEventListener("error",this._onError,true);this.source.pause();this.source.src="";this.source.load()}BaseImageResource2.prototype.dispose.call(this)};prototypeAccessors5.autoUpdate.get=function(){return this._autoUpdate};prototypeAccessors5.autoUpdate.set=function(value){if(value!==this._autoUpdate){this._autoUpdate=value;if(!this._autoUpdate&&this._isConnectedToTicker){Ticker.shared.remove(this.update,this);this._isConnectedToTicker=false}else if(this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()){Ticker.shared.add(this.update,this);this._isConnectedToTicker=true}}};prototypeAccessors5.updateFPS.get=function(){return this._updateFPS};prototypeAccessors5.updateFPS.set=function(value){if(value!==this._updateFPS){this._updateFPS=value}};VideoResource2.test=function test(source,extension){return source instanceof HTMLVideoElement||VideoResource2.TYPES.indexOf(extension)>-1};Object.defineProperties(VideoResource2.prototype,prototypeAccessors5);return VideoResource2}(BaseImageResource);VideoResource.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"];var ImageBitmapResource=function(BaseImageResource2){function ImageBitmapResource2(){BaseImageResource2.apply(this,arguments)}if(BaseImageResource2)ImageBitmapResource2.__proto__=BaseImageResource2;ImageBitmapResource2.prototype=Object.create(BaseImageResource2&&BaseImageResource2.prototype);ImageBitmapResource2.prototype.constructor=ImageBitmapResource2;ImageBitmapResource2.test=function test(source){return!!window.createImageBitmap&&source instanceof ImageBitmap};return ImageBitmapResource2}(BaseImageResource);INSTALLED.push(ImageResource,ImageBitmapResource,CanvasResource,VideoResource,SVGResource,BufferResource,CubeResource,ArrayResource);var index={INSTALLED:INSTALLED,autoDetectResource:autoDetectResource,ArrayResource:ArrayResource,BufferResource:BufferResource,CanvasResource:CanvasResource,CubeResource:CubeResource,ImageResource:ImageResource,ImageBitmapResource:ImageBitmapResource,SVGResource:SVGResource,VideoResource:VideoResource,Resource:Resource,BaseImageResource:BaseImageResource};var System=function System2(renderer){this.renderer=renderer};System.prototype.destroy=function destroy3(){this.renderer=null};var DepthResource=function(BufferResource2){function DepthResource2(){BufferResource2.apply(this,arguments)}if(BufferResource2)DepthResource2.__proto__=BufferResource2;DepthResource2.prototype=Object.create(BufferResource2&&BufferResource2.prototype);DepthResource2.prototype.constructor=DepthResource2;DepthResource2.prototype.upload=function upload3(renderer,baseTexture,glTexture){var gl=renderer.gl;gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,baseTexture.alphaMode===ALPHA_MODES.UNPACK);if(glTexture.width===baseTexture.width&&glTexture.height===baseTexture.height){gl.texSubImage2D(baseTexture.target,0,0,0,baseTexture.width,baseTexture.height,baseTexture.format,baseTexture.type,this.data)}else{glTexture.width=baseTexture.width;glTexture.height=baseTexture.height;gl.texImage2D(baseTexture.target,0,renderer.context.webGLVersion===1?gl.DEPTH_COMPONENT:gl.DEPTH_COMPONENT16,baseTexture.width,baseTexture.height,0,baseTexture.format,baseTexture.type,this.data)}return true};return DepthResource2}(BufferResource);var Framebuffer=function Framebuffer2(width,height){this.width=Math.ceil(width||100);this.height=Math.ceil(height||100);this.stencil=false;this.depth=false;this.dirtyId=0;this.dirtyFormat=0;this.dirtySize=0;this.depthTexture=null;this.colorTextures=[];this.glFramebuffers={};this.disposeRunner=new Runner("disposeFramebuffer",2)};var prototypeAccessors$12={colorTexture:{configurable:true}};prototypeAccessors$12.colorTexture.get=function(){return this.colorTextures[0]};Framebuffer.prototype.addColorTexture=function addColorTexture(index3,texture){if(index3===void 0)index3=0;this.colorTextures[index3]=texture||new BaseTexture(null,{scaleMode:SCALE_MODES.NEAREST,resolution:1,mipmap:false,width:this.width,height:this.height});this.dirtyId++;this.dirtyFormat++;return this};Framebuffer.prototype.addDepthTexture=function addDepthTexture(texture){this.depthTexture=texture||new BaseTexture(new DepthResource(null,{width:this.width,height:this.height}),{scaleMode:SCALE_MODES.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:false,format:FORMATS.DEPTH_COMPONENT,type:TYPES.UNSIGNED_SHORT});this.dirtyId++;this.dirtyFormat++;return this};Framebuffer.prototype.enableDepth=function enableDepth(){this.depth=true;this.dirtyId++;this.dirtyFormat++;return this};Framebuffer.prototype.enableStencil=function enableStencil(){this.stencil=true;this.dirtyId++;this.dirtyFormat++;return this};Framebuffer.prototype.resize=function resize2(width,height){width=Math.ceil(width);height=Math.ceil(height);if(width===this.width&&height===this.height){return}this.width=width;this.height=height;this.dirtyId++;this.dirtySize++;for(var i=0;i<this.colorTextures.length;i++){var texture=this.colorTextures[i];var resolution=texture.resolution;texture.setSize(width/resolution,height/resolution)}if(this.depthTexture){var resolution$1=this.depthTexture.resolution;this.depthTexture.setSize(width/resolution$1,height/resolution$1)}};Framebuffer.prototype.dispose=function dispose2(){this.disposeRunner.run(this,false)};Object.defineProperties(Framebuffer.prototype,prototypeAccessors$12);var BaseRenderTexture=function(BaseTexture2){function BaseRenderTexture2(options){if(typeof options==="number"){var width$1=arguments[0];var height$1=arguments[1];var scaleMode=arguments[2];var resolution=arguments[3];options={width:width$1,height:height$1,scaleMode:scaleMode,resolution:resolution}}BaseTexture2.call(this,null,options);var ref=options||{};var width=ref.width;var height=ref.height;this.mipmap=false;this.width=Math.ceil(width)||100;this.height=Math.ceil(height)||100;this.valid=true;this._canvasRenderTarget=null;this.clearColor=[0,0,0,0];this.framebuffer=new Framebuffer(this.width*this.resolution,this.height*this.resolution).addColorTexture(0,this);this.maskStack=[];this.filterStack=[{}]}if(BaseTexture2)BaseRenderTexture2.__proto__=BaseTexture2;BaseRenderTexture2.prototype=Object.create(BaseTexture2&&BaseTexture2.prototype);BaseRenderTexture2.prototype.constructor=BaseRenderTexture2;BaseRenderTexture2.prototype.resize=function resize3(width,height){width=Math.ceil(width);height=Math.ceil(height);this.framebuffer.resize(width*this.resolution,height*this.resolution)};BaseRenderTexture2.prototype.dispose=function dispose5(){this.framebuffer.dispose();BaseTexture2.prototype.dispose.call(this)};BaseRenderTexture2.prototype.destroy=function destroy25(){BaseTexture2.prototype.destroy.call(this,true);this.framebuffer=null};return BaseRenderTexture2}(BaseTexture);var TextureUvs=function TextureUvs2(){this.x0=0;this.y0=0;this.x1=1;this.y1=0;this.x2=1;this.y2=1;this.x3=0;this.y3=1;this.uvsFloat32=new Float32Array(8)};TextureUvs.prototype.set=function set(frame,baseFrame,rotate){var tw=baseFrame.width;var th=baseFrame.height;if(rotate){var w2=frame.width/2/tw;var h2=frame.height/2/th;var cX=frame.x/tw+w2;var cY=frame.y/th+h2;rotate=groupD8.add(rotate,groupD8.NW);this.x0=cX+w2*groupD8.uX(rotate);this.y0=cY+h2*groupD8.uY(rotate);rotate=groupD8.add(rotate,2);this.x1=cX+w2*groupD8.uX(rotate);this.y1=cY+h2*groupD8.uY(rotate);rotate=groupD8.add(rotate,2);this.x2=cX+w2*groupD8.uX(rotate);this.y2=cY+h2*groupD8.uY(rotate);rotate=groupD8.add(rotate,2);this.x3=cX+w2*groupD8.uX(rotate);this.y3=cY+h2*groupD8.uY(rotate)}else{this.x0=frame.x/tw;this.y0=frame.y/th;this.x1=(frame.x+frame.width)/tw;this.y1=frame.y/th;this.x2=(frame.x+frame.width)/tw;this.y2=(frame.y+frame.height)/th;this.x3=frame.x/tw;this.y3=(frame.y+frame.height)/th}this.uvsFloat32[0]=this.x0;this.uvsFloat32[1]=this.y0;this.uvsFloat32[2]=this.x1;this.uvsFloat32[3]=this.y1;this.uvsFloat32[4]=this.x2;this.uvsFloat32[5]=this.y2;this.uvsFloat32[6]=this.x3;this.uvsFloat32[7]=this.y3};var DEFAULT_UVS=new TextureUvs;var Texture=function(EventEmitter){function Texture2(baseTexture,frame,orig,trim,rotate,anchor){EventEmitter.call(this);this.noFrame=false;if(!frame){this.noFrame=true;frame=new Rectangle(0,0,1,1)}if(baseTexture instanceof Texture2){baseTexture=baseTexture.baseTexture}this.baseTexture=baseTexture;this._frame=frame;this.trim=trim;this.valid=false;this.requiresUpdate=false;this._uvs=DEFAULT_UVS;this.uvMatrix=null;this.orig=orig||frame;this._rotate=Number(rotate||0);if(rotate===true){this._rotate=2}else if(this._rotate%2!==0){throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually")}this.defaultAnchor=anchor?new Point(anchor.x,anchor.y):new Point(0,0);this._updateID=0;this.textureCacheIds=[];if(!baseTexture.valid){baseTexture.once("loaded",this.onBaseTextureUpdated,this)}else if(this.noFrame){if(baseTexture.valid){this.onBaseTextureUpdated(baseTexture)}}else{this.frame=frame}if(this.noFrame){baseTexture.on("update",this.onBaseTextureUpdated,this)}}if(EventEmitter)Texture2.__proto__=EventEmitter;Texture2.prototype=Object.create(EventEmitter&&EventEmitter.prototype);Texture2.prototype.constructor=Texture2;var prototypeAccessors5={resolution:{configurable:true},frame:{configurable:true},rotate:{configurable:true},width:{configurable:true},height:{configurable:true}};Texture2.prototype.update=function update7(){if(this.baseTexture.resource){this.baseTexture.resource.update()}};Texture2.prototype.onBaseTextureUpdated=function onBaseTextureUpdated(baseTexture){if(this.noFrame){if(!this.baseTexture.valid){return}this._frame.width=baseTexture.width;this._frame.height=baseTexture.height;this.valid=true;this.updateUvs()}else{this.frame=this._frame}this.emit("update",this)};Texture2.prototype.destroy=function destroy25(destroyBase){if(this.baseTexture){if(destroyBase){var ref=this.baseTexture;var resource=ref.resource;if(resource&&_TextureCache[resource.url]){Texture2.removeFromCache(resource.url)}this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this);this.baseTexture.off("update",this.onBaseTextureUpdated,this);this.baseTexture=null}this._frame=null;this._uvs=null;this.trim=null;this.orig=null;this.valid=false;Texture2.removeFromCache(this);this.textureCacheIds=null};Texture2.prototype.clone=function clone5(){return new Texture2(this.baseTexture,this.frame.clone(),this.orig.clone(),this.trim&&this.trim.clone(),this.rotate,this.defaultAnchor)};Texture2.prototype.updateUvs=function updateUvs(){if(this._uvs===DEFAULT_UVS){this._uvs=new TextureUvs}this._uvs.set(this._frame,this.baseTexture,this.rotate);this._updateID++};Texture2.from=function from6(source,options,strict){if(options===void 0)options={};if(strict===void 0)strict=settings.STRICT_TEXTURE_CACHE;var isFrame=typeof source==="string";var cacheId=null;if(isFrame){cacheId=source}else{if(!source._pixiId){source._pixiId="pixiid_"+_uid()}cacheId=source._pixiId}var texture=_TextureCache[cacheId];if(isFrame&&strict&&!texture){throw new Error("The cacheId \""+cacheId+"\" does not exist in TextureCache.")}if(!texture){if(!options.resolution){options.resolution=_getResolutionOfUrl(source)}texture=new Texture2(new BaseTexture(source,options));texture.baseTexture.cacheId=cacheId;BaseTexture.addToCache(texture.baseTexture,cacheId);Texture2.addToCache(texture,cacheId)}return texture};Texture2.fromBuffer=function fromBuffer(buffer,width,height,options){return new Texture2(BaseTexture.fromBuffer(buffer,width,height,options))};Texture2.fromLoader=function fromLoader(source,imageUrl,name){var resource=new ImageResource(source);resource.url=imageUrl;var baseTexture=new BaseTexture(resource,{scaleMode:settings.SCALE_MODE,resolution:_getResolutionOfUrl(imageUrl)});var texture=new Texture2(baseTexture);if(!name){name=imageUrl}BaseTexture.addToCache(texture.baseTexture,name);Texture2.addToCache(texture,name);if(name!==imageUrl){BaseTexture.addToCache(texture.baseTexture,imageUrl);Texture2.addToCache(texture,imageUrl)}return texture};Texture2.addToCache=function addToCache(texture,id){if(id){if(texture.textureCacheIds.indexOf(id)===-1){texture.textureCacheIds.push(id)}if(_TextureCache[id]){console.warn("Texture added to the cache with an id ["+id+"] that already had an entry")}_TextureCache[id]=texture}};Texture2.removeFromCache=function removeFromCache(texture){if(typeof texture==="string"){var textureFromCache=_TextureCache[texture];if(textureFromCache){var index3=textureFromCache.textureCacheIds.indexOf(texture);if(index3>-1){textureFromCache.textureCacheIds.splice(index3,1)}delete _TextureCache[texture];return textureFromCache}}else if(texture&&texture.textureCacheIds){for(var i=0;i<texture.textureCacheIds.length;++i){if(_TextureCache[texture.textureCacheIds[i]]===texture){delete _TextureCache[texture.textureCacheIds[i]]}}texture.textureCacheIds.length=0;return texture}return null};prototypeAccessors5.resolution.get=function(){return this.baseTexture.resolution};prototypeAccessors5.frame.get=function(){return this._frame};prototypeAccessors5.frame.set=function(frame){this._frame=frame;this.noFrame=false;var x=frame.x;var y=frame.y;var width=frame.width;var height=frame.height;var xNotFit=x+width>this.baseTexture.width;var yNotFit=y+height>this.baseTexture.height;if(xNotFit||yNotFit){var relationship=xNotFit&&yNotFit?"and":"or";var errorX="X: "+x+" + "+width+" = "+(x+width)+" > "+this.baseTexture.width;var errorY="Y: "+y+" + "+height+" = "+(y+height)+" > "+this.baseTexture.height;throw new Error("Texture Error: frame does not fit inside the base Texture dimensions: "+errorX+" "+relationship+" "+errorY)}this.valid=width&&height&&this.baseTexture.valid;if(!this.trim&&!this.rotate){this.orig=frame}if(this.valid){this.updateUvs()}};prototypeAccessors5.rotate.get=function(){return this._rotate};prototypeAccessors5.rotate.set=function(rotate){this._rotate=rotate;if(this.valid){this.updateUvs()}};prototypeAccessors5.width.get=function(){return this.orig.width};prototypeAccessors5.height.get=function(){return this.orig.height};Object.defineProperties(Texture2.prototype,prototypeAccessors5);return Texture2}(import_eventemitter3.default);function createWhiteTexture(){var canvas4=document.createElement("canvas");canvas4.width=16;canvas4.height=16;var context2=canvas4.getContext("2d");context2.fillStyle="white";context2.fillRect(0,0,16,16);return new Texture(new BaseTexture(new CanvasResource(canvas4)))}function removeAllHandlers(tex){tex.destroy=function _emptyDestroy(){};tex.on=function _emptyOn(){};tex.once=function _emptyOnce(){};tex.emit=function _emptyEmit(){}}Texture.EMPTY=new Texture(new BaseTexture());removeAllHandlers(Texture.EMPTY);removeAllHandlers(Texture.EMPTY.baseTexture);Texture.WHITE=createWhiteTexture();removeAllHandlers(Texture.WHITE);removeAllHandlers(Texture.WHITE.baseTexture);var RenderTexture=function(Texture2){function RenderTexture2(baseRenderTexture,frame){var _legacyRenderer=null;if(!(baseRenderTexture instanceof BaseRenderTexture)){var width=arguments[1];var height=arguments[2];var scaleMode=arguments[3];var resolution=arguments[4];console.warn("Please use RenderTexture.create("+width+", "+height+") instead of the ctor directly.");_legacyRenderer=arguments[0];frame=null;baseRenderTexture=new BaseRenderTexture({width:width,height:height,scaleMode:scaleMode,resolution:resolution})}Texture2.call(this,baseRenderTexture,frame);this.legacyRenderer=_legacyRenderer;this.valid=true;this.filterFrame=null;this.filterPoolKey=null;this.updateUvs()}if(Texture2)RenderTexture2.__proto__=Texture2;RenderTexture2.prototype=Object.create(Texture2&&Texture2.prototype);RenderTexture2.prototype.constructor=RenderTexture2;RenderTexture2.prototype.resize=function resize3(width,height,resizeBaseTexture){if(resizeBaseTexture===void 0)resizeBaseTexture=true;width=Math.ceil(width);height=Math.ceil(height);this.valid=width>0&&height>0;this._frame.width=this.orig.width=width;this._frame.height=this.orig.height=height;if(resizeBaseTexture){this.baseTexture.resize(width,height)}this.updateUvs()};RenderTexture2.prototype.setResolution=function setResolution(resolution){var ref=this;var baseTexture=ref.baseTexture;if(baseTexture.resolution===resolution){return}baseTexture.setResolution(resolution);this.resize(baseTexture.width,baseTexture.height,false)};RenderTexture2.create=function create3(options){if(typeof options==="number"){options={width:options,height:arguments[1],scaleMode:arguments[2],resolution:arguments[3]}}return new RenderTexture2(new BaseRenderTexture(options))};return RenderTexture2}(Texture);var RenderTexturePool=function RenderTexturePool2(textureOptions){this.texturePool={};this.textureOptions=textureOptions||{};this.enableFullScreen=false;this._pixelsWidth=0;this._pixelsHeight=0};RenderTexturePool.prototype.createTexture=function createTexture(realWidth,realHeight){var baseRenderTexture=new BaseRenderTexture(Object.assign({width:realWidth,height:realHeight,resolution:1},this.textureOptions));return new RenderTexture(baseRenderTexture)};RenderTexturePool.prototype.getOptimalTexture=function getOptimalTexture(minWidth,minHeight,resolution){if(resolution===void 0)resolution=1;var key=RenderTexturePool.SCREEN_KEY;minWidth*=resolution;minHeight*=resolution;if(!this.enableFullScreen||minWidth!==this._pixelsWidth||minHeight!==this._pixelsHeight){minWidth=_nextPow(minWidth);minHeight=_nextPow(minHeight);key=(minWidth&65535)<<16|minHeight&65535}if(!this.texturePool[key]){this.texturePool[key]=[]}var renderTexture=this.texturePool[key].pop();if(!renderTexture){renderTexture=this.createTexture(minWidth,minHeight)}renderTexture.filterPoolKey=key;renderTexture.setResolution(resolution);return renderTexture};RenderTexturePool.prototype.getFilterTexture=function getFilterTexture(input,resolution){var filterTexture=this.getOptimalTexture(input.width,input.height,resolution||input.resolution);filterTexture.filterFrame=input.filterFrame;return filterTexture};RenderTexturePool.prototype.returnTexture=function returnTexture(renderTexture){var key=renderTexture.filterPoolKey;renderTexture.filterFrame=null;this.texturePool[key].push(renderTexture)};RenderTexturePool.prototype.returnFilterTexture=function returnFilterTexture(renderTexture){this.returnTexture(renderTexture)};RenderTexturePool.prototype.clear=function clear2(destroyTextures){destroyTextures=destroyTextures!==false;if(destroyTextures){for(var i in this.texturePool){var textures=this.texturePool[i];if(textures){for(var j=0;j<textures.length;j++){textures[j].destroy(true)}}}}this.texturePool={}};RenderTexturePool.prototype.setScreenSize=function setScreenSize(size){if(size.width===this._pixelsWidth&&size.height===this._pixelsHeight){return}var screenKey=RenderTexturePool.SCREEN_KEY;var textures=this.texturePool[screenKey];this.enableFullScreen=size.width>0&&size.height>0;if(textures){for(var j=0;j<textures.length;j++){textures[j].destroy(true)}}this.texturePool[screenKey]=[];this._pixelsWidth=size.width;this._pixelsHeight=size.height};RenderTexturePool.SCREEN_KEY="screen";var Attribute=function Attribute2(buffer,size,normalized,type,stride,start2,instance){if(normalized===void 0)normalized=false;if(type===void 0)type=5126;this.buffer=buffer;this.size=size;this.normalized=normalized;this.type=type;this.stride=stride;this.start=start2;this.instance=instance};Attribute.prototype.destroy=function destroy4(){this.buffer=null};Attribute.from=function from(buffer,size,normalized,type,stride){return new Attribute(buffer,size,normalized,type,stride)};var UID=0;var Buffer2=function Buffer3(data,_static,index3){if(_static===void 0)_static=true;if(index3===void 0)index3=false;this.data=data||new Float32Array(1);this._glBuffers={};this._updateID=0;this.index=index3;this.static=_static;this.id=UID++;this.disposeRunner=new Runner("disposeBuffer",2)};Buffer2.prototype.update=function update3(data){this.data=data||this.data;this._updateID++};Buffer2.prototype.dispose=function dispose3(){this.disposeRunner.run(this,false)};Buffer2.prototype.destroy=function destroy5(){this.dispose();this.data=null};Buffer2.from=function from2(data){if(data instanceof Array){data=new Float32Array(data)}return new Buffer2(data)};function getBufferType2(array){if(array.BYTES_PER_ELEMENT===4){if(array instanceof Float32Array){return"Float32Array"}else if(array instanceof Uint32Array){return"Uint32Array"}return"Int32Array"}else if(array.BYTES_PER_ELEMENT===2){if(array instanceof Uint16Array){return"Uint16Array"}}else if(array.BYTES_PER_ELEMENT===1){if(array instanceof Uint8Array){return"Uint8Array"}}return null}var map2={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array};function interleaveTypedArrays2(arrays,sizes){var outSize=0;var stride=0;var views={};for(var i=0;i<arrays.length;i++){stride+=sizes[i];outSize+=arrays[i].length}var buffer=new ArrayBuffer(outSize*4);var out=null;var littleOffset=0;for(var i$1=0;i$1<arrays.length;i$1++){var size=sizes[i$1];var array=arrays[i$1];var type=getBufferType2(array);if(!views[type]){views[type]=new map2[type](buffer)}out=views[type];for(var j=0;j<array.length;j++){var indexStart=(j/size|0)*stride+littleOffset;var index3=j%size;out[indexStart+index3]=array[j]}littleOffset+=size}return new Float32Array(buffer)}var byteSizeMap={5126:4,5123:2,5121:1};var UID$1=0;var map$1={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array,Uint16Array:Uint16Array};var Geometry=function Geometry2(buffers,attributes){if(buffers===void 0)buffers=[];if(attributes===void 0)attributes={};this.buffers=buffers;this.indexBuffer=null;this.attributes=attributes;this.glVertexArrayObjects={};this.id=UID$1++;this.instanced=false;this.instanceCount=1;this.disposeRunner=new Runner("disposeGeometry",2);this.refCount=0};Geometry.prototype.addAttribute=function addAttribute(id,buffer,size,normalized,type,stride,start2,instance){if(normalized===void 0)normalized=false;if(instance===void 0)instance=false;if(!buffer){throw new Error("You must pass a buffer when creating an attribute")}if(!buffer.data){if(buffer instanceof Array){buffer=new Float32Array(buffer)}buffer=new Buffer2(buffer)}var ids=id.split("|");if(ids.length>1){for(var i=0;i<ids.length;i++){this.addAttribute(ids[i],buffer,size,normalized,type)}return this}var bufferIndex=this.buffers.indexOf(buffer);if(bufferIndex===-1){this.buffers.push(buffer);bufferIndex=this.buffers.length-1}this.attributes[id]=new Attribute(bufferIndex,size,normalized,type,stride,start2,instance);this.instanced=this.instanced||instance;return this};Geometry.prototype.getAttribute=function getAttribute(id){return this.attributes[id]};Geometry.prototype.getBuffer=function getBuffer(id){return this.buffers[this.getAttribute(id).buffer]};Geometry.prototype.addIndex=function addIndex(buffer){if(!buffer.data){if(buffer instanceof Array){buffer=new Uint16Array(buffer)}buffer=new Buffer2(buffer)}buffer.index=true;this.indexBuffer=buffer;if(this.buffers.indexOf(buffer)===-1){this.buffers.push(buffer)}return this};Geometry.prototype.getIndex=function getIndex(){return this.indexBuffer};Geometry.prototype.interleave=function interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer){return this}var arrays=[];var sizes=[];var interleavedBuffer=new Buffer2;var i;for(i in this.attributes){var attribute=this.attributes[i];var buffer=this.buffers[attribute.buffer];arrays.push(buffer.data);sizes.push(attribute.size*byteSizeMap[attribute.type]/4);attribute.buffer=0}interleavedBuffer.data=interleaveTypedArrays2(arrays,sizes);for(i=0;i<this.buffers.length;i++){if(this.buffers[i]!==this.indexBuffer){this.buffers[i].destroy()}}this.buffers=[interleavedBuffer];if(this.indexBuffer){this.buffers.push(this.indexBuffer)}return this};Geometry.prototype.getSize=function getSize(){for(var i in this.attributes){var attribute=this.attributes[i];var buffer=this.buffers[attribute.buffer];return buffer.data.length/(attribute.stride/4||attribute.size)}return 0};Geometry.prototype.dispose=function dispose4(){this.disposeRunner.run(this,false)};Geometry.prototype.destroy=function destroy6(){this.dispose();this.buffers=null;this.indexBuffer=null;this.attributes=null};Geometry.prototype.clone=function clone(){var geometry=new Geometry;for(var i=0;i<this.buffers.length;i++){geometry.buffers[i]=new Buffer2(this.buffers[i].data.slice())}for(var i$1 in this.attributes){var attrib=this.attributes[i$1];geometry.attributes[i$1]=new Attribute(attrib.buffer,attrib.size,attrib.normalized,attrib.type,attrib.stride,attrib.start,attrib.instance)}if(this.indexBuffer){geometry.indexBuffer=geometry.buffers[this.buffers.indexOf(this.indexBuffer)];geometry.indexBuffer.index=true}return geometry};Geometry.merge=function merge(geometries){var geometryOut=new Geometry;var arrays=[];var sizes=[];var offsets=[];var geometry;for(var i=0;i<geometries.length;i++){geometry=geometries[i];for(var j=0;j<geometry.buffers.length;j++){sizes[j]=sizes[j]||0;sizes[j]+=geometry.buffers[j].data.length;offsets[j]=0}}for(var i$1=0;i$1<geometry.buffers.length;i$1++){arrays[i$1]=new map$1[getBufferType2(geometry.buffers[i$1].data)](sizes[i$1]);geometryOut.buffers[i$1]=new Buffer2(arrays[i$1])}for(var i$2=0;i$2<geometries.length;i$2++){geometry=geometries[i$2];for(var j$1=0;j$1<geometry.buffers.length;j$1++){arrays[j$1].set(geometry.buffers[j$1].data,offsets[j$1]);offsets[j$1]+=geometry.buffers[j$1].data.length}}geometryOut.attributes=geometry.attributes;if(geometry.indexBuffer){geometryOut.indexBuffer=geometryOut.buffers[geometry.buffers.indexOf(geometry.indexBuffer)];geometryOut.indexBuffer.index=true;var offset=0;var stride=0;var offset2=0;var bufferIndexToCount=0;for(var i$3=0;i$3<geometry.buffers.length;i$3++){if(geometry.buffers[i$3]!==geometry.indexBuffer){bufferIndexToCount=i$3;break}}for(var i$4 in geometry.attributes){var attribute=geometry.attributes[i$4];if((attribute.buffer|0)===bufferIndexToCount){stride+=attribute.size*byteSizeMap[attribute.type]/4}}for(var i$5=0;i$5<geometries.length;i$5++){var indexBufferData=geometries[i$5].indexBuffer.data;for(var j$2=0;j$2<indexBufferData.length;j$2++){geometryOut.indexBuffer.data[j$2+offset2]+=offset}offset+=geometry.buffers[bufferIndexToCount].data.length/stride;offset2+=indexBufferData.length}}return geometryOut};var Quad=function(Geometry3){function Quad2(){Geometry3.call(this);this.addAttribute("aVertexPosition",[0,0,1,0,1,1,0,1]).addIndex([0,1,3,2])}if(Geometry3)Quad2.__proto__=Geometry3;Quad2.prototype=Object.create(Geometry3&&Geometry3.prototype);Quad2.prototype.constructor=Quad2;return Quad2}(Geometry);var QuadUv=function(Geometry3){function QuadUv2(){Geometry3.call(this);this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]);this.uvs=new Float32Array([0,0,1,0,1,1,0,1]);this.vertexBuffer=new Buffer2(this.vertices);this.uvBuffer=new Buffer2(this.uvs);this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}if(Geometry3)QuadUv2.__proto__=Geometry3;QuadUv2.prototype=Object.create(Geometry3&&Geometry3.prototype);QuadUv2.prototype.constructor=QuadUv2;QuadUv2.prototype.map=function map3(targetTextureFrame,destinationFrame){var x=0;var y=0;this.uvs[0]=x;this.uvs[1]=y;this.uvs[2]=x+destinationFrame.width/targetTextureFrame.width;this.uvs[3]=y;this.uvs[4]=x+destinationFrame.width/targetTextureFrame.width;this.uvs[5]=y+destinationFrame.height/targetTextureFrame.height;this.uvs[6]=x;this.uvs[7]=y+destinationFrame.height/targetTextureFrame.height;x=destinationFrame.x;y=destinationFrame.y;this.vertices[0]=x;this.vertices[1]=y;this.vertices[2]=x+destinationFrame.width;this.vertices[3]=y;this.vertices[4]=x+destinationFrame.width;this.vertices[5]=y+destinationFrame.height;this.vertices[6]=x;this.vertices[7]=y+destinationFrame.height;this.invalidate();return this};QuadUv2.prototype.invalidate=function invalidate(){this.vertexBuffer._updateID++;this.uvBuffer._updateID++;return this};return QuadUv2}(Geometry);var UID$2=0;var UniformGroup=function UniformGroup2(uniforms,_static){this.uniforms=uniforms;this.group=true;this.syncUniforms={};this.dirtyId=0;this.id=UID$2++;this.static=!!_static};UniformGroup.prototype.update=function update4(){this.dirtyId++};UniformGroup.prototype.add=function add(name,uniforms,_static){this.uniforms[name]=new UniformGroup(uniforms,_static)};UniformGroup.from=function from3(uniforms,_static){return new UniformGroup(uniforms,_static)};var FilterState=function FilterState2(){this.renderTexture=null;this.target=null;this.legacy=false;this.resolution=1;this.sourceFrame=new Rectangle;this.destinationFrame=new Rectangle;this.filters=[]};FilterState.prototype.clear=function clear3(){this.target=null;this.filters=null;this.renderTexture=null};var FilterSystem=function(System3){function FilterSystem2(renderer){System3.call(this,renderer);this.defaultFilterStack=[{}];this.texturePool=new RenderTexturePool;this.texturePool.setScreenSize(renderer.view);this.statePool=[];this.quad=new Quad;this.quadUv=new QuadUv;this.tempRect=new Rectangle;this.activeState={};this.globalUniforms=new UniformGroup({outputFrame:this.tempRect,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},true);this.forceClear=false;this.useMaxPadding=false}if(System3)FilterSystem2.__proto__=System3;FilterSystem2.prototype=Object.create(System3&&System3.prototype);FilterSystem2.prototype.constructor=FilterSystem2;FilterSystem2.prototype.push=function push(target,filters){var renderer=this.renderer;var filterStack=this.defaultFilterStack;var state=this.statePool.pop()||new FilterState;var resolution=filters[0].resolution;var padding=filters[0].padding;var autoFit=filters[0].autoFit;var legacy=filters[0].legacy;for(var i=1;i<filters.length;i++){var filter=filters[i];resolution=Math.min(resolution,filter.resolution);padding=this.useMaxPadding?Math.max(padding,filter.padding):padding+filter.padding;autoFit=autoFit||filter.autoFit;legacy=legacy||filter.legacy}if(filterStack.length===1){this.defaultFilterStack[0].renderTexture=renderer.renderTexture.current}filterStack.push(state);state.resolution=resolution;state.legacy=legacy;state.target=target;state.sourceFrame.copyFrom(target.filterArea||target.getBounds(true));state.sourceFrame.pad(padding);if(autoFit){state.sourceFrame.fit(this.renderer.renderTexture.sourceFrame)}state.sourceFrame.ceil(resolution);state.renderTexture=this.getOptimalFilterTexture(state.sourceFrame.width,state.sourceFrame.height,resolution);state.filters=filters;state.destinationFrame.width=state.renderTexture.width;state.destinationFrame.height=state.renderTexture.height;state.renderTexture.filterFrame=state.sourceFrame;renderer.renderTexture.bind(state.renderTexture,state.sourceFrame);renderer.renderTexture.clear()};FilterSystem2.prototype.pop=function pop(){var filterStack=this.defaultFilterStack;var state=filterStack.pop();var filters=state.filters;this.activeState=state;var globalUniforms=this.globalUniforms.uniforms;globalUniforms.outputFrame=state.sourceFrame;globalUniforms.resolution=state.resolution;var inputSize=globalUniforms.inputSize;var inputPixel=globalUniforms.inputPixel;var inputClamp=globalUniforms.inputClamp;inputSize[0]=state.destinationFrame.width;inputSize[1]=state.destinationFrame.height;inputSize[2]=1/inputSize[0];inputSize[3]=1/inputSize[1];inputPixel[0]=inputSize[0]*state.resolution;inputPixel[1]=inputSize[1]*state.resolution;inputPixel[2]=1/inputPixel[0];inputPixel[3]=1/inputPixel[1];inputClamp[0]=0.5*inputPixel[2];inputClamp[1]=0.5*inputPixel[3];inputClamp[2]=state.sourceFrame.width*inputSize[2]-0.5*inputPixel[2];inputClamp[3]=state.sourceFrame.height*inputSize[3]-0.5*inputPixel[3];if(state.legacy){var filterArea=globalUniforms.filterArea;filterArea[0]=state.destinationFrame.width;filterArea[1]=state.destinationFrame.height;filterArea[2]=state.sourceFrame.x;filterArea[3]=state.sourceFrame.y;globalUniforms.filterClamp=globalUniforms.inputClamp}this.globalUniforms.update();var lastState=filterStack[filterStack.length-1];if(filters.length===1){filters[0].apply(this,state.renderTexture,lastState.renderTexture,false,state);this.returnFilterTexture(state.renderTexture)}else{var flip=state.renderTexture;var flop=this.getOptimalFilterTexture(flip.width,flip.height,state.resolution);flop.filterFrame=flip.filterFrame;var i=0;for(i=0;i<filters.length-1;++i){filters[i].apply(this,flip,flop,true,state);var t=flip;flip=flop;flop=t}filters[i].apply(this,flip,lastState.renderTexture,false,state);this.returnFilterTexture(flip);this.returnFilterTexture(flop)}state.clear();this.statePool.push(state)};FilterSystem2.prototype.applyFilter=function applyFilter(filter,input,output,clear5){var renderer=this.renderer;renderer.renderTexture.bind(output,output?output.filterFrame:null);if(clear5){renderer.renderTexture.clear()}filter.uniforms.uSampler=input;filter.uniforms.filterGlobals=this.globalUniforms;renderer.state.set(filter.state);renderer.shader.bind(filter);if(filter.legacy){this.quadUv.map(input._frame,input.filterFrame);renderer.geometry.bind(this.quadUv);renderer.geometry.draw(DRAW_MODES.TRIANGLES)}else{renderer.geometry.bind(this.quad);renderer.geometry.draw(DRAW_MODES.TRIANGLE_STRIP)}};FilterSystem2.prototype.calculateSpriteMatrix=function calculateSpriteMatrix(outputMatrix,sprite){var ref=this.activeState;var sourceFrame=ref.sourceFrame;var destinationFrame=ref.destinationFrame;var ref$1=sprite._texture;var orig=ref$1.orig;var mappedMatrix=outputMatrix.set(destinationFrame.width,0,0,destinationFrame.height,sourceFrame.x,sourceFrame.y);var worldTransform=sprite.worldTransform.copyTo(Matrix.TEMP_MATRIX);worldTransform.invert();mappedMatrix.prepend(worldTransform);mappedMatrix.scale(1/orig.width,1/orig.height);mappedMatrix.translate(sprite.anchor.x,sprite.anchor.y);return mappedMatrix};FilterSystem2.prototype.destroy=function destroy25(){this.texturePool.clear(false)};FilterSystem2.prototype.getOptimalFilterTexture=function getOptimalFilterTexture(minWidth,minHeight,resolution){if(resolution===void 0)resolution=1;return this.texturePool.getOptimalTexture(minWidth,minHeight,resolution)};FilterSystem2.prototype.getFilterTexture=function getFilterTexture2(input,resolution){if(typeof input==="number"){var swap=input;input=resolution;resolution=swap}input=input||this.activeState.renderTexture;var filterTexture=this.texturePool.getOptimalTexture(input.width,input.height,resolution||input.resolution);filterTexture.filterFrame=input.filterFrame;return filterTexture};FilterSystem2.prototype.returnFilterTexture=function returnFilterTexture2(renderTexture){this.texturePool.returnTexture(renderTexture)};FilterSystem2.prototype.emptyPool=function emptyPool(){this.texturePool.clear(true)};FilterSystem2.prototype.resize=function resize3(){this.texturePool.setScreenSize(this.renderer.view)};return FilterSystem2}(System);var ObjectRenderer=function ObjectRenderer2(renderer){this.renderer=renderer};ObjectRenderer.prototype.flush=function flush(){};ObjectRenderer.prototype.destroy=function destroy7(){this.renderer=null};ObjectRenderer.prototype.start=function start(){};ObjectRenderer.prototype.stop=function stop(){this.flush()};ObjectRenderer.prototype.render=function render(object){};var BatchSystem=function(System3){function BatchSystem2(renderer){System3.call(this,renderer);this.emptyRenderer=new ObjectRenderer(renderer);this.currentRenderer=this.emptyRenderer}if(System3)BatchSystem2.__proto__=System3;BatchSystem2.prototype=Object.create(System3&&System3.prototype);BatchSystem2.prototype.constructor=BatchSystem2;BatchSystem2.prototype.setObjectRenderer=function setObjectRenderer(objectRenderer){if(this.currentRenderer===objectRenderer){return}this.currentRenderer.stop();this.currentRenderer=objectRenderer;this.currentRenderer.start()};BatchSystem2.prototype.flush=function flush2(){this.setObjectRenderer(this.emptyRenderer)};BatchSystem2.prototype.reset=function reset7(){this.setObjectRenderer(this.emptyRenderer)};BatchSystem2.prototype.copyBoundTextures=function copyBoundTextures(arr,maxTextures){var ref=this.renderer.texture;var boundTextures=ref.boundTextures;for(var i=maxTextures-1;i>=0;--i){arr[i]=boundTextures[i]||null;if(arr[i]){arr[i]._batchLocation=i}}};BatchSystem2.prototype.boundArray=function boundArray(texArray,boundTextures,batchId,maxTextures){var elements=texArray.elements;var ids=texArray.ids;var count=texArray.count;var j=0;for(var i=0;i<count;i++){var tex=elements[i];var loc=tex._batchLocation;if(loc>=0&&loc<maxTextures&&boundTextures[loc]===tex){ids[i]=loc;continue}while(j<maxTextures){var bound=boundTextures[j];if(bound&&bound._batchEnabled===batchId&&bound._batchLocation===j){j++;continue}ids[i]=j;tex._batchLocation=j;boundTextures[j]=tex;break}}};return BatchSystem2}(System);settings.PREFER_ENV=isMobile2.any?ENV.WEBGL:ENV.WEBGL2;settings.STRICT_TEXTURE_CACHE=false;var CONTEXT_UID=0;var ContextSystem=function(System3){function ContextSystem2(renderer){System3.call(this,renderer);this.webGLVersion=1;this.extensions={};this.handleContextLost=this.handleContextLost.bind(this);this.handleContextRestored=this.handleContextRestored.bind(this);renderer.view.addEventListener("webglcontextlost",this.handleContextLost,false);renderer.view.addEventListener("webglcontextrestored",this.handleContextRestored,false)}if(System3)ContextSystem2.__proto__=System3;ContextSystem2.prototype=Object.create(System3&&System3.prototype);ContextSystem2.prototype.constructor=ContextSystem2;var prototypeAccessors5={isLost:{configurable:true}};prototypeAccessors5.isLost.get=function(){return!this.gl||this.gl.isContextLost()};ContextSystem2.prototype.contextChange=function contextChange(gl){this.gl=gl;this.renderer.gl=gl;this.renderer.CONTEXT_UID=CONTEXT_UID++;if(gl.isContextLost()&&gl.getExtension("WEBGL_lose_context")){gl.getExtension("WEBGL_lose_context").restoreContext()}};ContextSystem2.prototype.initFromContext=function initFromContext(gl){this.gl=gl;this.validateContext(gl);this.renderer.gl=gl;this.renderer.CONTEXT_UID=CONTEXT_UID++;this.renderer.runners.contextChange.run(gl)};ContextSystem2.prototype.initFromOptions=function initFromOptions(options){var gl=this.createContext(this.renderer.view,options);this.initFromContext(gl)};ContextSystem2.prototype.createContext=function createContext(canvas4,options){var gl;if(settings.PREFER_ENV>=ENV.WEBGL2){gl=canvas4.getContext("webgl2",options)}if(gl){this.webGLVersion=2}else{this.webGLVersion=1;gl=canvas4.getContext("webgl",options)||canvas4.getContext("experimental-webgl",options);if(!gl){throw new Error("This browser does not support WebGL. Try using the canvas renderer")}}this.gl=gl;this.getExtensions();return gl};ContextSystem2.prototype.getExtensions=function getExtensions(){var ref=this;var gl=ref.gl;if(this.webGLVersion===1){Object.assign(this.extensions,{drawBuffers:gl.getExtension("WEBGL_draw_buffers"),depthTexture:gl.getExtension("WEBGL_depth_texture"),loseContext:gl.getExtension("WEBGL_lose_context"),vertexArrayObject:gl.getExtension("OES_vertex_array_object")||gl.getExtension("MOZ_OES_vertex_array_object")||gl.getExtension("WEBKIT_OES_vertex_array_object"),anisotropicFiltering:gl.getExtension("EXT_texture_filter_anisotropic"),uint32ElementIndex:gl.getExtension("OES_element_index_uint"),floatTexture:gl.getExtension("OES_texture_float"),floatTextureLinear:gl.getExtension("OES_texture_float_linear"),textureHalfFloat:gl.getExtension("OES_texture_half_float"),textureHalfFloatLinear:gl.getExtension("OES_texture_half_float_linear")})}else if(this.webGLVersion===2){Object.assign(this.extensions,{anisotropicFiltering:gl.getExtension("EXT_texture_filter_anisotropic"),colorBufferFloat:gl.getExtension("EXT_color_buffer_float"),floatTextureLinear:gl.getExtension("OES_texture_float_linear")})}};ContextSystem2.prototype.handleContextLost=function handleContextLost(event2){event2.preventDefault()};ContextSystem2.prototype.handleContextRestored=function handleContextRestored(){this.renderer.runners.contextChange.run(this.gl)};ContextSystem2.prototype.destroy=function destroy25(){var view2=this.renderer.view;view2.removeEventListener("webglcontextlost",this.handleContextLost);view2.removeEventListener("webglcontextrestored",this.handleContextRestored);this.gl.useProgram(null);if(this.extensions.loseContext){this.extensions.loseContext.loseContext()}};ContextSystem2.prototype.postrender=function postrender(){if(this.renderer.renderingToScreen){this.gl.flush()}};ContextSystem2.prototype.validateContext=function validateContext(gl){var attributes=gl.getContextAttributes();if(!attributes.stencil){console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly")}};Object.defineProperties(ContextSystem2.prototype,prototypeAccessors5);return ContextSystem2}(System);var FramebufferSystem=function(System3){function FramebufferSystem2(renderer){System3.call(this,renderer);this.managedFramebuffers=[];this.unknownFramebuffer=new Framebuffer(10,10)}if(System3)FramebufferSystem2.__proto__=System3;FramebufferSystem2.prototype=Object.create(System3&&System3.prototype);FramebufferSystem2.prototype.constructor=FramebufferSystem2;var prototypeAccessors5={size:{configurable:true}};FramebufferSystem2.prototype.contextChange=function contextChange(){var gl=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID;this.current=this.unknownFramebuffer;this.viewport=new Rectangle;this.hasMRT=true;this.writeDepthTexture=true;this.disposeAll(true);if(this.renderer.context.webGLVersion===1){var nativeDrawBuffersExtension=this.renderer.context.extensions.drawBuffers;var nativeDepthTextureExtension=this.renderer.context.extensions.depthTexture;if(settings.PREFER_ENV===ENV.WEBGL_LEGACY){nativeDrawBuffersExtension=null;nativeDepthTextureExtension=null}if(nativeDrawBuffersExtension){gl.drawBuffers=function(activeTextures){return nativeDrawBuffersExtension.drawBuffersWEBGL(activeTextures)}}else{this.hasMRT=false;gl.drawBuffers=function(){}}if(!nativeDepthTextureExtension){this.writeDepthTexture=false}}};FramebufferSystem2.prototype.bind=function bind2(framebuffer,frame){var ref=this;var gl=ref.gl;if(framebuffer){var fbo=framebuffer.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(framebuffer);if(this.current!==framebuffer){this.current=framebuffer;gl.bindFramebuffer(gl.FRAMEBUFFER,fbo.framebuffer)}if(fbo.dirtyId!==framebuffer.dirtyId){fbo.dirtyId=framebuffer.dirtyId;if(fbo.dirtyFormat!==framebuffer.dirtyFormat){fbo.dirtyFormat=framebuffer.dirtyFormat;this.updateFramebuffer(framebuffer)}else if(fbo.dirtySize!==framebuffer.dirtySize){fbo.dirtySize=framebuffer.dirtySize;this.resizeFramebuffer(framebuffer)}}for(var i=0;i<framebuffer.colorTextures.length;i++){if(framebuffer.colorTextures[i].texturePart){this.renderer.texture.unbind(framebuffer.colorTextures[i].texture)}else{this.renderer.texture.unbind(framebuffer.colorTextures[i])}}if(framebuffer.depthTexture){this.renderer.texture.unbind(framebuffer.depthTexture)}if(frame){this.setViewport(frame.x,frame.y,frame.width,frame.height)}else{this.setViewport(0,0,framebuffer.width,framebuffer.height)}}else{if(this.current){this.current=null;gl.bindFramebuffer(gl.FRAMEBUFFER,null)}if(frame){this.setViewport(frame.x,frame.y,frame.width,frame.height)}else{this.setViewport(0,0,this.renderer.width,this.renderer.height)}}};FramebufferSystem2.prototype.setViewport=function setViewport(x,y,width,height){var v=this.viewport;if(v.width!==width||v.height!==height||v.x!==x||v.y!==y){v.x=x;v.y=y;v.width=width;v.height=height;this.gl.viewport(x,y,width,height)}};prototypeAccessors5.size.get=function(){if(this.current){return{x:0,y:0,width:this.current.width,height:this.current.height}}return{x:0,y:0,width:this.renderer.width,height:this.renderer.height}};FramebufferSystem2.prototype.clear=function clear5(r,g,b,a){var ref=this;var gl=ref.gl;gl.clearColor(r,g,b,a);gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT)};FramebufferSystem2.prototype.initFramebuffer=function initFramebuffer(framebuffer){var ref=this;var gl=ref.gl;var fbo={framebuffer:gl.createFramebuffer(),stencil:null,dirtyId:0,dirtyFormat:0,dirtySize:0};framebuffer.glFramebuffers[this.CONTEXT_UID]=fbo;this.managedFramebuffers.push(framebuffer);framebuffer.disposeRunner.add(this);return fbo};FramebufferSystem2.prototype.resizeFramebuffer=function resizeFramebuffer(framebuffer){var ref=this;var gl=ref.gl;var fbo=framebuffer.glFramebuffers[this.CONTEXT_UID];if(fbo.stencil){gl.bindRenderbuffer(gl.RENDERBUFFER,fbo.stencil);gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_STENCIL,framebuffer.width,framebuffer.height)}var colorTextures=framebuffer.colorTextures;for(var i=0;i<colorTextures.length;i++){this.renderer.texture.bind(colorTextures[i],0)}if(framebuffer.depthTexture){this.renderer.texture.bind(framebuffer.depthTexture,0)}};FramebufferSystem2.prototype.updateFramebuffer=function updateFramebuffer(framebuffer){var ref=this;var gl=ref.gl;var fbo=framebuffer.glFramebuffers[this.CONTEXT_UID];var colorTextures=framebuffer.colorTextures;var count=colorTextures.length;if(!gl.drawBuffers){count=Math.min(count,1)}var activeTextures=[];for(var i=0;i<count;i++){var texture=framebuffer.colorTextures[i];if(texture.texturePart){this.renderer.texture.bind(texture.texture,0);gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0+i,gl.TEXTURE_CUBE_MAP_NEGATIVE_X+texture.side,texture.texture._glTextures[this.CONTEXT_UID].texture,0)}else{this.renderer.texture.bind(texture,0);gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0+i,gl.TEXTURE_2D,texture._glTextures[this.CONTEXT_UID].texture,0)}activeTextures.push(gl.COLOR_ATTACHMENT0+i)}if(activeTextures.length>1){gl.drawBuffers(activeTextures)}if(framebuffer.depthTexture){var writeDepthTexture=this.writeDepthTexture;if(writeDepthTexture){var depthTexture=framebuffer.depthTexture;this.renderer.texture.bind(depthTexture,0);gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.DEPTH_ATTACHMENT,gl.TEXTURE_2D,depthTexture._glTextures[this.CONTEXT_UID].texture,0)}}if(!fbo.stencil&&(framebuffer.stencil||framebuffer.depth)){fbo.stencil=gl.createRenderbuffer();gl.bindRenderbuffer(gl.RENDERBUFFER,fbo.stencil);gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_STENCIL,framebuffer.width,framebuffer.height);if(!framebuffer.depthTexture){gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.DEPTH_STENCIL_ATTACHMENT,gl.RENDERBUFFER,fbo.stencil)}}};FramebufferSystem2.prototype.disposeFramebuffer=function disposeFramebuffer(framebuffer,contextLost){var fbo=framebuffer.glFramebuffers[this.CONTEXT_UID];var gl=this.gl;if(!fbo){return}delete framebuffer.glFramebuffers[this.CONTEXT_UID];var index3=this.managedFramebuffers.indexOf(framebuffer);if(index3>=0){this.managedFramebuffers.splice(index3,1)}framebuffer.disposeRunner.remove(this);if(!contextLost){gl.deleteFramebuffer(fbo.framebuffer);if(fbo.stencil){gl.deleteRenderbuffer(fbo.stencil)}}};FramebufferSystem2.prototype.disposeAll=function disposeAll(contextLost){var list=this.managedFramebuffers;this.managedFramebuffers=[];for(var i=0;i<list.length;i++){this.disposeFramebuffer(list[i],contextLost)}};FramebufferSystem2.prototype.forceStencil=function forceStencil(){var framebuffer=this.current;if(!framebuffer){return}var fbo=framebuffer.glFramebuffers[this.CONTEXT_UID];if(!fbo||fbo.stencil){return}framebuffer.enableStencil();var w=framebuffer.width;var h=framebuffer.height;var gl=this.gl;var stencil=gl.createRenderbuffer();gl.bindRenderbuffer(gl.RENDERBUFFER,stencil);gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_STENCIL,w,h);fbo.stencil=stencil;gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.DEPTH_STENCIL_ATTACHMENT,gl.RENDERBUFFER,stencil)};FramebufferSystem2.prototype.reset=function reset7(){this.current=this.unknownFramebuffer;this.viewport=new Rectangle};Object.defineProperties(FramebufferSystem2.prototype,prototypeAccessors5);return FramebufferSystem2}(System);var GLBuffer=function GLBuffer2(buffer){this.buffer=buffer;this.updateID=-1;this.byteLength=-1;this.refCount=0};var byteSizeMap$1={5126:4,5123:2,5121:1};var GeometrySystem=function(System3){function GeometrySystem2(renderer){System3.call(this,renderer);this._activeGeometry=null;this._activeVao=null;this.hasVao=true;this.hasInstance=true;this.canUseUInt32ElementIndex=false;this.boundBuffers={};this.managedGeometries={};this.managedBuffers={}}if(System3)GeometrySystem2.__proto__=System3;GeometrySystem2.prototype=Object.create(System3&&System3.prototype);GeometrySystem2.prototype.constructor=GeometrySystem2;GeometrySystem2.prototype.contextChange=function contextChange(){this.disposeAll(true);var gl=this.gl=this.renderer.gl;var context2=this.renderer.context;this.CONTEXT_UID=this.renderer.CONTEXT_UID;if(!gl.createVertexArray){var nativeVaoExtension=this.renderer.context.extensions.vertexArrayObject;if(settings.PREFER_ENV===ENV.WEBGL_LEGACY){nativeVaoExtension=null}if(nativeVaoExtension){gl.createVertexArray=function(){return nativeVaoExtension.createVertexArrayOES()};gl.bindVertexArray=function(vao){return nativeVaoExtension.bindVertexArrayOES(vao)};gl.deleteVertexArray=function(vao){return nativeVaoExtension.deleteVertexArrayOES(vao)}}else{this.hasVao=false;gl.createVertexArray=function(){};gl.bindVertexArray=function(){};gl.deleteVertexArray=function(){}}}if(!gl.vertexAttribDivisor){var instanceExt=gl.getExtension("ANGLE_instanced_arrays");if(instanceExt){gl.vertexAttribDivisor=function(a,b){return instanceExt.vertexAttribDivisorANGLE(a,b)};gl.drawElementsInstanced=function(a,b,c,d,e){return instanceExt.drawElementsInstancedANGLE(a,b,c,d,e)};gl.drawArraysInstanced=function(a,b,c,d){return instanceExt.drawArraysInstancedANGLE(a,b,c,d)}}else{this.hasInstance=false}}this.canUseUInt32ElementIndex=context2.webGLVersion===2||!!context2.extensions.uint32ElementIndex};GeometrySystem2.prototype.bind=function bind2(geometry,shader){shader=shader||this.renderer.shader.shader;var ref=this;var gl=ref.gl;var vaos=geometry.glVertexArrayObjects[this.CONTEXT_UID];if(!vaos){this.managedGeometries[geometry.id]=geometry;geometry.disposeRunner.add(this);geometry.glVertexArrayObjects[this.CONTEXT_UID]=vaos={}}var vao=vaos[shader.program.id]||this.initGeometryVao(geometry,shader.program);this._activeGeometry=geometry;if(this._activeVao!==vao){this._activeVao=vao;if(this.hasVao){gl.bindVertexArray(vao)}else{this.activateVao(geometry,shader.program)}}this.updateBuffers()};GeometrySystem2.prototype.reset=function reset7(){this.unbind()};GeometrySystem2.prototype.updateBuffers=function updateBuffers(){var geometry=this._activeGeometry;var ref=this;var gl=ref.gl;for(var i=0;i<geometry.buffers.length;i++){var buffer=geometry.buffers[i];var glBuffer=buffer._glBuffers[this.CONTEXT_UID];if(buffer._updateID!==glBuffer.updateID){glBuffer.updateID=buffer._updateID;var type=buffer.index?gl.ELEMENT_ARRAY_BUFFER:gl.ARRAY_BUFFER;gl.bindBuffer(type,glBuffer.buffer);this._boundBuffer=glBuffer;if(glBuffer.byteLength>=buffer.data.byteLength){gl.bufferSubData(type,0,buffer.data)}else{var drawType=buffer.static?gl.STATIC_DRAW:gl.DYNAMIC_DRAW;glBuffer.byteLength=buffer.data.byteLength;gl.bufferData(type,buffer.data,drawType)}}}};GeometrySystem2.prototype.checkCompatibility=function checkCompatibility(geometry,program){var geometryAttributes=geometry.attributes;var shaderAttributes=program.attributeData;for(var j in shaderAttributes){if(!geometryAttributes[j]){throw new Error("shader and geometry incompatible, geometry missing the \""+j+"\" attribute")}}};GeometrySystem2.prototype.getSignature=function getSignature(geometry,program){var attribs=geometry.attributes;var shaderAttributes=program.attributeData;var strings=["g",geometry.id];for(var i in attribs){if(shaderAttributes[i]){strings.push(i)}}return strings.join("-")};GeometrySystem2.prototype.initGeometryVao=function initGeometryVao(geometry,program){this.checkCompatibility(geometry,program);var gl=this.gl;var CONTEXT_UID2=this.CONTEXT_UID;var signature=this.getSignature(geometry,program);var vaoObjectHash=geometry.glVertexArrayObjects[this.CONTEXT_UID];var vao=vaoObjectHash[signature];if(vao){vaoObjectHash[program.id]=vao;return vao}var buffers=geometry.buffers;var attributes=geometry.attributes;var tempStride={};var tempStart={};for(var j in buffers){tempStride[j]=0;tempStart[j]=0}for(var j$1 in attributes){if(!attributes[j$1].size&&program.attributeData[j$1]){attributes[j$1].size=program.attributeData[j$1].size}else if(!attributes[j$1].size){console.warn("PIXI Geometry attribute '"+j$1+"' size cannot be determined (likely the bound shader does not have the attribute)")}tempStride[attributes[j$1].buffer]+=attributes[j$1].size*byteSizeMap$1[attributes[j$1].type]}for(var j$2 in attributes){var attribute=attributes[j$2];var attribSize=attribute.size;if(attribute.stride===void 0){if(tempStride[attribute.buffer]===attribSize*byteSizeMap$1[attribute.type]){attribute.stride=0}else{attribute.stride=tempStride[attribute.buffer]}}if(attribute.start===void 0){attribute.start=tempStart[attribute.buffer];tempStart[attribute.buffer]+=attribSize*byteSizeMap$1[attribute.type]}}vao=gl.createVertexArray();gl.bindVertexArray(vao);for(var i=0;i<buffers.length;i++){var buffer=buffers[i];if(!buffer._glBuffers[CONTEXT_UID2]){buffer._glBuffers[CONTEXT_UID2]=new GLBuffer(gl.createBuffer());this.managedBuffers[buffer.id]=buffer;buffer.disposeRunner.add(this)}buffer._glBuffers[CONTEXT_UID2].refCount++}this.activateVao(geometry,program);this._activeVao=vao;vaoObjectHash[program.id]=vao;vaoObjectHash[signature]=vao;return vao};GeometrySystem2.prototype.disposeBuffer=function disposeBuffer(buffer,contextLost){if(!this.managedBuffers[buffer.id]){return}delete this.managedBuffers[buffer.id];var glBuffer=buffer._glBuffers[this.CONTEXT_UID];var gl=this.gl;buffer.disposeRunner.remove(this);if(!glBuffer){return}if(!contextLost){gl.deleteBuffer(glBuffer.buffer)}delete buffer._glBuffers[this.CONTEXT_UID]};GeometrySystem2.prototype.disposeGeometry=function disposeGeometry(geometry,contextLost){if(!this.managedGeometries[geometry.id]){return}delete this.managedGeometries[geometry.id];var vaos=geometry.glVertexArrayObjects[this.CONTEXT_UID];var gl=this.gl;var buffers=geometry.buffers;geometry.disposeRunner.remove(this);if(!vaos){return}for(var i=0;i<buffers.length;i++){var buf=buffers[i]._glBuffers[this.CONTEXT_UID];buf.refCount--;if(buf.refCount===0&&!contextLost){this.disposeBuffer(buffers[i],contextLost)}}if(!contextLost){for(var vaoId in vaos){if(vaoId[0]==="g"){var vao=vaos[vaoId];if(this._activeVao===vao){this.unbind()}gl.deleteVertexArray(vao)}}}delete geometry.glVertexArrayObjects[this.CONTEXT_UID]};GeometrySystem2.prototype.disposeAll=function disposeAll(contextLost){var all=Object.keys(this.managedGeometries);for(var i=0;i<all.length;i++){this.disposeGeometry(this.managedGeometries[all[i]],contextLost)}all=Object.keys(this.managedBuffers);for(var i$1=0;i$1<all.length;i$1++){this.disposeBuffer(this.managedBuffers[all[i$1]],contextLost)}};GeometrySystem2.prototype.activateVao=function activateVao(geometry,program){var gl=this.gl;var CONTEXT_UID2=this.CONTEXT_UID;var buffers=geometry.buffers;var attributes=geometry.attributes;if(geometry.indexBuffer){gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,geometry.indexBuffer._glBuffers[CONTEXT_UID2].buffer)}var lastBuffer=null;for(var j in attributes){var attribute=attributes[j];var buffer=buffers[attribute.buffer];var glBuffer=buffer._glBuffers[CONTEXT_UID2];if(program.attributeData[j]){if(lastBuffer!==glBuffer){gl.bindBuffer(gl.ARRAY_BUFFER,glBuffer.buffer);lastBuffer=glBuffer}var location2=program.attributeData[j].location;gl.enableVertexAttribArray(location2);gl.vertexAttribPointer(location2,attribute.size,attribute.type||gl.FLOAT,attribute.normalized,attribute.stride,attribute.start);if(attribute.instance){if(this.hasInstance){gl.vertexAttribDivisor(location2,1)}else{throw new Error("geometry error, GPU Instancing is not supported on this device")}}}}};GeometrySystem2.prototype.draw=function draw(type,size,start2,instanceCount){var ref=this;var gl=ref.gl;var geometry=this._activeGeometry;if(geometry.indexBuffer){var byteSize=geometry.indexBuffer.data.BYTES_PER_ELEMENT;var glType=byteSize===2?gl.UNSIGNED_SHORT:gl.UNSIGNED_INT;if(byteSize===2||byteSize===4&&this.canUseUInt32ElementIndex){if(geometry.instanced){gl.drawElementsInstanced(type,size||geometry.indexBuffer.data.length,glType,(start2||0)*byteSize,instanceCount||1)}else{gl.drawElements(type,size||geometry.indexBuffer.data.length,glType,(start2||0)*byteSize)}}else{console.warn("unsupported index buffer type: uint32")}}else if(geometry.instanced){gl.drawArraysInstanced(type,start2,size||geometry.getSize(),instanceCount||1)}else{gl.drawArrays(type,start2,size||geometry.getSize())}return this};GeometrySystem2.prototype.unbind=function unbind2(){this.gl.bindVertexArray(null);this._activeVao=null;this._activeGeometry=null};return GeometrySystem2}(System);var MaskData=function MaskData2(maskObject){this.type=MASK_TYPES.NONE;this.autoDetect=true;this.maskObject=maskObject||null;this.pooled=false;this.isMaskData=true;this._stencilCounter=0;this._scissorCounter=0;this._scissorRect=null;this._target=null};MaskData.prototype.reset=function reset3(){if(this.pooled){this.maskObject=null;this.type=MASK_TYPES.NONE;this.autoDetect=true}this._target=null};MaskData.prototype.copyCountersOrReset=function copyCountersOrReset(maskAbove){if(maskAbove){this._stencilCounter=maskAbove._stencilCounter;this._scissorCounter=maskAbove._scissorCounter;this._scissorRect=maskAbove._scissorRect}else{this._stencilCounter=0;this._scissorCounter=0;this._scissorRect=null}};function compileProgram(gl,vertexSrc,fragmentSrc,attributeLocations){var glVertShader=compileShader(gl,gl.VERTEX_SHADER,vertexSrc);var glFragShader=compileShader(gl,gl.FRAGMENT_SHADER,fragmentSrc);var program=gl.createProgram();gl.attachShader(program,glVertShader);gl.attachShader(program,glFragShader);if(attributeLocations){for(var i in attributeLocations){gl.bindAttribLocation(program,attributeLocations[i],i)}}gl.linkProgram(program);if(!gl.getProgramParameter(program,gl.LINK_STATUS)){if(!gl.getShaderParameter(glVertShader,gl.COMPILE_STATUS)){console.warn(vertexSrc);console.error(gl.getShaderInfoLog(glVertShader))}if(!gl.getShaderParameter(glFragShader,gl.COMPILE_STATUS)){console.warn(fragmentSrc);console.error(gl.getShaderInfoLog(glFragShader))}console.error("Pixi.js Error: Could not initialize shader.");console.error("gl.VALIDATE_STATUS",gl.getProgramParameter(program,gl.VALIDATE_STATUS));console.error("gl.getError()",gl.getError());if(gl.getProgramInfoLog(program)!==""){console.warn("Pixi.js Warning: gl.getProgramInfoLog()",gl.getProgramInfoLog(program))}gl.deleteProgram(program);program=null}gl.deleteShader(glVertShader);gl.deleteShader(glFragShader);return program}function compileShader(gl,type,src){var shader=gl.createShader(type);gl.shaderSource(shader,src);gl.compileShader(shader);return shader}function defaultValue(type,size){switch(type){case"float":return 0;case"vec2":return new Float32Array(2*size);case"vec3":return new Float32Array(3*size);case"vec4":return new Float32Array(4*size);case"int":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*size);case"ivec3":return new Int32Array(3*size);case"ivec4":return new Int32Array(4*size);case"bool":return false;case"bvec2":return booleanArray(2*size);case"bvec3":return booleanArray(3*size);case"bvec4":return booleanArray(4*size);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);}return null}function booleanArray(size){var array=new Array(size);for(var i=0;i<array.length;i++){array[i]=false}return array}var unknownContext={};var context=unknownContext;function getTestContext(){if(context===unknownContext||context&&context.isContextLost()){var canvas4=document.createElement("canvas");var gl;if(settings.PREFER_ENV>=ENV.WEBGL2){gl=canvas4.getContext("webgl2",{})}if(!gl){gl=canvas4.getContext("webgl",{})||canvas4.getContext("experimental-webgl",{});if(!gl){gl=null}else{gl.getExtension("WEBGL_draw_buffers")}}context=gl}return context}var maxFragmentPrecision;function getMaxFragmentPrecision(){if(!maxFragmentPrecision){maxFragmentPrecision=PRECISION.MEDIUM;var gl=getTestContext();if(gl){if(gl.getShaderPrecisionFormat){var shaderFragment=gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER,gl.HIGH_FLOAT);maxFragmentPrecision=shaderFragment.precision?PRECISION.HIGH:PRECISION.MEDIUM}}}return maxFragmentPrecision}function setPrecision(src,requestedPrecision,maxSupportedPrecision){if(src.substring(0,9)!=="precision"){var precision=requestedPrecision;if(requestedPrecision===PRECISION.HIGH&&maxSupportedPrecision!==PRECISION.HIGH){precision=PRECISION.MEDIUM}return"precision "+precision+" float;\n"+src}else if(maxSupportedPrecision!==PRECISION.HIGH&&src.substring(0,15)==="precision highp"){return src.replace("precision highp","precision mediump")}return src}var GLSL_TO_SIZE={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function mapSize(type){return GLSL_TO_SIZE[type]}var GL_TABLE=null;var GL_TO_GLSL_TYPES={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray"};function mapType(gl,type){if(!GL_TABLE){var typeNames=Object.keys(GL_TO_GLSL_TYPES);GL_TABLE={};for(var i=0;i<typeNames.length;++i){var tn=typeNames[i];GL_TABLE[gl[tn]]=GL_TO_GLSL_TYPES[tn]}}return GL_TABLE[type]}var GLSL_TO_SINGLE_SETTERS_CACHED={float:"\n    if(cv !== v)\n    {\n        cv.v = v;\n        gl.uniform1f(location, v)\n    }",vec2:"\n    if(cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        gl.uniform2f(location, v[0], v[1])\n    }",vec3:"\n    if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3f(location, v[0], v[1], v[2])\n    }",vec4:"gl.uniform4f(location, v[0], v[1], v[2], v[3])",int:"gl.uniform1i(location, v)",ivec2:"gl.uniform2i(location, v[0], v[1])",ivec3:"gl.uniform3i(location, v[0], v[1], v[2])",ivec4:"gl.uniform4i(location, v[0], v[1], v[2], v[3])",bool:"gl.uniform1i(location, v)",bvec2:"gl.uniform2i(location, v[0], v[1])",bvec3:"gl.uniform3i(location, v[0], v[1], v[2])",bvec4:"gl.uniform4i(location, v[0], v[1], v[2], v[3])",mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:"gl.uniform1i(location, v)",samplerCube:"gl.uniform1i(location, v)",sampler2DArray:"gl.uniform1i(location, v)"};var GLSL_TO_ARRAY_SETTERS={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function generateUniformsSync(group,uniformData){var func="var v = null;\n    var cv = null\n    var t = 0;\n    var gl = renderer.gl\n    ";for(var i in group.uniforms){var data=uniformData[i];if(!data){if(group.uniforms[i].group){func+="\n                    renderer.shader.syncUniformGroup(uv."+i+", syncData);\n                "}continue}if(data.type==="float"&&data.size===1){func+="\n            if(uv."+i+" !== ud."+i+".value)\n            {\n                ud."+i+".value = uv."+i+"\n                gl.uniform1f(ud."+i+".location, uv."+i+")\n            }\n"}else if((data.type==="sampler2D"||data.type==="samplerCube"||data.type==="sampler2DArray")&&data.size===1&&!data.isArray){func+="\n\n            t = syncData.textureCount++;\n\n            renderer.texture.bind(uv."+i+", t);\n            \n            if(ud."+i+".value !== t)\n            {\n                ud."+i+".value = t;\n                gl.uniform1i(ud."+i+".location, t);\n; // eslint-disable-line max-len\n            }\n"}else if(data.type==="mat3"&&data.size===1){if(group.uniforms[i].a!==void 0){func+="\n                gl.uniformMatrix3fv(ud."+i+".location, false, uv."+i+".toArray(true));\n                \n"}else{func+="\n                gl.uniformMatrix3fv(ud."+i+".location, false, uv."+i+");\n                \n"}}else if(data.type==="vec2"&&data.size===1){if(group.uniforms[i].x!==void 0){func+="\n                cv = ud."+i+".value;\n                v = uv."+i+";\n\n                if(cv[0] !== v.x || cv[1] !== v.y)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    gl.uniform2f(ud."+i+".location, v.x, v.y);\n                }\n"}else{func+="\n                cv = ud."+i+".value;\n                v = uv."+i+";\n\n                if(cv[0] !== v[0] || cv[1] !== v[1])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    gl.uniform2f(ud."+i+".location, v[0], v[1]);\n                }\n                \n"}}else if(data.type==="vec4"&&data.size===1){if(group.uniforms[i].width!==void 0){func+="\n                cv = ud."+i+".value;\n                v = uv."+i+";\n\n                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    cv[2] = v.width;\n                    cv[3] = v.height;\n                    gl.uniform4f(ud."+i+".location, v.x, v.y, v.width, v.height)\n                }\n"}else{func+="\n                cv = ud."+i+".value;\n                v = uv."+i+";\n\n                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    cv[2] = v[2];\n                    cv[3] = v[3];\n\n                    gl.uniform4f(ud."+i+".location, v[0], v[1], v[2], v[3])\n                }\n                \n"}}else{var templateType=data.size===1?GLSL_TO_SINGLE_SETTERS_CACHED:GLSL_TO_ARRAY_SETTERS;var template=templateType[data.type].replace("location","ud."+i+".location");func+="\n            cv = ud."+i+".value;\n            v = uv."+i+";\n            "+template+";\n"}}return new Function("ud","uv","renderer","syncData",func)}var fragTemplate=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function checkMaxIfStatementsInShader(maxIfs,gl){if(maxIfs===0){throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`")}var shader=gl.createShader(gl.FRAGMENT_SHADER);while(true){var fragmentSrc=fragTemplate.replace(/%forloop%/gi,generateIfTestSrc(maxIfs));gl.shaderSource(shader,fragmentSrc);gl.compileShader(shader);if(!gl.getShaderParameter(shader,gl.COMPILE_STATUS)){maxIfs=maxIfs/2|0}else{break}}return maxIfs}function generateIfTestSrc(maxIfs){var src="";for(var i=0;i<maxIfs;++i){if(i>0){src+="\nelse "}if(i<maxIfs-1){src+="if(test == "+i+".0){}"}}return src}var unsafeEval;function unsafeEvalSupported(){if(typeof unsafeEval==="boolean"){return unsafeEval}try{var func=new Function("param1","param2","param3","return param1[param2] === param3;");unsafeEval=func({a:"b"},"a","b")===true}catch(e){unsafeEval=false}return unsafeEval}var defaultFragment="varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor *= texture2D(uSampler, vTextureCoord);\n}";var defaultVertex="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n}\n";var UID$3=0;var nameCache={};var Program=function Program2(vertexSrc,fragmentSrc,name){if(name===void 0)name="pixi-shader";this.id=UID$3++;this.vertexSrc=vertexSrc||Program2.defaultVertexSrc;this.fragmentSrc=fragmentSrc||Program2.defaultFragmentSrc;this.vertexSrc=this.vertexSrc.trim();this.fragmentSrc=this.fragmentSrc.trim();if(this.vertexSrc.substring(0,8)!=="#version"){name=name.replace(/\s+/g,"-");if(nameCache[name]){nameCache[name]++;name+="-"+nameCache[name]}else{nameCache[name]=1}this.vertexSrc="#define SHADER_NAME "+name+"\n"+this.vertexSrc;this.fragmentSrc="#define SHADER_NAME "+name+"\n"+this.fragmentSrc;this.vertexSrc=setPrecision(this.vertexSrc,settings.PRECISION_VERTEX,PRECISION.HIGH);this.fragmentSrc=setPrecision(this.fragmentSrc,settings.PRECISION_FRAGMENT,getMaxFragmentPrecision())}this.extractData(this.vertexSrc,this.fragmentSrc);this.glPrograms={};this.syncUniforms=null};var staticAccessors={defaultVertexSrc:{configurable:true},defaultFragmentSrc:{configurable:true}};Program.prototype.extractData=function extractData(vertexSrc,fragmentSrc){var gl=getTestContext();if(gl){var program=compileProgram(gl,vertexSrc,fragmentSrc);this.attributeData=this.getAttributeData(program,gl);this.uniformData=this.getUniformData(program,gl);gl.deleteProgram(program)}else{this.uniformData={};this.attributeData={}}};Program.prototype.getAttributeData=function getAttributeData(program,gl){var attributes={};var attributesArray=[];var totalAttributes=gl.getProgramParameter(program,gl.ACTIVE_ATTRIBUTES);for(var i=0;i<totalAttributes;i++){var attribData=gl.getActiveAttrib(program,i);var type=mapType(gl,attribData.type);var data={type:type,name:attribData.name,size:mapSize(type),location:0};attributes[attribData.name]=data;attributesArray.push(data)}attributesArray.sort(function(a,b){return a.name>b.name?1:-1});for(var i$1=0;i$1<attributesArray.length;i$1++){attributesArray[i$1].location=i$1}return attributes};Program.prototype.getUniformData=function getUniformData(program,gl){var uniforms={};var totalUniforms=gl.getProgramParameter(program,gl.ACTIVE_UNIFORMS);for(var i=0;i<totalUniforms;i++){var uniformData=gl.getActiveUniform(program,i);var name=uniformData.name.replace(/\[.*?\]/,"");var isArray=uniformData.name.match(/\[.*?\]/,"");var type=mapType(gl,uniformData.type);uniforms[name]={type:type,size:uniformData.size,isArray:isArray,value:defaultValue(type,uniformData.size)}}return uniforms};staticAccessors.defaultVertexSrc.get=function(){return defaultVertex};staticAccessors.defaultFragmentSrc.get=function(){return defaultFragment};Program.from=function from4(vertexSrc,fragmentSrc,name){var key=vertexSrc+fragmentSrc;var program=_ProgramCache[key];if(!program){_ProgramCache[key]=program=new Program(vertexSrc,fragmentSrc,name)}return program};Object.defineProperties(Program,staticAccessors);var Shader=function Shader2(program,uniforms){this.program=program;if(uniforms){if(uniforms instanceof UniformGroup){this.uniformGroup=uniforms}else{this.uniformGroup=new UniformGroup(uniforms)}}else{this.uniformGroup=new UniformGroup({})}for(var i in program.uniformData){if(this.uniformGroup.uniforms[i]instanceof Array){this.uniformGroup.uniforms[i]=new Float32Array(this.uniformGroup.uniforms[i])}}};var prototypeAccessors$2={uniforms:{configurable:true}};Shader.prototype.checkUniformExists=function checkUniformExists(name,group){if(group.uniforms[name]){return true}for(var i in group.uniforms){var uniform=group.uniforms[i];if(uniform.group){if(this.checkUniformExists(name,uniform)){return true}}}return false};Shader.prototype.destroy=function destroy8(){this.uniformGroup=null};prototypeAccessors$2.uniforms.get=function(){return this.uniformGroup.uniforms};Shader.from=function from5(vertexSrc,fragmentSrc,uniforms){var program=Program.from(vertexSrc,fragmentSrc);return new Shader(program,uniforms)};Object.defineProperties(Shader.prototype,prototypeAccessors$2);var BLEND=0;var OFFSET=1;var CULLING=2;var DEPTH_TEST=3;var WINDING=4;var State=function State2(){this.data=0;this.blendMode=BLEND_MODES.NORMAL;this.polygonOffset=0;this.blend=true};var prototypeAccessors$3={blend:{configurable:true},offsets:{configurable:true},culling:{configurable:true},depthTest:{configurable:true},clockwiseFrontFace:{configurable:true},blendMode:{configurable:true},polygonOffset:{configurable:true}};prototypeAccessors$3.blend.get=function(){return!!(this.data&1<<BLEND)};prototypeAccessors$3.blend.set=function(value){if(!!(this.data&1<<BLEND)!==value){this.data^=1<<BLEND}};prototypeAccessors$3.offsets.get=function(){return!!(this.data&1<<OFFSET)};prototypeAccessors$3.offsets.set=function(value){if(!!(this.data&1<<OFFSET)!==value){this.data^=1<<OFFSET}};prototypeAccessors$3.culling.get=function(){return!!(this.data&1<<CULLING)};prototypeAccessors$3.culling.set=function(value){if(!!(this.data&1<<CULLING)!==value){this.data^=1<<CULLING}};prototypeAccessors$3.depthTest.get=function(){return!!(this.data&1<<DEPTH_TEST)};prototypeAccessors$3.depthTest.set=function(value){if(!!(this.data&1<<DEPTH_TEST)!==value){this.data^=1<<DEPTH_TEST}};prototypeAccessors$3.clockwiseFrontFace.get=function(){return!!(this.data&1<<WINDING)};prototypeAccessors$3.clockwiseFrontFace.set=function(value){if(!!(this.data&1<<WINDING)!==value){this.data^=1<<WINDING}};prototypeAccessors$3.blendMode.get=function(){return this._blendMode};prototypeAccessors$3.blendMode.set=function(value){this.blend=value!==BLEND_MODES.NONE;this._blendMode=value};prototypeAccessors$3.polygonOffset.get=function(){return this._polygonOffset};prototypeAccessors$3.polygonOffset.set=function(value){this.offsets=!!value;this._polygonOffset=value};State.for2d=function for2d(){var state=new State;state.depthTest=false;state.blend=true;return state};Object.defineProperties(State.prototype,prototypeAccessors$3);var defaultVertex$1="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n";var defaultFragment$1="varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n}\n";var Filter=function(Shader3){function Filter2(vertexSrc,fragmentSrc,uniforms){var program=Program.from(vertexSrc||Filter2.defaultVertexSrc,fragmentSrc||Filter2.defaultFragmentSrc);Shader3.call(this,program,uniforms);this.padding=0;this.resolution=settings.FILTER_RESOLUTION;this.enabled=true;this.autoFit=true;this.legacy=!!this.program.attributeData.aTextureCoord;this.state=new State}if(Shader3)Filter2.__proto__=Shader3;Filter2.prototype=Object.create(Shader3&&Shader3.prototype);Filter2.prototype.constructor=Filter2;var prototypeAccessors5={blendMode:{configurable:true}};var staticAccessors3={defaultVertexSrc:{configurable:true},defaultFragmentSrc:{configurable:true}};Filter2.prototype.apply=function apply(filterManager,input,output,clear5,currentState){filterManager.applyFilter(this,input,output,clear5,currentState)};prototypeAccessors5.blendMode.get=function(){return this.state.blendMode};prototypeAccessors5.blendMode.set=function(value){this.state.blendMode=value};staticAccessors3.defaultVertexSrc.get=function(){return defaultVertex$1};staticAccessors3.defaultFragmentSrc.get=function(){return defaultFragment$1};Object.defineProperties(Filter2.prototype,prototypeAccessors5);Object.defineProperties(Filter2,staticAccessors3);return Filter2}(Shader);Filter.SOURCE_KEY_MAP={};var vertex="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n";var fragment="varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform float npmAlpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);\n\n    original *= (alphaMul * masky.r * alpha * clip);\n\n    gl_FragColor = original;\n}\n";var tempMat=new Matrix;var TextureMatrix=function TextureMatrix2(texture,clampMargin){this._texture=texture;this.mapCoord=new Matrix;this.uClampFrame=new Float32Array(4);this.uClampOffset=new Float32Array(2);this._updateID=-1;this.clampOffset=0;this.clampMargin=typeof clampMargin==="undefined"?0.5:clampMargin;this.isSimple=false};var prototypeAccessors$4={texture:{configurable:true}};prototypeAccessors$4.texture.get=function(){return this._texture};prototypeAccessors$4.texture.set=function(value){this._texture=value;this._updateID=-1};TextureMatrix.prototype.multiplyUvs=function multiplyUvs(uvs,out){if(out===void 0){out=uvs}var mat=this.mapCoord;for(var i=0;i<uvs.length;i+=2){var x=uvs[i];var y=uvs[i+1];out[i]=x*mat.a+y*mat.c+mat.tx;out[i+1]=x*mat.b+y*mat.d+mat.ty}return out};TextureMatrix.prototype.update=function update5(forceUpdate){var tex=this._texture;if(!tex||!tex.valid){return false}if(!forceUpdate&&this._updateID===tex._updateID){return false}this._updateID=tex._updateID;var uvs=tex._uvs;this.mapCoord.set(uvs.x1-uvs.x0,uvs.y1-uvs.y0,uvs.x3-uvs.x0,uvs.y3-uvs.y0,uvs.x0,uvs.y0);var orig=tex.orig;var trim=tex.trim;if(trim){tempMat.set(orig.width/trim.width,0,0,orig.height/trim.height,-trim.x/trim.width,-trim.y/trim.height);this.mapCoord.append(tempMat)}var texBase=tex.baseTexture;var frame=this.uClampFrame;var margin=this.clampMargin/texBase.resolution;var offset=this.clampOffset;frame[0]=(tex._frame.x+margin+offset)/texBase.width;frame[1]=(tex._frame.y+margin+offset)/texBase.height;frame[2]=(tex._frame.x+tex._frame.width-margin+offset)/texBase.width;frame[3]=(tex._frame.y+tex._frame.height-margin+offset)/texBase.height;this.uClampOffset[0]=offset/texBase.realWidth;this.uClampOffset[1]=offset/texBase.realHeight;this.isSimple=tex._frame.width===texBase.width&&tex._frame.height===texBase.height&&tex.rotate===0;return true};Object.defineProperties(TextureMatrix.prototype,prototypeAccessors$4);var SpriteMaskFilter=function(Filter2){function SpriteMaskFilter2(sprite){var maskMatrix=new Matrix;Filter2.call(this,vertex,fragment);sprite.renderable=false;this.maskSprite=sprite;this.maskMatrix=maskMatrix}if(Filter2)SpriteMaskFilter2.__proto__=Filter2;SpriteMaskFilter2.prototype=Object.create(Filter2&&Filter2.prototype);SpriteMaskFilter2.prototype.constructor=SpriteMaskFilter2;SpriteMaskFilter2.prototype.apply=function apply(filterManager,input,output,clear5){var maskSprite=this.maskSprite;var tex=this.maskSprite.texture;if(!tex.valid){return}if(!tex.transform){tex.transform=new TextureMatrix(tex,0)}tex.transform.update();this.uniforms.npmAlpha=tex.baseTexture.alphaMode?0:1;this.uniforms.mask=tex;this.uniforms.otherMatrix=filterManager.calculateSpriteMatrix(this.maskMatrix,maskSprite).prepend(tex.transform.mapCoord);this.uniforms.alpha=maskSprite.worldAlpha;this.uniforms.maskClamp=tex.transform.uClampFrame;filterManager.applyFilter(this,input,output,clear5)};return SpriteMaskFilter2}(Filter);var MaskSystem=function(System3){function MaskSystem2(renderer){System3.call(this,renderer);this.scissorRenderTarget=null;this.enableScissor=false;this.alphaMaskPool=[];this.maskDataPool=[];this.maskStack=[];this.alphaMaskIndex=0}if(System3)MaskSystem2.__proto__=System3;MaskSystem2.prototype=Object.create(System3&&System3.prototype);MaskSystem2.prototype.constructor=MaskSystem2;MaskSystem2.prototype.setMaskStack=function setMaskStack(maskStack){this.maskStack=maskStack;this.renderer.scissor.setMaskStack(maskStack);this.renderer.stencil.setMaskStack(maskStack)};MaskSystem2.prototype.push=function push(target,maskData){if(!maskData.isMaskData){var d=this.maskDataPool.pop()||new MaskData;d.pooled=true;d.maskObject=maskData;maskData=d}if(maskData.autoDetect){this.detect(maskData)}maskData.copyCountersOrReset(this.maskStack[this.maskStack.length-1]);maskData._target=target;switch(maskData.type){case MASK_TYPES.SCISSOR:this.maskStack.push(maskData);this.renderer.scissor.push(maskData);break;case MASK_TYPES.STENCIL:this.maskStack.push(maskData);this.renderer.stencil.push(maskData);break;case MASK_TYPES.SPRITE:maskData.copyCountersOrReset(null);this.pushSpriteMask(maskData);this.maskStack.push(maskData);break;default:break;}};MaskSystem2.prototype.pop=function pop(target){var maskData=this.maskStack.pop();if(!maskData||maskData._target!==target){return}switch(maskData.type){case MASK_TYPES.SCISSOR:this.renderer.scissor.pop();break;case MASK_TYPES.STENCIL:this.renderer.stencil.pop(maskData.maskObject);break;case MASK_TYPES.SPRITE:this.popSpriteMask();break;default:break;}maskData.reset();if(maskData.pooled){this.maskDataPool.push(maskData)}};MaskSystem2.prototype.detect=function detect(maskData){var maskObject=maskData.maskObject;if(maskObject.isSprite){maskData.type=MASK_TYPES.SPRITE;return}maskData.type=MASK_TYPES.STENCIL;if(this.enableScissor&&maskObject.isFastRect&&maskObject.isFastRect()){var matrix=maskObject.worldTransform;var rotX=Math.atan2(matrix.b,matrix.a);var rotXY=Math.atan2(matrix.d,matrix.c);rotX=Math.round(rotX*(180/Math.PI)*100);rotXY=Math.round(rotXY*(180/Math.PI)*100)-rotX;rotX=(rotX%9e3+9e3)%9e3;rotXY=(rotXY%18e3+18e3)%18e3;if(rotX===0&&rotXY===9e3){maskData.type=MASK_TYPES.SCISSOR}}};MaskSystem2.prototype.pushSpriteMask=function pushSpriteMask(maskData){var maskObject=maskData.maskObject;var target=maskData._target;var alphaMaskFilter=this.alphaMaskPool[this.alphaMaskIndex];if(!alphaMaskFilter){alphaMaskFilter=this.alphaMaskPool[this.alphaMaskIndex]=[new SpriteMaskFilter(maskObject)]}alphaMaskFilter[0].resolution=this.renderer.resolution;alphaMaskFilter[0].maskSprite=maskObject;var stashFilterArea=target.filterArea;target.filterArea=maskObject.getBounds(true);this.renderer.filter.push(target,alphaMaskFilter);target.filterArea=stashFilterArea;this.alphaMaskIndex++};MaskSystem2.prototype.popSpriteMask=function popSpriteMask(){this.renderer.filter.pop();this.alphaMaskIndex--};return MaskSystem2}(System);var AbstractMaskSystem=function(System3){function AbstractMaskSystem2(renderer){System3.call(this,renderer);this.maskStack=[];this.glConst=0}if(System3)AbstractMaskSystem2.__proto__=System3;AbstractMaskSystem2.prototype=Object.create(System3&&System3.prototype);AbstractMaskSystem2.prototype.constructor=AbstractMaskSystem2;AbstractMaskSystem2.prototype.getStackLength=function getStackLength(){return this.maskStack.length};AbstractMaskSystem2.prototype.setMaskStack=function setMaskStack(maskStack){var ref=this.renderer;var gl=ref.gl;var curStackLen=this.getStackLength();this.maskStack=maskStack;var newStackLen=this.getStackLength();if(newStackLen!==curStackLen){if(newStackLen===0){gl.disable(this.glConst)}else{gl.enable(this.glConst);this._useCurrent()}}};AbstractMaskSystem2.prototype._useCurrent=function _useCurrent(){};AbstractMaskSystem2.prototype.destroy=function destroy25(){System3.prototype.destroy.call(this,this);this.maskStack=null};return AbstractMaskSystem2}(System);var ScissorSystem=function(AbstractMaskSystem2){function ScissorSystem2(renderer){AbstractMaskSystem2.call(this,renderer);this.glConst=WebGLRenderingContext.SCISSOR_TEST}if(AbstractMaskSystem2)ScissorSystem2.__proto__=AbstractMaskSystem2;ScissorSystem2.prototype=Object.create(AbstractMaskSystem2&&AbstractMaskSystem2.prototype);ScissorSystem2.prototype.constructor=ScissorSystem2;ScissorSystem2.prototype.getStackLength=function getStackLength(){var maskData=this.maskStack[this.maskStack.length-1];if(maskData){return maskData._scissorCounter}return 0};ScissorSystem2.prototype.push=function push(maskData){var maskObject=maskData.maskObject;maskObject.renderable=true;var prevData=maskData._scissorRect;var bounds=maskObject.getBounds(true);var ref=this.renderer;var gl=ref.gl;maskObject.renderable=false;if(prevData){bounds.fit(prevData)}else{gl.enable(gl.SCISSOR_TEST)}maskData._scissorCounter++;maskData._scissorRect=bounds;this._useCurrent()};ScissorSystem2.prototype.pop=function pop(){var ref=this.renderer;var gl=ref.gl;if(this.getStackLength()>0){this._useCurrent()}else{gl.disable(gl.SCISSOR_TEST)}};ScissorSystem2.prototype._useCurrent=function _useCurrent(){var rect=this.maskStack[this.maskStack.length-1]._scissorRect;var rt=this.renderer.renderTexture.current;var ref=this.renderer.projection;var transform=ref.transform;var sourceFrame=ref.sourceFrame;var destinationFrame=ref.destinationFrame;var resolution=rt?rt.resolution:this.renderer.resolution;var x=(rect.x-sourceFrame.x)*resolution+destinationFrame.x;var y=(rect.y-sourceFrame.y)*resolution+destinationFrame.y;var width=rect.width*resolution;var height=rect.height*resolution;if(transform){x+=transform.tx*resolution;y+=transform.ty*resolution}if(!rt){y=this.renderer.height-height-y}this.renderer.gl.scissor(x,y,width,height)};return ScissorSystem2}(AbstractMaskSystem);var StencilSystem=function(AbstractMaskSystem2){function StencilSystem2(renderer){AbstractMaskSystem2.call(this,renderer);this.glConst=WebGLRenderingContext.STENCIL_TEST}if(AbstractMaskSystem2)StencilSystem2.__proto__=AbstractMaskSystem2;StencilSystem2.prototype=Object.create(AbstractMaskSystem2&&AbstractMaskSystem2.prototype);StencilSystem2.prototype.constructor=StencilSystem2;StencilSystem2.prototype.getStackLength=function getStackLength(){var maskData=this.maskStack[this.maskStack.length-1];if(maskData){return maskData._stencilCounter}return 0};StencilSystem2.prototype.push=function push(maskData){var maskObject=maskData.maskObject;var ref=this.renderer;var gl=ref.gl;var prevMaskCount=maskData._stencilCounter;if(prevMaskCount===0){this.renderer.framebuffer.forceStencil();gl.enable(gl.STENCIL_TEST)}maskData._stencilCounter++;gl.colorMask(false,false,false,false);gl.stencilFunc(gl.EQUAL,prevMaskCount,this._getBitwiseMask());gl.stencilOp(gl.KEEP,gl.KEEP,gl.INCR);maskObject.renderable=true;maskObject.render(this.renderer);this.renderer.batch.flush();maskObject.renderable=false;this._useCurrent()};StencilSystem2.prototype.pop=function pop(maskObject){var gl=this.renderer.gl;if(this.getStackLength()===0){gl.disable(gl.STENCIL_TEST);gl.clear(gl.STENCIL_BUFFER_BIT);gl.clearStencil(0)}else{gl.colorMask(false,false,false,false);gl.stencilOp(gl.KEEP,gl.KEEP,gl.DECR);maskObject.renderable=true;maskObject.render(this.renderer);this.renderer.batch.flush();maskObject.renderable=false;this._useCurrent()}};StencilSystem2.prototype._useCurrent=function _useCurrent(){var gl=this.renderer.gl;gl.colorMask(true,true,true,true);gl.stencilFunc(gl.EQUAL,this.getStackLength(),this._getBitwiseMask());gl.stencilOp(gl.KEEP,gl.KEEP,gl.KEEP)};StencilSystem2.prototype._getBitwiseMask=function _getBitwiseMask(){return(1<<this.getStackLength())-1};return StencilSystem2}(AbstractMaskSystem);var ProjectionSystem=function(System3){function ProjectionSystem2(renderer){System3.call(this,renderer);this.destinationFrame=null;this.sourceFrame=null;this.defaultFrame=null;this.projectionMatrix=new Matrix;this.transform=null}if(System3)ProjectionSystem2.__proto__=System3;ProjectionSystem2.prototype=Object.create(System3&&System3.prototype);ProjectionSystem2.prototype.constructor=ProjectionSystem2;ProjectionSystem2.prototype.update=function update7(destinationFrame,sourceFrame,resolution,root){this.destinationFrame=destinationFrame||this.destinationFrame||this.defaultFrame;this.sourceFrame=sourceFrame||this.sourceFrame||destinationFrame;this.calculateProjection(this.destinationFrame,this.sourceFrame,resolution,root);if(this.transform){this.projectionMatrix.append(this.transform)}var renderer=this.renderer;renderer.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix;renderer.globalUniforms.update();if(renderer.shader.shader){renderer.shader.syncUniformGroup(renderer.shader.shader.uniforms.globals)}};ProjectionSystem2.prototype.calculateProjection=function calculateProjection(destinationFrame,sourceFrame,resolution,root){var pm=this.projectionMatrix;if(!root){pm.a=1/destinationFrame.width*2*resolution;pm.d=1/destinationFrame.height*2*resolution;pm.tx=-1-sourceFrame.x*pm.a;pm.ty=-1-sourceFrame.y*pm.d}else{pm.a=1/destinationFrame.width*2*resolution;pm.d=-1/destinationFrame.height*2*resolution;pm.tx=-1-sourceFrame.x*pm.a;pm.ty=1-sourceFrame.y*pm.d}};ProjectionSystem2.prototype.setTransform=function setTransform(){};return ProjectionSystem2}(System);var tempRect=new Rectangle;var RenderTextureSystem=function(System3){function RenderTextureSystem2(renderer){System3.call(this,renderer);this.clearColor=renderer._backgroundColorRgba;this.defaultMaskStack=[];this.current=null;this.sourceFrame=new Rectangle;this.destinationFrame=new Rectangle}if(System3)RenderTextureSystem2.__proto__=System3;RenderTextureSystem2.prototype=Object.create(System3&&System3.prototype);RenderTextureSystem2.prototype.constructor=RenderTextureSystem2;RenderTextureSystem2.prototype.bind=function bind2(renderTexture,sourceFrame,destinationFrame){if(renderTexture===void 0)renderTexture=null;this.current=renderTexture;var renderer=this.renderer;var resolution;if(renderTexture){var baseTexture=renderTexture.baseTexture;resolution=baseTexture.resolution;if(!destinationFrame){tempRect.width=baseTexture.realWidth;tempRect.height=baseTexture.realHeight;destinationFrame=tempRect}if(!sourceFrame){sourceFrame=destinationFrame}this.renderer.framebuffer.bind(baseTexture.framebuffer,destinationFrame);this.renderer.projection.update(destinationFrame,sourceFrame,resolution,false);this.renderer.mask.setMaskStack(baseTexture.maskStack)}else{resolution=this.renderer.resolution;if(!destinationFrame){tempRect.width=renderer.width;tempRect.height=renderer.height;destinationFrame=tempRect}if(!sourceFrame){sourceFrame=destinationFrame}renderer.framebuffer.bind(null,destinationFrame);this.renderer.projection.update(destinationFrame,sourceFrame,resolution,true);this.renderer.mask.setMaskStack(this.defaultMaskStack)}this.sourceFrame.copyFrom(sourceFrame);this.destinationFrame.x=destinationFrame.x/resolution;this.destinationFrame.y=destinationFrame.y/resolution;this.destinationFrame.width=destinationFrame.width/resolution;this.destinationFrame.height=destinationFrame.height/resolution;if(sourceFrame===destinationFrame){this.sourceFrame.copyFrom(this.destinationFrame)}};RenderTextureSystem2.prototype.clear=function clear5(clearColor){if(this.current){clearColor=clearColor||this.current.baseTexture.clearColor}else{clearColor=clearColor||this.clearColor}this.renderer.framebuffer.clear(clearColor[0],clearColor[1],clearColor[2],clearColor[3])};RenderTextureSystem2.prototype.resize=function resize3(){this.bind(null)};RenderTextureSystem2.prototype.reset=function reset7(){this.bind(null)};return RenderTextureSystem2}(System);var GLProgram=function GLProgram2(program,uniformData){this.program=program;this.uniformData=uniformData;this.uniformGroups={}};GLProgram.prototype.destroy=function destroy9(){this.uniformData=null;this.uniformGroups=null;this.program=null};var UID$4=0;var defaultSyncData={textureCount:0};var ShaderSystem=function(System3){function ShaderSystem2(renderer){System3.call(this,renderer);this.systemCheck();this.gl=null;this.shader=null;this.program=null;this.cache={};this.id=UID$4++}if(System3)ShaderSystem2.__proto__=System3;ShaderSystem2.prototype=Object.create(System3&&System3.prototype);ShaderSystem2.prototype.constructor=ShaderSystem2;ShaderSystem2.prototype.systemCheck=function systemCheck(){if(!unsafeEvalSupported()){throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}};ShaderSystem2.prototype.contextChange=function contextChange(gl){this.gl=gl;this.reset()};ShaderSystem2.prototype.bind=function bind2(shader,dontSync){shader.uniforms.globals=this.renderer.globalUniforms;var program=shader.program;var glProgram=program.glPrograms[this.renderer.CONTEXT_UID]||this.generateShader(shader);this.shader=shader;if(this.program!==program){this.program=program;this.gl.useProgram(glProgram.program)}if(!dontSync){defaultSyncData.textureCount=0;this.syncUniformGroup(shader.uniformGroup,defaultSyncData)}return glProgram};ShaderSystem2.prototype.setUniforms=function setUniforms(uniforms){var shader=this.shader.program;var glProgram=shader.glPrograms[this.renderer.CONTEXT_UID];shader.syncUniforms(glProgram.uniformData,uniforms,this.renderer)};ShaderSystem2.prototype.syncUniformGroup=function syncUniformGroup(group,syncData){var glProgram=this.getglProgram();if(!group.static||group.dirtyId!==glProgram.uniformGroups[group.id]){glProgram.uniformGroups[group.id]=group.dirtyId;this.syncUniforms(group,glProgram,syncData)}};ShaderSystem2.prototype.syncUniforms=function syncUniforms(group,glProgram,syncData){var syncFunc=group.syncUniforms[this.shader.program.id]||this.createSyncGroups(group);syncFunc(glProgram.uniformData,group.uniforms,this.renderer,syncData)};ShaderSystem2.prototype.createSyncGroups=function createSyncGroups(group){var id=this.getSignature(group,this.shader.program.uniformData);if(!this.cache[id]){this.cache[id]=generateUniformsSync(group,this.shader.program.uniformData)}group.syncUniforms[this.shader.program.id]=this.cache[id];return group.syncUniforms[this.shader.program.id]};ShaderSystem2.prototype.getSignature=function getSignature(group,uniformData){var uniforms=group.uniforms;var strings=[];for(var i in uniforms){strings.push(i);if(uniformData[i]){strings.push(uniformData[i].type)}}return strings.join("-")};ShaderSystem2.prototype.getglProgram=function getglProgram(){if(this.shader){return this.shader.program.glPrograms[this.renderer.CONTEXT_UID]}return null};ShaderSystem2.prototype.generateShader=function generateShader2(shader){var gl=this.gl;var program=shader.program;var attribMap={};for(var i in program.attributeData){attribMap[i]=program.attributeData[i].location}var shaderProgram=compileProgram(gl,program.vertexSrc,program.fragmentSrc,attribMap);var uniformData={};for(var i$1 in program.uniformData){var data=program.uniformData[i$1];uniformData[i$1]={location:gl.getUniformLocation(shaderProgram,i$1),value:defaultValue(data.type,data.size)}}var glProgram=new GLProgram(shaderProgram,uniformData);program.glPrograms[this.renderer.CONTEXT_UID]=glProgram;return glProgram};ShaderSystem2.prototype.reset=function reset7(){this.program=null;this.shader=null};ShaderSystem2.prototype.destroy=function destroy25(){this.destroyed=true};return ShaderSystem2}(System);function mapWebGLBlendModesToPixi(gl,array){if(array===void 0)array=[];array[BLEND_MODES.NORMAL]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[BLEND_MODES.ADD]=[gl.ONE,gl.ONE];array[BLEND_MODES.MULTIPLY]=[gl.DST_COLOR,gl.ONE_MINUS_SRC_ALPHA,gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[BLEND_MODES.SCREEN]=[gl.ONE,gl.ONE_MINUS_SRC_COLOR,gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[BLEND_MODES.OVERLAY]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[BLEND_MODES.DARKEN]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[BLEND_MODES.LIGHTEN]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[BLEND_MODES.COLOR_DODGE]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[BLEND_MODES.COLOR_BURN]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[BLEND_MODES.HARD_LIGHT]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[BLEND_MODES.SOFT_LIGHT]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[BLEND_MODES.DIFFERENCE]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[BLEND_MODES.EXCLUSION]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[BLEND_MODES.HUE]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[BLEND_MODES.SATURATION]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[BLEND_MODES.COLOR]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[BLEND_MODES.LUMINOSITY]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[BLEND_MODES.NONE]=[0,0];array[BLEND_MODES.NORMAL_NPM]=[gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA,gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[BLEND_MODES.ADD_NPM]=[gl.SRC_ALPHA,gl.ONE,gl.ONE,gl.ONE];array[BLEND_MODES.SCREEN_NPM]=[gl.SRC_ALPHA,gl.ONE_MINUS_SRC_COLOR,gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[BLEND_MODES.SRC_IN]=[gl.DST_ALPHA,gl.ZERO];array[BLEND_MODES.SRC_OUT]=[gl.ONE_MINUS_DST_ALPHA,gl.ZERO];array[BLEND_MODES.SRC_ATOP]=[gl.DST_ALPHA,gl.ONE_MINUS_SRC_ALPHA];array[BLEND_MODES.DST_OVER]=[gl.ONE_MINUS_DST_ALPHA,gl.ONE];array[BLEND_MODES.DST_IN]=[gl.ZERO,gl.SRC_ALPHA];array[BLEND_MODES.DST_OUT]=[gl.ZERO,gl.ONE_MINUS_SRC_ALPHA];array[BLEND_MODES.DST_ATOP]=[gl.ONE_MINUS_DST_ALPHA,gl.SRC_ALPHA];array[BLEND_MODES.XOR]=[gl.ONE_MINUS_DST_ALPHA,gl.ONE_MINUS_SRC_ALPHA];array[BLEND_MODES.SUBTRACT]=[gl.ONE,gl.ONE,gl.ONE,gl.ONE,gl.FUNC_REVERSE_SUBTRACT,gl.FUNC_ADD];return array}var BLEND$1=0;var OFFSET$1=1;var CULLING$1=2;var DEPTH_TEST$1=3;var WINDING$1=4;var StateSystem=function(System3){function StateSystem2(renderer){System3.call(this,renderer);this.gl=null;this.stateId=0;this.polygonOffset=0;this.blendMode=BLEND_MODES.NONE;this._blendEq=false;this.map=[];this.map[BLEND$1]=this.setBlend;this.map[OFFSET$1]=this.setOffset;this.map[CULLING$1]=this.setCullFace;this.map[DEPTH_TEST$1]=this.setDepthTest;this.map[WINDING$1]=this.setFrontFace;this.checks=[];this.defaultState=new State;this.defaultState.blend=true;this.defaultState.depth=true}if(System3)StateSystem2.__proto__=System3;StateSystem2.prototype=Object.create(System3&&System3.prototype);StateSystem2.prototype.constructor=StateSystem2;StateSystem2.prototype.contextChange=function contextChange(gl){this.gl=gl;this.blendModes=mapWebGLBlendModesToPixi(gl);this.set(this.defaultState);this.reset()};StateSystem2.prototype.set=function set4(state){state=state||this.defaultState;if(this.stateId!==state.data){var diff=this.stateId^state.data;var i=0;while(diff){if(diff&1){this.map[i].call(this,!!(state.data&1<<i))}diff=diff>>1;i++}this.stateId=state.data}for(var i$1=0;i$1<this.checks.length;i$1++){this.checks[i$1](this,state)}};StateSystem2.prototype.forceState=function forceState(state){state=state||this.defaultState;for(var i=0;i<this.map.length;i++){this.map[i].call(this,!!(state.data&1<<i))}for(var i$1=0;i$1<this.checks.length;i$1++){this.checks[i$1](this,state)}this.stateId=state.data};StateSystem2.prototype.setBlend=function setBlend(value){this.updateCheck(StateSystem2.checkBlendMode,value);this.gl[value?"enable":"disable"](this.gl.BLEND)};StateSystem2.prototype.setOffset=function setOffset(value){this.updateCheck(StateSystem2.checkPolygonOffset,value);this.gl[value?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)};StateSystem2.prototype.setDepthTest=function setDepthTest(value){this.gl[value?"enable":"disable"](this.gl.DEPTH_TEST)};StateSystem2.prototype.setCullFace=function setCullFace(value){this.gl[value?"enable":"disable"](this.gl.CULL_FACE)};StateSystem2.prototype.setFrontFace=function setFrontFace(value){this.gl.frontFace(this.gl[value?"CW":"CCW"])};StateSystem2.prototype.setBlendMode=function setBlendMode(value){if(value===this.blendMode){return}this.blendMode=value;var mode=this.blendModes[value];var gl=this.gl;if(mode.length===2){gl.blendFunc(mode[0],mode[1])}else{gl.blendFuncSeparate(mode[0],mode[1],mode[2],mode[3])}if(mode.length===6){this._blendEq=true;gl.blendEquationSeparate(mode[4],mode[5])}else if(this._blendEq){this._blendEq=false;gl.blendEquationSeparate(gl.FUNC_ADD,gl.FUNC_ADD)}};StateSystem2.prototype.setPolygonOffset=function setPolygonOffset(value,scale){this.gl.polygonOffset(value,scale)};StateSystem2.prototype.reset=function reset7(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,false);this.forceState(0);this._blendEq=true;this.blendMode=-1;this.setBlendMode(0)};StateSystem2.prototype.updateCheck=function updateCheck(func,value){var index3=this.checks.indexOf(func);if(value&&index3===-1){this.checks.push(func)}else if(!value&&index3!==-1){this.checks.splice(index3,1)}};StateSystem2.checkBlendMode=function checkBlendMode(system,state){system.setBlendMode(state.blendMode)};StateSystem2.checkPolygonOffset=function checkPolygonOffset(system,state){system.setPolygonOffset(state.polygonOffset,0)};return StateSystem2}(System);var TextureGCSystem=function(System3){function TextureGCSystem2(renderer){System3.call(this,renderer);this.count=0;this.checkCount=0;this.maxIdle=settings.GC_MAX_IDLE;this.checkCountMax=settings.GC_MAX_CHECK_COUNT;this.mode=settings.GC_MODE}if(System3)TextureGCSystem2.__proto__=System3;TextureGCSystem2.prototype=Object.create(System3&&System3.prototype);TextureGCSystem2.prototype.constructor=TextureGCSystem2;TextureGCSystem2.prototype.postrender=function postrender(){if(!this.renderer.renderingToScreen){return}this.count++;if(this.mode===GC_MODES.MANUAL){return}this.checkCount++;if(this.checkCount>this.checkCountMax){this.checkCount=0;this.run()}};TextureGCSystem2.prototype.run=function run(){var tm=this.renderer.texture;var managedTextures=tm.managedTextures;var wasRemoved=false;for(var i=0;i<managedTextures.length;i++){var texture=managedTextures[i];if(!texture.framebuffer&&this.count-texture.touched>this.maxIdle){tm.destroyTexture(texture,true);managedTextures[i]=null;wasRemoved=true}}if(wasRemoved){var j=0;for(var i$1=0;i$1<managedTextures.length;i$1++){if(managedTextures[i$1]!==null){managedTextures[j++]=managedTextures[i$1]}}managedTextures.length=j}};TextureGCSystem2.prototype.unload=function unload(displayObject){var tm=this.renderer.textureSystem;if(displayObject._texture&&displayObject._texture._glRenderTargets){tm.destroyTexture(displayObject._texture)}for(var i=displayObject.children.length-1;i>=0;i--){this.unload(displayObject.children[i])}};return TextureGCSystem2}(System);var GLTexture=function GLTexture2(texture){this.texture=texture;this.width=-1;this.height=-1;this.dirtyId=-1;this.dirtyStyleId=-1;this.mipmap=false;this.wrapMode=33071;this.type=6408;this.internalFormat=5121};var TextureSystem=function(System3){function TextureSystem2(renderer){System3.call(this,renderer);this.boundTextures=[];this.currentLocation=-1;this.managedTextures=[];this._unknownBoundTextures=false;this.unknownTexture=new BaseTexture}if(System3)TextureSystem2.__proto__=System3;TextureSystem2.prototype=Object.create(System3&&System3.prototype);TextureSystem2.prototype.constructor=TextureSystem2;TextureSystem2.prototype.contextChange=function contextChange(){var gl=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID;this.webGLVersion=this.renderer.context.webGLVersion;var maxTextures=gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=maxTextures;for(var i=0;i<maxTextures;i++){this.boundTextures[i]=null}this.emptyTextures={};var emptyTexture2D=new GLTexture(gl.createTexture());gl.bindTexture(gl.TEXTURE_2D,emptyTexture2D.texture);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,1,1,0,gl.RGBA,gl.UNSIGNED_BYTE,new Uint8Array(4));this.emptyTextures[gl.TEXTURE_2D]=emptyTexture2D;this.emptyTextures[gl.TEXTURE_CUBE_MAP]=new GLTexture(gl.createTexture());gl.bindTexture(gl.TEXTURE_CUBE_MAP,this.emptyTextures[gl.TEXTURE_CUBE_MAP].texture);for(var i$1=0;i$1<6;i$1++){gl.texImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X+i$1,0,gl.RGBA,1,1,0,gl.RGBA,gl.UNSIGNED_BYTE,null)}gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_MAG_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_MIN_FILTER,gl.LINEAR);for(var i$2=0;i$2<this.boundTextures.length;i$2++){this.bind(null,i$2)}};TextureSystem2.prototype.bind=function bind2(texture,location2){if(location2===void 0)location2=0;var ref=this;var gl=ref.gl;if(texture){texture=texture.baseTexture||texture;if(texture.valid){texture.touched=this.renderer.textureGC.count;var glTexture=texture._glTextures[this.CONTEXT_UID]||this.initTexture(texture);if(this.boundTextures[location2]!==texture){if(this.currentLocation!==location2){this.currentLocation=location2;gl.activeTexture(gl.TEXTURE0+location2)}gl.bindTexture(texture.target,glTexture.texture)}if(glTexture.dirtyId!==texture.dirtyId){if(this.currentLocation!==location2){this.currentLocation=location2;gl.activeTexture(gl.TEXTURE0+location2)}this.updateTexture(texture)}this.boundTextures[location2]=texture}}else{if(this.currentLocation!==location2){this.currentLocation=location2;gl.activeTexture(gl.TEXTURE0+location2)}gl.bindTexture(gl.TEXTURE_2D,this.emptyTextures[gl.TEXTURE_2D].texture);this.boundTextures[location2]=null}};TextureSystem2.prototype.reset=function reset7(){this._unknownBoundTextures=true;this.currentLocation=-1;for(var i=0;i<this.boundTextures.length;i++){this.boundTextures[i]=this.unknownTexture}};TextureSystem2.prototype.unbind=function unbind2(texture){var ref=this;var gl=ref.gl;var boundTextures=ref.boundTextures;if(this._unknownBoundTextures){this._unknownBoundTextures=false;for(var i=0;i<boundTextures.length;i++){if(boundTextures[i]===this.unknownTexture){this.bind(null,i)}}}for(var i$1=0;i$1<boundTextures.length;i$1++){if(boundTextures[i$1]===texture){if(this.currentLocation!==i$1){gl.activeTexture(gl.TEXTURE0+i$1);this.currentLocation=i$1}gl.bindTexture(gl.TEXTURE_2D,this.emptyTextures[texture.target].texture);boundTextures[i$1]=null}}};TextureSystem2.prototype.initTexture=function initTexture(texture){var glTexture=new GLTexture(this.gl.createTexture());glTexture.dirtyId=-1;texture._glTextures[this.CONTEXT_UID]=glTexture;this.managedTextures.push(texture);texture.on("dispose",this.destroyTexture,this);return glTexture};TextureSystem2.prototype.initTextureType=function initTextureType(texture,glTexture){glTexture.internalFormat=texture.format;glTexture.type=texture.type;if(this.webGLVersion!==2){return}var gl=this.renderer.gl;if(texture.type===gl.FLOAT&&texture.format===gl.RGBA){glTexture.internalFormat=gl.RGBA32F}if(texture.type===TYPES.HALF_FLOAT){glTexture.type=gl.HALF_FLOAT}if(glTexture.type===gl.HALF_FLOAT&&texture.format===gl.RGBA){glTexture.internalFormat=gl.RGBA16F}};TextureSystem2.prototype.updateTexture=function updateTexture(texture){var glTexture=texture._glTextures[this.CONTEXT_UID];if(!glTexture){return}var renderer=this.renderer;this.initTextureType(texture,glTexture);if(texture.resource&&texture.resource.upload(renderer,texture,glTexture));else{var width=texture.realWidth;var height=texture.realHeight;var gl=renderer.gl;if(glTexture.width!==width||glTexture.height!==height||glTexture.dirtyId<0){glTexture.width=width;glTexture.height=height;gl.texImage2D(texture.target,0,glTexture.internalFormat,width,height,0,texture.format,glTexture.type,null)}}if(texture.dirtyStyleId!==glTexture.dirtyStyleId){this.updateTextureStyle(texture)}glTexture.dirtyId=texture.dirtyId};TextureSystem2.prototype.destroyTexture=function destroyTexture(texture,skipRemove){var ref=this;var gl=ref.gl;texture=texture.baseTexture||texture;if(texture._glTextures[this.CONTEXT_UID]){this.unbind(texture);gl.deleteTexture(texture._glTextures[this.CONTEXT_UID].texture);texture.off("dispose",this.destroyTexture,this);delete texture._glTextures[this.CONTEXT_UID];if(!skipRemove){var i=this.managedTextures.indexOf(texture);if(i!==-1){_removeItems(this.managedTextures,i,1)}}}};TextureSystem2.prototype.updateTextureStyle=function updateTextureStyle(texture){var glTexture=texture._glTextures[this.CONTEXT_UID];if(!glTexture){return}if((texture.mipmap===MIPMAP_MODES.POW2||this.webGLVersion!==2)&&!texture.isPowerOfTwo){glTexture.mipmap=0}else{glTexture.mipmap=texture.mipmap>=1}if(this.webGLVersion!==2&&!texture.isPowerOfTwo){glTexture.wrapMode=WRAP_MODES.CLAMP}else{glTexture.wrapMode=texture.wrapMode}if(texture.resource&&texture.resource.style(this.renderer,texture,glTexture));else{this.setStyle(texture,glTexture)}glTexture.dirtyStyleId=texture.dirtyStyleId};TextureSystem2.prototype.setStyle=function setStyle(texture,glTexture){var gl=this.gl;if(glTexture.mipmap){gl.generateMipmap(texture.target)}gl.texParameteri(texture.target,gl.TEXTURE_WRAP_S,glTexture.wrapMode);gl.texParameteri(texture.target,gl.TEXTURE_WRAP_T,glTexture.wrapMode);if(glTexture.mipmap){gl.texParameteri(texture.target,gl.TEXTURE_MIN_FILTER,texture.scaleMode===SCALE_MODES.LINEAR?gl.LINEAR_MIPMAP_LINEAR:gl.NEAREST_MIPMAP_NEAREST);var anisotropicExt=this.renderer.context.extensions.anisotropicFiltering;if(anisotropicExt&&texture.anisotropicLevel>0&&texture.scaleMode===SCALE_MODES.LINEAR){var level=Math.min(texture.anisotropicLevel,gl.getParameter(anisotropicExt.MAX_TEXTURE_MAX_ANISOTROPY_EXT));gl.texParameterf(texture.target,anisotropicExt.TEXTURE_MAX_ANISOTROPY_EXT,level)}}else{gl.texParameteri(texture.target,gl.TEXTURE_MIN_FILTER,texture.scaleMode===SCALE_MODES.LINEAR?gl.LINEAR:gl.NEAREST)}gl.texParameteri(texture.target,gl.TEXTURE_MAG_FILTER,texture.scaleMode===SCALE_MODES.LINEAR?gl.LINEAR:gl.NEAREST)};return TextureSystem2}(System);var tempMatrix=new Matrix;var AbstractRenderer=function(EventEmitter){function AbstractRenderer2(system,options){EventEmitter.call(this);options=Object.assign({},settings.RENDER_OPTIONS,options);if(options.roundPixels){settings.ROUND_PIXELS=options.roundPixels;_deprecation("5.0.0","Renderer roundPixels option is deprecated, please use PIXI.settings.ROUND_PIXELS",2)}this.options=options;this.type=RENDERER_TYPE.UNKNOWN;this.screen=new Rectangle(0,0,options.width,options.height);this.view=options.view||document.createElement("canvas");this.resolution=options.resolution||settings.RESOLUTION;this.transparent=options.transparent;this.autoDensity=options.autoDensity||options.autoResize||false;this.preserveDrawingBuffer=options.preserveDrawingBuffer;this.clearBeforeRender=options.clearBeforeRender;this._backgroundColor=0;this._backgroundColorRgba=[0,0,0,0];this._backgroundColorString="#000000";this.backgroundColor=options.backgroundColor||this._backgroundColor;this._tempDisplayObjectParent=new Container;this._lastObjectRendered=this._tempDisplayObjectParent;this.plugins={}}if(EventEmitter)AbstractRenderer2.__proto__=EventEmitter;AbstractRenderer2.prototype=Object.create(EventEmitter&&EventEmitter.prototype);AbstractRenderer2.prototype.constructor=AbstractRenderer2;var prototypeAccessors5={width:{configurable:true},height:{configurable:true},backgroundColor:{configurable:true}};AbstractRenderer2.prototype.initPlugins=function initPlugins(staticMap){for(var o in staticMap){this.plugins[o]=new staticMap[o](this)}};prototypeAccessors5.width.get=function(){return this.view.width};prototypeAccessors5.height.get=function(){return this.view.height};AbstractRenderer2.prototype.resize=function resize3(screenWidth,screenHeight){this.screen.width=screenWidth;this.screen.height=screenHeight;this.view.width=screenWidth*this.resolution;this.view.height=screenHeight*this.resolution;if(this.autoDensity){this.view.style.width=screenWidth+"px";this.view.style.height=screenHeight+"px"}};AbstractRenderer2.prototype.generateTexture=function generateTexture(displayObject,scaleMode,resolution,region){region=region||displayObject.getLocalBounds();if(region.width===0){region.width=1}if(region.height===0){region.height=1}var renderTexture=RenderTexture.create({width:region.width|0,height:region.height|0,scaleMode:scaleMode,resolution:resolution});tempMatrix.tx=-region.x;tempMatrix.ty=-region.y;this.render(displayObject,renderTexture,false,tempMatrix,!!displayObject.parent);return renderTexture};AbstractRenderer2.prototype.destroy=function destroy25(removeView){for(var o in this.plugins){this.plugins[o].destroy();this.plugins[o]=null}if(removeView&&this.view.parentNode){this.view.parentNode.removeChild(this.view)}this.plugins=null;this.type=RENDERER_TYPE.UNKNOWN;this.view=null;this.screen=null;this.resolution=0;this.transparent=false;this.autoDensity=false;this.blendModes=null;this.options=null;this.preserveDrawingBuffer=false;this.clearBeforeRender=false;this._backgroundColor=0;this._backgroundColorRgba=null;this._backgroundColorString=null;this._tempDisplayObjectParent=null;this._lastObjectRendered=null};prototypeAccessors5.backgroundColor.get=function(){return this._backgroundColor};prototypeAccessors5.backgroundColor.set=function(value){this._backgroundColor=value;this._backgroundColorString=_hex2string(value);_hex2rgb(value,this._backgroundColorRgba)};Object.defineProperties(AbstractRenderer2.prototype,prototypeAccessors5);return AbstractRenderer2}(import_eventemitter3.default);var Renderer=function(AbstractRenderer2){function Renderer2(options){if(options===void 0)options={};AbstractRenderer2.call(this,"WebGL",options);options=this.options;this.type=RENDERER_TYPE.WEBGL;this.gl=null;this.CONTEXT_UID=0;this.runners={destroy:new Runner("destroy"),contextChange:new Runner("contextChange",1),reset:new Runner("reset"),update:new Runner("update"),postrender:new Runner("postrender"),prerender:new Runner("prerender"),resize:new Runner("resize",2)};this.globalUniforms=new UniformGroup({projectionMatrix:new Matrix},true);this.addSystem(MaskSystem,"mask").addSystem(ContextSystem,"context").addSystem(StateSystem,"state").addSystem(ShaderSystem,"shader").addSystem(TextureSystem,"texture").addSystem(GeometrySystem,"geometry").addSystem(FramebufferSystem,"framebuffer").addSystem(ScissorSystem,"scissor").addSystem(StencilSystem,"stencil").addSystem(ProjectionSystem,"projection").addSystem(TextureGCSystem,"textureGC").addSystem(FilterSystem,"filter").addSystem(RenderTextureSystem,"renderTexture").addSystem(BatchSystem,"batch");this.initPlugins(Renderer2.__plugins);if(options.context){this.context.initFromContext(options.context)}else{this.context.initFromOptions({alpha:this.transparent,antialias:options.antialias,premultipliedAlpha:this.transparent&&this.transparent!=="notMultiplied",stencil:true,preserveDrawingBuffer:options.preserveDrawingBuffer,powerPreference:this.options.powerPreference})}this.renderingToScreen=true;_sayHello(this.context.webGLVersion===2?"WebGL 2":"WebGL 1");this.resize(this.options.width,this.options.height)}if(AbstractRenderer2)Renderer2.__proto__=AbstractRenderer2;Renderer2.prototype=Object.create(AbstractRenderer2&&AbstractRenderer2.prototype);Renderer2.prototype.constructor=Renderer2;Renderer2.create=function create3(options){if(_isWebGLSupported()){return new Renderer2(options)}throw new Error("WebGL unsupported in this browser, use \"pixi.js-legacy\" for fallback canvas2d support.")};Renderer2.prototype.addSystem=function addSystem(ClassRef,name){if(!name){name=ClassRef.name}var system=new ClassRef(this);if(this[name]){throw new Error("Whoops! The name \""+name+"\" is already in use")}this[name]=system;for(var i in this.runners){this.runners[i].add(system)}return this};Renderer2.prototype.render=function render6(displayObject,renderTexture,clear5,transform,skipUpdateTransform){this.renderingToScreen=!renderTexture;this.runners.prerender.run();this.emit("prerender");this.projection.transform=transform;if(this.context.isLost){return}if(!renderTexture){this._lastObjectRendered=displayObject}if(!skipUpdateTransform){var cacheParent=displayObject.parent;displayObject.parent=this._tempDisplayObjectParent;displayObject.updateTransform();displayObject.parent=cacheParent}this.renderTexture.bind(renderTexture);this.batch.currentRenderer.start();if(clear5!==void 0?clear5:this.clearBeforeRender){this.renderTexture.clear()}displayObject.render(this);this.batch.currentRenderer.flush();if(renderTexture){renderTexture.baseTexture.update()}this.runners.postrender.run();this.projection.transform=null;this.emit("postrender")};Renderer2.prototype.resize=function resize3(screenWidth,screenHeight){AbstractRenderer2.prototype.resize.call(this,screenWidth,screenHeight);this.runners.resize.run(screenWidth,screenHeight)};Renderer2.prototype.reset=function reset7(){this.runners.reset.run();return this};Renderer2.prototype.clear=function clear5(){this.framebuffer.bind();this.framebuffer.clear()};Renderer2.prototype.destroy=function destroy25(removeView){this.runners.destroy.run();for(var r in this.runners){this.runners[r].destroy()}AbstractRenderer2.prototype.destroy.call(this,removeView);this.gl=null};Renderer2.registerPlugin=function registerPlugin3(pluginName,ctor){Renderer2.__plugins=Renderer2.__plugins||{};Renderer2.__plugins[pluginName]=ctor};return Renderer2}(AbstractRenderer);function autoDetectRenderer(options){return Renderer.create(options)}var defaultFilter="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n";var BatchDrawCall=function BatchDrawCall2(){this.texArray=null;this.blend=0;this.type=DRAW_MODES.TRIANGLES;this.start=0;this.size=0;this.data=null};var BatchTextureArray=function BatchTextureArray2(){this.elements=[];this.ids=[];this.count=0};BatchTextureArray.prototype.clear=function clear4(){for(var i=0;i<this.count;i++){this.elements[i]=null}this.count=0};var ViewableBuffer=function ViewableBuffer2(size){this.rawBinaryData=new ArrayBuffer(size);this.uint32View=new Uint32Array(this.rawBinaryData);this.float32View=new Float32Array(this.rawBinaryData)};var prototypeAccessors$5={int8View:{configurable:true},uint8View:{configurable:true},int16View:{configurable:true},uint16View:{configurable:true},int32View:{configurable:true}};prototypeAccessors$5.int8View.get=function(){if(!this._int8View){this._int8View=new Int8Array(this.rawBinaryData)}return this._int8View};prototypeAccessors$5.uint8View.get=function(){if(!this._uint8View){this._uint8View=new Uint8Array(this.rawBinaryData)}return this._uint8View};prototypeAccessors$5.int16View.get=function(){if(!this._int16View){this._int16View=new Int16Array(this.rawBinaryData)}return this._int16View};prototypeAccessors$5.uint16View.get=function(){if(!this._uint16View){this._uint16View=new Uint16Array(this.rawBinaryData)}return this._uint16View};prototypeAccessors$5.int32View.get=function(){if(!this._int32View){this._int32View=new Int32Array(this.rawBinaryData)}return this._int32View};ViewableBuffer.prototype.view=function view(type){return this[type+"View"]};ViewableBuffer.prototype.destroy=function destroy10(){this.rawBinaryData=null;this._int8View=null;this._uint8View=null;this._int16View=null;this._uint16View=null;this._int32View=null;this.uint32View=null;this.float32View=null};ViewableBuffer.sizeOf=function sizeOf(type){switch(type){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(type+" isn't a valid view type");}};Object.defineProperties(ViewableBuffer.prototype,prototypeAccessors$5);var AbstractBatchRenderer=function(ObjectRenderer3){function AbstractBatchRenderer2(renderer){ObjectRenderer3.call(this,renderer);this.shaderGenerator=null;this.geometryClass=null;this.vertexSize=null;this.state=State.for2d();this.size=settings.SPRITE_BATCH_SIZE*4;this._vertexCount=0;this._indexCount=0;this._bufferedElements=[];this._bufferedTextures=[];this._bufferSize=0;this._shader=null;this._packedGeometries=[];this._packedGeometryPoolSize=2;this._flushId=0;this._aBuffers={};this._iBuffers={};this.MAX_TEXTURES=1;this.renderer.on("prerender",this.onPrerender,this);renderer.runners.contextChange.add(this);this._dcIndex=0;this._aIndex=0;this._iIndex=0;this._attributeBuffer=null;this._indexBuffer=null;this._tempBoundTextures=[]}if(ObjectRenderer3)AbstractBatchRenderer2.__proto__=ObjectRenderer3;AbstractBatchRenderer2.prototype=Object.create(ObjectRenderer3&&ObjectRenderer3.prototype);AbstractBatchRenderer2.prototype.constructor=AbstractBatchRenderer2;AbstractBatchRenderer2.prototype.contextChange=function contextChange(){var gl=this.renderer.gl;if(settings.PREFER_ENV===ENV.WEBGL_LEGACY){this.MAX_TEXTURES=1}else{this.MAX_TEXTURES=Math.min(gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS),settings.SPRITE_MAX_TEXTURES);this.MAX_TEXTURES=checkMaxIfStatementsInShader(this.MAX_TEXTURES,gl)}this._shader=this.shaderGenerator.generateShader(this.MAX_TEXTURES);for(var i=0;i<this._packedGeometryPoolSize;i++){this._packedGeometries[i]=new this.geometryClass}this.initFlushBuffers()};AbstractBatchRenderer2.prototype.initFlushBuffers=function initFlushBuffers(){var _drawCallPool=AbstractBatchRenderer2._drawCallPool;var _textureArrayPool=AbstractBatchRenderer2._textureArrayPool;var MAX_SPRITES=this.size/4;var MAX_TA=Math.floor(MAX_SPRITES/this.MAX_TEXTURES)+1;while(_drawCallPool.length<MAX_SPRITES){_drawCallPool.push(new BatchDrawCall)}while(_textureArrayPool.length<MAX_TA){_textureArrayPool.push(new BatchTextureArray)}for(var i=0;i<this.MAX_TEXTURES;i++){this._tempBoundTextures[i]=null}};AbstractBatchRenderer2.prototype.onPrerender=function onPrerender(){this._flushId=0};AbstractBatchRenderer2.prototype.render=function render6(element){if(!element._texture.valid){return}if(this._vertexCount+element.vertexData.length/2>this.size){this.flush()}this._vertexCount+=element.vertexData.length/2;this._indexCount+=element.indices.length;this._bufferedTextures[this._bufferSize]=element._texture.baseTexture;this._bufferedElements[this._bufferSize++]=element};AbstractBatchRenderer2.prototype.buildTexturesAndDrawCalls=function buildTexturesAndDrawCalls(){var ref=this;var textures=ref._bufferedTextures;var MAX_TEXTURES=ref.MAX_TEXTURES;var textureArrays=AbstractBatchRenderer2._textureArrayPool;var batch=this.renderer.batch;var boundTextures=this._tempBoundTextures;var touch=this.renderer.textureGC.count;var TICK=++BaseTexture._globalBatch;var countTexArrays=0;var texArray=textureArrays[0];var start2=0;batch.copyBoundTextures(boundTextures,MAX_TEXTURES);for(var i=0;i<this._bufferSize;++i){var tex=textures[i];textures[i]=null;if(tex._batchEnabled===TICK){continue}if(texArray.count>=MAX_TEXTURES){batch.boundArray(texArray,boundTextures,TICK,MAX_TEXTURES);this.buildDrawCalls(texArray,start2,i);start2=i;texArray=textureArrays[++countTexArrays];++TICK}tex._batchEnabled=TICK;tex.touched=touch;texArray.elements[texArray.count++]=tex}if(texArray.count>0){batch.boundArray(texArray,boundTextures,TICK,MAX_TEXTURES);this.buildDrawCalls(texArray,start2,this._bufferSize);++countTexArrays;++TICK}for(var i$1=0;i$1<boundTextures.length;i$1++){boundTextures[i$1]=null}BaseTexture._globalBatch=TICK};AbstractBatchRenderer2.prototype.buildDrawCalls=function buildDrawCalls(texArray,start2,finish){var ref=this;var elements=ref._bufferedElements;var _attributeBuffer=ref._attributeBuffer;var _indexBuffer=ref._indexBuffer;var vertexSize=ref.vertexSize;var drawCalls=AbstractBatchRenderer2._drawCallPool;var dcIndex=this._dcIndex;var aIndex=this._aIndex;var iIndex=this._iIndex;var drawCall=drawCalls[dcIndex];drawCall.start=this._iIndex;drawCall.texArray=texArray;for(var i=start2;i<finish;++i){var sprite=elements[i];var tex=sprite._texture.baseTexture;var spriteBlendMode=_premultiplyBlendMode[tex.alphaMode?1:0][sprite.blendMode];elements[i]=null;if(start2<i&&drawCall.blend!==spriteBlendMode){drawCall.size=iIndex-drawCall.start;start2=i;drawCall=drawCalls[++dcIndex];drawCall.texArray=texArray;drawCall.start=iIndex}this.packInterleavedGeometry(sprite,_attributeBuffer,_indexBuffer,aIndex,iIndex);aIndex+=sprite.vertexData.length/2*vertexSize;iIndex+=sprite.indices.length;drawCall.blend=spriteBlendMode}if(start2<finish){drawCall.size=iIndex-drawCall.start;++dcIndex}this._dcIndex=dcIndex;this._aIndex=aIndex;this._iIndex=iIndex};AbstractBatchRenderer2.prototype.bindAndClearTexArray=function bindAndClearTexArray(texArray){var textureSystem=this.renderer.texture;for(var j=0;j<texArray.count;j++){textureSystem.bind(texArray.elements[j],texArray.ids[j]);texArray.elements[j]=null}texArray.count=0};AbstractBatchRenderer2.prototype.updateGeometry=function updateGeometry(){var ref=this;var packedGeometries=ref._packedGeometries;var attributeBuffer=ref._attributeBuffer;var indexBuffer=ref._indexBuffer;if(!settings.CAN_UPLOAD_SAME_BUFFER){if(this._packedGeometryPoolSize<=this._flushId){this._packedGeometryPoolSize++;packedGeometries[this._flushId]=new this.geometryClass}packedGeometries[this._flushId]._buffer.update(attributeBuffer.rawBinaryData);packedGeometries[this._flushId]._indexBuffer.update(indexBuffer);this.renderer.geometry.bind(packedGeometries[this._flushId]);this.renderer.geometry.updateBuffers();this._flushId++}else{packedGeometries[this._flushId]._buffer.update(attributeBuffer.rawBinaryData);packedGeometries[this._flushId]._indexBuffer.update(indexBuffer);this.renderer.geometry.updateBuffers()}};AbstractBatchRenderer2.prototype.drawBatches=function drawBatches(){var dcCount=this._dcIndex;var ref=this.renderer;var gl=ref.gl;var stateSystem=ref.state;var drawCalls=AbstractBatchRenderer2._drawCallPool;var curTexArray=null;for(var i=0;i<dcCount;i++){var ref$1=drawCalls[i];var texArray=ref$1.texArray;var type=ref$1.type;var size=ref$1.size;var start2=ref$1.start;var blend=ref$1.blend;if(curTexArray!==texArray){curTexArray=texArray;this.bindAndClearTexArray(texArray)}this.state.blendMode=blend;stateSystem.set(this.state);gl.drawElements(type,size,gl.UNSIGNED_SHORT,start2*2)}};AbstractBatchRenderer2.prototype.flush=function flush2(){if(this._vertexCount===0){return}this._attributeBuffer=this.getAttributeBuffer(this._vertexCount);this._indexBuffer=this.getIndexBuffer(this._indexCount);this._aIndex=0;this._iIndex=0;this._dcIndex=0;this.buildTexturesAndDrawCalls();this.updateGeometry();this.drawBatches();this._bufferSize=0;this._vertexCount=0;this._indexCount=0};AbstractBatchRenderer2.prototype.start=function start2(){this.renderer.state.set(this.state);this.renderer.shader.bind(this._shader);if(settings.CAN_UPLOAD_SAME_BUFFER){this.renderer.geometry.bind(this._packedGeometries[this._flushId])}};AbstractBatchRenderer2.prototype.stop=function stop2(){this.flush()};AbstractBatchRenderer2.prototype.destroy=function destroy25(){for(var i=0;i<this._packedGeometryPoolSize;i++){if(this._packedGeometries[i]){this._packedGeometries[i].destroy()}}this.renderer.off("prerender",this.onPrerender,this);this._aBuffers=null;this._iBuffers=null;this._packedGeometries=null;this._attributeBuffer=null;this._indexBuffer=null;if(this._shader){this._shader.destroy();this._shader=null}ObjectRenderer3.prototype.destroy.call(this)};AbstractBatchRenderer2.prototype.getAttributeBuffer=function getAttributeBuffer(size){var roundedP2=_nextPow(Math.ceil(size/8));var roundedSizeIndex=_log(roundedP2);var roundedSize=roundedP2*8;if(this._aBuffers.length<=roundedSizeIndex){this._iBuffers.length=roundedSizeIndex+1}var buffer=this._aBuffers[roundedSize];if(!buffer){this._aBuffers[roundedSize]=buffer=new ViewableBuffer(roundedSize*this.vertexSize*4)}return buffer};AbstractBatchRenderer2.prototype.getIndexBuffer=function getIndexBuffer(size){var roundedP2=_nextPow(Math.ceil(size/12));var roundedSizeIndex=_log(roundedP2);var roundedSize=roundedP2*12;if(this._iBuffers.length<=roundedSizeIndex){this._iBuffers.length=roundedSizeIndex+1}var buffer=this._iBuffers[roundedSizeIndex];if(!buffer){this._iBuffers[roundedSizeIndex]=buffer=new Uint16Array(roundedSize)}return buffer};AbstractBatchRenderer2.prototype.packInterleavedGeometry=function packInterleavedGeometry(element,attributeBuffer,indexBuffer,aIndex,iIndex){var uint32View=attributeBuffer.uint32View;var float32View=attributeBuffer.float32View;var packedVertices=aIndex/this.vertexSize;var uvs=element.uvs;var indicies=element.indices;var vertexData=element.vertexData;var textureId=element._texture.baseTexture._batchLocation;var alpha=Math.min(element.worldAlpha,1);var argb=alpha<1&&element._texture.baseTexture.alphaMode?_premultiplyTint(element._tintRGB,alpha):element._tintRGB+(alpha*255<<24);for(var i=0;i<vertexData.length;i+=2){float32View[aIndex++]=vertexData[i];float32View[aIndex++]=vertexData[i+1];float32View[aIndex++]=uvs[i];float32View[aIndex++]=uvs[i+1];uint32View[aIndex++]=argb;float32View[aIndex++]=textureId}for(var i$1=0;i$1<indicies.length;i$1++){indexBuffer[iIndex++]=packedVertices+indicies[i$1]}};return AbstractBatchRenderer2}(ObjectRenderer);AbstractBatchRenderer._drawCallPool=[];AbstractBatchRenderer._textureArrayPool=[];var BatchShaderGenerator=function BatchShaderGenerator2(vertexSrc,fragTemplate3){this.vertexSrc=vertexSrc;this.fragTemplate=fragTemplate3;this.programCache={};this.defaultGroupCache={};if(fragTemplate3.indexOf("%count%")<0){throw new Error("Fragment template must contain \"%count%\".")}if(fragTemplate3.indexOf("%forloop%")<0){throw new Error("Fragment template must contain \"%forloop%\".")}};BatchShaderGenerator.prototype.generateShader=function generateShader(maxTextures){if(!this.programCache[maxTextures]){var sampleValues=new Int32Array(maxTextures);for(var i=0;i<maxTextures;i++){sampleValues[i]=i}this.defaultGroupCache[maxTextures]=UniformGroup.from({uSamplers:sampleValues},true);var fragmentSrc=this.fragTemplate;fragmentSrc=fragmentSrc.replace(/%count%/gi,""+maxTextures);fragmentSrc=fragmentSrc.replace(/%forloop%/gi,this.generateSampleSrc(maxTextures));this.programCache[maxTextures]=new Program(this.vertexSrc,fragmentSrc)}var uniforms={tint:new Float32Array([1,1,1,1]),translationMatrix:new Matrix,default:this.defaultGroupCache[maxTextures]};return new Shader(this.programCache[maxTextures],uniforms)};BatchShaderGenerator.prototype.generateSampleSrc=function generateSampleSrc(maxTextures){var src="";src+="\n";src+="\n";for(var i=0;i<maxTextures;i++){if(i>0){src+="\nelse "}if(i<maxTextures-1){src+="if(vTextureId < "+i+".5)"}src+="\n{";src+="\n\tcolor = texture2D(uSamplers["+i+"], vTextureCoord);";src+="\n}"}src+="\n";src+="\n";return src};var BatchGeometry=function(Geometry3){function BatchGeometry2(_static){if(_static===void 0)_static=false;Geometry3.call(this);this._buffer=new Buffer2(null,_static,false);this._indexBuffer=new Buffer2(null,_static,true);this.addAttribute("aVertexPosition",this._buffer,2,false,TYPES.FLOAT).addAttribute("aTextureCoord",this._buffer,2,false,TYPES.FLOAT).addAttribute("aColor",this._buffer,4,true,TYPES.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,true,TYPES.FLOAT).addIndex(this._indexBuffer)}if(Geometry3)BatchGeometry2.__proto__=Geometry3;BatchGeometry2.prototype=Object.create(Geometry3&&Geometry3.prototype);BatchGeometry2.prototype.constructor=BatchGeometry2;return BatchGeometry2}(Geometry);var defaultVertex$2="precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform vec4 tint;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor * tint;\n}\n";var defaultFragment$2="varying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\n    vec4 color;\n    %forloop%\n    gl_FragColor = color * vColor;\n}\n";var BatchPluginFactory=function BatchPluginFactory2(){};var staticAccessors$1={defaultVertexSrc:{configurable:true},defaultFragmentTemplate:{configurable:true}};BatchPluginFactory.create=function create(options){var ref=Object.assign({vertex:defaultVertex$2,fragment:defaultFragment$2,geometryClass:BatchGeometry,vertexSize:6},options);var vertex5=ref.vertex;var fragment6=ref.fragment;var vertexSize=ref.vertexSize;var geometryClass=ref.geometryClass;return function(AbstractBatchRenderer2){function BatchPlugin(renderer){AbstractBatchRenderer2.call(this,renderer);this.shaderGenerator=new BatchShaderGenerator(vertex5,fragment6);this.geometryClass=geometryClass;this.vertexSize=vertexSize}if(AbstractBatchRenderer2)BatchPlugin.__proto__=AbstractBatchRenderer2;BatchPlugin.prototype=Object.create(AbstractBatchRenderer2&&AbstractBatchRenderer2.prototype);BatchPlugin.prototype.constructor=BatchPlugin;return BatchPlugin}(AbstractBatchRenderer)};staticAccessors$1.defaultVertexSrc.get=function(){return defaultVertex$2};staticAccessors$1.defaultFragmentTemplate.get=function(){return defaultFragment$2};Object.defineProperties(BatchPluginFactory,staticAccessors$1);var BatchRenderer=BatchPluginFactory.create();var Application=function Application2(options){var this$1=this;options=Object.assign({forceCanvas:false},options);this.renderer=autoDetectRenderer(options);this.stage=new Container;Application2._plugins.forEach(function(plugin){plugin.init.call(this$1,options)})};var prototypeAccessors3={view:{configurable:true},screen:{configurable:true}};Application.registerPlugin=function registerPlugin(plugin){Application._plugins.push(plugin)};Application.prototype.render=function render2(){this.renderer.render(this.stage)};prototypeAccessors3.view.get=function(){return this.renderer.view};prototypeAccessors3.screen.get=function(){return this.renderer.screen};Application.prototype.destroy=function destroy11(removeView,stageOptions){var this$1=this;var plugins=Application._plugins.slice(0);plugins.reverse();plugins.forEach(function(plugin){plugin.destroy.call(this$1)});this.stage.destroy(stageOptions);this.stage=null;this.renderer.destroy(removeView);this.renderer=null;this._options=null};Object.defineProperties(Application.prototype,prototypeAccessors3);Application._plugins=[];var ResizePlugin=function ResizePlugin2(){};ResizePlugin.init=function init2(options){var this$1=this;Object.defineProperty(this,"resizeTo",{set:function set4(dom){window.removeEventListener("resize",this.resize);this._resizeTo=dom;if(dom){window.addEventListener("resize",this.resize);this.resize()}},get:function get3(){return this._resizeTo}});this.resize=function(){if(this$1._resizeTo){if(this$1._resizeTo===window){this$1.renderer.resize(window.innerWidth,window.innerHeight)}else{this$1.renderer.resize(this$1._resizeTo.clientWidth,this$1._resizeTo.clientHeight)}}};this._resizeTo=null;this.resizeTo=options.resizeTo||null};ResizePlugin.destroy=function destroy12(){this.resizeTo=null;this.resize=null};Application.registerPlugin(ResizePlugin);var TEMP_RECT=new Rectangle;var BYTES_PER_PIXEL=4;var Extract=function Extract2(renderer){this.renderer=renderer;renderer.extract=this};Extract.prototype.image=function image(target,format,quality){var image3=new Image;image3.src=this.base64(target,format,quality);return image3};Extract.prototype.base64=function base64(target,format,quality){return this.canvas(target).toDataURL(format,quality)};Extract.prototype.canvas=function canvas(target){var renderer=this.renderer;var resolution;var frame;var flipY=false;var renderTexture;var generated=false;if(target){if(target instanceof RenderTexture){renderTexture=target}else{renderTexture=this.renderer.generateTexture(target);generated=true}}if(renderTexture){resolution=renderTexture.baseTexture.resolution;frame=renderTexture.frame;flipY=false;renderer.renderTexture.bind(renderTexture)}else{resolution=this.renderer.resolution;flipY=true;frame=TEMP_RECT;frame.width=this.renderer.width;frame.height=this.renderer.height;renderer.renderTexture.bind(null)}var width=Math.floor(frame.width*resolution+1e-4);var height=Math.floor(frame.height*resolution+1e-4);var canvasBuffer=new _CanvasRenderTarget(width,height,1);var webglPixels=new Uint8Array(BYTES_PER_PIXEL*width*height);var gl=renderer.gl;gl.readPixels(frame.x*resolution,frame.y*resolution,width,height,gl.RGBA,gl.UNSIGNED_BYTE,webglPixels);var canvasData=canvasBuffer.context.getImageData(0,0,width,height);Extract.arrayPostDivide(webglPixels,canvasData.data);canvasBuffer.context.putImageData(canvasData,0,0);if(flipY){var target$1=new _CanvasRenderTarget(canvasBuffer.width,canvasBuffer.height,1);target$1.context.scale(1,-1);target$1.context.drawImage(canvasBuffer.canvas,0,-height);canvasBuffer.destroy();canvasBuffer=target$1}if(generated){renderTexture.destroy(true)}return canvasBuffer.canvas};Extract.prototype.pixels=function pixels(target){var renderer=this.renderer;var resolution;var frame;var renderTexture;var generated=false;if(target){if(target instanceof RenderTexture){renderTexture=target}else{renderTexture=this.renderer.generateTexture(target);generated=true}}if(renderTexture){resolution=renderTexture.baseTexture.resolution;frame=renderTexture.frame;renderer.renderTexture.bind(renderTexture)}else{resolution=renderer.resolution;frame=TEMP_RECT;frame.width=renderer.width;frame.height=renderer.height;renderer.renderTexture.bind(null)}var width=frame.width*resolution;var height=frame.height*resolution;var webglPixels=new Uint8Array(BYTES_PER_PIXEL*width*height);var gl=renderer.gl;gl.readPixels(frame.x*resolution,frame.y*resolution,width,height,gl.RGBA,gl.UNSIGNED_BYTE,webglPixels);if(generated){renderTexture.destroy(true)}Extract.arrayPostDivide(webglPixels,webglPixels);return webglPixels};Extract.prototype.destroy=function destroy13(){this.renderer.extract=null;this.renderer=null};Extract.arrayPostDivide=function arrayPostDivide(pixels3,out){for(var i=0;i<pixels3.length;i+=4){var alpha=out[i+3]=pixels3[i+3];if(alpha!==0){out[i]=Math.round(Math.min(pixels3[i]*255/alpha,255));out[i+1]=Math.round(Math.min(pixels3[i+1]*255/alpha,255));out[i+2]=Math.round(Math.min(pixels3[i+2]*255/alpha,255))}else{out[i]=pixels3[i];out[i+1]=pixels3[i+1];out[i+2]=pixels3[i+2]}}};var import_parse_uri=__toModule(require_parse_uri());var import_mini_signals=__toModule(require_mini_signals());function _noop(){}function eachSeries(array,iterator,callback,deferNext){var i=0;var len=array.length;(function next(err){if(err||i===len){if(callback){callback(err)}return}if(deferNext){setTimeout(function(){iterator(array[i++],next)},1)}else{iterator(array[i++],next)}})()}function onlyOnce(fn){return function onceWrapper(){if(fn===null){throw new Error("Callback was already called.")}var callFn=fn;fn=null;callFn.apply(this,arguments)}}function queue(worker,concurrency){if(concurrency==null){concurrency=1}else if(concurrency===0){throw new Error("Concurrency must not be zero")}var workers=0;var q={_tasks:[],concurrency:concurrency,saturated:_noop,unsaturated:_noop,buffer:concurrency/4,empty:_noop,drain:_noop,error:_noop,started:false,paused:false,push:function push(data,callback){_insert(data,false,callback)},kill:function kill(){workers=0;q.drain=_noop;q.started=false;q._tasks=[]},unshift:function unshift(data,callback){_insert(data,true,callback)},process:function process(){while(!q.paused&&workers<q.concurrency&&q._tasks.length){var task=q._tasks.shift();if(q._tasks.length===0){q.empty()}workers+=1;if(workers===q.concurrency){q.saturated()}worker(task.data,onlyOnce(_next(task)))}},length:function length(){return q._tasks.length},running:function running(){return workers},idle:function idle(){return q._tasks.length+workers===0},pause:function pause(){if(q.paused===true){return}q.paused=true},resume:function resume(){if(q.paused===false){return}q.paused=false;for(var w=1;w<=q.concurrency;w++){q.process()}}};function _insert(data,insertAtFront,callback){if(callback!=null&&typeof callback!=="function"){throw new Error("task callback must be a function")}q.started=true;if(data==null&&q.idle()){setTimeout(function(){return q.drain()},1);return}var item={data:data,callback:typeof callback==="function"?callback:_noop};if(insertAtFront){q._tasks.unshift(item)}else{q._tasks.push(item)}setTimeout(function(){return q.process()},1)}function _next(task){return function next(){workers-=1;task.callback.apply(task,arguments);if(arguments[0]!=null){q.error(arguments[0],task.data)}if(workers<=q.concurrency-q.buffer){q.unsaturated()}if(q.idle()){q.drain()}q.process()}}return q}var cache={};function caching(resource,next){var _this=this;if(cache[resource.url]){resource.data=cache[resource.url];resource.complete()}else{resource.onComplete.once(function(){return cache[_this.url]=_this.data})}next()}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}var useXdr=!!(window.XDomainRequest&&!("withCredentials"in new XMLHttpRequest));var tempAnchor2=null;var STATUS_NONE=0;var STATUS_OK=200;var STATUS_EMPTY=204;var STATUS_IE_BUG_EMPTY=1223;var STATUS_TYPE_OK=2;function _noop$1(){}var Resource3=function(){Resource4.setExtensionLoadType=function setExtensionLoadType(extname,loadType){setExtMap(Resource4._loadTypeMap,extname,loadType)};Resource4.setExtensionXhrType=function setExtensionXhrType(extname,xhrType){setExtMap(Resource4._xhrTypeMap,extname,xhrType)};function Resource4(name,url,options){if(typeof name!=="string"||typeof url!=="string"){throw new Error("Both name and url are required for constructing a resource.")}options=options||{};this._flags=0;this._setFlag(Resource4.STATUS_FLAGS.DATA_URL,url.indexOf("data:")===0);this.name=name;this.url=url;this.extension=this._getExtension();this.data=null;this.crossOrigin=options.crossOrigin===true?"anonymous":options.crossOrigin;this.timeout=options.timeout||0;this.loadType=options.loadType||this._determineLoadType();this.xhrType=options.xhrType;this.metadata=options.metadata||{};this.error=null;this.xhr=null;this.children=[];this.type=Resource4.TYPE.UNKNOWN;this.progressChunk=0;this._dequeue=_noop$1;this._onLoadBinding=null;this._elementTimer=0;this._boundComplete=this.complete.bind(this);this._boundOnError=this._onError.bind(this);this._boundOnProgress=this._onProgress.bind(this);this._boundOnTimeout=this._onTimeout.bind(this);this._boundXhrOnError=this._xhrOnError.bind(this);this._boundXhrOnTimeout=this._xhrOnTimeout.bind(this);this._boundXhrOnAbort=this._xhrOnAbort.bind(this);this._boundXhrOnLoad=this._xhrOnLoad.bind(this);this.onStart=new import_mini_signals.default;this.onProgress=new import_mini_signals.default;this.onComplete=new import_mini_signals.default;this.onAfterMiddleware=new import_mini_signals.default}var _proto=Resource4.prototype;_proto.complete=function complete(){this._clearEvents();this._finish()};_proto.abort=function abort(message){if(this.error){return}this.error=new Error(message);this._clearEvents();if(this.xhr){this.xhr.abort()}else if(this.xdr){this.xdr.abort()}else if(this.data){if(this.data.src){this.data.src=Resource4.EMPTY_GIF}else{while(this.data.firstChild){this.data.removeChild(this.data.firstChild)}}}this._finish()};_proto.load=function load2(cb){var _this=this;if(this.isLoading){return}if(this.isComplete){if(cb){setTimeout(function(){return cb(_this)},1)}return}else if(cb){this.onComplete.once(cb)}this._setFlag(Resource4.STATUS_FLAGS.LOADING,true);this.onStart.dispatch(this);if(this.crossOrigin===false||typeof this.crossOrigin!=="string"){this.crossOrigin=this._determineCrossOrigin(this.url)}switch(this.loadType){case Resource4.LOAD_TYPE.IMAGE:this.type=Resource4.TYPE.IMAGE;this._loadElement("image");break;case Resource4.LOAD_TYPE.AUDIO:this.type=Resource4.TYPE.AUDIO;this._loadSourceElement("audio");break;case Resource4.LOAD_TYPE.VIDEO:this.type=Resource4.TYPE.VIDEO;this._loadSourceElement("video");break;case Resource4.LOAD_TYPE.XHR:default:if(useXdr&&this.crossOrigin){this._loadXdr()}else{this._loadXhr()}break;}};_proto._hasFlag=function _hasFlag(flag){return(this._flags&flag)!==0};_proto._setFlag=function _setFlag(flag,value){this._flags=value?this._flags|flag:this._flags&~flag};_proto._clearEvents=function _clearEvents(){clearTimeout(this._elementTimer);if(this.data&&this.data.removeEventListener){this.data.removeEventListener("error",this._boundOnError,false);this.data.removeEventListener("load",this._boundComplete,false);this.data.removeEventListener("progress",this._boundOnProgress,false);this.data.removeEventListener("canplaythrough",this._boundComplete,false)}if(this.xhr){if(this.xhr.removeEventListener){this.xhr.removeEventListener("error",this._boundXhrOnError,false);this.xhr.removeEventListener("timeout",this._boundXhrOnTimeout,false);this.xhr.removeEventListener("abort",this._boundXhrOnAbort,false);this.xhr.removeEventListener("progress",this._boundOnProgress,false);this.xhr.removeEventListener("load",this._boundXhrOnLoad,false)}else{this.xhr.onerror=null;this.xhr.ontimeout=null;this.xhr.onprogress=null;this.xhr.onload=null}}};_proto._finish=function _finish(){if(this.isComplete){throw new Error("Complete called again for an already completed resource.")}this._setFlag(Resource4.STATUS_FLAGS.COMPLETE,true);this._setFlag(Resource4.STATUS_FLAGS.LOADING,false);this.onComplete.dispatch(this)};_proto._loadElement=function _loadElement(type){if(this.metadata.loadElement){this.data=this.metadata.loadElement}else if(type==="image"&&typeof window.Image!=="undefined"){this.data=new Image}else{this.data=document.createElement(type)}if(this.crossOrigin){this.data.crossOrigin=this.crossOrigin}if(!this.metadata.skipSource){this.data.src=this.url}this.data.addEventListener("error",this._boundOnError,false);this.data.addEventListener("load",this._boundComplete,false);this.data.addEventListener("progress",this._boundOnProgress,false);if(this.timeout){this._elementTimer=setTimeout(this._boundOnTimeout,this.timeout)}};_proto._loadSourceElement=function _loadSourceElement(type){if(this.metadata.loadElement){this.data=this.metadata.loadElement}else if(type==="audio"&&typeof window.Audio!=="undefined"){this.data=new Audio}else{this.data=document.createElement(type)}if(this.data===null){this.abort("Unsupported element: "+type);return}if(this.crossOrigin){this.data.crossOrigin=this.crossOrigin}if(!this.metadata.skipSource){if(navigator.isCocoonJS){this.data.src=Array.isArray(this.url)?this.url[0]:this.url}else if(Array.isArray(this.url)){var mimeTypes=this.metadata.mimeType;for(var i=0;i<this.url.length;++i){this.data.appendChild(this._createSource(type,this.url[i],Array.isArray(mimeTypes)?mimeTypes[i]:mimeTypes))}}else{var _mimeTypes=this.metadata.mimeType;this.data.appendChild(this._createSource(type,this.url,Array.isArray(_mimeTypes)?_mimeTypes[0]:_mimeTypes))}}this.data.addEventListener("error",this._boundOnError,false);this.data.addEventListener("load",this._boundComplete,false);this.data.addEventListener("progress",this._boundOnProgress,false);this.data.addEventListener("canplaythrough",this._boundComplete,false);this.data.load();if(this.timeout){this._elementTimer=setTimeout(this._boundOnTimeout,this.timeout)}};_proto._loadXhr=function _loadXhr(){if(typeof this.xhrType!=="string"){this.xhrType=this._determineXhrType()}var xhr=this.xhr=new XMLHttpRequest;xhr.open("GET",this.url,true);xhr.timeout=this.timeout;if(this.xhrType===Resource4.XHR_RESPONSE_TYPE.JSON||this.xhrType===Resource4.XHR_RESPONSE_TYPE.DOCUMENT){xhr.responseType=Resource4.XHR_RESPONSE_TYPE.TEXT}else{xhr.responseType=this.xhrType}xhr.addEventListener("error",this._boundXhrOnError,false);xhr.addEventListener("timeout",this._boundXhrOnTimeout,false);xhr.addEventListener("abort",this._boundXhrOnAbort,false);xhr.addEventListener("progress",this._boundOnProgress,false);xhr.addEventListener("load",this._boundXhrOnLoad,false);xhr.send()};_proto._loadXdr=function _loadXdr(){if(typeof this.xhrType!=="string"){this.xhrType=this._determineXhrType()}var xdr=this.xhr=new XDomainRequest;xdr.timeout=this.timeout||5e3;xdr.onerror=this._boundXhrOnError;xdr.ontimeout=this._boundXhrOnTimeout;xdr.onprogress=this._boundOnProgress;xdr.onload=this._boundXhrOnLoad;xdr.open("GET",this.url,true);setTimeout(function(){return xdr.send()},1)};_proto._createSource=function _createSource(type,url,mime){if(!mime){mime=type+"/"+this._getExtension(url)}var source=document.createElement("source");source.src=url;source.type=mime;return source};_proto._onError=function _onError(event2){this.abort("Failed to load element using: "+event2.target.nodeName)};_proto._onProgress=function _onProgress(event2){if(event2&&event2.lengthComputable){this.onProgress.dispatch(this,event2.loaded/event2.total)}};_proto._onTimeout=function _onTimeout(){this.abort("Load timed out.")};_proto._xhrOnError=function _xhrOnError(){var xhr=this.xhr;this.abort(reqType(xhr)+" Request failed. Status: "+xhr.status+", text: \""+xhr.statusText+"\"")};_proto._xhrOnTimeout=function _xhrOnTimeout(){var xhr=this.xhr;this.abort(reqType(xhr)+" Request timed out.")};_proto._xhrOnAbort=function _xhrOnAbort(){var xhr=this.xhr;this.abort(reqType(xhr)+" Request was aborted by the user.")};_proto._xhrOnLoad=function _xhrOnLoad(){var xhr=this.xhr;var text="";var status=typeof xhr.status==="undefined"?STATUS_OK:xhr.status;if(xhr.responseType===""||xhr.responseType==="text"||typeof xhr.responseType==="undefined"){text=xhr.responseText}if(status===STATUS_NONE&&(text.length>0||xhr.responseType===Resource4.XHR_RESPONSE_TYPE.BUFFER)){status=STATUS_OK}else if(status===STATUS_IE_BUG_EMPTY){status=STATUS_EMPTY}var statusType=status/100|0;if(statusType===STATUS_TYPE_OK){if(this.xhrType===Resource4.XHR_RESPONSE_TYPE.TEXT){this.data=text;this.type=Resource4.TYPE.TEXT}else if(this.xhrType===Resource4.XHR_RESPONSE_TYPE.JSON){try{this.data=JSON.parse(text);this.type=Resource4.TYPE.JSON}catch(e){this.abort("Error trying to parse loaded json: "+e);return}}else if(this.xhrType===Resource4.XHR_RESPONSE_TYPE.DOCUMENT){try{if(window.DOMParser){var domparser=new DOMParser;this.data=domparser.parseFromString(text,"text/xml")}else{var div=document.createElement("div");div.innerHTML=text;this.data=div}this.type=Resource4.TYPE.XML}catch(e){this.abort("Error trying to parse loaded xml: "+e);return}}else{this.data=xhr.response||text}}else{this.abort("["+xhr.status+"] "+xhr.statusText+": "+xhr.responseURL);return}this.complete()};_proto._determineCrossOrigin=function _determineCrossOrigin(url,loc){if(url.indexOf("data:")===0){return""}if(window.origin!==window.location.origin){return"anonymous"}loc=loc||window.location;if(!tempAnchor2){tempAnchor2=document.createElement("a")}tempAnchor2.href=url;url=(0,import_parse_uri.default)(tempAnchor2.href,{strictMode:true});var samePort=!url.port&&loc.port===""||url.port===loc.port;var protocol=url.protocol?url.protocol+":":"";if(url.host!==loc.hostname||!samePort||protocol!==loc.protocol){return"anonymous"}return""};_proto._determineXhrType=function _determineXhrType(){return Resource4._xhrTypeMap[this.extension]||Resource4.XHR_RESPONSE_TYPE.TEXT};_proto._determineLoadType=function _determineLoadType(){return Resource4._loadTypeMap[this.extension]||Resource4.LOAD_TYPE.XHR};_proto._getExtension=function _getExtension(){var url=this.url;var ext="";if(this.isDataUrl){var slashIndex=url.indexOf("/");ext=url.substring(slashIndex+1,url.indexOf(";",slashIndex))}else{var queryStart=url.indexOf("?");var hashStart=url.indexOf("#");var index3=Math.min(queryStart>-1?queryStart:url.length,hashStart>-1?hashStart:url.length);url=url.substring(0,index3);ext=url.substring(url.lastIndexOf(".")+1)}return ext.toLowerCase()};_proto._getMimeFromXhrType=function _getMimeFromXhrType(type){switch(type){case Resource4.XHR_RESPONSE_TYPE.BUFFER:return"application/octet-binary";case Resource4.XHR_RESPONSE_TYPE.BLOB:return"application/blob";case Resource4.XHR_RESPONSE_TYPE.DOCUMENT:return"application/xml";case Resource4.XHR_RESPONSE_TYPE.JSON:return"application/json";case Resource4.XHR_RESPONSE_TYPE.DEFAULT:case Resource4.XHR_RESPONSE_TYPE.TEXT:default:return"text/plain";}};_createClass(Resource4,[{key:"isDataUrl",get:function get3(){return this._hasFlag(Resource4.STATUS_FLAGS.DATA_URL)}},{key:"isComplete",get:function get3(){return this._hasFlag(Resource4.STATUS_FLAGS.COMPLETE)}},{key:"isLoading",get:function get3(){return this._hasFlag(Resource4.STATUS_FLAGS.LOADING)}}]);return Resource4}();Resource3.STATUS_FLAGS={NONE:0,DATA_URL:1<<0,COMPLETE:1<<1,LOADING:1<<2};Resource3.TYPE={UNKNOWN:0,JSON:1,XML:2,IMAGE:3,AUDIO:4,VIDEO:5,TEXT:6};Resource3.LOAD_TYPE={XHR:1,IMAGE:2,AUDIO:3,VIDEO:4};Resource3.XHR_RESPONSE_TYPE={DEFAULT:"text",BUFFER:"arraybuffer",BLOB:"blob",DOCUMENT:"document",JSON:"json",TEXT:"text"};Resource3._loadTypeMap={gif:Resource3.LOAD_TYPE.IMAGE,png:Resource3.LOAD_TYPE.IMAGE,bmp:Resource3.LOAD_TYPE.IMAGE,jpg:Resource3.LOAD_TYPE.IMAGE,jpeg:Resource3.LOAD_TYPE.IMAGE,tif:Resource3.LOAD_TYPE.IMAGE,tiff:Resource3.LOAD_TYPE.IMAGE,webp:Resource3.LOAD_TYPE.IMAGE,tga:Resource3.LOAD_TYPE.IMAGE,svg:Resource3.LOAD_TYPE.IMAGE,"svg+xml":Resource3.LOAD_TYPE.IMAGE,mp3:Resource3.LOAD_TYPE.AUDIO,ogg:Resource3.LOAD_TYPE.AUDIO,wav:Resource3.LOAD_TYPE.AUDIO,mp4:Resource3.LOAD_TYPE.VIDEO,webm:Resource3.LOAD_TYPE.VIDEO};Resource3._xhrTypeMap={xhtml:Resource3.XHR_RESPONSE_TYPE.DOCUMENT,html:Resource3.XHR_RESPONSE_TYPE.DOCUMENT,htm:Resource3.XHR_RESPONSE_TYPE.DOCUMENT,xml:Resource3.XHR_RESPONSE_TYPE.DOCUMENT,tmx:Resource3.XHR_RESPONSE_TYPE.DOCUMENT,svg:Resource3.XHR_RESPONSE_TYPE.DOCUMENT,tsx:Resource3.XHR_RESPONSE_TYPE.DOCUMENT,gif:Resource3.XHR_RESPONSE_TYPE.BLOB,png:Resource3.XHR_RESPONSE_TYPE.BLOB,bmp:Resource3.XHR_RESPONSE_TYPE.BLOB,jpg:Resource3.XHR_RESPONSE_TYPE.BLOB,jpeg:Resource3.XHR_RESPONSE_TYPE.BLOB,tif:Resource3.XHR_RESPONSE_TYPE.BLOB,tiff:Resource3.XHR_RESPONSE_TYPE.BLOB,webp:Resource3.XHR_RESPONSE_TYPE.BLOB,tga:Resource3.XHR_RESPONSE_TYPE.BLOB,json:Resource3.XHR_RESPONSE_TYPE.JSON,text:Resource3.XHR_RESPONSE_TYPE.TEXT,txt:Resource3.XHR_RESPONSE_TYPE.TEXT,ttf:Resource3.XHR_RESPONSE_TYPE.BUFFER,otf:Resource3.XHR_RESPONSE_TYPE.BUFFER};Resource3.EMPTY_GIF="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==";function setExtMap(map3,extname,val){if(extname&&extname.indexOf(".")===0){extname=extname.substring(1)}if(!extname){return}map3[extname]=val}function reqType(xhr){return xhr.toString().replace("object ","")}var _keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function encodeBinary(input){var output="";var inx=0;while(inx<input.length){var bytebuffer=[0,0,0];var encodedCharIndexes=[0,0,0,0];for(var jnx=0;jnx<bytebuffer.length;++jnx){if(inx<input.length){bytebuffer[jnx]=input.charCodeAt(inx++)&255}else{bytebuffer[jnx]=0}}encodedCharIndexes[0]=bytebuffer[0]>>2;encodedCharIndexes[1]=(bytebuffer[0]&3)<<4|bytebuffer[1]>>4;encodedCharIndexes[2]=(bytebuffer[1]&15)<<2|bytebuffer[2]>>6;encodedCharIndexes[3]=bytebuffer[2]&63;var paddingBytes=inx-(input.length-1);switch(paddingBytes){case 2:encodedCharIndexes[3]=64;encodedCharIndexes[2]=64;break;case 1:encodedCharIndexes[3]=64;break;default:break;}for(var _jnx=0;_jnx<encodedCharIndexes.length;++_jnx){output+=_keyStr.charAt(encodedCharIndexes[_jnx])}}return output}var Url=window.URL||window.webkitURL;function parsing(resource,next){if(!resource.data){next();return}if(resource.xhr&&resource.xhrType===Resource3.XHR_RESPONSE_TYPE.BLOB){if(!window.Blob||typeof resource.data==="string"){var type=resource.xhr.getResponseHeader("content-type");if(type&&type.indexOf("image")===0){resource.data=new Image;resource.data.src="data:"+type+";base64,"+encodeBinary(resource.xhr.responseText);resource.type=Resource3.TYPE.IMAGE;resource.data.onload=function(){resource.data.onload=null;next()};return}}else if(resource.data.type.indexOf("image")===0){var src=Url.createObjectURL(resource.data);resource.blob=resource.data;resource.data=new Image;resource.data.src=src;resource.type=Resource3.TYPE.IMAGE;resource.data.onload=function(){Url.revokeObjectURL(src);resource.data.onload=null;next()};return}}next()}var index2={caching:caching,parsing:parsing};var MAX_PROGRESS=100;var rgxExtractUrlHash=/(#[\w-]+)?$/;var Loader=function(){function Loader3(baseUrl,concurrency){var _this=this;if(baseUrl===void 0){baseUrl=""}if(concurrency===void 0){concurrency=10}this.baseUrl=baseUrl;this.progress=0;this.loading=false;this.defaultQueryString="";this._beforeMiddleware=[];this._afterMiddleware=[];this._resourcesParsing=[];this._boundLoadResource=function(r,d){return _this._loadResource(r,d)};this._queue=queue(this._boundLoadResource,concurrency);this._queue.pause();this.resources={};this.onProgress=new import_mini_signals.default;this.onError=new import_mini_signals.default;this.onLoad=new import_mini_signals.default;this.onStart=new import_mini_signals.default;this.onComplete=new import_mini_signals.default;for(var i=0;i<Loader3._defaultBeforeMiddleware.length;++i){this.pre(Loader3._defaultBeforeMiddleware[i])}for(var _i=0;_i<Loader3._defaultAfterMiddleware.length;++_i){this.use(Loader3._defaultAfterMiddleware[_i])}}var _proto=Loader3.prototype;_proto.add=function add4(name,url,options,cb){if(Array.isArray(name)){for(var i=0;i<name.length;++i){this.add(name[i])}return this}if(_typeof(name)==="object"){cb=url||name.callback||name.onComplete;options=name;url=name.url;name=name.name||name.key||name.url}if(typeof url!=="string"){cb=options;options=url;url=name}if(typeof url!=="string"){throw new Error("No url passed to add resource to loader.")}if(typeof options==="function"){cb=options;options=null}if(this.loading&&(!options||!options.parentResource)){throw new Error("Cannot add resources while the loader is running.")}if(this.resources[name]){throw new Error("Resource named \""+name+"\" already exists.")}url=this._prepareUrl(url);this.resources[name]=new Resource3(name,url,options);if(typeof cb==="function"){this.resources[name].onAfterMiddleware.once(cb)}if(this.loading){var parent=options.parentResource;var incompleteChildren=[];for(var _i2=0;_i2<parent.children.length;++_i2){if(!parent.children[_i2].isComplete){incompleteChildren.push(parent.children[_i2])}}var fullChunk=parent.progressChunk*(incompleteChildren.length+1);var eachChunk=fullChunk/(incompleteChildren.length+2);parent.children.push(this.resources[name]);parent.progressChunk=eachChunk;for(var _i3=0;_i3<incompleteChildren.length;++_i3){incompleteChildren[_i3].progressChunk=eachChunk}this.resources[name].progressChunk=eachChunk}this._queue.push(this.resources[name]);return this};_proto.pre=function pre(fn){this._beforeMiddleware.push(fn);return this};_proto.use=function use4(fn){this._afterMiddleware.push(fn);return this};_proto.reset=function reset7(){this.progress=0;this.loading=false;this._queue.kill();this._queue.pause();for(var k in this.resources){var res=this.resources[k];if(res._onLoadBinding){res._onLoadBinding.detach()}if(res.isLoading){res.abort()}}this.resources={};return this};_proto.load=function load2(cb){if(typeof cb==="function"){this.onComplete.once(cb)}if(this.loading){return this}if(this._queue.idle()){this._onStart();this._onComplete()}else{var numTasks=this._queue._tasks.length;var chunk=MAX_PROGRESS/numTasks;for(var i=0;i<this._queue._tasks.length;++i){this._queue._tasks[i].data.progressChunk=chunk}this._onStart();this._queue.resume()}return this};_proto._prepareUrl=function _prepareUrl(url){var parsedUrl=(0,import_parse_uri.default)(url,{strictMode:true});var result;if(parsedUrl.protocol||!parsedUrl.path||url.indexOf("//")===0){result=url}else if(this.baseUrl.length&&this.baseUrl.lastIndexOf("/")!==this.baseUrl.length-1&&url.charAt(0)!=="/"){result=this.baseUrl+"/"+url}else{result=this.baseUrl+url}if(this.defaultQueryString){var hash=rgxExtractUrlHash.exec(result)[0];result=result.substr(0,result.length-hash.length);if(result.indexOf("?")!==-1){result+="&"+this.defaultQueryString}else{result+="?"+this.defaultQueryString}result+=hash}return result};_proto._loadResource=function _loadResource(resource,dequeue){var _this2=this;resource._dequeue=dequeue;eachSeries(this._beforeMiddleware,function(fn,next){fn.call(_this2,resource,function(){next(resource.isComplete?{}:null)})},function(){if(resource.isComplete){_this2._onLoad(resource)}else{resource._onLoadBinding=resource.onComplete.once(_this2._onLoad,_this2);resource.load()}},true)};_proto._onStart=function _onStart(){this.progress=0;this.loading=true;this.onStart.dispatch(this)};_proto._onComplete=function _onComplete(){this.progress=MAX_PROGRESS;this.loading=false;this.onComplete.dispatch(this,this.resources)};_proto._onLoad=function _onLoad(resource){var _this3=this;resource._onLoadBinding=null;this._resourcesParsing.push(resource);resource._dequeue();eachSeries(this._afterMiddleware,function(fn,next){fn.call(_this3,resource,next)},function(){resource.onAfterMiddleware.dispatch(resource);_this3.progress=Math.min(MAX_PROGRESS,_this3.progress+resource.progressChunk);_this3.onProgress.dispatch(_this3,resource);if(resource.error){_this3.onError.dispatch(resource.error,_this3,resource)}else{_this3.onLoad.dispatch(_this3,resource)}_this3._resourcesParsing.splice(_this3._resourcesParsing.indexOf(resource),1);if(_this3._queue.idle()&&_this3._resourcesParsing.length===0){_this3._onComplete()}},true)};_createClass(Loader3,[{key:"concurrency",get:function get3(){return this._queue.concurrency},set:function set4(concurrency){this._queue.concurrency=concurrency}}]);return Loader3}();Loader._defaultBeforeMiddleware=[];Loader._defaultAfterMiddleware=[];Loader.pre=function LoaderPreStatic(fn){Loader._defaultBeforeMiddleware.push(fn);return Loader};Loader.use=function LoaderUseStatic(fn){Loader._defaultAfterMiddleware.push(fn);return Loader};var TextureLoader=function TextureLoader2(){};TextureLoader.use=function use(resource,next){if(resource.data&&resource.type===Resource3.TYPE.IMAGE){resource.texture=Texture.fromLoader(resource.data,resource.url,resource.name)}next()};var Loader2=function(ResourceLoader){function Loader3(baseUrl,concurrency){var this$1=this;ResourceLoader.call(this,baseUrl,concurrency);import_eventemitter3.default.call(this);for(var i=0;i<Loader3._plugins.length;++i){var plugin=Loader3._plugins[i];var pre=plugin.pre;var use4=plugin.use;if(pre){this.pre(pre)}if(use4){this.use(use4)}}this.onStart.add(function(l){return this$1.emit("start",l)});this.onProgress.add(function(l,r){return this$1.emit("progress",l,r)});this.onError.add(function(e,l,r){return this$1.emit("error",e,l,r)});this.onLoad.add(function(l,r){return this$1.emit("load",l,r)});this.onComplete.add(function(l,r){return this$1.emit("complete",l,r)});this._protected=false}if(ResourceLoader)Loader3.__proto__=ResourceLoader;Loader3.prototype=Object.create(ResourceLoader&&ResourceLoader.prototype);Loader3.prototype.constructor=Loader3;var staticAccessors3={shared:{configurable:true}};Loader3.prototype.destroy=function destroy25(){if(!this._protected){this.removeAllListeners();this.reset()}};staticAccessors3.shared.get=function(){var shared=Loader3._shared;if(!shared){shared=new Loader3;shared._protected=true;Loader3._shared=shared}return shared};Object.defineProperties(Loader3,staticAccessors3);return Loader3}(Loader);Object.assign(Loader2.prototype,import_eventemitter3.default.prototype);Loader2._plugins=[];Loader2.registerPlugin=function registerPlugin2(plugin){Loader2._plugins.push(plugin);if(plugin.add){plugin.add()}return Loader2};Loader2.registerPlugin({use:index2.parsing});Loader2.registerPlugin(TextureLoader);var AppLoaderPlugin=function AppLoaderPlugin2(){};AppLoaderPlugin.init=function init3(options){options=Object.assign({sharedLoader:false},options);this.loader=options.sharedLoader?Loader2.shared:new Loader2};AppLoaderPlugin.destroy=function destroy14(){if(this.loader){this.loader.destroy();this.loader=null}};var LoaderResource=Resource3;var ParticleContainer=function(Container2){function ParticleContainer2(maxSize,properties,batchSize,autoResize){if(maxSize===void 0)maxSize=1500;if(batchSize===void 0)batchSize=16384;if(autoResize===void 0)autoResize=false;Container2.call(this);var maxBatchSize=16384;if(batchSize>maxBatchSize){batchSize=maxBatchSize}this._properties=[false,true,false,false,false];this._maxSize=maxSize;this._batchSize=batchSize;this._buffers=null;this._bufferUpdateIDs=[];this._updateID=0;this.interactiveChildren=false;this.blendMode=BLEND_MODES.NORMAL;this.autoResize=autoResize;this.roundPixels=true;this.baseTexture=null;this.setProperties(properties);this._tint=0;this.tintRgb=new Float32Array(4);this.tint=16777215}if(Container2)ParticleContainer2.__proto__=Container2;ParticleContainer2.prototype=Object.create(Container2&&Container2.prototype);ParticleContainer2.prototype.constructor=ParticleContainer2;var prototypeAccessors5={tint:{configurable:true}};ParticleContainer2.prototype.setProperties=function setProperties(properties){if(properties){this._properties[0]="vertices"in properties||"scale"in properties?!!properties.vertices||!!properties.scale:this._properties[0];this._properties[1]="position"in properties?!!properties.position:this._properties[1];this._properties[2]="rotation"in properties?!!properties.rotation:this._properties[2];this._properties[3]="uvs"in properties?!!properties.uvs:this._properties[3];this._properties[4]="tint"in properties||"alpha"in properties?!!properties.tint||!!properties.alpha:this._properties[4]}};ParticleContainer2.prototype.updateTransform=function updateTransform(){this.displayObjectUpdateTransform()};prototypeAccessors5.tint.get=function(){return this._tint};prototypeAccessors5.tint.set=function(value){this._tint=value;_hex2rgb(value,this.tintRgb)};ParticleContainer2.prototype.render=function render6(renderer){var this$1=this;if(!this.visible||this.worldAlpha<=0||!this.children.length||!this.renderable){return}if(!this.baseTexture){this.baseTexture=this.children[0]._texture.baseTexture;if(!this.baseTexture.valid){this.baseTexture.once("update",function(){return this$1.onChildrenChange(0)})}}renderer.batch.setObjectRenderer(renderer.plugins.particle);renderer.plugins.particle.render(this)};ParticleContainer2.prototype.onChildrenChange=function onChildrenChange(smallestChildIndex){var bufferIndex=Math.floor(smallestChildIndex/this._batchSize);while(this._bufferUpdateIDs.length<bufferIndex){this._bufferUpdateIDs.push(0)}this._bufferUpdateIDs[bufferIndex]=++this._updateID};ParticleContainer2.prototype.dispose=function dispose5(){if(this._buffers){for(var i=0;i<this._buffers.length;++i){this._buffers[i].destroy()}this._buffers=null}};ParticleContainer2.prototype.destroy=function destroy25(options){Container2.prototype.destroy.call(this,options);this.dispose();this._properties=null;this._buffers=null;this._bufferUpdateIDs=null};Object.defineProperties(ParticleContainer2.prototype,prototypeAccessors5);return ParticleContainer2}(Container);var ParticleBuffer=function ParticleBuffer2(properties,dynamicPropertyFlags,size){this.geometry=new Geometry;this.indexBuffer=null;this.size=size;this.dynamicProperties=[];this.staticProperties=[];for(var i=0;i<properties.length;++i){var property=properties[i];property={attributeName:property.attributeName,size:property.size,uploadFunction:property.uploadFunction,type:property.type||TYPES.FLOAT,offset:property.offset};if(dynamicPropertyFlags[i]){this.dynamicProperties.push(property)}else{this.staticProperties.push(property)}}this.staticStride=0;this.staticBuffer=null;this.staticData=null;this.staticDataUint32=null;this.dynamicStride=0;this.dynamicBuffer=null;this.dynamicData=null;this.dynamicDataUint32=null;this._updateID=0;this.initBuffers()};ParticleBuffer.prototype.initBuffers=function initBuffers(){var geometry=this.geometry;var dynamicOffset=0;this.indexBuffer=new Buffer2(_createIndicesForQuads(this.size),true,true);geometry.addIndex(this.indexBuffer);this.dynamicStride=0;for(var i=0;i<this.dynamicProperties.length;++i){var property=this.dynamicProperties[i];property.offset=dynamicOffset;dynamicOffset+=property.size;this.dynamicStride+=property.size}var dynBuffer=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(dynBuffer);this.dynamicDataUint32=new Uint32Array(dynBuffer);this.dynamicBuffer=new Buffer2(this.dynamicData,false,false);var staticOffset=0;this.staticStride=0;for(var i$1=0;i$1<this.staticProperties.length;++i$1){var property$1=this.staticProperties[i$1];property$1.offset=staticOffset;staticOffset+=property$1.size;this.staticStride+=property$1.size}var statBuffer=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(statBuffer);this.staticDataUint32=new Uint32Array(statBuffer);this.staticBuffer=new Buffer2(this.staticData,true,false);for(var i$2=0;i$2<this.dynamicProperties.length;++i$2){var property$2=this.dynamicProperties[i$2];geometry.addAttribute(property$2.attributeName,this.dynamicBuffer,0,property$2.type===TYPES.UNSIGNED_BYTE,property$2.type,this.dynamicStride*4,property$2.offset*4)}for(var i$3=0;i$3<this.staticProperties.length;++i$3){var property$3=this.staticProperties[i$3];geometry.addAttribute(property$3.attributeName,this.staticBuffer,0,property$3.type===TYPES.UNSIGNED_BYTE,property$3.type,this.staticStride*4,property$3.offset*4)}};ParticleBuffer.prototype.uploadDynamic=function uploadDynamic(children,startIndex,amount){for(var i=0;i<this.dynamicProperties.length;i++){var property=this.dynamicProperties[i];property.uploadFunction(children,startIndex,amount,property.type===TYPES.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,property.offset)}this.dynamicBuffer._updateID++};ParticleBuffer.prototype.uploadStatic=function uploadStatic(children,startIndex,amount){for(var i=0;i<this.staticProperties.length;i++){var property=this.staticProperties[i];property.uploadFunction(children,startIndex,amount,property.type===TYPES.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,property.offset)}this.staticBuffer._updateID++};ParticleBuffer.prototype.destroy=function destroy15(){this.indexBuffer=null;this.dynamicProperties=null;this.dynamicBuffer=null;this.dynamicData=null;this.dynamicDataUint32=null;this.staticProperties=null;this.staticBuffer=null;this.staticData=null;this.staticDataUint32=null;this.geometry.destroy()};var vertex2="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nattribute vec2 aPositionCoord;\nattribute float aRotation;\n\nuniform mat3 translationMatrix;\nuniform vec4 uColor;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void){\n    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);\n    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);\n\n    vec2 v = vec2(x, y);\n    v = v + aPositionCoord;\n\n    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vColor = aColor * uColor;\n}\n";var fragment2="varying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n    gl_FragColor = color;\n}";var ParticleRenderer=function(ObjectRenderer3){function ParticleRenderer2(renderer){ObjectRenderer3.call(this,renderer);this.shader=null;this.properties=null;this.tempMatrix=new Matrix;this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:TYPES.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}];this.shader=Shader.from(vertex2,fragment2,{});this.state=State.for2d()}if(ObjectRenderer3)ParticleRenderer2.__proto__=ObjectRenderer3;ParticleRenderer2.prototype=Object.create(ObjectRenderer3&&ObjectRenderer3.prototype);ParticleRenderer2.prototype.constructor=ParticleRenderer2;ParticleRenderer2.prototype.render=function render6(container){var children=container.children;var maxSize=container._maxSize;var batchSize=container._batchSize;var renderer=this.renderer;var totalChildren=children.length;if(totalChildren===0){return}else if(totalChildren>maxSize&&!container.autoResize){totalChildren=maxSize}var buffers=container._buffers;if(!buffers){buffers=container._buffers=this.generateBuffers(container)}var baseTexture=children[0]._texture.baseTexture;this.state.blendMode=_correctBlendMode(container.blendMode,baseTexture.alphaMode);renderer.state.set(this.state);var gl=renderer.gl;var m=container.worldTransform.copyTo(this.tempMatrix);m.prepend(renderer.globalUniforms.uniforms.projectionMatrix);this.shader.uniforms.translationMatrix=m.toArray(true);this.shader.uniforms.uColor=_premultiplyRgba(container.tintRgb,container.worldAlpha,this.shader.uniforms.uColor,baseTexture.alphaMode);this.shader.uniforms.uSampler=baseTexture;this.renderer.shader.bind(this.shader);var updateStatic=false;for(var i=0,j=0;i<totalChildren;i+=batchSize,j+=1){var amount=totalChildren-i;if(amount>batchSize){amount=batchSize}if(j>=buffers.length){buffers.push(this._generateOneMoreBuffer(container))}var buffer=buffers[j];buffer.uploadDynamic(children,i,amount);var bid=container._bufferUpdateIDs[j]||0;updateStatic=updateStatic||buffer._updateID<bid;if(updateStatic){buffer._updateID=container._updateID;buffer.uploadStatic(children,i,amount)}renderer.geometry.bind(buffer.geometry);gl.drawElements(gl.TRIANGLES,amount*6,gl.UNSIGNED_SHORT,0)}};ParticleRenderer2.prototype.generateBuffers=function generateBuffers(container){var buffers=[];var size=container._maxSize;var batchSize=container._batchSize;var dynamicPropertyFlags=container._properties;for(var i=0;i<size;i+=batchSize){buffers.push(new ParticleBuffer(this.properties,dynamicPropertyFlags,batchSize))}return buffers};ParticleRenderer2.prototype._generateOneMoreBuffer=function _generateOneMoreBuffer(container){var batchSize=container._batchSize;var dynamicPropertyFlags=container._properties;return new ParticleBuffer(this.properties,dynamicPropertyFlags,batchSize)};ParticleRenderer2.prototype.uploadVertices=function uploadVertices(children,startIndex,amount,array,stride,offset){var w0=0;var w1=0;var h0=0;var h1=0;for(var i=0;i<amount;++i){var sprite=children[startIndex+i];var texture=sprite._texture;var sx=sprite.scale.x;var sy=sprite.scale.y;var trim=texture.trim;var orig=texture.orig;if(trim){w1=trim.x-sprite.anchor.x*orig.width;w0=w1+trim.width;h1=trim.y-sprite.anchor.y*orig.height;h0=h1+trim.height}else{w0=orig.width*(1-sprite.anchor.x);w1=orig.width*-sprite.anchor.x;h0=orig.height*(1-sprite.anchor.y);h1=orig.height*-sprite.anchor.y}array[offset]=w1*sx;array[offset+1]=h1*sy;array[offset+stride]=w0*sx;array[offset+stride+1]=h1*sy;array[offset+stride*2]=w0*sx;array[offset+stride*2+1]=h0*sy;array[offset+stride*3]=w1*sx;array[offset+stride*3+1]=h0*sy;offset+=stride*4}};ParticleRenderer2.prototype.uploadPosition=function uploadPosition(children,startIndex,amount,array,stride,offset){for(var i=0;i<amount;i++){var spritePosition=children[startIndex+i].position;array[offset]=spritePosition.x;array[offset+1]=spritePosition.y;array[offset+stride]=spritePosition.x;array[offset+stride+1]=spritePosition.y;array[offset+stride*2]=spritePosition.x;array[offset+stride*2+1]=spritePosition.y;array[offset+stride*3]=spritePosition.x;array[offset+stride*3+1]=spritePosition.y;offset+=stride*4}};ParticleRenderer2.prototype.uploadRotation=function uploadRotation(children,startIndex,amount,array,stride,offset){for(var i=0;i<amount;i++){var spriteRotation=children[startIndex+i].rotation;array[offset]=spriteRotation;array[offset+stride]=spriteRotation;array[offset+stride*2]=spriteRotation;array[offset+stride*3]=spriteRotation;offset+=stride*4}};ParticleRenderer2.prototype.uploadUvs=function uploadUvs(children,startIndex,amount,array,stride,offset){for(var i=0;i<amount;++i){var textureUvs=children[startIndex+i]._texture._uvs;if(textureUvs){array[offset]=textureUvs.x0;array[offset+1]=textureUvs.y0;array[offset+stride]=textureUvs.x1;array[offset+stride+1]=textureUvs.y1;array[offset+stride*2]=textureUvs.x2;array[offset+stride*2+1]=textureUvs.y2;array[offset+stride*3]=textureUvs.x3;array[offset+stride*3+1]=textureUvs.y3;offset+=stride*4}else{array[offset]=0;array[offset+1]=0;array[offset+stride]=0;array[offset+stride+1]=0;array[offset+stride*2]=0;array[offset+stride*2+1]=0;array[offset+stride*3]=0;array[offset+stride*3+1]=0;offset+=stride*4}}};ParticleRenderer2.prototype.uploadTint=function uploadTint(children,startIndex,amount,array,stride,offset){for(var i=0;i<amount;++i){var sprite=children[startIndex+i];var premultiplied=sprite._texture.baseTexture.alphaMode>0;var alpha=sprite.alpha;var argb=alpha<1&&premultiplied?_premultiplyTint(sprite._tintRGB,alpha):sprite._tintRGB+(alpha*255<<24);array[offset]=argb;array[offset+stride]=argb;array[offset+stride*2]=argb;array[offset+stride*3]=argb;offset+=stride*4}};ParticleRenderer2.prototype.destroy=function destroy25(){ObjectRenderer3.prototype.destroy.call(this);if(this.shader){this.shader.destroy();this.shader=null}this.tempMatrix=null};return ParticleRenderer2}(ObjectRenderer);var GRAPHICS_CURVES={adaptive:true,maxLength:10,minSegments:8,maxSegments:2048,_segmentsCount:function _segmentsCount(length,defaultSegments){if(defaultSegments===void 0)defaultSegments=20;if(!this.adaptive||!length||isNaN(length)){return defaultSegments}var result=Math.ceil(length/this.maxLength);if(result<this.minSegments){result=this.minSegments}else if(result>this.maxSegments){result=this.maxSegments}return result}};var FillStyle=function FillStyle2(){this.reset()};FillStyle.prototype.clone=function clone2(){var obj=new FillStyle;obj.color=this.color;obj.alpha=this.alpha;obj.texture=this.texture;obj.matrix=this.matrix;obj.visible=this.visible;return obj};FillStyle.prototype.reset=function reset4(){this.color=16777215;this.alpha=1;this.texture=Texture.WHITE;this.matrix=null;this.visible=false};FillStyle.prototype.destroy=function destroy16(){this.texture=null;this.matrix=null};var buildPoly={build:function build(graphicsData){graphicsData.points=graphicsData.shape.points.slice()},triangulate:function triangulate(graphicsData,graphicsGeometry){var points=graphicsData.points;var holes=graphicsData.holes;var verts=graphicsGeometry.points;var indices2=graphicsGeometry.indices;if(points.length>=6){var holeArray=[];for(var i=0;i<holes.length;i++){var hole=holes[i];holeArray.push(points.length/2);points=points.concat(hole.points)}var triangles=(0,import_earcut.default)(points,holeArray,2);if(!triangles){return}var vertPos=verts.length/2;for(var i$1=0;i$1<triangles.length;i$1+=3){indices2.push(triangles[i$1]+vertPos);indices2.push(triangles[i$1+1]+vertPos);indices2.push(triangles[i$1+2]+vertPos)}for(var i$2=0;i$2<points.length;i$2++){verts.push(points[i$2])}}}};var buildCircle={build:function build2(graphicsData){var circleData=graphicsData.shape;var points=graphicsData.points;var x=circleData.x;var y=circleData.y;var width;var height;points.length=0;if(graphicsData.type===SHAPES.CIRC){width=circleData.radius;height=circleData.radius}else{width=circleData.width;height=circleData.height}if(width===0||height===0){return}var totalSegs=Math.floor(30*Math.sqrt(circleData.radius))||Math.floor(15*Math.sqrt(circleData.width+circleData.height));totalSegs/=2.3;var seg=Math.PI*2/totalSegs;for(var i=0;i<totalSegs-0.5;i++){points.push(x+Math.sin(-seg*i)*width,y+Math.cos(-seg*i)*height)}points.push(points[0],points[1])},triangulate:function triangulate2(graphicsData,graphicsGeometry){var points=graphicsData.points;var verts=graphicsGeometry.points;var indices2=graphicsGeometry.indices;var vertPos=verts.length/2;var center=vertPos;var circle=graphicsData.shape;var matrix=graphicsData.matrix;var x=circle.x;var y=circle.y;verts.push(graphicsData.matrix?matrix.a*x+matrix.c*y+matrix.tx:x,graphicsData.matrix?matrix.b*x+matrix.d*y+matrix.ty:y);for(var i=0;i<points.length;i+=2){verts.push(points[i],points[i+1]);indices2.push(vertPos++,center,vertPos)}}};var buildRectangle={build:function build3(graphicsData){var rectData=graphicsData.shape;var x=rectData.x;var y=rectData.y;var width=rectData.width;var height=rectData.height;var points=graphicsData.points;points.length=0;points.push(x,y,x+width,y,x+width,y+height,x,y+height)},triangulate:function triangulate3(graphicsData,graphicsGeometry){var points=graphicsData.points;var verts=graphicsGeometry.points;var vertPos=verts.length/2;verts.push(points[0],points[1],points[2],points[3],points[6],points[7],points[4],points[5]);graphicsGeometry.indices.push(vertPos,vertPos+1,vertPos+2,vertPos+1,vertPos+2,vertPos+3)}};var buildRoundedRectangle={build:function build4(graphicsData){var rrectData=graphicsData.shape;var points=graphicsData.points;var x=rrectData.x;var y=rrectData.y;var width=rrectData.width;var height=rrectData.height;var radius=Math.max(0,Math.min(rrectData.radius,Math.min(width,height)/2));points.length=0;if(!radius){points.push(x,y,x+width,y,x+width,y+height,x,y+height)}else{quadraticBezierCurve(x,y+radius,x,y,x+radius,y,points);quadraticBezierCurve(x+width-radius,y,x+width,y,x+width,y+radius,points);quadraticBezierCurve(x+width,y+height-radius,x+width,y+height,x+width-radius,y+height,points);quadraticBezierCurve(x+radius,y+height,x,y+height,x,y+height-radius,points)}},triangulate:function triangulate4(graphicsData,graphicsGeometry){var points=graphicsData.points;var verts=graphicsGeometry.points;var indices2=graphicsGeometry.indices;var vecPos=verts.length/2;var triangles=(0,import_earcut.default)(points,null,2);for(var i=0,j=triangles.length;i<j;i+=3){indices2.push(triangles[i]+vecPos);indices2.push(triangles[i+1]+vecPos);indices2.push(triangles[i+2]+vecPos)}for(var i$1=0,j$1=points.length;i$1<j$1;i$1++){verts.push(points[i$1],points[++i$1])}}};function getPt(n1,n2,perc){var diff=n2-n1;return n1+diff*perc}function quadraticBezierCurve(fromX,fromY,cpX,cpY,toX,toY,out){if(out===void 0)out=[];var n=20;var points=out;var xa=0;var ya=0;var xb=0;var yb=0;var x=0;var y=0;for(var i=0,j=0;i<=n;++i){j=i/n;xa=getPt(fromX,cpX,j);ya=getPt(fromY,cpY,j);xb=getPt(cpX,toX,j);yb=getPt(cpY,toY,j);x=getPt(xa,xb,j);y=getPt(ya,yb,j);points.push(x,y)}return points}function buildLine(graphicsData,graphicsGeometry){if(graphicsData.lineStyle.native){buildNativeLine(graphicsData,graphicsGeometry)}else{buildNonNativeLine(graphicsData,graphicsGeometry)}}function buildNonNativeLine(graphicsData,graphicsGeometry){var shape=graphicsData.shape;var points=graphicsData.points||shape.points.slice();var eps=graphicsGeometry.closePointEps;if(points.length===0){return}var style2=graphicsData.lineStyle;var firstPoint=new Point(points[0],points[1]);var lastPoint=new Point(points[points.length-2],points[points.length-1]);var closedShape=shape.type!==SHAPES.POLY||shape.closeStroke;var closedPath=Math.abs(firstPoint.x-lastPoint.x)<eps&&Math.abs(firstPoint.y-lastPoint.y)<eps;if(closedShape){points=points.slice();if(closedPath){points.pop();points.pop();lastPoint.set(points[points.length-2],points[points.length-1])}var midPointX=lastPoint.x+(firstPoint.x-lastPoint.x)*0.5;var midPointY=lastPoint.y+(firstPoint.y-lastPoint.y)*0.5;points.unshift(midPointX,midPointY);points.push(midPointX,midPointY)}var verts=graphicsGeometry.points;var length=points.length/2;var indexCount=points.length;var indexStart=verts.length/2;var width=style2.width/2;var p1x=points[0];var p1y=points[1];var p2x=points[2];var p2y=points[3];var p3x=0;var p3y=0;var perpx=-(p1y-p2y);var perpy=p1x-p2x;var perp2x=0;var perp2y=0;var perp3x=0;var perp3y=0;var dist=Math.sqrt(perpx*perpx+perpy*perpy);perpx/=dist;perpy/=dist;perpx*=width;perpy*=width;var ratio=style2.alignment;var r1=(1-ratio)*2;var r2=ratio*2;verts.push(p1x-perpx*r1,p1y-perpy*r1);verts.push(p1x+perpx*r2,p1y+perpy*r2);for(var i=1;i<length-1;++i){p1x=points[(i-1)*2];p1y=points[(i-1)*2+1];p2x=points[i*2];p2y=points[i*2+1];p3x=points[(i+1)*2];p3y=points[(i+1)*2+1];perpx=-(p1y-p2y);perpy=p1x-p2x;dist=Math.sqrt(perpx*perpx+perpy*perpy);perpx/=dist;perpy/=dist;perpx*=width;perpy*=width;perp2x=-(p2y-p3y);perp2y=p2x-p3x;dist=Math.sqrt(perp2x*perp2x+perp2y*perp2y);perp2x/=dist;perp2y/=dist;perp2x*=width;perp2y*=width;var a1=-perpy+p1y-(-perpy+p2y);var b1=-perpx+p2x-(-perpx+p1x);var c1=(-perpx+p1x)*(-perpy+p2y)-(-perpx+p2x)*(-perpy+p1y);var a2=-perp2y+p3y-(-perp2y+p2y);var b2=-perp2x+p2x-(-perp2x+p3x);var c2=(-perp2x+p3x)*(-perp2y+p2y)-(-perp2x+p2x)*(-perp2y+p3y);var denom=a1*b2-a2*b1;if(Math.abs(denom)<0.1){denom+=10.1;verts.push(p2x-perpx*r1,p2y-perpy*r1);verts.push(p2x+perpx*r2,p2y+perpy*r2);continue}var px=(b1*c2-b2*c1)/denom;var py=(a2*c1-a1*c2)/denom;var pdist=(px-p2x)*(px-p2x)+(py-p2y)*(py-p2y);if(pdist>196*width*width){perp3x=perpx-perp2x;perp3y=perpy-perp2y;dist=Math.sqrt(perp3x*perp3x+perp3y*perp3y);perp3x/=dist;perp3y/=dist;perp3x*=width;perp3y*=width;verts.push(p2x-perp3x*r1,p2y-perp3y*r1);verts.push(p2x+perp3x*r2,p2y+perp3y*r2);verts.push(p2x-perp3x*r2*r1,p2y-perp3y*r1);indexCount++}else{verts.push(p2x+(px-p2x)*r1,p2y+(py-p2y)*r1);verts.push(p2x-(px-p2x)*r2,p2y-(py-p2y)*r2)}}p1x=points[(length-2)*2];p1y=points[(length-2)*2+1];p2x=points[(length-1)*2];p2y=points[(length-1)*2+1];perpx=-(p1y-p2y);perpy=p1x-p2x;dist=Math.sqrt(perpx*perpx+perpy*perpy);perpx/=dist;perpy/=dist;perpx*=width;perpy*=width;verts.push(p2x-perpx*r1,p2y-perpy*r1);verts.push(p2x+perpx*r2,p2y+perpy*r2);var indices2=graphicsGeometry.indices;for(var i$1=0;i$1<indexCount-2;++i$1){indices2.push(indexStart,indexStart+1,indexStart+2);indexStart++}}function buildNativeLine(graphicsData,graphicsGeometry){var i=0;var shape=graphicsData.shape;var points=graphicsData.points||shape.points;var closedShape=shape.type!==SHAPES.POLY||shape.closeStroke;if(points.length===0){return}var verts=graphicsGeometry.points;var indices2=graphicsGeometry.indices;var length=points.length/2;var startIndex=verts.length/2;var currentIndex=startIndex;verts.push(points[0],points[1]);for(i=1;i<length;i++){verts.push(points[i*2],points[i*2+1]);indices2.push(currentIndex,currentIndex+1);currentIndex++}if(closedShape){indices2.push(currentIndex,startIndex)}}var Star=function(Polygon2){function Star2(x,y,points,radius,innerRadius,rotation){innerRadius=innerRadius||radius/2;var startAngle=-1*Math.PI/2+rotation;var len=points*2;var delta=PI_2/len;var polygon=[];for(var i=0;i<len;i++){var r=i%2?innerRadius:radius;var angle=i*delta+startAngle;polygon.push(x+r*Math.cos(angle),y+r*Math.sin(angle))}Polygon2.call(this,polygon)}if(Polygon2)Star2.__proto__=Polygon2;Star2.prototype=Object.create(Polygon2&&Polygon2.prototype);Star2.prototype.constructor=Star2;return Star2}(Polygon);var ArcUtils=function ArcUtils2(){};ArcUtils.curveTo=function curveTo(x1,y1,x2,y2,radius,points){var fromX=points[points.length-2];var fromY=points[points.length-1];var a1=fromY-y1;var b1=fromX-x1;var a2=y2-y1;var b2=x2-x1;var mm=Math.abs(a1*b2-b1*a2);if(mm<1e-8||radius===0){if(points[points.length-2]!==x1||points[points.length-1]!==y1){points.push(x1,y1)}return null}var dd=a1*a1+b1*b1;var cc=a2*a2+b2*b2;var tt=a1*a2+b1*b2;var k1=radius*Math.sqrt(dd)/mm;var k2=radius*Math.sqrt(cc)/mm;var j1=k1*tt/dd;var j2=k2*tt/cc;var cx=k1*b2+k2*b1;var cy=k1*a2+k2*a1;var px=b1*(k2+j1);var py=a1*(k2+j1);var qx=b2*(k1+j2);var qy=a2*(k1+j2);var startAngle=Math.atan2(py-cy,px-cx);var endAngle=Math.atan2(qy-cy,qx-cx);return{cx:cx+x1,cy:cy+y1,radius:radius,startAngle:startAngle,endAngle:endAngle,anticlockwise:b1*a2>b2*a1}};ArcUtils.arc=function arc(startX,startY,cx,cy,radius,startAngle,endAngle,anticlockwise,points){var sweep=endAngle-startAngle;var n=GRAPHICS_CURVES._segmentsCount(Math.abs(sweep)*radius,Math.ceil(Math.abs(sweep)/PI_2)*40);var theta=sweep/(n*2);var theta2=theta*2;var cTheta=Math.cos(theta);var sTheta=Math.sin(theta);var segMinus=n-1;var remainder=segMinus%1/segMinus;for(var i=0;i<=segMinus;++i){var real=i+remainder*i;var angle=theta+startAngle+theta2*real;var c=Math.cos(angle);var s=-Math.sin(angle);points.push((cTheta*c+sTheta*s)*radius+cx,(cTheta*-s+sTheta*c)*radius+cy)}};var BezierUtils=function BezierUtils2(){};BezierUtils.curveLength=function curveLength(fromX,fromY,cpX,cpY,cpX2,cpY2,toX,toY){var n=10;var result=0;var t=0;var t2=0;var t3=0;var nt=0;var nt2=0;var nt3=0;var x=0;var y=0;var dx=0;var dy=0;var prevX=fromX;var prevY=fromY;for(var i=1;i<=n;++i){t=i/n;t2=t*t;t3=t2*t;nt=1-t;nt2=nt*nt;nt3=nt2*nt;x=nt3*fromX+3*nt2*t*cpX+3*nt*t2*cpX2+t3*toX;y=nt3*fromY+3*nt2*t*cpY+3*nt*t2*cpY2+t3*toY;dx=prevX-x;dy=prevY-y;prevX=x;prevY=y;result+=Math.sqrt(dx*dx+dy*dy)}return result};BezierUtils.curveTo=function curveTo2(cpX,cpY,cpX2,cpY2,toX,toY,points){var fromX=points[points.length-2];var fromY=points[points.length-1];points.length-=2;var n=GRAPHICS_CURVES._segmentsCount(BezierUtils.curveLength(fromX,fromY,cpX,cpY,cpX2,cpY2,toX,toY));var dt=0;var dt2=0;var dt3=0;var t2=0;var t3=0;points.push(fromX,fromY);for(var i=1,j=0;i<=n;++i){j=i/n;dt=1-j;dt2=dt*dt;dt3=dt2*dt;t2=j*j;t3=t2*j;points.push(dt3*fromX+3*dt2*j*cpX+3*dt*t2*cpX2+t3*toX,dt3*fromY+3*dt2*j*cpY+3*dt*t2*cpY2+t3*toY)}};var QuadraticUtils=function QuadraticUtils2(){};QuadraticUtils.curveLength=function curveLength2(fromX,fromY,cpX,cpY,toX,toY){var ax=fromX-2*cpX+toX;var ay=fromY-2*cpY+toY;var bx=2*cpX-2*fromX;var by=2*cpY-2*fromY;var a=4*(ax*ax+ay*ay);var b=4*(ax*bx+ay*by);var c=bx*bx+by*by;var s=2*Math.sqrt(a+b+c);var a2=Math.sqrt(a);var a32=2*a*a2;var c2=2*Math.sqrt(c);var ba=b/a2;return(a32*s+a2*b*(s-c2)+(4*c*a-b*b)*Math.log((2*a2+ba+s)/(ba+c2)))/(4*a32)};QuadraticUtils.curveTo=function curveTo3(cpX,cpY,toX,toY,points){var fromX=points[points.length-2];var fromY=points[points.length-1];var n=GRAPHICS_CURVES._segmentsCount(QuadraticUtils.curveLength(fromX,fromY,cpX,cpY,toX,toY));var xa=0;var ya=0;for(var i=1;i<=n;++i){var j=i/n;xa=fromX+(cpX-fromX)*j;ya=fromY+(cpY-fromY)*j;points.push(xa+(cpX+(toX-cpX)*j-xa)*j,ya+(cpY+(toY-cpY)*j-ya)*j)}};var BatchPart=function BatchPart2(){this.reset()};BatchPart.prototype.begin=function begin(style2,startIndex,attribStart){this.reset();this.style=style2;this.start=startIndex;this.attribStart=attribStart};BatchPart.prototype.end=function end(endIndex,endAttrib){this.attribSize=endAttrib-this.attribStart;this.size=endIndex-this.start};BatchPart.prototype.reset=function reset5(){this.style=null;this.size=0;this.start=0;this.attribStart=0;this.attribSize=0};var FILL_COMMANDS={};FILL_COMMANDS[SHAPES.POLY]=buildPoly;FILL_COMMANDS[SHAPES.CIRC]=buildCircle;FILL_COMMANDS[SHAPES.ELIP]=buildCircle;FILL_COMMANDS[SHAPES.RECT]=buildRectangle;FILL_COMMANDS[SHAPES.RREC]=buildRoundedRectangle;var BATCH_POOL=[];var DRAW_CALL_POOL=[];var GraphicsData=function GraphicsData2(shape,fillStyle,lineStyle,matrix){if(fillStyle===void 0)fillStyle=null;if(lineStyle===void 0)lineStyle=null;if(matrix===void 0)matrix=null;this.shape=shape;this.lineStyle=lineStyle;this.fillStyle=fillStyle;this.matrix=matrix;this.type=shape.type;this.points=[];this.holes=[]};GraphicsData.prototype.clone=function clone3(){return new GraphicsData(this.shape,this.fillStyle,this.lineStyle,this.matrix)};GraphicsData.prototype.destroy=function destroy17(){this.shape=null;this.holes.length=0;this.holes=null;this.points.length=0;this.points=null;this.lineStyle=null;this.fillStyle=null};var tmpPoint=new Point;var tmpBounds=new Bounds;var GraphicsGeometry=function(BatchGeometry2){function GraphicsGeometry2(){BatchGeometry2.call(this);this.points=[];this.colors=[];this.uvs=[];this.indices=[];this.textureIds=[];this.graphicsData=[];this.dirty=0;this.batchDirty=-1;this.cacheDirty=-1;this.clearDirty=0;this.drawCalls=[];this.batches=[];this.shapeIndex=0;this._bounds=new Bounds;this.boundsDirty=-1;this.boundsPadding=0;this.batchable=false;this.indicesUint16=null;this.uvsFloat32=null;this.closePointEps=1e-4}if(BatchGeometry2)GraphicsGeometry2.__proto__=BatchGeometry2;GraphicsGeometry2.prototype=Object.create(BatchGeometry2&&BatchGeometry2.prototype);GraphicsGeometry2.prototype.constructor=GraphicsGeometry2;var prototypeAccessors5={bounds:{configurable:true}};prototypeAccessors5.bounds.get=function(){if(this.boundsDirty!==this.dirty){this.boundsDirty=this.dirty;this.calculateBounds()}return this._bounds};GraphicsGeometry2.prototype.invalidate=function invalidate(){this.boundsDirty=-1;this.dirty++;this.batchDirty++;this.shapeIndex=0;this.points.length=0;this.colors.length=0;this.uvs.length=0;this.indices.length=0;this.textureIds.length=0;for(var i=0;i<this.drawCalls.length;i++){this.drawCalls[i].textures.length=0;DRAW_CALL_POOL.push(this.drawCalls[i])}this.drawCalls.length=0;for(var i$1=0;i$1<this.batches.length;i$1++){var batchPart=this.batches[i$1];batchPart.reset();BATCH_POOL.push(batchPart)}this.batches.length=0};GraphicsGeometry2.prototype.clear=function clear5(){if(this.graphicsData.length>0){this.invalidate();this.clearDirty++;this.graphicsData.length=0}return this};GraphicsGeometry2.prototype.drawShape=function drawShape(shape,fillStyle,lineStyle,matrix){var data=new GraphicsData(shape,fillStyle,lineStyle,matrix);this.graphicsData.push(data);this.dirty++;return this};GraphicsGeometry2.prototype.drawHole=function drawHole(shape,matrix){if(!this.graphicsData.length){return null}var data=new GraphicsData(shape,null,null,matrix);var lastShape=this.graphicsData[this.graphicsData.length-1];data.lineStyle=lastShape.lineStyle;lastShape.holes.push(data);this.dirty++;return this};GraphicsGeometry2.prototype.destroy=function destroy25(options){BatchGeometry2.prototype.destroy.call(this,options);for(var i=0;i<this.graphicsData.length;++i){this.graphicsData[i].destroy()}this.points.length=0;this.points=null;this.colors.length=0;this.colors=null;this.uvs.length=0;this.uvs=null;this.indices.length=0;this.indices=null;this.indexBuffer.destroy();this.indexBuffer=null;this.graphicsData.length=0;this.graphicsData=null;this.drawCalls.length=0;this.drawCalls=null;this.batches.length=0;this.batches=null;this._bounds=null};GraphicsGeometry2.prototype.containsPoint=function containsPoint(point){var graphicsData=this.graphicsData;for(var i=0;i<graphicsData.length;++i){var data=graphicsData[i];if(!data.fillStyle.visible){continue}if(data.shape){if(data.matrix){data.matrix.applyInverse(point,tmpPoint)}else{tmpPoint.copyFrom(point)}if(data.shape.contains(tmpPoint.x,tmpPoint.y)){var hitHole=false;if(data.holes){for(var i$1=0;i$1<data.holes.length;i$1++){var hole=data.holes[i$1];if(hole.shape.contains(tmpPoint.x,tmpPoint.y)){hitHole=true;break}}}if(!hitHole){return true}}}}return false};GraphicsGeometry2.prototype.updateBatches=function updateBatches(){if(!this.graphicsData.length){this.batchable=true;return}if(!this.validateBatching()){return}this.cacheDirty=this.dirty;var uvs=this.uvs;var graphicsData=this.graphicsData;var batchPart=null;var currentStyle=null;if(this.batches.length>0){batchPart=this.batches[this.batches.length-1];currentStyle=batchPart.style}for(var i=this.shapeIndex;i<graphicsData.length;i++){this.shapeIndex++;var data=graphicsData[i];var fillStyle=data.fillStyle;var lineStyle=data.lineStyle;var command=FILL_COMMANDS[data.type];command.build(data);if(data.matrix){this.transformPoints(data.points,data.matrix)}for(var j=0;j<2;j++){var style2=j===0?fillStyle:lineStyle;if(!style2.visible){continue}var nextTexture=style2.texture.baseTexture;var index3=this.indices.length;var attribIndex=this.points.length/2;nextTexture.wrapMode=WRAP_MODES.REPEAT;if(j===0){this.processFill(data)}else{this.processLine(data)}var size=this.points.length/2-attribIndex;if(size===0){continue}if(batchPart&&!this._compareStyles(currentStyle,style2)){batchPart.end(index3,attribIndex);batchPart=null}if(!batchPart){batchPart=BATCH_POOL.pop()||new BatchPart;batchPart.begin(style2,index3,attribIndex);this.batches.push(batchPart);currentStyle=style2}this.addUvs(this.points,uvs,style2.texture,attribIndex,size,style2.matrix)}}if(batchPart){var index$1=this.indices.length;var attrib=this.points.length/2;batchPart.end(index$1,attrib)}if(this.batches.length===0){this.batchable=true;return}this.indicesUint16=new Uint16Array(this.indices);this.batchable=this.isBatchable();if(this.batchable){this.packBatches()}else{this.buildDrawCalls()}};GraphicsGeometry2.prototype._compareStyles=function _compareStyles(styleA,styleB){if(!styleA||!styleB){return false}if(styleA.texture.baseTexture!==styleB.texture.baseTexture){return false}if(styleA.color+styleA.alpha!==styleB.color+styleB.alpha){return false}if(!!styleA.native!==!!styleB.native){return false}return true};GraphicsGeometry2.prototype.validateBatching=function validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length){return false}for(var i=0,l=this.graphicsData.length;i<l;i++){var data=this.graphicsData[i];var fill=data.fillStyle;var line=data.lineStyle;if(fill&&!fill.texture.baseTexture.valid){return false}if(line&&!line.texture.baseTexture.valid){return false}}return true};GraphicsGeometry2.prototype.packBatches=function packBatches(){this.batchDirty++;this.uvsFloat32=new Float32Array(this.uvs);var batches=this.batches;for(var i=0,l=batches.length;i<l;i++){var batch=batches[i];for(var j=0;j<batch.size;j++){var index3=batch.start+j;this.indicesUint16[index3]=this.indicesUint16[index3]-batch.attribStart}}};GraphicsGeometry2.prototype.isBatchable=function isBatchable(){var batches=this.batches;for(var i=0;i<batches.length;i++){if(batches[i].style.native){return false}}return this.points.length<GraphicsGeometry2.BATCHABLE_SIZE*2};GraphicsGeometry2.prototype.buildDrawCalls=function buildDrawCalls(){var TICK=++BaseTexture._globalBatch;for(var i=0;i<this.drawCalls.length;i++){this.drawCalls[i].textures.length=0;DRAW_CALL_POOL.push(this.drawCalls[i])}this.drawCalls.length=0;var colors=this.colors;var textureIds=this.textureIds;var currentGroup=DRAW_CALL_POOL.pop();if(!currentGroup){currentGroup=new BatchDrawCall;currentGroup.textures=new BatchTextureArray}currentGroup.textures.count=0;currentGroup.start=0;currentGroup.size=0;currentGroup.type=DRAW_MODES.TRIANGLES;var textureCount=0;var currentTexture=null;var textureId=0;var native=false;var drawMode=DRAW_MODES.TRIANGLES;var index3=0;this.drawCalls.push(currentGroup);for(var i$1=0;i$1<this.batches.length;i$1++){var data=this.batches[i$1];var MAX_TEXTURES=8;var style2=data.style;var nextTexture=style2.texture.baseTexture;if(native!==!!style2.native){native=!!style2.native;drawMode=native?DRAW_MODES.LINES:DRAW_MODES.TRIANGLES;currentTexture=null;textureCount=MAX_TEXTURES;TICK++}if(currentTexture!==nextTexture){currentTexture=nextTexture;if(nextTexture._batchEnabled!==TICK){if(textureCount===MAX_TEXTURES){TICK++;textureCount=0;if(currentGroup.size>0){currentGroup=DRAW_CALL_POOL.pop();if(!currentGroup){currentGroup=new BatchDrawCall;currentGroup.textures=new BatchTextureArray}this.drawCalls.push(currentGroup)}currentGroup.start=index3;currentGroup.size=0;currentGroup.textures.count=0;currentGroup.type=drawMode}nextTexture.touched=1;nextTexture._batchEnabled=TICK;nextTexture._batchLocation=textureCount;nextTexture.wrapMode=10497;currentGroup.textures.elements[currentGroup.textures.count++]=nextTexture;textureCount++}}currentGroup.size+=data.size;index3+=data.size;textureId=nextTexture._batchLocation;this.addColors(colors,style2.color,style2.alpha,data.attribSize);this.addTextureIds(textureIds,textureId,data.attribSize)}BaseTexture._globalBatch=TICK;this.packAttributes()};GraphicsGeometry2.prototype.packAttributes=function packAttributes(){var verts=this.points;var uvs=this.uvs;var colors=this.colors;var textureIds=this.textureIds;var glPoints=new ArrayBuffer(verts.length*3*4);var f32=new Float32Array(glPoints);var u32=new Uint32Array(glPoints);var p=0;for(var i=0;i<verts.length/2;i++){f32[p++]=verts[i*2];f32[p++]=verts[i*2+1];f32[p++]=uvs[i*2];f32[p++]=uvs[i*2+1];u32[p++]=colors[i];f32[p++]=textureIds[i]}this._buffer.update(glPoints);this._indexBuffer.update(this.indicesUint16)};GraphicsGeometry2.prototype.processFill=function processFill(data){if(data.holes.length){this.processHoles(data.holes);buildPoly.triangulate(data,this)}else{var command=FILL_COMMANDS[data.type];command.triangulate(data,this)}};GraphicsGeometry2.prototype.processLine=function processLine(data){buildLine(data,this);for(var i=0;i<data.holes.length;i++){buildLine(data.holes[i],this)}};GraphicsGeometry2.prototype.processHoles=function processHoles(holes){for(var i=0;i<holes.length;i++){var hole=holes[i];var command=FILL_COMMANDS[hole.type];command.build(hole);if(hole.matrix){this.transformPoints(hole.points,hole.matrix)}}};GraphicsGeometry2.prototype.calculateBounds=function calculateBounds(){var bounds=this._bounds;var sequenceBounds=tmpBounds;var curMatrix=Matrix.IDENTITY;this._bounds.clear();sequenceBounds.clear();for(var i=0;i<this.graphicsData.length;i++){var data=this.graphicsData[i];var shape=data.shape;var type=data.type;var lineStyle=data.lineStyle;var nextMatrix=data.matrix||Matrix.IDENTITY;var lineWidth=0;if(lineStyle&&lineStyle.visible){var alignment=lineStyle.alignment;lineWidth=lineStyle.width;if(type===SHAPES.POLY){lineWidth=lineWidth*(0.5+Math.abs(0.5-alignment))}else{lineWidth=lineWidth*Math.max(0,alignment)}}if(curMatrix!==nextMatrix){if(!sequenceBounds.isEmpty()){bounds.addBoundsMatrix(sequenceBounds,curMatrix);sequenceBounds.clear()}curMatrix=nextMatrix}if(type===SHAPES.RECT||type===SHAPES.RREC){sequenceBounds.addFramePad(shape.x,shape.y,shape.x+shape.width,shape.y+shape.height,lineWidth,lineWidth)}else if(type===SHAPES.CIRC){sequenceBounds.addFramePad(shape.x,shape.y,shape.x,shape.y,shape.radius+lineWidth,shape.radius+lineWidth)}else if(type===SHAPES.ELIP){sequenceBounds.addFramePad(shape.x,shape.y,shape.x,shape.y,shape.width+lineWidth,shape.height+lineWidth)}else{bounds.addVerticesMatrix(curMatrix,shape.points,0,shape.points.length,lineWidth,lineWidth)}}if(!sequenceBounds.isEmpty()){bounds.addBoundsMatrix(sequenceBounds,curMatrix)}bounds.pad(this.boundsPadding,this.boundsPadding)};GraphicsGeometry2.prototype.transformPoints=function transformPoints(points,matrix){for(var i=0;i<points.length/2;i++){var x=points[i*2];var y=points[i*2+1];points[i*2]=matrix.a*x+matrix.c*y+matrix.tx;points[i*2+1]=matrix.b*x+matrix.d*y+matrix.ty}};GraphicsGeometry2.prototype.addColors=function addColors(colors,color,alpha,size){var rgb=(color>>16)+(color&65280)+((color&255)<<16);var rgba=_premultiplyTint(rgb,alpha);while(size-->0){colors.push(rgba)}};GraphicsGeometry2.prototype.addTextureIds=function addTextureIds(textureIds,id,size){while(size-->0){textureIds.push(id)}};GraphicsGeometry2.prototype.addUvs=function addUvs(verts,uvs,texture,start2,size,matrix){var index3=0;var uvsStart=uvs.length;var frame=texture.frame;while(index3<size){var x=verts[(start2+index3)*2];var y=verts[(start2+index3)*2+1];if(matrix){var nx=matrix.a*x+matrix.c*y+matrix.tx;y=matrix.b*x+matrix.d*y+matrix.ty;x=nx}index3++;uvs.push(x/frame.width,y/frame.height)}var baseTexture=texture.baseTexture;if(frame.width<baseTexture.width||frame.height<baseTexture.height){this.adjustUvs(uvs,texture,uvsStart,size)}};GraphicsGeometry2.prototype.adjustUvs=function adjustUvs(uvs,texture,start2,size){var baseTexture=texture.baseTexture;var eps=1e-6;var finish=start2+size*2;var frame=texture.frame;var scaleX=frame.width/baseTexture.width;var scaleY=frame.height/baseTexture.height;var offsetX=frame.x/frame.width;var offsetY=frame.y/frame.height;var minX=Math.floor(uvs[start2]+eps);var minY=Math.floor(uvs[start2+1]+eps);for(var i=start2+2;i<finish;i+=2){minX=Math.min(minX,Math.floor(uvs[i]+eps));minY=Math.min(minY,Math.floor(uvs[i+1]+eps))}offsetX-=minX;offsetY-=minY;for(var i$1=start2;i$1<finish;i$1+=2){uvs[i$1]=(uvs[i$1]+offsetX)*scaleX;uvs[i$1+1]=(uvs[i$1+1]+offsetY)*scaleY}};Object.defineProperties(GraphicsGeometry2.prototype,prototypeAccessors5);return GraphicsGeometry2}(BatchGeometry);GraphicsGeometry.BATCHABLE_SIZE=100;var LineStyle=function(FillStyle3){function LineStyle2(){FillStyle3.apply(this,arguments)}if(FillStyle3)LineStyle2.__proto__=FillStyle3;LineStyle2.prototype=Object.create(FillStyle3&&FillStyle3.prototype);LineStyle2.prototype.constructor=LineStyle2;LineStyle2.prototype.clone=function clone5(){var obj=new LineStyle2;obj.color=this.color;obj.alpha=this.alpha;obj.texture=this.texture;obj.matrix=this.matrix;obj.visible=this.visible;obj.width=this.width;obj.alignment=this.alignment;obj.native=this.native;return obj};LineStyle2.prototype.reset=function reset7(){FillStyle3.prototype.reset.call(this);this.color=0;this.width=0;this.alignment=0.5;this.native=false};return LineStyle2}(FillStyle);var temp=new Float32Array(3);var DEFAULT_SHADERS={};var Graphics=function(Container2){function Graphics2(geometry){if(geometry===void 0)geometry=null;Container2.call(this);this.geometry=geometry||new GraphicsGeometry;this.geometry.refCount++;this.shader=null;this.state=State.for2d();this._fillStyle=new FillStyle;this._lineStyle=new LineStyle;this._matrix=null;this._holeMode=false;this.currentPath=null;this.batches=[];this.batchTint=-1;this.vertexData=null;this._transformID=-1;this.batchDirty=-1;this.pluginName="batch";this.tint=16777215;this.blendMode=BLEND_MODES.NORMAL}if(Container2)Graphics2.__proto__=Container2;Graphics2.prototype=Object.create(Container2&&Container2.prototype);Graphics2.prototype.constructor=Graphics2;var prototypeAccessors5={blendMode:{configurable:true},tint:{configurable:true},fill:{configurable:true},line:{configurable:true}};Graphics2.prototype.clone=function clone5(){this.finishPoly();return new Graphics2(this.geometry)};prototypeAccessors5.blendMode.set=function(value){this.state.blendMode=value};prototypeAccessors5.blendMode.get=function(){return this.state.blendMode};prototypeAccessors5.tint.get=function(){return this._tint};prototypeAccessors5.tint.set=function(value){this._tint=value};prototypeAccessors5.fill.get=function(){return this._fillStyle};prototypeAccessors5.line.get=function(){return this._lineStyle};Graphics2.prototype.lineStyle=function lineStyle(options){if(typeof options==="number"){var args=arguments;options={width:args[0]||0,color:args[1]||0,alpha:args[2]!==void 0?args[2]:1,alignment:args[3]!==void 0?args[3]:0.5,native:!!args[4]}}return this.lineTextureStyle(options)};Graphics2.prototype.lineTextureStyle=function lineTextureStyle(options){if(typeof options==="number"){_deprecation("v5.2.0","Please use object-based options for Graphics#lineTextureStyle");var width=arguments[0];var texture=arguments[1];var color=arguments[2];var alpha=arguments[3];var matrix=arguments[4];var alignment=arguments[5];var native=arguments[6];options={width:width,texture:texture,color:color,alpha:alpha,matrix:matrix,alignment:alignment,native:native};Object.keys(options).forEach(function(key){return options[key]===void 0&&delete options[key]})}options=Object.assign({width:0,texture:Texture.WHITE,color:options&&options.texture?16777215:0,alpha:1,matrix:null,alignment:0.5,native:false},options);if(this.currentPath){this.startPoly()}var visible=options.width>0&&options.alpha>0;if(!visible){this._lineStyle.reset()}else{if(options.matrix){options.matrix=options.matrix.clone();options.matrix.invert()}Object.assign(this._lineStyle,{visible:visible},options)}return this};Graphics2.prototype.startPoly=function startPoly(){if(this.currentPath){var points=this.currentPath.points;var len=this.currentPath.points.length;if(len>2){this.drawShape(this.currentPath);this.currentPath=new Polygon;this.currentPath.closeStroke=false;this.currentPath.points.push(points[len-2],points[len-1])}}else{this.currentPath=new Polygon;this.currentPath.closeStroke=false}};Graphics2.prototype.finishPoly=function finishPoly(){if(this.currentPath){if(this.currentPath.points.length>2){this.drawShape(this.currentPath);this.currentPath=null}else{this.currentPath.points.length=0}}};Graphics2.prototype.moveTo=function moveTo(x,y){this.startPoly();this.currentPath.points[0]=x;this.currentPath.points[1]=y;return this};Graphics2.prototype.lineTo=function lineTo(x,y){if(!this.currentPath){this.moveTo(0,0)}var points=this.currentPath.points;var fromX=points[points.length-2];var fromY=points[points.length-1];if(fromX!==x||fromY!==y){points.push(x,y)}return this};Graphics2.prototype._initCurve=function _initCurve(x,y){if(x===void 0)x=0;if(y===void 0)y=0;if(this.currentPath){if(this.currentPath.points.length===0){this.currentPath.points=[x,y]}}else{this.moveTo(x,y)}};Graphics2.prototype.quadraticCurveTo=function quadraticCurveTo(cpX,cpY,toX,toY){this._initCurve();var points=this.currentPath.points;if(points.length===0){this.moveTo(0,0)}QuadraticUtils.curveTo(cpX,cpY,toX,toY,points);return this};Graphics2.prototype.bezierCurveTo=function bezierCurveTo(cpX,cpY,cpX2,cpY2,toX,toY){this._initCurve();BezierUtils.curveTo(cpX,cpY,cpX2,cpY2,toX,toY,this.currentPath.points);return this};Graphics2.prototype.arcTo=function arcTo(x1,y1,x2,y2,radius){this._initCurve(x1,y1);var points=this.currentPath.points;var result=ArcUtils.curveTo(x1,y1,x2,y2,radius,points);if(result){var cx=result.cx;var cy=result.cy;var radius$1=result.radius;var startAngle=result.startAngle;var endAngle=result.endAngle;var anticlockwise=result.anticlockwise;this.arc(cx,cy,radius$1,startAngle,endAngle,anticlockwise)}return this};Graphics2.prototype.arc=function arc2(cx,cy,radius,startAngle,endAngle,anticlockwise){if(anticlockwise===void 0)anticlockwise=false;if(startAngle===endAngle){return this}if(!anticlockwise&&endAngle<=startAngle){endAngle+=PI_2}else if(anticlockwise&&startAngle<=endAngle){startAngle+=PI_2}var sweep=endAngle-startAngle;if(sweep===0){return this}var startX=cx+Math.cos(startAngle)*radius;var startY=cy+Math.sin(startAngle)*radius;var eps=this.geometry.closePointEps;var points=this.currentPath?this.currentPath.points:null;if(points){var xDiff=Math.abs(points[points.length-2]-startX);var yDiff=Math.abs(points[points.length-1]-startY);if(xDiff<eps&&yDiff<eps);else{points.push(startX,startY)}}else{this.moveTo(startX,startY);points=this.currentPath.points}ArcUtils.arc(startX,startY,cx,cy,radius,startAngle,endAngle,anticlockwise,points);return this};Graphics2.prototype.beginFill=function beginFill(color,alpha){if(color===void 0)color=0;if(alpha===void 0)alpha=1;return this.beginTextureFill({texture:Texture.WHITE,color:color,alpha:alpha})};Graphics2.prototype.beginTextureFill=function beginTextureFill(options){if(options instanceof Texture){_deprecation("v5.2.0","Please use object-based options for Graphics#beginTextureFill");var texture=arguments[0];var color=arguments[1];var alpha=arguments[2];var matrix=arguments[3];options={texture:texture,color:color,alpha:alpha,matrix:matrix};Object.keys(options).forEach(function(key){return options[key]===void 0&&delete options[key]})}options=Object.assign({texture:Texture.WHITE,color:16777215,alpha:1,matrix:null},options);if(this.currentPath){this.startPoly()}var visible=options.alpha>0;if(!visible){this._fillStyle.reset()}else{if(options.matrix){options.matrix=options.matrix.clone();options.matrix.invert()}Object.assign(this._fillStyle,{visible:visible},options)}return this};Graphics2.prototype.endFill=function endFill(){this.finishPoly();this._fillStyle.reset();return this};Graphics2.prototype.drawRect=function drawRect(x,y,width,height){return this.drawShape(new Rectangle(x,y,width,height))};Graphics2.prototype.drawRoundedRect=function drawRoundedRect(x,y,width,height,radius){return this.drawShape(new RoundedRectangle(x,y,width,height,radius))};Graphics2.prototype.drawCircle=function drawCircle(x,y,radius){return this.drawShape(new Circle(x,y,radius))};Graphics2.prototype.drawEllipse=function drawEllipse(x,y,width,height){return this.drawShape(new Ellipse(x,y,width,height))};Graphics2.prototype.drawPolygon=function drawPolygon(path){var arguments$1=arguments;var points=path;var closeStroke=true;if(points.points){closeStroke=points.closeStroke;points=points.points}if(!Array.isArray(points)){points=new Array(arguments.length);for(var i=0;i<points.length;++i){points[i]=arguments$1[i]}}var shape=new Polygon(points);shape.closeStroke=closeStroke;this.drawShape(shape);return this};Graphics2.prototype.drawShape=function drawShape(shape){if(!this._holeMode){this.geometry.drawShape(shape,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix)}else{this.geometry.drawHole(shape,this._matrix)}return this};Graphics2.prototype.drawStar=function drawStar(x,y,points,radius,innerRadius,rotation){if(rotation===void 0)rotation=0;return this.drawPolygon(new Star(x,y,points,radius,innerRadius,rotation))};Graphics2.prototype.clear=function clear5(){this.geometry.clear();this._lineStyle.reset();this._fillStyle.reset();this._matrix=null;this._holeMode=false;this.currentPath=null;return this};Graphics2.prototype.isFastRect=function isFastRect(){return this.geometry.graphicsData.length===1&&this.geometry.graphicsData[0].shape.type===SHAPES.RECT&&!this.geometry.graphicsData[0].lineWidth};Graphics2.prototype._render=function _render(renderer){this.finishPoly();var geometry=this.geometry;geometry.updateBatches();if(geometry.batchable){if(this.batchDirty!==geometry.batchDirty){this._populateBatches()}this._renderBatched(renderer)}else{renderer.batch.flush();this._renderDirect(renderer)}};Graphics2.prototype._populateBatches=function _populateBatches(){var geometry=this.geometry;var blendMode=this.blendMode;this.batches=[];this.batchTint=-1;this._transformID=-1;this.batchDirty=geometry.batchDirty;this.vertexData=new Float32Array(geometry.points);for(var i=0,l=geometry.batches.length;i<l;i++){var gI=geometry.batches[i];var color=gI.style.color;var vertexData=new Float32Array(this.vertexData.buffer,gI.attribStart*4*2,gI.attribSize*2);var uvs=new Float32Array(geometry.uvsFloat32.buffer,gI.attribStart*4*2,gI.attribSize*2);var indices2=new Uint16Array(geometry.indicesUint16.buffer,gI.start*2,gI.size);var batch={vertexData:vertexData,blendMode:blendMode,indices:indices2,uvs:uvs,_batchRGB:_hex2rgb(color),_tintRGB:color,_texture:gI.style.texture,alpha:gI.style.alpha,worldAlpha:1};this.batches[i]=batch}};Graphics2.prototype._renderBatched=function _renderBatched(renderer){if(!this.batches.length){return}renderer.batch.setObjectRenderer(renderer.plugins[this.pluginName]);this.calculateVertices();this.calculateTints();for(var i=0,l=this.batches.length;i<l;i++){var batch=this.batches[i];batch.worldAlpha=this.worldAlpha*batch.alpha;renderer.plugins[this.pluginName].render(batch)}};Graphics2.prototype._renderDirect=function _renderDirect(renderer){var shader=this._resolveDirectShader(renderer);var geometry=this.geometry;var tint=this.tint;var worldAlpha=this.worldAlpha;var uniforms=shader.uniforms;var drawCalls=geometry.drawCalls;uniforms.translationMatrix=this.transform.worldTransform;uniforms.tint[0]=(tint>>16&255)/255*worldAlpha;uniforms.tint[1]=(tint>>8&255)/255*worldAlpha;uniforms.tint[2]=(tint&255)/255*worldAlpha;uniforms.tint[3]=worldAlpha;renderer.shader.bind(shader);renderer.geometry.bind(geometry,shader);renderer.state.set(this.state);for(var i=0,l=drawCalls.length;i<l;i++){this._renderDrawCallDirect(renderer,geometry.drawCalls[i])}};Graphics2.prototype._renderDrawCallDirect=function _renderDrawCallDirect(renderer,drawCall){var textures=drawCall.textures;var type=drawCall.type;var size=drawCall.size;var start2=drawCall.start;var groupTextureCount=textures.count;for(var j=0;j<groupTextureCount;j++){renderer.texture.bind(textures.elements[j],j)}renderer.geometry.draw(type,size,start2)};Graphics2.prototype._resolveDirectShader=function _resolveDirectShader(renderer){var shader=this.shader;var pluginName=this.pluginName;if(!shader){if(!DEFAULT_SHADERS[pluginName]){var sampleValues=new Int32Array(16);for(var i=0;i<16;i++){sampleValues[i]=i}var uniforms={tint:new Float32Array([1,1,1,1]),translationMatrix:new Matrix,default:UniformGroup.from({uSamplers:sampleValues},true)};var program=renderer.plugins[pluginName]._shader.program;DEFAULT_SHADERS[pluginName]=new Shader(program,uniforms)}shader=DEFAULT_SHADERS[pluginName]}return shader};Graphics2.prototype._calculateBounds=function _calculateBounds(){this.finishPoly();var geometry=this.geometry;if(!geometry.graphicsData.length){return}var ref=geometry.bounds;var minX=ref.minX;var minY=ref.minY;var maxX=ref.maxX;var maxY=ref.maxY;this._bounds.addFrame(this.transform,minX,minY,maxX,maxY)};Graphics2.prototype.containsPoint=function containsPoint(point){this.worldTransform.applyInverse(point,Graphics2._TEMP_POINT);return this.geometry.containsPoint(Graphics2._TEMP_POINT)};Graphics2.prototype.calculateTints=function calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this.tint;var tintRGB=_hex2rgb(this.tint,temp);for(var i=0;i<this.batches.length;i++){var batch=this.batches[i];var batchTint=batch._batchRGB;var r=tintRGB[0]*batchTint[0]*255;var g=tintRGB[1]*batchTint[1]*255;var b=tintRGB[2]*batchTint[2]*255;var color=(r<<16)+(g<<8)+(b|0);batch._tintRGB=(color>>16)+(color&65280)+((color&255)<<16)}}};Graphics2.prototype.calculateVertices=function calculateVertices(){if(this._transformID===this.transform._worldID){return}this._transformID=this.transform._worldID;var wt=this.transform.worldTransform;var a=wt.a;var b=wt.b;var c=wt.c;var d=wt.d;var tx=wt.tx;var ty=wt.ty;var data=this.geometry.points;var vertexData=this.vertexData;var count=0;for(var i=0;i<data.length;i+=2){var x=data[i];var y=data[i+1];vertexData[count++]=a*x+c*y+tx;vertexData[count++]=d*y+b*x+ty}};Graphics2.prototype.closePath=function closePath(){var currentPath=this.currentPath;if(currentPath){currentPath.closeStroke=true}return this};Graphics2.prototype.setMatrix=function setMatrix(matrix){this._matrix=matrix;return this};Graphics2.prototype.beginHole=function beginHole(){this.finishPoly();this._holeMode=true;return this};Graphics2.prototype.endHole=function endHole(){this.finishPoly();this._holeMode=false;return this};Graphics2.prototype.destroy=function destroy25(options){Container2.prototype.destroy.call(this,options);this.geometry.refCount--;if(this.geometry.refCount===0){this.geometry.dispose()}this._matrix=null;this.currentPath=null;this._lineStyle.destroy();this._lineStyle=null;this._fillStyle.destroy();this._fillStyle=null;this.geometry=null;this.shader=null;this.vertexData=null;this.batches.length=0;this.batches=null;Container2.prototype.destroy.call(this,options)};Object.defineProperties(Graphics2.prototype,prototypeAccessors5);return Graphics2}(Container);Graphics._TEMP_POINT=new Point;var tempPoint=new Point;var indices=new Uint16Array([0,1,2,0,2,3]);var Sprite=function(Container2){function Sprite2(texture){Container2.call(this);this._anchor=new ObservablePoint(this._onAnchorUpdate,this,texture?texture.defaultAnchor.x:0,texture?texture.defaultAnchor.y:0);this._texture=null;this._width=0;this._height=0;this._tint=null;this._tintRGB=null;this.tint=16777215;this.blendMode=BLEND_MODES.NORMAL;this.shader=null;this._cachedTint=16777215;this.uvs=null;this.texture=texture||Texture.EMPTY;this.vertexData=new Float32Array(8);this.vertexTrimmedData=null;this._transformID=-1;this._textureID=-1;this._transformTrimmedID=-1;this._textureTrimmedID=-1;this.indices=indices;this.pluginName="batch";this.isSprite=true;this._roundPixels=settings.ROUND_PIXELS}if(Container2)Sprite2.__proto__=Container2;Sprite2.prototype=Object.create(Container2&&Container2.prototype);Sprite2.prototype.constructor=Sprite2;var prototypeAccessors5={roundPixels:{configurable:true},width:{configurable:true},height:{configurable:true},anchor:{configurable:true},tint:{configurable:true},texture:{configurable:true}};Sprite2.prototype._onTextureUpdate=function _onTextureUpdate(){this._textureID=-1;this._textureTrimmedID=-1;this._cachedTint=16777215;if(this._width){this.scale.x=_sign(this.scale.x)*this._width/this._texture.orig.width}if(this._height){this.scale.y=_sign(this.scale.y)*this._height/this._texture.orig.height}};Sprite2.prototype._onAnchorUpdate=function _onAnchorUpdate(){this._transformID=-1;this._transformTrimmedID=-1};Sprite2.prototype.calculateVertices=function calculateVertices(){var texture=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===texture._updateID){return}if(this._textureID!==texture._updateID){this.uvs=this._texture._uvs.uvsFloat32}this._transformID=this.transform._worldID;this._textureID=texture._updateID;var wt=this.transform.worldTransform;var a=wt.a;var b=wt.b;var c=wt.c;var d=wt.d;var tx=wt.tx;var ty=wt.ty;var vertexData=this.vertexData;var trim=texture.trim;var orig=texture.orig;var anchor=this._anchor;var w0=0;var w1=0;var h0=0;var h1=0;if(trim){w1=trim.x-anchor._x*orig.width;w0=w1+trim.width;h1=trim.y-anchor._y*orig.height;h0=h1+trim.height}else{w1=-anchor._x*orig.width;w0=w1+orig.width;h1=-anchor._y*orig.height;h0=h1+orig.height}vertexData[0]=a*w1+c*h1+tx;vertexData[1]=d*h1+b*w1+ty;vertexData[2]=a*w0+c*h1+tx;vertexData[3]=d*h1+b*w0+ty;vertexData[4]=a*w0+c*h0+tx;vertexData[5]=d*h0+b*w0+ty;vertexData[6]=a*w1+c*h0+tx;vertexData[7]=d*h0+b*w1+ty;if(this._roundPixels){var resolution=settings.RESOLUTION;for(var i=0;i<vertexData.length;++i){vertexData[i]=Math.round((vertexData[i]*resolution|0)/resolution)}}};Sprite2.prototype.calculateTrimmedVertices=function calculateTrimmedVertices(){if(!this.vertexTrimmedData){this.vertexTrimmedData=new Float32Array(8)}else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID){return}this._transformTrimmedID=this.transform._worldID;this._textureTrimmedID=this._texture._updateID;var texture=this._texture;var vertexData=this.vertexTrimmedData;var orig=texture.orig;var anchor=this._anchor;var wt=this.transform.worldTransform;var a=wt.a;var b=wt.b;var c=wt.c;var d=wt.d;var tx=wt.tx;var ty=wt.ty;var w1=-anchor._x*orig.width;var w0=w1+orig.width;var h1=-anchor._y*orig.height;var h0=h1+orig.height;vertexData[0]=a*w1+c*h1+tx;vertexData[1]=d*h1+b*w1+ty;vertexData[2]=a*w0+c*h1+tx;vertexData[3]=d*h1+b*w0+ty;vertexData[4]=a*w0+c*h0+tx;vertexData[5]=d*h0+b*w0+ty;vertexData[6]=a*w1+c*h0+tx;vertexData[7]=d*h0+b*w1+ty};Sprite2.prototype._render=function _render(renderer){this.calculateVertices();renderer.batch.setObjectRenderer(renderer.plugins[this.pluginName]);renderer.plugins[this.pluginName].render(this)};Sprite2.prototype._calculateBounds=function _calculateBounds(){var trim=this._texture.trim;var orig=this._texture.orig;if(!trim||trim.width===orig.width&&trim.height===orig.height){this.calculateVertices();this._bounds.addQuad(this.vertexData)}else{this.calculateTrimmedVertices();this._bounds.addQuad(this.vertexTrimmedData)}};Sprite2.prototype.getLocalBounds=function getLocalBounds(rect){if(this.children.length===0){this._bounds.minX=this._texture.orig.width*-this._anchor._x;this._bounds.minY=this._texture.orig.height*-this._anchor._y;this._bounds.maxX=this._texture.orig.width*(1-this._anchor._x);this._bounds.maxY=this._texture.orig.height*(1-this._anchor._y);if(!rect){if(!this._localBoundsRect){this._localBoundsRect=new Rectangle}rect=this._localBoundsRect}return this._bounds.getRectangle(rect)}return Container2.prototype.getLocalBounds.call(this,rect)};Sprite2.prototype.containsPoint=function containsPoint(point){this.worldTransform.applyInverse(point,tempPoint);var width=this._texture.orig.width;var height=this._texture.orig.height;var x1=-width*this.anchor.x;var y1=0;if(tempPoint.x>=x1&&tempPoint.x<x1+width){y1=-height*this.anchor.y;if(tempPoint.y>=y1&&tempPoint.y<y1+height){return true}}return false};Sprite2.prototype.destroy=function destroy25(options){Container2.prototype.destroy.call(this,options);this._texture.off("update",this._onTextureUpdate,this);this._anchor=null;var destroyTexture=typeof options==="boolean"?options:options&&options.texture;if(destroyTexture){var destroyBaseTexture=typeof options==="boolean"?options:options&&options.baseTexture;this._texture.destroy(!!destroyBaseTexture)}this._texture=null;this.shader=null};Sprite2.from=function from6(source,options){var texture=source instanceof Texture?source:Texture.from(source,options);return new Sprite2(texture)};prototypeAccessors5.roundPixels.set=function(value){if(this._roundPixels!==value){this._transformID=-1}this._roundPixels=value};prototypeAccessors5.roundPixels.get=function(){return this._roundPixels};prototypeAccessors5.width.get=function(){return Math.abs(this.scale.x)*this._texture.orig.width};prototypeAccessors5.width.set=function(value){var s=_sign(this.scale.x)||1;this.scale.x=s*value/this._texture.orig.width;this._width=value};prototypeAccessors5.height.get=function(){return Math.abs(this.scale.y)*this._texture.orig.height};prototypeAccessors5.height.set=function(value){var s=_sign(this.scale.y)||1;this.scale.y=s*value/this._texture.orig.height;this._height=value};prototypeAccessors5.anchor.get=function(){return this._anchor};prototypeAccessors5.anchor.set=function(value){this._anchor.copyFrom(value)};prototypeAccessors5.tint.get=function(){return this._tint};prototypeAccessors5.tint.set=function(value){this._tint=value;this._tintRGB=(value>>16)+(value&65280)+((value&255)<<16)};prototypeAccessors5.texture.get=function(){return this._texture};prototypeAccessors5.texture.set=function(value){if(this._texture===value){return}if(this._texture){this._texture.off("update",this._onTextureUpdate,this)}this._texture=value||Texture.EMPTY;this._cachedTint=16777215;this._textureID=-1;this._textureTrimmedID=-1;if(value){if(value.baseTexture.valid){this._onTextureUpdate()}else{value.once("update",this._onTextureUpdate,this)}}};Object.defineProperties(Sprite2.prototype,prototypeAccessors5);return Sprite2}(Container);var TEXT_GRADIENT={LINEAR_VERTICAL:0,LINEAR_HORIZONTAL:1};var defaultStyle={align:"left",breakWords:false,dropShadow:false,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:TEXT_GRADIENT.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:false,whiteSpace:"pre",wordWrap:false,wordWrapWidth:100,leading:0};var genericFontFamilies=["serif","sans-serif","monospace","cursive","fantasy","system-ui"];var TextStyle=function TextStyle2(style2){this.styleID=0;this.reset();deepCopyProperties(this,style2,style2)};var prototypeAccessors4={align:{configurable:true},breakWords:{configurable:true},dropShadow:{configurable:true},dropShadowAlpha:{configurable:true},dropShadowAngle:{configurable:true},dropShadowBlur:{configurable:true},dropShadowColor:{configurable:true},dropShadowDistance:{configurable:true},fill:{configurable:true},fillGradientType:{configurable:true},fillGradientStops:{configurable:true},fontFamily:{configurable:true},fontSize:{configurable:true},fontStyle:{configurable:true},fontVariant:{configurable:true},fontWeight:{configurable:true},letterSpacing:{configurable:true},lineHeight:{configurable:true},leading:{configurable:true},lineJoin:{configurable:true},miterLimit:{configurable:true},padding:{configurable:true},stroke:{configurable:true},strokeThickness:{configurable:true},textBaseline:{configurable:true},trim:{configurable:true},whiteSpace:{configurable:true},wordWrap:{configurable:true},wordWrapWidth:{configurable:true}};TextStyle.prototype.clone=function clone4(){var clonedProperties={};deepCopyProperties(clonedProperties,this,defaultStyle);return new TextStyle(clonedProperties)};TextStyle.prototype.reset=function reset6(){deepCopyProperties(this,defaultStyle,defaultStyle)};prototypeAccessors4.align.get=function(){return this._align};prototypeAccessors4.align.set=function(align){if(this._align!==align){this._align=align;this.styleID++}};prototypeAccessors4.breakWords.get=function(){return this._breakWords};prototypeAccessors4.breakWords.set=function(breakWords){if(this._breakWords!==breakWords){this._breakWords=breakWords;this.styleID++}};prototypeAccessors4.dropShadow.get=function(){return this._dropShadow};prototypeAccessors4.dropShadow.set=function(dropShadow){if(this._dropShadow!==dropShadow){this._dropShadow=dropShadow;this.styleID++}};prototypeAccessors4.dropShadowAlpha.get=function(){return this._dropShadowAlpha};prototypeAccessors4.dropShadowAlpha.set=function(dropShadowAlpha){if(this._dropShadowAlpha!==dropShadowAlpha){this._dropShadowAlpha=dropShadowAlpha;this.styleID++}};prototypeAccessors4.dropShadowAngle.get=function(){return this._dropShadowAngle};prototypeAccessors4.dropShadowAngle.set=function(dropShadowAngle){if(this._dropShadowAngle!==dropShadowAngle){this._dropShadowAngle=dropShadowAngle;this.styleID++}};prototypeAccessors4.dropShadowBlur.get=function(){return this._dropShadowBlur};prototypeAccessors4.dropShadowBlur.set=function(dropShadowBlur){if(this._dropShadowBlur!==dropShadowBlur){this._dropShadowBlur=dropShadowBlur;this.styleID++}};prototypeAccessors4.dropShadowColor.get=function(){return this._dropShadowColor};prototypeAccessors4.dropShadowColor.set=function(dropShadowColor){var outputColor=getColor(dropShadowColor);if(this._dropShadowColor!==outputColor){this._dropShadowColor=outputColor;this.styleID++}};prototypeAccessors4.dropShadowDistance.get=function(){return this._dropShadowDistance};prototypeAccessors4.dropShadowDistance.set=function(dropShadowDistance){if(this._dropShadowDistance!==dropShadowDistance){this._dropShadowDistance=dropShadowDistance;this.styleID++}};prototypeAccessors4.fill.get=function(){return this._fill};prototypeAccessors4.fill.set=function(fill){var outputColor=getColor(fill);if(this._fill!==outputColor){this._fill=outputColor;this.styleID++}};prototypeAccessors4.fillGradientType.get=function(){return this._fillGradientType};prototypeAccessors4.fillGradientType.set=function(fillGradientType){if(this._fillGradientType!==fillGradientType){this._fillGradientType=fillGradientType;this.styleID++}};prototypeAccessors4.fillGradientStops.get=function(){return this._fillGradientStops};prototypeAccessors4.fillGradientStops.set=function(fillGradientStops){if(!areArraysEqual(this._fillGradientStops,fillGradientStops)){this._fillGradientStops=fillGradientStops;this.styleID++}};prototypeAccessors4.fontFamily.get=function(){return this._fontFamily};prototypeAccessors4.fontFamily.set=function(fontFamily){if(this.fontFamily!==fontFamily){this._fontFamily=fontFamily;this.styleID++}};prototypeAccessors4.fontSize.get=function(){return this._fontSize};prototypeAccessors4.fontSize.set=function(fontSize){if(this._fontSize!==fontSize){this._fontSize=fontSize;this.styleID++}};prototypeAccessors4.fontStyle.get=function(){return this._fontStyle};prototypeAccessors4.fontStyle.set=function(fontStyle){if(this._fontStyle!==fontStyle){this._fontStyle=fontStyle;this.styleID++}};prototypeAccessors4.fontVariant.get=function(){return this._fontVariant};prototypeAccessors4.fontVariant.set=function(fontVariant){if(this._fontVariant!==fontVariant){this._fontVariant=fontVariant;this.styleID++}};prototypeAccessors4.fontWeight.get=function(){return this._fontWeight};prototypeAccessors4.fontWeight.set=function(fontWeight){if(this._fontWeight!==fontWeight){this._fontWeight=fontWeight;this.styleID++}};prototypeAccessors4.letterSpacing.get=function(){return this._letterSpacing};prototypeAccessors4.letterSpacing.set=function(letterSpacing){if(this._letterSpacing!==letterSpacing){this._letterSpacing=letterSpacing;this.styleID++}};prototypeAccessors4.lineHeight.get=function(){return this._lineHeight};prototypeAccessors4.lineHeight.set=function(lineHeight){if(this._lineHeight!==lineHeight){this._lineHeight=lineHeight;this.styleID++}};prototypeAccessors4.leading.get=function(){return this._leading};prototypeAccessors4.leading.set=function(leading){if(this._leading!==leading){this._leading=leading;this.styleID++}};prototypeAccessors4.lineJoin.get=function(){return this._lineJoin};prototypeAccessors4.lineJoin.set=function(lineJoin){if(this._lineJoin!==lineJoin){this._lineJoin=lineJoin;this.styleID++}};prototypeAccessors4.miterLimit.get=function(){return this._miterLimit};prototypeAccessors4.miterLimit.set=function(miterLimit){if(this._miterLimit!==miterLimit){this._miterLimit=miterLimit;this.styleID++}};prototypeAccessors4.padding.get=function(){return this._padding};prototypeAccessors4.padding.set=function(padding){if(this._padding!==padding){this._padding=padding;this.styleID++}};prototypeAccessors4.stroke.get=function(){return this._stroke};prototypeAccessors4.stroke.set=function(stroke){var outputColor=getColor(stroke);if(this._stroke!==outputColor){this._stroke=outputColor;this.styleID++}};prototypeAccessors4.strokeThickness.get=function(){return this._strokeThickness};prototypeAccessors4.strokeThickness.set=function(strokeThickness){if(this._strokeThickness!==strokeThickness){this._strokeThickness=strokeThickness;this.styleID++}};prototypeAccessors4.textBaseline.get=function(){return this._textBaseline};prototypeAccessors4.textBaseline.set=function(textBaseline){if(this._textBaseline!==textBaseline){this._textBaseline=textBaseline;this.styleID++}};prototypeAccessors4.trim.get=function(){return this._trim};prototypeAccessors4.trim.set=function(trim){if(this._trim!==trim){this._trim=trim;this.styleID++}};prototypeAccessors4.whiteSpace.get=function(){return this._whiteSpace};prototypeAccessors4.whiteSpace.set=function(whiteSpace){if(this._whiteSpace!==whiteSpace){this._whiteSpace=whiteSpace;this.styleID++}};prototypeAccessors4.wordWrap.get=function(){return this._wordWrap};prototypeAccessors4.wordWrap.set=function(wordWrap2){if(this._wordWrap!==wordWrap2){this._wordWrap=wordWrap2;this.styleID++}};prototypeAccessors4.wordWrapWidth.get=function(){return this._wordWrapWidth};prototypeAccessors4.wordWrapWidth.set=function(wordWrapWidth){if(this._wordWrapWidth!==wordWrapWidth){this._wordWrapWidth=wordWrapWidth;this.styleID++}};TextStyle.prototype.toFontString=function toFontString(){var fontSizeString=typeof this.fontSize==="number"?this.fontSize+"px":this.fontSize;var fontFamilies=this.fontFamily;if(!Array.isArray(this.fontFamily)){fontFamilies=this.fontFamily.split(",")}for(var i=fontFamilies.length-1;i>=0;i--){var fontFamily=fontFamilies[i].trim();if(!/([\"\'])[^\'\"]+\1/.test(fontFamily)&&genericFontFamilies.indexOf(fontFamily)<0){fontFamily="\""+fontFamily+"\""}fontFamilies[i]=fontFamily}return this.fontStyle+" "+this.fontVariant+" "+this.fontWeight+" "+fontSizeString+" "+fontFamilies.join(",")};Object.defineProperties(TextStyle.prototype,prototypeAccessors4);function getSingleColor(color){if(typeof color==="number"){return _hex2string(color)}else if(typeof color==="string"){if(color.indexOf("0x")===0){color=color.replace("0x","#")}}return color}function getColor(color){if(!Array.isArray(color)){return getSingleColor(color)}else{for(var i=0;i<color.length;++i){color[i]=getSingleColor(color[i])}return color}}function areArraysEqual(array1,array2){if(!Array.isArray(array1)||!Array.isArray(array2)){return false}if(array1.length!==array2.length){return false}for(var i=0;i<array1.length;++i){if(array1[i]!==array2[i]){return false}}return true}function deepCopyProperties(target,source,propertyObj){for(var prop in propertyObj){if(Array.isArray(source[prop])){target[prop]=source[prop].slice()}else{target[prop]=source[prop]}}}var TextMetrics=function TextMetrics2(text,style2,width,height,lines,lineWidths,lineHeight,maxLineWidth,fontProperties){this.text=text;this.style=style2;this.width=width;this.height=height;this.lines=lines;this.lineWidths=lineWidths;this.lineHeight=lineHeight;this.maxLineWidth=maxLineWidth;this.fontProperties=fontProperties};TextMetrics.measureText=function measureText(text,style2,wordWrap2,canvas4){if(canvas4===void 0)canvas4=TextMetrics._canvas;wordWrap2=wordWrap2===void 0||wordWrap2===null?style2.wordWrap:wordWrap2;var font=style2.toFontString();var fontProperties=TextMetrics.measureFont(font);if(fontProperties.fontSize===0){fontProperties.fontSize=style2.fontSize;fontProperties.ascent=style2.fontSize}var context2=canvas4.getContext("2d");context2.font=font;var outputText=wordWrap2?TextMetrics.wordWrap(text,style2,canvas4):text;var lines=outputText.split(/(?:\r\n|\r|\n)/);var lineWidths=new Array(lines.length);var maxLineWidth=0;for(var i=0;i<lines.length;i++){var lineWidth=context2.measureText(lines[i]).width+(lines[i].length-1)*style2.letterSpacing;lineWidths[i]=lineWidth;maxLineWidth=Math.max(maxLineWidth,lineWidth)}var width=maxLineWidth+style2.strokeThickness;if(style2.dropShadow){width+=style2.dropShadowDistance}var lineHeight=style2.lineHeight||fontProperties.fontSize+style2.strokeThickness;var height=Math.max(lineHeight,fontProperties.fontSize+style2.strokeThickness)+(lines.length-1)*(lineHeight+style2.leading);if(style2.dropShadow){height+=style2.dropShadowDistance}return new TextMetrics(text,style2,width,height,lines,lineWidths,lineHeight+style2.leading,maxLineWidth,fontProperties)};TextMetrics.wordWrap=function wordWrap(text,style2,canvas4){if(canvas4===void 0)canvas4=TextMetrics._canvas;var context2=canvas4.getContext("2d");var width=0;var line="";var lines="";var cache2={};var letterSpacing=style2.letterSpacing;var whiteSpace=style2.whiteSpace;var collapseSpaces2=TextMetrics.collapseSpaces(whiteSpace);var collapseNewlines2=TextMetrics.collapseNewlines(whiteSpace);var canPrependSpaces=!collapseSpaces2;var wordWrapWidth=style2.wordWrapWidth+letterSpacing;var tokens=TextMetrics.tokenize(text);for(var i=0;i<tokens.length;i++){var token=tokens[i];if(TextMetrics.isNewline(token)){if(!collapseNewlines2){lines+=TextMetrics.addLine(line);canPrependSpaces=!collapseSpaces2;line="";width=0;continue}token=" "}if(collapseSpaces2){var currIsBreakingSpace=TextMetrics.isBreakingSpace(token);var lastIsBreakingSpace=TextMetrics.isBreakingSpace(line[line.length-1]);if(currIsBreakingSpace&&lastIsBreakingSpace){continue}}var tokenWidth=TextMetrics.getFromCache(token,letterSpacing,cache2,context2);if(tokenWidth>wordWrapWidth){if(line!==""){lines+=TextMetrics.addLine(line);line="";width=0}if(TextMetrics.canBreakWords(token,style2.breakWords)){var characters=TextMetrics.wordWrapSplit(token);for(var j=0;j<characters.length;j++){var char=characters[j];var k=1;while(characters[j+k]){var nextChar=characters[j+k];var lastChar=char[char.length-1];if(!TextMetrics.canBreakChars(lastChar,nextChar,token,j,style2.breakWords)){char+=nextChar}else{break}k++}j+=char.length-1;var characterWidth=TextMetrics.getFromCache(char,letterSpacing,cache2,context2);if(characterWidth+width>wordWrapWidth){lines+=TextMetrics.addLine(line);canPrependSpaces=false;line="";width=0}line+=char;width+=characterWidth}}else{if(line.length>0){lines+=TextMetrics.addLine(line);line="";width=0}var isLastToken=i===tokens.length-1;lines+=TextMetrics.addLine(token,!isLastToken);canPrependSpaces=false;line="";width=0}}else{if(tokenWidth+width>wordWrapWidth){canPrependSpaces=false;lines+=TextMetrics.addLine(line);line="";width=0}if(line.length>0||!TextMetrics.isBreakingSpace(token)||canPrependSpaces){line+=token;width+=tokenWidth}}}lines+=TextMetrics.addLine(line,false);return lines};TextMetrics.addLine=function addLine(line,newLine){if(newLine===void 0)newLine=true;line=TextMetrics.trimRight(line);line=newLine?line+"\n":line;return line};TextMetrics.getFromCache=function getFromCache(key,letterSpacing,cache2,context2){var width=cache2[key];if(width===void 0){var spacing=key.length*letterSpacing;width=context2.measureText(key).width+spacing;cache2[key]=width}return width};TextMetrics.collapseSpaces=function collapseSpaces(whiteSpace){return whiteSpace==="normal"||whiteSpace==="pre-line"};TextMetrics.collapseNewlines=function collapseNewlines(whiteSpace){return whiteSpace==="normal"};TextMetrics.trimRight=function trimRight(text){if(typeof text!=="string"){return""}for(var i=text.length-1;i>=0;i--){var char=text[i];if(!TextMetrics.isBreakingSpace(char)){break}text=text.slice(0,-1)}return text};TextMetrics.isNewline=function isNewline(char){if(typeof char!=="string"){return false}return TextMetrics._newlines.indexOf(char.charCodeAt(0))>=0};TextMetrics.isBreakingSpace=function isBreakingSpace(char){if(typeof char!=="string"){return false}return TextMetrics._breakingSpaces.indexOf(char.charCodeAt(0))>=0};TextMetrics.tokenize=function tokenize(text){var tokens=[];var token="";if(typeof text!=="string"){return tokens}for(var i=0;i<text.length;i++){var char=text[i];if(TextMetrics.isBreakingSpace(char)||TextMetrics.isNewline(char)){if(token!==""){tokens.push(token);token=""}tokens.push(char);continue}token+=char}if(token!==""){tokens.push(token)}return tokens};TextMetrics.canBreakWords=function canBreakWords(token,breakWords){return breakWords};TextMetrics.canBreakChars=function canBreakChars(char,nextChar,token,index3,breakWords){return true};TextMetrics.wordWrapSplit=function wordWrapSplit(token){return token.split("")};TextMetrics.measureFont=function measureFont(font){if(TextMetrics._fonts[font]){return TextMetrics._fonts[font]}var properties={};var canvas4=TextMetrics._canvas;var context2=TextMetrics._context;context2.font=font;var metricsString=TextMetrics.METRICS_STRING+TextMetrics.BASELINE_SYMBOL;var width=Math.ceil(context2.measureText(metricsString).width);var baseline=Math.ceil(context2.measureText(TextMetrics.BASELINE_SYMBOL).width);var height=2*baseline;baseline=baseline*TextMetrics.BASELINE_MULTIPLIER|0;canvas4.width=width;canvas4.height=height;context2.fillStyle="#f00";context2.fillRect(0,0,width,height);context2.font=font;context2.textBaseline="alphabetic";context2.fillStyle="#000";context2.fillText(metricsString,0,baseline);var imagedata=context2.getImageData(0,0,width,height).data;var pixels3=imagedata.length;var line=width*4;var i=0;var idx=0;var stop2=false;for(i=0;i<baseline;++i){for(var j=0;j<line;j+=4){if(imagedata[idx+j]!==255){stop2=true;break}}if(!stop2){idx+=line}else{break}}properties.ascent=baseline-i;idx=pixels3-line;stop2=false;for(i=height;i>baseline;--i){for(var j$1=0;j$1<line;j$1+=4){if(imagedata[idx+j$1]!==255){stop2=true;break}}if(!stop2){idx-=line}else{break}}properties.descent=i-baseline;properties.fontSize=properties.ascent+properties.descent;TextMetrics._fonts[font]=properties;return properties};TextMetrics.clearMetrics=function clearMetrics(font){if(font===void 0)font="";if(font){delete TextMetrics._fonts[font]}else{TextMetrics._fonts={}}};var canvas2=function(){try{var c=new OffscreenCanvas(0,0);var context2=c.getContext("2d");if(context2&&context2.measureText){return c}return document.createElement("canvas")}catch(ex){return document.createElement("canvas")}}();canvas2.width=canvas2.height=10;TextMetrics._canvas=canvas2;TextMetrics._context=canvas2.getContext("2d");TextMetrics._fonts={};TextMetrics.METRICS_STRING="|\xC9q\xC5";TextMetrics.BASELINE_SYMBOL="M";TextMetrics.BASELINE_MULTIPLIER=1.4;TextMetrics._newlines=[10,13];TextMetrics._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];var defaultDestroyOptions={texture:true,children:false,baseTexture:true};var Text=function(Sprite2){function Text2(text,style2,canvas4){var ownCanvas=false;if(!canvas4){canvas4=document.createElement("canvas");ownCanvas=true}canvas4.width=3;canvas4.height=3;var texture=Texture.from(canvas4);texture.orig=new Rectangle;texture.trim=new Rectangle;Sprite2.call(this,texture);this._ownCanvas=ownCanvas;this.canvas=canvas4;this.context=this.canvas.getContext("2d");this._resolution=settings.RESOLUTION;this._autoResolution=true;this._text=null;this._style=null;this._styleListener=null;this._font="";this.text=text;this.style=style2;this.localStyleID=-1}if(Sprite2)Text2.__proto__=Sprite2;Text2.prototype=Object.create(Sprite2&&Sprite2.prototype);Text2.prototype.constructor=Text2;var prototypeAccessors5={width:{configurable:true},height:{configurable:true},style:{configurable:true},text:{configurable:true},resolution:{configurable:true}};Text2.prototype.updateText=function updateText(respectDirty){var style2=this._style;if(this.localStyleID!==style2.styleID){this.dirty=true;this.localStyleID=style2.styleID}if(!this.dirty&&respectDirty){return}this._font=this._style.toFontString();var context2=this.context;var measured=TextMetrics.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas);var width=measured.width;var height=measured.height;var lines=measured.lines;var lineHeight=measured.lineHeight;var lineWidths=measured.lineWidths;var maxLineWidth=measured.maxLineWidth;var fontProperties=measured.fontProperties;this.canvas.width=Math.ceil((Math.max(1,width)+style2.padding*2)*this._resolution);this.canvas.height=Math.ceil((Math.max(1,height)+style2.padding*2)*this._resolution);context2.scale(this._resolution,this._resolution);context2.clearRect(0,0,this.canvas.width,this.canvas.height);context2.font=this._font;context2.lineWidth=style2.strokeThickness;context2.textBaseline=style2.textBaseline;context2.lineJoin=style2.lineJoin;context2.miterLimit=style2.miterLimit;var linePositionX;var linePositionY;var passesCount=style2.dropShadow?2:1;for(var i=0;i<passesCount;++i){var isShadowPass=style2.dropShadow&&i===0;var dsOffsetText=isShadowPass?height*2:0;var dsOffsetShadow=dsOffsetText*this.resolution;if(isShadowPass){context2.fillStyle="black";context2.strokeStyle="black";var dropShadowColor=style2.dropShadowColor;var rgb=_hex2rgb(typeof dropShadowColor==="number"?dropShadowColor:_string2hex(dropShadowColor));context2.shadowColor="rgba("+rgb[0]*255+","+rgb[1]*255+","+rgb[2]*255+","+style2.dropShadowAlpha+")";context2.shadowBlur=style2.dropShadowBlur;context2.shadowOffsetX=Math.cos(style2.dropShadowAngle)*style2.dropShadowDistance;context2.shadowOffsetY=Math.sin(style2.dropShadowAngle)*style2.dropShadowDistance+dsOffsetShadow}else{context2.fillStyle=this._generateFillStyle(style2,lines,measured);context2.strokeStyle=style2.stroke;context2.shadowColor=0;context2.shadowBlur=0;context2.shadowOffsetX=0;context2.shadowOffsetY=0}for(var i$1=0;i$1<lines.length;i$1++){linePositionX=style2.strokeThickness/2;linePositionY=style2.strokeThickness/2+i$1*lineHeight+fontProperties.ascent;if(style2.align==="right"){linePositionX+=maxLineWidth-lineWidths[i$1]}else if(style2.align==="center"){linePositionX+=(maxLineWidth-lineWidths[i$1])/2}if(style2.stroke&&style2.strokeThickness){this.drawLetterSpacing(lines[i$1],linePositionX+style2.padding,linePositionY+style2.padding-dsOffsetText,true)}if(style2.fill){this.drawLetterSpacing(lines[i$1],linePositionX+style2.padding,linePositionY+style2.padding-dsOffsetText)}}}this.updateTexture()};Text2.prototype.drawLetterSpacing=function drawLetterSpacing(text,x,y,isStroke){if(isStroke===void 0)isStroke=false;var style2=this._style;var letterSpacing=style2.letterSpacing;if(letterSpacing===0){if(isStroke){this.context.strokeText(text,x,y)}else{this.context.fillText(text,x,y)}return}var currentPosition=x;var stringArray=Array.from?Array.from(text):text.split("");var previousWidth=this.context.measureText(text).width;var currentWidth=0;for(var i=0;i<stringArray.length;++i){var currentChar=stringArray[i];if(isStroke){this.context.strokeText(currentChar,currentPosition,y)}else{this.context.fillText(currentChar,currentPosition,y)}currentWidth=this.context.measureText(text.substring(i+1)).width;currentPosition+=previousWidth-currentWidth+letterSpacing;previousWidth=currentWidth}};Text2.prototype.updateTexture=function updateTexture(){var canvas4=this.canvas;if(this._style.trim){var trimmed=_trimCanvas(canvas4);if(trimmed.data){canvas4.width=trimmed.width;canvas4.height=trimmed.height;this.context.putImageData(trimmed.data,0,0)}}var texture=this._texture;var style2=this._style;var padding=style2.trim?0:style2.padding;var baseTexture=texture.baseTexture;texture.trim.width=texture._frame.width=Math.ceil(canvas4.width/this._resolution);texture.trim.height=texture._frame.height=Math.ceil(canvas4.height/this._resolution);texture.trim.x=-padding;texture.trim.y=-padding;texture.orig.width=texture._frame.width-padding*2;texture.orig.height=texture._frame.height-padding*2;this._onTextureUpdate();baseTexture.setRealSize(canvas4.width,canvas4.height,this._resolution);this.dirty=false};Text2.prototype._render=function _render(renderer){if(this._autoResolution&&this._resolution!==renderer.resolution){this._resolution=renderer.resolution;this.dirty=true}this.updateText(true);Sprite2.prototype._render.call(this,renderer)};Text2.prototype.getLocalBounds=function getLocalBounds(rect){this.updateText(true);return Sprite2.prototype.getLocalBounds.call(this,rect)};Text2.prototype._calculateBounds=function _calculateBounds(){this.updateText(true);this.calculateVertices();this._bounds.addQuad(this.vertexData)};Text2.prototype._onStyleChange=function _onStyleChange(){this.dirty=true};Text2.prototype._generateFillStyle=function _generateFillStyle(style2,lines,metrics){if(!Array.isArray(style2.fill)){return style2.fill}else if(style2.fill.length===1){return style2.fill[0]}var gradient;var dropShadowCorrection=style2.dropShadow?style2.dropShadowDistance:0;var padding=style2.padding||0;var width=Math.ceil(this.canvas.width/this._resolution)-dropShadowCorrection-padding*2;var height=Math.ceil(this.canvas.height/this._resolution)-dropShadowCorrection-padding*2;var fill=style2.fill.slice();var fillGradientStops=style2.fillGradientStops.slice();if(!fillGradientStops.length){var lengthPlus1=fill.length+1;for(var i=1;i<lengthPlus1;++i){fillGradientStops.push(i/lengthPlus1)}}fill.unshift(style2.fill[0]);fillGradientStops.unshift(0);fill.push(style2.fill[style2.fill.length-1]);fillGradientStops.push(1);if(style2.fillGradientType===TEXT_GRADIENT.LINEAR_VERTICAL){gradient=this.context.createLinearGradient(width/2,padding,width/2,height+padding);var lastIterationStop=0;var textHeight=metrics.fontProperties.fontSize+style2.strokeThickness;var gradStopLineHeight=textHeight/height;for(var i$1=0;i$1<lines.length;i$1++){var thisLineTop=metrics.lineHeight*i$1;for(var j=0;j<fill.length;j++){var lineStop=0;if(typeof fillGradientStops[j]==="number"){lineStop=fillGradientStops[j]}else{lineStop=j/fill.length}var globalStop=thisLineTop/height+lineStop*gradStopLineHeight;var clampedStop=Math.max(lastIterationStop,globalStop);clampedStop=Math.min(clampedStop,1);gradient.addColorStop(clampedStop,fill[j]);lastIterationStop=clampedStop}}}else{gradient=this.context.createLinearGradient(padding,height/2,width+padding,height/2);var totalIterations=fill.length+1;var currentIteration=1;for(var i$2=0;i$2<fill.length;i$2++){var stop2=void 0;if(typeof fillGradientStops[i$2]==="number"){stop2=fillGradientStops[i$2]}else{stop2=currentIteration/totalIterations}gradient.addColorStop(stop2,fill[i$2]);currentIteration++}}return gradient};Text2.prototype.destroy=function destroy25(options){if(typeof options==="boolean"){options={children:options}}options=Object.assign({},defaultDestroyOptions,options);Sprite2.prototype.destroy.call(this,options);if(this._ownCanvas){this.canvas.height=this.canvas.width=0}this.context=null;this.canvas=null;this._style=null};prototypeAccessors5.width.get=function(){this.updateText(true);return Math.abs(this.scale.x)*this._texture.orig.width};prototypeAccessors5.width.set=function(value){this.updateText(true);var s=_sign(this.scale.x)||1;this.scale.x=s*value/this._texture.orig.width;this._width=value};prototypeAccessors5.height.get=function(){this.updateText(true);return Math.abs(this.scale.y)*this._texture.orig.height};prototypeAccessors5.height.set=function(value){this.updateText(true);var s=_sign(this.scale.y)||1;this.scale.y=s*value/this._texture.orig.height;this._height=value};prototypeAccessors5.style.get=function(){return this._style};prototypeAccessors5.style.set=function(style2){style2=style2||{};if(style2 instanceof TextStyle){this._style=style2}else{this._style=new TextStyle(style2)}this.localStyleID=-1;this.dirty=true};prototypeAccessors5.text.get=function(){return this._text};prototypeAccessors5.text.set=function(text){text=String(text===null||text===void 0?"":text);if(this._text===text){return}this._text=text;this.dirty=true};prototypeAccessors5.resolution.get=function(){return this._resolution};prototypeAccessors5.resolution.set=function(value){this._autoResolution=false;if(this._resolution===value){return}this._resolution=value;this.dirty=true};Object.defineProperties(Text2.prototype,prototypeAccessors5);return Text2}(Sprite);settings.UPLOADS_PER_FRAME=4;var CountLimiter=function CountLimiter2(maxItemsPerFrame){this.maxItemsPerFrame=maxItemsPerFrame;this.itemsLeft=0};CountLimiter.prototype.beginFrame=function beginFrame(){this.itemsLeft=this.maxItemsPerFrame};CountLimiter.prototype.allowedToUpload=function allowedToUpload(){return this.itemsLeft-->0};var BasePrepare=function BasePrepare2(renderer){var this$1=this;this.limiter=new CountLimiter(settings.UPLOADS_PER_FRAME);this.renderer=renderer;this.uploadHookHelper=null;this.queue=[];this.addHooks=[];this.uploadHooks=[];this.completes=[];this.ticking=false;this.delayedTick=function(){if(!this$1.queue){return}this$1.prepareItems()};this.registerFindHook(findText);this.registerFindHook(findTextStyle);this.registerFindHook(findMultipleBaseTextures);this.registerFindHook(findBaseTexture);this.registerFindHook(findTexture);this.registerUploadHook(drawText);this.registerUploadHook(calculateTextStyle)};BasePrepare.prototype.upload=function upload2(item,done){if(typeof item==="function"){done=item;item=null}if(item){this.add(item)}if(this.queue.length){if(done){this.completes.push(done)}if(!this.ticking){this.ticking=true;Ticker.system.addOnce(this.tick,this,UPDATE_PRIORITY.UTILITY)}}else if(done){done()}};BasePrepare.prototype.tick=function tick(){setTimeout(this.delayedTick,0)};BasePrepare.prototype.prepareItems=function prepareItems(){this.limiter.beginFrame();while(this.queue.length&&this.limiter.allowedToUpload()){var item=this.queue[0];var uploaded=false;if(item&&!item._destroyed){for(var i=0,len=this.uploadHooks.length;i<len;i++){if(this.uploadHooks[i](this.uploadHookHelper,item)){this.queue.shift();uploaded=true;break}}}if(!uploaded){this.queue.shift()}}if(!this.queue.length){this.ticking=false;var completes=this.completes.slice(0);this.completes.length=0;for(var i$1=0,len$1=completes.length;i$1<len$1;i$1++){completes[i$1]()}}else{Ticker.system.addOnce(this.tick,this,UPDATE_PRIORITY.UTILITY)}};BasePrepare.prototype.registerFindHook=function registerFindHook(addHook){if(addHook){this.addHooks.push(addHook)}return this};BasePrepare.prototype.registerUploadHook=function registerUploadHook(uploadHook){if(uploadHook){this.uploadHooks.push(uploadHook)}return this};BasePrepare.prototype.add=function add2(item){for(var i=0,len=this.addHooks.length;i<len;i++){if(this.addHooks[i](item,this.queue)){break}}if(item instanceof Container){for(var i$1=item.children.length-1;i$1>=0;i$1--){this.add(item.children[i$1])}}return this};BasePrepare.prototype.destroy=function destroy18(){if(this.ticking){Ticker.system.remove(this.tick,this)}this.ticking=false;this.addHooks=null;this.uploadHooks=null;this.renderer=null;this.completes=null;this.queue=null;this.limiter=null;this.uploadHookHelper=null};function findMultipleBaseTextures(item,queue2){var result=false;if(item&&item._textures&&item._textures.length){for(var i=0;i<item._textures.length;i++){if(item._textures[i]instanceof Texture){var baseTexture=item._textures[i].baseTexture;if(queue2.indexOf(baseTexture)===-1){queue2.push(baseTexture);result=true}}}}return result}function findBaseTexture(item,queue2){if(item.baseTexture instanceof BaseTexture){var texture=item.baseTexture;if(queue2.indexOf(texture)===-1){queue2.push(texture)}return true}return false}function findTexture(item,queue2){if(item._texture&&item._texture instanceof Texture){var texture=item._texture.baseTexture;if(queue2.indexOf(texture)===-1){queue2.push(texture)}return true}return false}function drawText(helper,item){if(item instanceof Text){item.updateText(true);return true}return false}function calculateTextStyle(helper,item){if(item instanceof TextStyle){var font=item.toFontString();TextMetrics.measureFont(font);return true}return false}function findText(item,queue2){if(item instanceof Text){if(queue2.indexOf(item.style)===-1){queue2.push(item.style)}if(queue2.indexOf(item)===-1){queue2.push(item)}var texture=item._texture.baseTexture;if(queue2.indexOf(texture)===-1){queue2.push(texture)}return true}return false}function findTextStyle(item,queue2){if(item instanceof TextStyle){if(queue2.indexOf(item)===-1){queue2.push(item)}return true}return false}var Prepare=function(BasePrepare3){function Prepare2(renderer){BasePrepare3.call(this,renderer);this.uploadHookHelper=this.renderer;this.registerFindHook(findGraphics);this.registerUploadHook(uploadBaseTextures);this.registerUploadHook(uploadGraphics)}if(BasePrepare3)Prepare2.__proto__=BasePrepare3;Prepare2.prototype=Object.create(BasePrepare3&&BasePrepare3.prototype);Prepare2.prototype.constructor=Prepare2;return Prepare2}(BasePrepare);function uploadBaseTextures(renderer,item){if(item instanceof BaseTexture){if(!item._glTextures[renderer.CONTEXT_UID]){renderer.texture.bind(item)}return true}return false}function uploadGraphics(renderer,item){if(!(item instanceof Graphics)){return false}var geometry=item.geometry;item.finishPoly();geometry.updateBatches();var batches=geometry.batches;for(var i=0;i<batches.length;i++){var ref=batches[i].style;var texture=ref.texture;if(texture){uploadBaseTextures(renderer,texture.baseTexture)}}if(!geometry.batchable){renderer.geometry.bind(geometry,item._resolveDirectShader(renderer))}return true}function findGraphics(item,queue2){if(item instanceof Graphics){queue2.push(item);return true}return false}var TimeLimiter=function TimeLimiter2(maxMilliseconds){this.maxMilliseconds=maxMilliseconds;this.frameStart=0};TimeLimiter.prototype.beginFrame=function beginFrame2(){this.frameStart=Date.now()};TimeLimiter.prototype.allowedToUpload=function allowedToUpload2(){return Date.now()-this.frameStart<this.maxMilliseconds};var Spritesheet=function Spritesheet2(texture,data,resolutionFilename){if(resolutionFilename===void 0)resolutionFilename=null;this._texture=texture instanceof Texture?texture:null;this.baseTexture=texture instanceof BaseTexture?texture:this._texture.baseTexture;this.textures={};this.animations={};this.data=data;this.resolution=this._updateResolution(resolutionFilename||(this.baseTexture.resource?this.baseTexture.resource.url:null));this._frames=this.data.frames;this._frameKeys=Object.keys(this._frames);this._batchIndex=0;this._callback=null};var staticAccessors2={BATCH_SIZE:{configurable:true}};staticAccessors2.BATCH_SIZE.get=function(){return 1e3};Spritesheet.prototype._updateResolution=function _updateResolution(resolutionFilename){var scale=this.data.meta.scale;var resolution=_getResolutionOfUrl(resolutionFilename,null);if(resolution===null){resolution=scale!==void 0?parseFloat(scale):1}if(resolution!==1){this.baseTexture.setResolution(resolution)}return resolution};Spritesheet.prototype.parse=function parse2(callback){this._batchIndex=0;this._callback=callback;if(this._frameKeys.length<=Spritesheet.BATCH_SIZE){this._processFrames(0);this._processAnimations();this._parseComplete()}else{this._nextBatch()}};Spritesheet.prototype._processFrames=function _processFrames(initialFrameIndex){var frameIndex=initialFrameIndex;var maxFrames=Spritesheet.BATCH_SIZE;while(frameIndex-initialFrameIndex<maxFrames&&frameIndex<this._frameKeys.length){var i=this._frameKeys[frameIndex];var data=this._frames[i];var rect=data.frame;if(rect){var frame=null;var trim=null;var sourceSize=data.trimmed!==false&&data.sourceSize?data.sourceSize:data.frame;var orig=new Rectangle(0,0,Math.floor(sourceSize.w)/this.resolution,Math.floor(sourceSize.h)/this.resolution);if(data.rotated){frame=new Rectangle(Math.floor(rect.x)/this.resolution,Math.floor(rect.y)/this.resolution,Math.floor(rect.h)/this.resolution,Math.floor(rect.w)/this.resolution)}else{frame=new Rectangle(Math.floor(rect.x)/this.resolution,Math.floor(rect.y)/this.resolution,Math.floor(rect.w)/this.resolution,Math.floor(rect.h)/this.resolution)}if(data.trimmed!==false&&data.spriteSourceSize){trim=new Rectangle(Math.floor(data.spriteSourceSize.x)/this.resolution,Math.floor(data.spriteSourceSize.y)/this.resolution,Math.floor(rect.w)/this.resolution,Math.floor(rect.h)/this.resolution)}this.textures[i]=new Texture(this.baseTexture,frame,orig,trim,data.rotated?2:0,data.anchor);Texture.addToCache(this.textures[i],i)}frameIndex++}};Spritesheet.prototype._processAnimations=function _processAnimations(){var animations=this.data.animations||{};for(var animName in animations){this.animations[animName]=[];for(var i=0;i<animations[animName].length;i++){var frameName=animations[animName][i];this.animations[animName].push(this.textures[frameName])}}};Spritesheet.prototype._parseComplete=function _parseComplete(){var callback=this._callback;this._callback=null;this._batchIndex=0;callback.call(this,this.textures)};Spritesheet.prototype._nextBatch=function _nextBatch(){var this$1=this;this._processFrames(this._batchIndex*Spritesheet.BATCH_SIZE);this._batchIndex++;setTimeout(function(){if(this$1._batchIndex*Spritesheet.BATCH_SIZE<this$1._frameKeys.length){this$1._nextBatch()}else{this$1._processAnimations();this$1._parseComplete()}},0)};Spritesheet.prototype.destroy=function destroy19(destroyBase){if(destroyBase===void 0)destroyBase=false;for(var i in this.textures){this.textures[i].destroy()}this._frames=null;this._frameKeys=null;this.data=null;this.textures=null;if(destroyBase){if(this._texture){this._texture.destroy()}this.baseTexture.destroy()}this._texture=null;this.baseTexture=null};Object.defineProperties(Spritesheet,staticAccessors2);var SpritesheetLoader=function SpritesheetLoader2(){};SpritesheetLoader.use=function use2(resource,next){var imageResourceName=resource.name+"_image";if(!resource.data||resource.type!==LoaderResource.TYPE.JSON||!resource.data.frames||this.resources[imageResourceName]){next();return}var loadOptions={crossOrigin:resource.crossOrigin,metadata:resource.metadata.imageMetadata,parentResource:resource};var resourcePath=SpritesheetLoader.getResourcePath(resource,this.baseUrl);this.add(imageResourceName,resourcePath,loadOptions,function onImageLoad(res){if(res.error){next(res.error);return}var spritesheet=new Spritesheet(res.texture,resource.data,resource.url);spritesheet.parse(function(){resource.spritesheet=spritesheet;resource.textures=spritesheet.textures;next()})})};SpritesheetLoader.getResourcePath=function getResourcePath(resource,baseUrl){if(resource.isDataUrl){return resource.data.meta.image}return import_url2.default.resolve(resource.url.replace(baseUrl,""),resource.data.meta.image)};var tempPoint2=new Point;var TilingSprite=function(Sprite2){function TilingSprite2(texture,width,height){if(width===void 0)width=100;if(height===void 0)height=100;Sprite2.call(this,texture);this.tileTransform=new Transform;this._width=width;this._height=height;this._canvasPattern=null;this.uvMatrix=texture.uvMatrix||new TextureMatrix(texture);this.pluginName="tilingSprite";this.uvRespectAnchor=false}if(Sprite2)TilingSprite2.__proto__=Sprite2;TilingSprite2.prototype=Object.create(Sprite2&&Sprite2.prototype);TilingSprite2.prototype.constructor=TilingSprite2;var prototypeAccessors5={clampMargin:{configurable:true},tileScale:{configurable:true},tilePosition:{configurable:true},width:{configurable:true},height:{configurable:true}};prototypeAccessors5.clampMargin.get=function(){return this.uvMatrix.clampMargin};prototypeAccessors5.clampMargin.set=function(value){this.uvMatrix.clampMargin=value;this.uvMatrix.update(true)};prototypeAccessors5.tileScale.get=function(){return this.tileTransform.scale};prototypeAccessors5.tileScale.set=function(value){this.tileTransform.scale.copyFrom(value)};prototypeAccessors5.tilePosition.get=function(){return this.tileTransform.position};prototypeAccessors5.tilePosition.set=function(value){this.tileTransform.position.copyFrom(value)};TilingSprite2.prototype._onTextureUpdate=function _onTextureUpdate(){if(this.uvMatrix){this.uvMatrix.texture=this._texture}this._cachedTint=16777215};TilingSprite2.prototype._render=function _render(renderer){var texture=this._texture;if(!texture||!texture.valid){return}this.tileTransform.updateLocalTransform();this.uvMatrix.update();renderer.batch.setObjectRenderer(renderer.plugins[this.pluginName]);renderer.plugins[this.pluginName].render(this)};TilingSprite2.prototype._calculateBounds=function _calculateBounds(){var minX=this._width*-this._anchor._x;var minY=this._height*-this._anchor._y;var maxX=this._width*(1-this._anchor._x);var maxY=this._height*(1-this._anchor._y);this._bounds.addFrame(this.transform,minX,minY,maxX,maxY)};TilingSprite2.prototype.getLocalBounds=function getLocalBounds(rect){if(this.children.length===0){this._bounds.minX=this._width*-this._anchor._x;this._bounds.minY=this._height*-this._anchor._y;this._bounds.maxX=this._width*(1-this._anchor._x);this._bounds.maxY=this._height*(1-this._anchor._y);if(!rect){if(!this._localBoundsRect){this._localBoundsRect=new Rectangle}rect=this._localBoundsRect}return this._bounds.getRectangle(rect)}return Sprite2.prototype.getLocalBounds.call(this,rect)};TilingSprite2.prototype.containsPoint=function containsPoint(point){this.worldTransform.applyInverse(point,tempPoint2);var width=this._width;var height=this._height;var x1=-width*this.anchor._x;if(tempPoint2.x>=x1&&tempPoint2.x<x1+width){var y1=-height*this.anchor._y;if(tempPoint2.y>=y1&&tempPoint2.y<y1+height){return true}}return false};TilingSprite2.prototype.destroy=function destroy25(options){Sprite2.prototype.destroy.call(this,options);this.tileTransform=null;this.uvMatrix=null};TilingSprite2.from=function from6(source,width,height){return new TilingSprite2(Texture.from(source),width,height)};TilingSprite2.fromFrame=function fromFrame(frameId,width,height){var texture=_TextureCache[frameId];if(!texture){throw new Error("The frameId \""+frameId+"\" does not exist in the texture cache "+this)}return new TilingSprite2(texture,width,height)};TilingSprite2.fromImage=function fromImage(imageId,width,height,options){if(options&&_typeof(options)!=="object"){options={scaleMode:arguments[4],resourceOptions:{crossorigin:arguments[3]}}}return new TilingSprite2(Texture.from(imageId,options),width,height)};prototypeAccessors5.width.get=function(){return this._width};prototypeAccessors5.width.set=function(value){this._width=value};prototypeAccessors5.height.get=function(){return this._height};prototypeAccessors5.height.set=function(value){this._height=value};Object.defineProperties(TilingSprite2.prototype,prototypeAccessors5);return TilingSprite2}(Sprite);var vertex3="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n";var fragment3="varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord - floor(vTextureCoord - uClampOffset);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    vec4 texSample = texture2D(uSampler, coord);\n    gl_FragColor = texSample * uColor;\n}\n";var fragmentSimple="varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 sample = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = sample * uColor;\n}\n";var tempMat2=new Matrix;var TilingSpriteRenderer=function(ObjectRenderer3){function TilingSpriteRenderer2(renderer){ObjectRenderer3.call(this,renderer);var uniforms={globals:this.renderer.globalUniforms};this.shader=Shader.from(vertex3,fragment3,uniforms);this.simpleShader=Shader.from(vertex3,fragmentSimple,uniforms);this.quad=new QuadUv;this.state=State.for2d()}if(ObjectRenderer3)TilingSpriteRenderer2.__proto__=ObjectRenderer3;TilingSpriteRenderer2.prototype=Object.create(ObjectRenderer3&&ObjectRenderer3.prototype);TilingSpriteRenderer2.prototype.constructor=TilingSpriteRenderer2;TilingSpriteRenderer2.prototype.render=function render6(ts){var renderer=this.renderer;var quad=this.quad;var vertices=quad.vertices;vertices[0]=vertices[6]=ts._width*-ts.anchor.x;vertices[1]=vertices[3]=ts._height*-ts.anchor.y;vertices[2]=vertices[4]=ts._width*(1-ts.anchor.x);vertices[5]=vertices[7]=ts._height*(1-ts.anchor.y);if(ts.uvRespectAnchor){vertices=quad.uvs;vertices[0]=vertices[6]=-ts.anchor.x;vertices[1]=vertices[3]=-ts.anchor.y;vertices[2]=vertices[4]=1-ts.anchor.x;vertices[5]=vertices[7]=1-ts.anchor.y}quad.invalidate();var tex=ts._texture;var baseTex=tex.baseTexture;var lt=ts.tileTransform.localTransform;var uv=ts.uvMatrix;var isSimple=baseTex.isPowerOfTwo&&tex.frame.width===baseTex.width&&tex.frame.height===baseTex.height;if(isSimple){if(!baseTex._glTextures[renderer.CONTEXT_UID]){if(baseTex.wrapMode===WRAP_MODES.CLAMP){baseTex.wrapMode=WRAP_MODES.REPEAT}}else{isSimple=baseTex.wrapMode!==WRAP_MODES.CLAMP}}var shader=isSimple?this.simpleShader:this.shader;var w=tex.width;var h=tex.height;var W2=ts._width;var H=ts._height;tempMat2.set(lt.a*w/W2,lt.b*w/H,lt.c*h/W2,lt.d*h/H,lt.tx/W2,lt.ty/H);tempMat2.invert();if(isSimple){tempMat2.prepend(uv.mapCoord)}else{shader.uniforms.uMapCoord=uv.mapCoord.toArray(true);shader.uniforms.uClampFrame=uv.uClampFrame;shader.uniforms.uClampOffset=uv.uClampOffset}shader.uniforms.uTransform=tempMat2.toArray(true);shader.uniforms.uColor=_premultiplyTintToRgba(ts.tint,ts.worldAlpha,shader.uniforms.uColor,baseTex.alphaMode);shader.uniforms.translationMatrix=ts.transform.worldTransform.toArray(true);shader.uniforms.uSampler=tex;renderer.shader.bind(shader);renderer.geometry.bind(quad);this.state.blendMode=_correctBlendMode(ts.blendMode,baseTex.alphaMode);renderer.state.set(this.state);renderer.geometry.draw(this.renderer.gl.TRIANGLES,6,0)};return TilingSpriteRenderer2}(ObjectRenderer);var BitmapText=function(Container2){function BitmapText2(text,style2){var this$1=this;if(style2===void 0)style2={};Container2.call(this);this._textWidth=0;this._textHeight=0;this._glyphs=[];this._font={tint:style2.tint!==void 0?style2.tint:16777215,align:style2.align||"left",name:null,size:0};this.font=style2.font;this._text=text;this._maxWidth=0;this._maxLineHeight=0;this._letterSpacing=0;this._anchor=new ObservablePoint(function(){this$1.dirty=true},this,0,0);this.dirty=false;this.roundPixels=settings.ROUND_PIXELS;this.updateText()}if(Container2)BitmapText2.__proto__=Container2;BitmapText2.prototype=Object.create(Container2&&Container2.prototype);BitmapText2.prototype.constructor=BitmapText2;var prototypeAccessors5={tint:{configurable:true},align:{configurable:true},anchor:{configurable:true},font:{configurable:true},text:{configurable:true},maxWidth:{configurable:true},maxLineHeight:{configurable:true},textWidth:{configurable:true},letterSpacing:{configurable:true},textHeight:{configurable:true}};BitmapText2.prototype.updateText=function updateText(){var data=BitmapText2.fonts[this._font.name];var scale=this._font.size/data.size;var pos=new Point;var chars=[];var lineWidths=[];var text=this._text.replace(/(?:\r\n|\r)/g,"\n")||" ";var textLength=text.length;var maxWidth=this._maxWidth*data.size/this._font.size;var prevCharCode=null;var lastLineWidth=0;var maxLineWidth=0;var line=0;var lastBreakPos=-1;var lastBreakWidth=0;var spacesRemoved=0;var maxLineHeight=0;for(var i=0;i<textLength;i++){var charCode=text.charCodeAt(i);var char=text.charAt(i);if(/(?:\s)/.test(char)){lastBreakPos=i;lastBreakWidth=lastLineWidth}if(char==="\r"||char==="\n"){lineWidths.push(lastLineWidth);maxLineWidth=Math.max(maxLineWidth,lastLineWidth);++line;++spacesRemoved;pos.x=0;pos.y+=data.lineHeight;prevCharCode=null;continue}var charData=data.chars[charCode];if(!charData){continue}if(prevCharCode&&charData.kerning[prevCharCode]){pos.x+=charData.kerning[prevCharCode]}chars.push({texture:charData.texture,line:line,charCode:charCode,position:new Point(pos.x+charData.xOffset+this._letterSpacing/2,pos.y+charData.yOffset)});pos.x+=charData.xAdvance+this._letterSpacing;lastLineWidth=pos.x;maxLineHeight=Math.max(maxLineHeight,charData.yOffset+charData.texture.height);prevCharCode=charCode;if(lastBreakPos!==-1&&maxWidth>0&&pos.x>maxWidth){++spacesRemoved;_removeItems(chars,1+lastBreakPos-spacesRemoved,1+i-lastBreakPos);i=lastBreakPos;lastBreakPos=-1;lineWidths.push(lastBreakWidth);maxLineWidth=Math.max(maxLineWidth,lastBreakWidth);line++;pos.x=0;pos.y+=data.lineHeight;prevCharCode=null}}var lastChar=text.charAt(text.length-1);if(lastChar!=="\r"&&lastChar!=="\n"){if(/(?:\s)/.test(lastChar)){lastLineWidth=lastBreakWidth}lineWidths.push(lastLineWidth);maxLineWidth=Math.max(maxLineWidth,lastLineWidth)}var lineAlignOffsets=[];for(var i$1=0;i$1<=line;i$1++){var alignOffset=0;if(this._font.align==="right"){alignOffset=maxLineWidth-lineWidths[i$1]}else if(this._font.align==="center"){alignOffset=(maxLineWidth-lineWidths[i$1])/2}lineAlignOffsets.push(alignOffset)}var lenChars=chars.length;var tint=this.tint;for(var i$2=0;i$2<lenChars;i$2++){var c=this._glyphs[i$2];if(c){c.texture=chars[i$2].texture}else{c=new Sprite(chars[i$2].texture);c.roundPixels=this.roundPixels;this._glyphs.push(c)}c.position.x=(chars[i$2].position.x+lineAlignOffsets[chars[i$2].line])*scale;c.position.y=chars[i$2].position.y*scale;c.scale.x=c.scale.y=scale;c.tint=tint;if(!c.parent){this.addChild(c)}}for(var i$3=lenChars;i$3<this._glyphs.length;++i$3){this.removeChild(this._glyphs[i$3])}this._textWidth=maxLineWidth*scale;this._textHeight=(pos.y+data.lineHeight)*scale;if(this.anchor.x!==0||this.anchor.y!==0){for(var i$4=0;i$4<lenChars;i$4++){this._glyphs[i$4].x-=this._textWidth*this.anchor.x;this._glyphs[i$4].y-=this._textHeight*this.anchor.y}}this._maxLineHeight=maxLineHeight*scale};BitmapText2.prototype.updateTransform=function updateTransform(){this.validate();this.containerUpdateTransform()};BitmapText2.prototype.getLocalBounds=function getLocalBounds(){this.validate();return Container2.prototype.getLocalBounds.call(this)};BitmapText2.prototype.validate=function validate(){if(this.dirty){this.updateText();this.dirty=false}};prototypeAccessors5.tint.get=function(){return this._font.tint};prototypeAccessors5.tint.set=function(value){this._font.tint=typeof value==="number"&&value>=0?value:16777215;this.dirty=true};prototypeAccessors5.align.get=function(){return this._font.align};prototypeAccessors5.align.set=function(value){this._font.align=value||"left";this.dirty=true};prototypeAccessors5.anchor.get=function(){return this._anchor};prototypeAccessors5.anchor.set=function(value){if(typeof value==="number"){this._anchor.set(value)}else{this._anchor.copyFrom(value)}};prototypeAccessors5.font.get=function(){return this._font};prototypeAccessors5.font.set=function(value){if(!value){return}if(typeof value==="string"){value=value.split(" ");this._font.name=value.length===1?value[0]:value.slice(1).join(" ");this._font.size=value.length>=2?parseInt(value[0],10):BitmapText2.fonts[this._font.name].size}else{this._font.name=value.name;this._font.size=typeof value.size==="number"?value.size:parseInt(value.size,10)}this.dirty=true};prototypeAccessors5.text.get=function(){return this._text};prototypeAccessors5.text.set=function(text){text=String(text===null||text===void 0?"":text);if(this._text===text){return}this._text=text;this.dirty=true};prototypeAccessors5.maxWidth.get=function(){return this._maxWidth};prototypeAccessors5.maxWidth.set=function(value){if(this._maxWidth===value){return}this._maxWidth=value;this.dirty=true};prototypeAccessors5.maxLineHeight.get=function(){this.validate();return this._maxLineHeight};prototypeAccessors5.textWidth.get=function(){this.validate();return this._textWidth};prototypeAccessors5.letterSpacing.get=function(){return this._letterSpacing};prototypeAccessors5.letterSpacing.set=function(value){if(this._letterSpacing!==value){this._letterSpacing=value;this.dirty=true}};prototypeAccessors5.textHeight.get=function(){this.validate();return this._textHeight};BitmapText2.registerFont=function registerFont(xml,textures){var data={};var info=xml.getElementsByTagName("info")[0];var common=xml.getElementsByTagName("common")[0];var pages=xml.getElementsByTagName("page");var res=_getResolutionOfUrl(pages[0].getAttribute("file"));var pagesTextures={};data.font=info.getAttribute("face");data.size=parseInt(info.getAttribute("size"),10);data.lineHeight=parseInt(common.getAttribute("lineHeight"),10)/res;data.chars={};if(textures instanceof Texture){textures=[textures]}for(var i=0;i<pages.length;i++){var id=pages[i].getAttribute("id");var file=pages[i].getAttribute("file");pagesTextures[id]=textures instanceof Array?textures[i]:textures[file]}var letters=xml.getElementsByTagName("char");for(var i$1=0;i$1<letters.length;i$1++){var letter=letters[i$1];var charCode=parseInt(letter.getAttribute("id"),10);var page=letter.getAttribute("page")||0;var textureRect=new Rectangle(parseInt(letter.getAttribute("x"),10)/res+pagesTextures[page].frame.x/res,parseInt(letter.getAttribute("y"),10)/res+pagesTextures[page].frame.y/res,parseInt(letter.getAttribute("width"),10)/res,parseInt(letter.getAttribute("height"),10)/res);data.chars[charCode]={xOffset:parseInt(letter.getAttribute("xoffset"),10)/res,yOffset:parseInt(letter.getAttribute("yoffset"),10)/res,xAdvance:parseInt(letter.getAttribute("xadvance"),10)/res,kerning:{},texture:new Texture(pagesTextures[page].baseTexture,textureRect),page:page}}var kernings=xml.getElementsByTagName("kerning");for(var i$2=0;i$2<kernings.length;i$2++){var kerning=kernings[i$2];var first=parseInt(kerning.getAttribute("first"),10)/res;var second=parseInt(kerning.getAttribute("second"),10)/res;var amount=parseInt(kerning.getAttribute("amount"),10)/res;if(data.chars[second]){data.chars[second].kerning[first]=amount}}BitmapText2.fonts[data.font]=data;return data};Object.defineProperties(BitmapText2.prototype,prototypeAccessors5);return BitmapText2}(Container);BitmapText.fonts={};var BitmapFontLoader=function BitmapFontLoader2(){};BitmapFontLoader.parse=function parse3(resource,texture){resource.bitmapFont=BitmapText.registerFont(resource.data,texture)};BitmapFontLoader.add=function add3(){LoaderResource.setExtensionXhrType("fnt",LoaderResource.XHR_RESPONSE_TYPE.DOCUMENT)};BitmapFontLoader.dirname=function dirname(url){var dir=url.replace(/\\/g,"/").replace(/\/$/,"").replace(/\/[^\/]*$/,"");if(dir===url){return"."}else if(dir===""){return"/"}return dir};BitmapFontLoader.use=function use3(resource,next){if(!resource.data||resource.type!==LoaderResource.TYPE.XML){next();return}if(resource.data.getElementsByTagName("page").length===0||resource.data.getElementsByTagName("info").length===0||resource.data.getElementsByTagName("info")[0].getAttribute("face")===null){next();return}var xmlUrl=!resource.isDataUrl?BitmapFontLoader.dirname(resource.url):"";if(resource.isDataUrl){if(xmlUrl==="."){xmlUrl=""}if(this.baseUrl&&xmlUrl){if(this.baseUrl.charAt(this.baseUrl.length-1)==="/"){xmlUrl+="/"}}}xmlUrl=xmlUrl.replace(this.baseUrl,"");if(xmlUrl&&xmlUrl.charAt(xmlUrl.length-1)!=="/"){xmlUrl+="/"}var pages=resource.data.getElementsByTagName("page");var textures={};var completed=function completed(page){textures[page.metadata.pageFile]=page.texture;if(Object.keys(textures).length===pages.length){BitmapFontLoader.parse(resource,textures);next()}};for(var i=0;i<pages.length;++i){var pageFile=pages[i].getAttribute("file");var url=xmlUrl+pageFile;var exists=false;for(var name in this.resources){var bitmapResource=this.resources[name];if(bitmapResource.url===url){bitmapResource.metadata.pageFile=pageFile;if(bitmapResource.texture){completed(bitmapResource)}else{bitmapResource.onAfterMiddleware.add(completed)}exists=true;break}}if(!exists){var options={crossOrigin:resource.crossOrigin,loadType:LoaderResource.LOAD_TYPE.IMAGE,metadata:Object.assign({pageFile:pageFile},resource.metadata.imageMetadata),parentResource:resource};this.add(url,options,completed)}}};var fragTemplate2=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join("\n");var fragment4="varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\nuniform float uAlpha;\n\nvoid main(void)\n{\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    if (uAlpha == 0.0) {\n        gl_FragColor = c;\n        return;\n    }\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.rgb /= c.a;\n    }\n\n    vec4 result;\n\n    result.r = (m[0] * c.r);\n        result.r += (m[1] * c.g);\n        result.r += (m[2] * c.b);\n        result.r += (m[3] * c.a);\n        result.r += m[4];\n\n    result.g = (m[5] * c.r);\n        result.g += (m[6] * c.g);\n        result.g += (m[7] * c.b);\n        result.g += (m[8] * c.a);\n        result.g += m[9];\n\n    result.b = (m[10] * c.r);\n       result.b += (m[11] * c.g);\n       result.b += (m[12] * c.b);\n       result.b += (m[13] * c.a);\n       result.b += m[14];\n\n    result.a = (m[15] * c.r);\n       result.a += (m[16] * c.g);\n       result.a += (m[17] * c.b);\n       result.a += (m[18] * c.a);\n       result.a += m[19];\n\n    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    gl_FragColor = vec4(rgb, result.a);\n}\n";var ColorMatrixFilter=function(Filter2){function ColorMatrixFilter2(){var uniforms={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};Filter2.call(this,defaultFilter,fragment4,uniforms);this.alpha=1}if(Filter2)ColorMatrixFilter2.__proto__=Filter2;ColorMatrixFilter2.prototype=Object.create(Filter2&&Filter2.prototype);ColorMatrixFilter2.prototype.constructor=ColorMatrixFilter2;var prototypeAccessors5={matrix:{configurable:true},alpha:{configurable:true}};ColorMatrixFilter2.prototype._loadMatrix=function _loadMatrix(matrix,multiply){if(multiply===void 0)multiply=false;var newMatrix=matrix;if(multiply){this._multiply(newMatrix,this.uniforms.m,matrix);newMatrix=this._colorMatrix(newMatrix)}this.uniforms.m=newMatrix};ColorMatrixFilter2.prototype._multiply=function _multiply(out,a,b){out[0]=a[0]*b[0]+a[1]*b[5]+a[2]*b[10]+a[3]*b[15];out[1]=a[0]*b[1]+a[1]*b[6]+a[2]*b[11]+a[3]*b[16];out[2]=a[0]*b[2]+a[1]*b[7]+a[2]*b[12]+a[3]*b[17];out[3]=a[0]*b[3]+a[1]*b[8]+a[2]*b[13]+a[3]*b[18];out[4]=a[0]*b[4]+a[1]*b[9]+a[2]*b[14]+a[3]*b[19]+a[4];out[5]=a[5]*b[0]+a[6]*b[5]+a[7]*b[10]+a[8]*b[15];out[6]=a[5]*b[1]+a[6]*b[6]+a[7]*b[11]+a[8]*b[16];out[7]=a[5]*b[2]+a[6]*b[7]+a[7]*b[12]+a[8]*b[17];out[8]=a[5]*b[3]+a[6]*b[8]+a[7]*b[13]+a[8]*b[18];out[9]=a[5]*b[4]+a[6]*b[9]+a[7]*b[14]+a[8]*b[19]+a[9];out[10]=a[10]*b[0]+a[11]*b[5]+a[12]*b[10]+a[13]*b[15];out[11]=a[10]*b[1]+a[11]*b[6]+a[12]*b[11]+a[13]*b[16];out[12]=a[10]*b[2]+a[11]*b[7]+a[12]*b[12]+a[13]*b[17];out[13]=a[10]*b[3]+a[11]*b[8]+a[12]*b[13]+a[13]*b[18];out[14]=a[10]*b[4]+a[11]*b[9]+a[12]*b[14]+a[13]*b[19]+a[14];out[15]=a[15]*b[0]+a[16]*b[5]+a[17]*b[10]+a[18]*b[15];out[16]=a[15]*b[1]+a[16]*b[6]+a[17]*b[11]+a[18]*b[16];out[17]=a[15]*b[2]+a[16]*b[7]+a[17]*b[12]+a[18]*b[17];out[18]=a[15]*b[3]+a[16]*b[8]+a[17]*b[13]+a[18]*b[18];out[19]=a[15]*b[4]+a[16]*b[9]+a[17]*b[14]+a[18]*b[19]+a[19];return out};ColorMatrixFilter2.prototype._colorMatrix=function _colorMatrix(matrix){var m=new Float32Array(matrix);m[4]/=255;m[9]/=255;m[14]/=255;m[19]/=255;return m};ColorMatrixFilter2.prototype.brightness=function brightness(b,multiply){var matrix=[b,0,0,0,0,0,b,0,0,0,0,0,b,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter2.prototype.greyscale=function greyscale(scale,multiply){var matrix=[scale,scale,scale,0,0,scale,scale,scale,0,0,scale,scale,scale,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter2.prototype.blackAndWhite=function blackAndWhite(multiply){var matrix=[0.3,0.6,0.1,0,0,0.3,0.6,0.1,0,0,0.3,0.6,0.1,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter2.prototype.hue=function hue(rotation,multiply){rotation=(rotation||0)/180*Math.PI;var cosR=Math.cos(rotation);var sinR=Math.sin(rotation);var sqrt=Math.sqrt;var w=1/3;var sqrW=sqrt(w);var a00=cosR+(1-cosR)*w;var a01=w*(1-cosR)-sqrW*sinR;var a02=w*(1-cosR)+sqrW*sinR;var a10=w*(1-cosR)+sqrW*sinR;var a11=cosR+w*(1-cosR);var a12=w*(1-cosR)-sqrW*sinR;var a20=w*(1-cosR)-sqrW*sinR;var a21=w*(1-cosR)+sqrW*sinR;var a22=cosR+w*(1-cosR);var matrix=[a00,a01,a02,0,0,a10,a11,a12,0,0,a20,a21,a22,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter2.prototype.contrast=function contrast(amount,multiply){var v=(amount||0)+1;var o=-0.5*(v-1);var matrix=[v,0,0,0,o,0,v,0,0,o,0,0,v,0,o,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter2.prototype.saturate=function saturate(amount,multiply){if(amount===void 0)amount=0;var x=amount*2/3+1;var y=(x-1)*-0.5;var matrix=[x,y,y,0,0,y,x,y,0,0,y,y,x,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter2.prototype.desaturate=function desaturate(){this.saturate(-1)};ColorMatrixFilter2.prototype.negative=function negative(multiply){var matrix=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter2.prototype.sepia=function sepia(multiply){var matrix=[0.393,0.7689999,0.18899999,0,0,0.349,0.6859999,0.16799999,0,0,0.272,0.5339999,0.13099999,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter2.prototype.technicolor=function technicolor(multiply){var matrix=[1.9125277891456083,-0.8545344976951645,-0.09155508482755585,0,11.793603434377337,-0.3087833385928097,1.7658908555458428,-0.10601743074722245,0,-70.35205161461398,-0.231103377548616,-0.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter2.prototype.polaroid=function polaroid(multiply){var matrix=[1.438,-0.062,-0.062,0,0,-0.122,1.378,-0.122,0,0,-0.016,-0.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter2.prototype.toBGR=function toBGR(multiply){var matrix=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter2.prototype.kodachrome=function kodachrome(multiply){var matrix=[1.1285582396593525,-0.3967382283601348,-0.03992559172921793,0,63.72958762196502,-0.16404339962244616,1.0835251566291304,-0.05498805115633132,0,24.732407896706203,-0.16786010706155763,-0.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter2.prototype.browni=function browni(multiply){var matrix=[0.5997023498159715,0.34553243048391263,-0.2708298674538042,0,47.43192855600873,-0.037703249837783157,0.8609577587992641,0.15059552388459913,0,-36.96841498319127,0.24113635128153335,-0.07441037908422492,0.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter2.prototype.vintage=function vintage(multiply){var matrix=[0.6279345635605994,0.3202183420819367,-0.03965408211312453,0,9.651285835294123,0.02578397704808868,0.6441188644374771,0.03259127616149294,0,7.462829176470591,0.0466055556782719,-0.0851232987247891,0.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter2.prototype.colorTone=function colorTone(desaturation,toned,lightColor,darkColor,multiply){desaturation=desaturation||0.2;toned=toned||0.15;lightColor=lightColor||16770432;darkColor=darkColor||3375104;var lR=(lightColor>>16&255)/255;var lG=(lightColor>>8&255)/255;var lB=(lightColor&255)/255;var dR=(darkColor>>16&255)/255;var dG=(darkColor>>8&255)/255;var dB=(darkColor&255)/255;var matrix=[0.3,0.59,0.11,0,0,lR,lG,lB,desaturation,0,dR,dG,dB,toned,0,lR-dR,lG-dG,lB-dB,0,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter2.prototype.night=function night(intensity,multiply){intensity=intensity||0.1;var matrix=[intensity*-2,-intensity,0,0,0,-intensity,0,intensity,0,0,0,intensity,intensity*2,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter2.prototype.predator=function predator(amount,multiply){var matrix=[11.224130630493164*amount,-4.794486999511719*amount,-2.8746118545532227*amount,0*amount,0.40342438220977783*amount,-3.6330697536468506*amount,9.193157196044922*amount,-2.951810836791992*amount,0*amount,-1.316135048866272*amount,-3.2184197902679443*amount,-4.2375030517578125*amount,7.476448059082031*amount,0*amount,0.8044459223747253*amount,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter2.prototype.lsd=function lsd(multiply){var matrix=[2,-0.4,0.5,0,0,-0.5,2,-0.4,0,0,-0.4,-0.5,3,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter2.prototype.reset=function reset7(){var matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(matrix,false)};prototypeAccessors5.matrix.get=function(){return this.uniforms.m};prototypeAccessors5.matrix.set=function(value){this.uniforms.m=value};prototypeAccessors5.alpha.get=function(){return this.uniforms.uAlpha};prototypeAccessors5.alpha.set=function(value){this.uniforms.uAlpha=value};Object.defineProperties(ColorMatrixFilter2.prototype,prototypeAccessors5);return ColorMatrixFilter2}(Filter);ColorMatrixFilter.prototype.grayscale=ColorMatrixFilter.prototype.greyscale;var _tempMatrix=new Matrix;DisplayObject.prototype._cacheAsBitmap=false;DisplayObject.prototype._cacheData=false;var CacheData=function CacheData2(){this.textureCacheId=null;this.originalRender=null;this.originalRenderCanvas=null;this.originalCalculateBounds=null;this.originalGetLocalBounds=null;this.originalUpdateTransform=null;this.originalHitTest=null;this.originalDestroy=null;this.originalMask=null;this.originalFilterArea=null;this.sprite=null};Object.defineProperties(DisplayObject.prototype,{cacheAsBitmap:{get:function get(){return this._cacheAsBitmap},set:function set2(value){if(this._cacheAsBitmap===value){return}this._cacheAsBitmap=value;var data;if(value){if(!this._cacheData){this._cacheData=new CacheData}data=this._cacheData;data.originalRender=this.render;data.originalRenderCanvas=this.renderCanvas;data.originalUpdateTransform=this.updateTransform;data.originalCalculateBounds=this.calculateBounds;data.originalGetLocalBounds=this.getLocalBounds;data.originalDestroy=this.destroy;data.originalContainsPoint=this.containsPoint;data.originalMask=this._mask;data.originalFilterArea=this.filterArea;this.render=this._renderCached;this.renderCanvas=this._renderCachedCanvas;this.destroy=this._cacheAsBitmapDestroy}else{data=this._cacheData;if(data.sprite){this._destroyCachedDisplayObject()}this.render=data.originalRender;this.renderCanvas=data.originalRenderCanvas;this.calculateBounds=data.originalCalculateBounds;this.getLocalBounds=data.originalGetLocalBounds;this.destroy=data.originalDestroy;this.updateTransform=data.originalUpdateTransform;this.containsPoint=data.originalContainsPoint;this._mask=data.originalMask;this.filterArea=data.originalFilterArea}}}});DisplayObject.prototype._renderCached=function _renderCached(renderer){if(!this.visible||this.worldAlpha<=0||!this.renderable){return}this._initCachedDisplayObject(renderer);this._cacheData.sprite.transform._worldID=this.transform._worldID;this._cacheData.sprite.worldAlpha=this.worldAlpha;this._cacheData.sprite._render(renderer)};DisplayObject.prototype._initCachedDisplayObject=function _initCachedDisplayObject(renderer){if(this._cacheData&&this._cacheData.sprite){return}var cacheAlpha=this.alpha;this.alpha=1;renderer.batch.flush();var bounds=this.getLocalBounds().clone();if(this.filters){var padding=this.filters[0].padding;bounds.pad(padding)}bounds.ceil(settings.RESOLUTION);var cachedRenderTexture=renderer.renderTexture.current;var cachedSourceFrame=renderer.renderTexture.sourceFrame.clone();var cachedProjectionTransform=renderer.projection.transform;var renderTexture=RenderTexture.create(bounds.width,bounds.height);var textureCacheId="cacheAsBitmap_"+_uid();this._cacheData.textureCacheId=textureCacheId;BaseTexture.addToCache(renderTexture.baseTexture,textureCacheId);Texture.addToCache(renderTexture,textureCacheId);var m=_tempMatrix;m.tx=-bounds.x;m.ty=-bounds.y;this.transform.worldTransform.identity();this.render=this._cacheData.originalRender;renderer.render(this,renderTexture,true,m,true);renderer.projection.transform=cachedProjectionTransform;renderer.renderTexture.bind(cachedRenderTexture,cachedSourceFrame);this.render=this._renderCached;this.updateTransform=this.displayObjectUpdateTransform;this.calculateBounds=this._calculateCachedBounds;this.getLocalBounds=this._getCachedLocalBounds;this._mask=null;this.filterArea=null;var cachedSprite=new Sprite(renderTexture);cachedSprite.transform.worldTransform=this.transform.worldTransform;cachedSprite.anchor.x=-(bounds.x/bounds.width);cachedSprite.anchor.y=-(bounds.y/bounds.height);cachedSprite.alpha=cacheAlpha;cachedSprite._bounds=this._bounds;this._cacheData.sprite=cachedSprite;this.transform._parentID=-1;if(!this.parent){this.parent=renderer._tempDisplayObjectParent;this.updateTransform();this.parent=null}else{this.updateTransform()}this.containsPoint=cachedSprite.containsPoint.bind(cachedSprite)};DisplayObject.prototype._renderCachedCanvas=function _renderCachedCanvas(renderer){if(!this.visible||this.worldAlpha<=0||!this.renderable){return}this._initCachedDisplayObjectCanvas(renderer);this._cacheData.sprite.worldAlpha=this.worldAlpha;this._cacheData.sprite._renderCanvas(renderer)};DisplayObject.prototype._initCachedDisplayObjectCanvas=function _initCachedDisplayObjectCanvas(renderer){if(this._cacheData&&this._cacheData.sprite){return}var bounds=this.getLocalBounds();var cacheAlpha=this.alpha;this.alpha=1;var cachedRenderTarget=renderer.context;var cachedProjectionTransform=renderer._projTransform;bounds.ceil(settings.RESOLUTION);var renderTexture=RenderTexture.create(bounds.width,bounds.height);var textureCacheId="cacheAsBitmap_"+_uid();this._cacheData.textureCacheId=textureCacheId;BaseTexture.addToCache(renderTexture.baseTexture,textureCacheId);Texture.addToCache(renderTexture,textureCacheId);var m=_tempMatrix;this.transform.localTransform.copyTo(m);m.invert();m.tx-=bounds.x;m.ty-=bounds.y;this.renderCanvas=this._cacheData.originalRenderCanvas;renderer.render(this,renderTexture,true,m,false);renderer.context=cachedRenderTarget;renderer._projTransform=cachedProjectionTransform;this.renderCanvas=this._renderCachedCanvas;this.updateTransform=this.displayObjectUpdateTransform;this.calculateBounds=this._calculateCachedBounds;this.getLocalBounds=this._getCachedLocalBounds;this._mask=null;this.filterArea=null;var cachedSprite=new Sprite(renderTexture);cachedSprite.transform.worldTransform=this.transform.worldTransform;cachedSprite.anchor.x=-(bounds.x/bounds.width);cachedSprite.anchor.y=-(bounds.y/bounds.height);cachedSprite.alpha=cacheAlpha;cachedSprite._bounds=this._bounds;this._cacheData.sprite=cachedSprite;this.transform._parentID=-1;if(!this.parent){this.parent=renderer._tempDisplayObjectParent;this.updateTransform();this.parent=null}else{this.updateTransform()}this.containsPoint=cachedSprite.containsPoint.bind(cachedSprite)};DisplayObject.prototype._calculateCachedBounds=function _calculateCachedBounds(){this._bounds.clear();this._cacheData.sprite.transform._worldID=this.transform._worldID;this._cacheData.sprite._calculateBounds();this._lastBoundsID=this._boundsID};DisplayObject.prototype._getCachedLocalBounds=function _getCachedLocalBounds(){return this._cacheData.sprite.getLocalBounds()};DisplayObject.prototype._destroyCachedDisplayObject=function _destroyCachedDisplayObject(){this._cacheData.sprite._texture.destroy(true);this._cacheData.sprite=null;BaseTexture.removeFromCache(this._cacheData.textureCacheId);Texture.removeFromCache(this._cacheData.textureCacheId);this._cacheData.textureCacheId=null};DisplayObject.prototype._cacheAsBitmapDestroy=function _cacheAsBitmapDestroy(options){this.cacheAsBitmap=false;this.destroy(options)};DisplayObject.prototype.name=null;Container.prototype.getChildByName=function getChildByName(name){for(var i=0;i<this.children.length;i++){if(this.children[i].name===name){return this.children[i]}}return null};DisplayObject.prototype.getGlobalPosition=function getGlobalPosition(point,skipUpdate){if(point===void 0)point=new Point;if(skipUpdate===void 0)skipUpdate=false;if(this.parent){this.parent.toGlobal(this.position,point,skipUpdate)}else{point.x=this.position.x;point.y=this.position.y}return point};var MeshBatchUvs=function MeshBatchUvs2(uvBuffer,uvMatrix){this.uvBuffer=uvBuffer;this.uvMatrix=uvMatrix;this.data=null;this._bufferUpdateId=-1;this._textureUpdateId=-1;this._updateID=0};MeshBatchUvs.prototype.update=function update6(forceUpdate){if(!forceUpdate&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID){return}this._bufferUpdateId=this.uvBuffer._updateID;this._textureUpdateId=this.uvMatrix._updateID;var data=this.uvBuffer.data;if(!this.data||this.data.length!==data.length){this.data=new Float32Array(data.length)}this.uvMatrix.multiplyUvs(data,this.data);this._updateID++};var tempPoint3=new Point;var tempPolygon=new Polygon;var Mesh=function(Container2){function Mesh2(geometry,shader,state,drawMode){if(drawMode===void 0)drawMode=DRAW_MODES.TRIANGLES;Container2.call(this);this.geometry=geometry;geometry.refCount++;this.shader=shader;this.state=state||State.for2d();this.drawMode=drawMode;this.start=0;this.size=0;this.uvs=null;this.indices=null;this.vertexData=new Float32Array(1);this.vertexDirty=0;this._transformID=-1;this.tint=16777215;this.blendMode=BLEND_MODES.NORMAL;this._roundPixels=settings.ROUND_PIXELS;this.batchUvs=null}if(Container2)Mesh2.__proto__=Container2;Mesh2.prototype=Object.create(Container2&&Container2.prototype);Mesh2.prototype.constructor=Mesh2;var prototypeAccessors5={uvBuffer:{configurable:true},verticesBuffer:{configurable:true},material:{configurable:true},blendMode:{configurable:true},roundPixels:{configurable:true},tint:{configurable:true},texture:{configurable:true}};prototypeAccessors5.uvBuffer.get=function(){return this.geometry.buffers[1]};prototypeAccessors5.verticesBuffer.get=function(){return this.geometry.buffers[0]};prototypeAccessors5.material.set=function(value){this.shader=value};prototypeAccessors5.material.get=function(){return this.shader};prototypeAccessors5.blendMode.set=function(value){this.state.blendMode=value};prototypeAccessors5.blendMode.get=function(){return this.state.blendMode};prototypeAccessors5.roundPixels.set=function(value){if(this._roundPixels!==value){this._transformID=-1}this._roundPixels=value};prototypeAccessors5.roundPixels.get=function(){return this._roundPixels};prototypeAccessors5.tint.get=function(){return this.shader.tint};prototypeAccessors5.tint.set=function(value){this.shader.tint=value};prototypeAccessors5.texture.get=function(){return this.shader.texture};prototypeAccessors5.texture.set=function(value){this.shader.texture=value};Mesh2.prototype._render=function _render(renderer){var vertices=this.geometry.buffers[0].data;if(this.shader.batchable&&this.drawMode===DRAW_MODES.TRIANGLES&&vertices.length<Mesh2.BATCHABLE_SIZE*2){this._renderToBatch(renderer)}else{this._renderDefault(renderer)}};Mesh2.prototype._renderDefault=function _renderDefault(renderer){var shader=this.shader;shader.alpha=this.worldAlpha;if(shader.update){shader.update()}renderer.batch.flush();if(shader.program.uniformData.translationMatrix){shader.uniforms.translationMatrix=this.transform.worldTransform.toArray(true)}renderer.shader.bind(shader);renderer.state.set(this.state);renderer.geometry.bind(this.geometry,shader);renderer.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)};Mesh2.prototype._renderToBatch=function _renderToBatch(renderer){var geometry=this.geometry;if(this.shader.uvMatrix){this.shader.uvMatrix.update();this.calculateUvs()}this.calculateVertices();this.indices=geometry.indexBuffer.data;this._tintRGB=this.shader._tintRGB;this._texture=this.shader.texture;var pluginName=this.material.pluginName;renderer.batch.setObjectRenderer(renderer.plugins[pluginName]);renderer.plugins[pluginName].render(this)};Mesh2.prototype.calculateVertices=function calculateVertices(){var geometry=this.geometry;var vertices=geometry.buffers[0].data;if(geometry.vertexDirtyId===this.vertexDirty&&this._transformID===this.transform._worldID){return}this._transformID=this.transform._worldID;if(this.vertexData.length!==vertices.length){this.vertexData=new Float32Array(vertices.length)}var wt=this.transform.worldTransform;var a=wt.a;var b=wt.b;var c=wt.c;var d=wt.d;var tx=wt.tx;var ty=wt.ty;var vertexData=this.vertexData;for(var i=0;i<vertexData.length/2;i++){var x=vertices[i*2];var y=vertices[i*2+1];vertexData[i*2]=a*x+c*y+tx;vertexData[i*2+1]=b*x+d*y+ty}if(this._roundPixels){var resolution=settings.RESOLUTION;for(var i$1=0;i$1<vertexData.length;++i$1){vertexData[i$1]=Math.round((vertexData[i$1]*resolution|0)/resolution)}}this.vertexDirty=geometry.vertexDirtyId};Mesh2.prototype.calculateUvs=function calculateUvs(){var geomUvs=this.geometry.buffers[1];if(!this.shader.uvMatrix.isSimple){if(!this.batchUvs){this.batchUvs=new MeshBatchUvs(geomUvs,this.shader.uvMatrix)}this.batchUvs.update();this.uvs=this.batchUvs.data}else{this.uvs=geomUvs.data}};Mesh2.prototype._calculateBounds=function _calculateBounds(){this.calculateVertices();this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)};Mesh2.prototype.containsPoint=function containsPoint(point){if(!this.getBounds().contains(point.x,point.y)){return false}this.worldTransform.applyInverse(point,tempPoint3);var vertices=this.geometry.getBuffer("aVertexPosition").data;var points=tempPolygon.points;var indices2=this.geometry.getIndex().data;var len=indices2.length;var step=this.drawMode===4?3:1;for(var i=0;i+2<len;i+=step){var ind0=indices2[i]*2;var ind1=indices2[i+1]*2;var ind2=indices2[i+2]*2;points[0]=vertices[ind0];points[1]=vertices[ind0+1];points[2]=vertices[ind1];points[3]=vertices[ind1+1];points[4]=vertices[ind2];points[5]=vertices[ind2+1];if(tempPolygon.contains(tempPoint3.x,tempPoint3.y)){return true}}return false};Mesh2.prototype.destroy=function destroy25(options){Container2.prototype.destroy.call(this,options);this.geometry.refCount--;if(this.geometry.refCount===0){this.geometry.dispose()}this.geometry=null;this.shader=null;this.state=null;this.uvs=null;this.indices=null;this.vertexData=null};Object.defineProperties(Mesh2.prototype,prototypeAccessors5);return Mesh2}(Container);Mesh.BATCHABLE_SIZE=100;var vertex4="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTextureMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\n}\n";var fragment5="varying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}\n";var MeshMaterial=function(Shader3){function MeshMaterial2(uSampler,options){var uniforms={uSampler:uSampler,alpha:1,uTextureMatrix:Matrix.IDENTITY,uColor:new Float32Array([1,1,1,1])};options=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},options);if(options.uniforms){Object.assign(uniforms,options.uniforms)}Shader3.call(this,options.program||Program.from(vertex4,fragment5),uniforms);this._colorDirty=false;this.uvMatrix=new TextureMatrix(uSampler);this.batchable=options.program===void 0;this.pluginName=options.pluginName;this.tint=options.tint;this.alpha=options.alpha}if(Shader3)MeshMaterial2.__proto__=Shader3;MeshMaterial2.prototype=Object.create(Shader3&&Shader3.prototype);MeshMaterial2.prototype.constructor=MeshMaterial2;var prototypeAccessors5={texture:{configurable:true},alpha:{configurable:true},tint:{configurable:true}};prototypeAccessors5.texture.get=function(){return this.uniforms.uSampler};prototypeAccessors5.texture.set=function(value){if(this.uniforms.uSampler!==value){this.uniforms.uSampler=value;this.uvMatrix.texture=value}};prototypeAccessors5.alpha.set=function(value){if(value===this._alpha){return}this._alpha=value;this._colorDirty=true};prototypeAccessors5.alpha.get=function(){return this._alpha};prototypeAccessors5.tint.set=function(value){if(value===this._tint){return}this._tint=value;this._tintRGB=(value>>16)+(value&65280)+((value&255)<<16);this._colorDirty=true};prototypeAccessors5.tint.get=function(){return this._tint};MeshMaterial2.prototype.update=function update7(){if(this._colorDirty){this._colorDirty=false;var baseTexture=this.texture.baseTexture;_premultiplyTintToRgba(this._tint,this._alpha,this.uniforms.uColor,baseTexture.alphaMode)}if(this.uvMatrix.update()){this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord}};Object.defineProperties(MeshMaterial2.prototype,prototypeAccessors5);return MeshMaterial2}(Shader);var MeshGeometry=function(Geometry3){function MeshGeometry2(vertices,uvs,index3){Geometry3.call(this);var verticesBuffer=new Buffer2(vertices);var uvsBuffer=new Buffer2(uvs,true);var indexBuffer=new Buffer2(index3,true,true);this.addAttribute("aVertexPosition",verticesBuffer,2,false,TYPES.FLOAT).addAttribute("aTextureCoord",uvsBuffer,2,false,TYPES.FLOAT).addIndex(indexBuffer);this._updateId=-1}if(Geometry3)MeshGeometry2.__proto__=Geometry3;MeshGeometry2.prototype=Object.create(Geometry3&&Geometry3.prototype);MeshGeometry2.prototype.constructor=MeshGeometry2;var prototypeAccessors5={vertexDirtyId:{configurable:true}};prototypeAccessors5.vertexDirtyId.get=function(){return this.buffers[0]._updateID};Object.defineProperties(MeshGeometry2.prototype,prototypeAccessors5);return MeshGeometry2}(Geometry);var PlaneGeometry=function(MeshGeometry2){function PlaneGeometry2(width,height,segWidth,segHeight){if(width===void 0)width=100;if(height===void 0)height=100;if(segWidth===void 0)segWidth=10;if(segHeight===void 0)segHeight=10;MeshGeometry2.call(this);this.segWidth=segWidth;this.segHeight=segHeight;this.width=width;this.height=height;this.build()}if(MeshGeometry2)PlaneGeometry2.__proto__=MeshGeometry2;PlaneGeometry2.prototype=Object.create(MeshGeometry2&&MeshGeometry2.prototype);PlaneGeometry2.prototype.constructor=PlaneGeometry2;PlaneGeometry2.prototype.build=function build5(){var total=this.segWidth*this.segHeight;var verts=[];var uvs=[];var indices2=[];var segmentsX=this.segWidth-1;var segmentsY=this.segHeight-1;var sizeX=this.width/segmentsX;var sizeY=this.height/segmentsY;for(var i=0;i<total;i++){var x=i%this.segWidth;var y=i/this.segWidth|0;verts.push(x*sizeX,y*sizeY);uvs.push(x/segmentsX,y/segmentsY)}var totalSub=segmentsX*segmentsY;for(var i$1=0;i$1<totalSub;i$1++){var xpos=i$1%segmentsX;var ypos=i$1/segmentsX|0;var value=ypos*this.segWidth+xpos;var value2=ypos*this.segWidth+xpos+1;var value3=(ypos+1)*this.segWidth+xpos;var value4=(ypos+1)*this.segWidth+xpos+1;indices2.push(value,value2,value3,value2,value4,value3)}this.buffers[0].data=new Float32Array(verts);this.buffers[1].data=new Float32Array(uvs);this.indexBuffer.data=new Uint16Array(indices2);this.buffers[0].update();this.buffers[1].update();this.indexBuffer.update()};return PlaneGeometry2}(MeshGeometry);var RopeGeometry=function(MeshGeometry2){function RopeGeometry2(width,points,textureScale){if(width===void 0)width=200;if(textureScale===void 0)textureScale=0;MeshGeometry2.call(this,new Float32Array(points.length*4),new Float32Array(points.length*4),new Uint16Array((points.length-1)*6));this.points=points;this.width=width;this.textureScale=textureScale;this.build()}if(MeshGeometry2)RopeGeometry2.__proto__=MeshGeometry2;RopeGeometry2.prototype=Object.create(MeshGeometry2&&MeshGeometry2.prototype);RopeGeometry2.prototype.constructor=RopeGeometry2;RopeGeometry2.prototype.build=function build5(){var points=this.points;if(!points){return}var vertexBuffer=this.getBuffer("aVertexPosition");var uvBuffer=this.getBuffer("aTextureCoord");var indexBuffer=this.getIndex();if(points.length<1){return}if(vertexBuffer.data.length/4!==points.length){vertexBuffer.data=new Float32Array(points.length*4);uvBuffer.data=new Float32Array(points.length*4);indexBuffer.data=new Uint16Array((points.length-1)*6)}var uvs=uvBuffer.data;var indices2=indexBuffer.data;uvs[0]=0;uvs[1]=0;uvs[2]=0;uvs[3]=1;var amount=0;var prev=points[0];var textureWidth=this.width*this.textureScale;var total=points.length;for(var i=0;i<total;i++){var index3=i*4;if(this.textureScale>0){var dx=prev.x-points[i].x;var dy=prev.y-points[i].y;var distance=Math.sqrt(dx*dx+dy*dy);prev=points[i];amount+=distance/textureWidth}else{amount=i/(total-1)}uvs[index3]=amount;uvs[index3+1]=0;uvs[index3+2]=amount;uvs[index3+3]=1}var indexCount=0;for(var i$1=0;i$1<total-1;i$1++){var index$1=i$1*2;indices2[indexCount++]=index$1;indices2[indexCount++]=index$1+1;indices2[indexCount++]=index$1+2;indices2[indexCount++]=index$1+2;indices2[indexCount++]=index$1+1;indices2[indexCount++]=index$1+3}uvBuffer.update();indexBuffer.update();this.updateVertices()};RopeGeometry2.prototype.updateVertices=function updateVertices(){var points=this.points;if(points.length<1){return}var lastPoint=points[0];var nextPoint;var perpX=0;var perpY=0;var vertices=this.buffers[0].data;var total=points.length;for(var i=0;i<total;i++){var point=points[i];var index3=i*4;if(i<points.length-1){nextPoint=points[i+1]}else{nextPoint=point}perpY=-(nextPoint.x-lastPoint.x);perpX=nextPoint.y-lastPoint.y;var perpLength=Math.sqrt(perpX*perpX+perpY*perpY);var num=this.textureScale>0?this.textureScale*this.width/2:this.width/2;perpX/=perpLength;perpY/=perpLength;perpX*=num;perpY*=num;vertices[index3]=point.x+perpX;vertices[index3+1]=point.y+perpY;vertices[index3+2]=point.x-perpX;vertices[index3+3]=point.y-perpY;lastPoint=point}this.buffers[0].update()};RopeGeometry2.prototype.update=function update7(){if(this.textureScale>0){this.build()}else{this.updateVertices()}};return RopeGeometry2}(MeshGeometry);var SimpleRope=function(Mesh2){function SimpleRope2(texture,points,textureScale){if(textureScale===void 0)textureScale=0;var ropeGeometry=new RopeGeometry(texture.height,points,textureScale);var meshMaterial=new MeshMaterial(texture);if(textureScale>0){texture.baseTexture.wrapMode=WRAP_MODES.REPEAT}Mesh2.call(this,ropeGeometry,meshMaterial);this.autoUpdate=true}if(Mesh2)SimpleRope2.__proto__=Mesh2;SimpleRope2.prototype=Object.create(Mesh2&&Mesh2.prototype);SimpleRope2.prototype.constructor=SimpleRope2;SimpleRope2.prototype._render=function _render(renderer){if(this.autoUpdate||this.geometry.width!==this.shader.texture.height){this.geometry.width=this.shader.texture.height;this.geometry.update()}Mesh2.prototype._render.call(this,renderer)};return SimpleRope2}(Mesh);var SimplePlane=function(Mesh2){function SimplePlane2(texture,verticesX,verticesY){var planeGeometry=new PlaneGeometry(texture.width,texture.height,verticesX,verticesY);var meshMaterial=new MeshMaterial(Texture.WHITE);Mesh2.call(this,planeGeometry,meshMaterial);this.texture=texture}if(Mesh2)SimplePlane2.__proto__=Mesh2;SimplePlane2.prototype=Object.create(Mesh2&&Mesh2.prototype);SimplePlane2.prototype.constructor=SimplePlane2;var prototypeAccessors5={texture:{configurable:true}};SimplePlane2.prototype.textureUpdated=function textureUpdated(){this._textureID=this.shader.texture._updateID;this.geometry.width=this.shader.texture.width;this.geometry.height=this.shader.texture.height;this.geometry.build()};prototypeAccessors5.texture.set=function(value){if(this.shader.texture===value){return}this.shader.texture=value;this._textureID=-1;if(value.baseTexture.valid){this.textureUpdated()}else{value.once("update",this.textureUpdated,this)}};prototypeAccessors5.texture.get=function(){return this.shader.texture};SimplePlane2.prototype._render=function _render(renderer){if(this._textureID!==this.shader.texture._updateID){this.textureUpdated()}Mesh2.prototype._render.call(this,renderer)};Object.defineProperties(SimplePlane2.prototype,prototypeAccessors5);return SimplePlane2}(Mesh);var SimpleMesh=function(Mesh2){function SimpleMesh2(texture,vertices,uvs,indices2,drawMode){if(texture===void 0)texture=Texture.EMPTY;var geometry=new MeshGeometry(vertices,uvs,indices2);geometry.getBuffer("aVertexPosition").static=false;var meshMaterial=new MeshMaterial(texture);Mesh2.call(this,geometry,meshMaterial,null,drawMode);this.autoUpdate=true}if(Mesh2)SimpleMesh2.__proto__=Mesh2;SimpleMesh2.prototype=Object.create(Mesh2&&Mesh2.prototype);SimpleMesh2.prototype.constructor=SimpleMesh2;var prototypeAccessors5={vertices:{configurable:true}};prototypeAccessors5.vertices.get=function(){return this.geometry.getBuffer("aVertexPosition").data};prototypeAccessors5.vertices.set=function(value){this.geometry.getBuffer("aVertexPosition").data=value};SimpleMesh2.prototype._render=function _render(renderer){if(this.autoUpdate){this.geometry.getBuffer("aVertexPosition").update()}Mesh2.prototype._render.call(this,renderer)};Object.defineProperties(SimpleMesh2.prototype,prototypeAccessors5);return SimpleMesh2}(Mesh);var DEFAULT_BORDER_SIZE=10;var NineSlicePlane=function(SimplePlane2){function NineSlicePlane2(texture,leftWidth,topHeight,rightWidth,bottomHeight){SimplePlane2.call(this,Texture.WHITE,4,4);this._origWidth=texture.orig.width;this._origHeight=texture.orig.height;this._width=this._origWidth;this._height=this._origHeight;this._leftWidth=typeof leftWidth!=="undefined"?leftWidth:DEFAULT_BORDER_SIZE;this._rightWidth=typeof rightWidth!=="undefined"?rightWidth:DEFAULT_BORDER_SIZE;this._topHeight=typeof topHeight!=="undefined"?topHeight:DEFAULT_BORDER_SIZE;this._bottomHeight=typeof bottomHeight!=="undefined"?bottomHeight:DEFAULT_BORDER_SIZE;this.texture=texture}if(SimplePlane2)NineSlicePlane2.__proto__=SimplePlane2;NineSlicePlane2.prototype=Object.create(SimplePlane2&&SimplePlane2.prototype);NineSlicePlane2.prototype.constructor=NineSlicePlane2;var prototypeAccessors5={vertices:{configurable:true},width:{configurable:true},height:{configurable:true},leftWidth:{configurable:true},rightWidth:{configurable:true},topHeight:{configurable:true},bottomHeight:{configurable:true}};NineSlicePlane2.prototype.textureUpdated=function textureUpdated(){this._textureID=this.shader.texture._updateID;this._refresh()};prototypeAccessors5.vertices.get=function(){return this.geometry.getBuffer("aVertexPosition").data};prototypeAccessors5.vertices.set=function(value){this.geometry.getBuffer("aVertexPosition").data=value};NineSlicePlane2.prototype.updateHorizontalVertices=function updateHorizontalVertices(){var vertices=this.vertices;var scale=this._getMinScale();vertices[9]=vertices[11]=vertices[13]=vertices[15]=this._topHeight*scale;vertices[17]=vertices[19]=vertices[21]=vertices[23]=this._height-this._bottomHeight*scale;vertices[25]=vertices[27]=vertices[29]=vertices[31]=this._height};NineSlicePlane2.prototype.updateVerticalVertices=function updateVerticalVertices(){var vertices=this.vertices;var scale=this._getMinScale();vertices[2]=vertices[10]=vertices[18]=vertices[26]=this._leftWidth*scale;vertices[4]=vertices[12]=vertices[20]=vertices[28]=this._width-this._rightWidth*scale;vertices[6]=vertices[14]=vertices[22]=vertices[30]=this._width};NineSlicePlane2.prototype._getMinScale=function _getMinScale(){var w=this._leftWidth+this._rightWidth;var scaleW=this._width>w?1:this._width/w;var h=this._topHeight+this._bottomHeight;var scaleH=this._height>h?1:this._height/h;var scale=Math.min(scaleW,scaleH);return scale};prototypeAccessors5.width.get=function(){return this._width};prototypeAccessors5.width.set=function(value){this._width=value;this._refresh()};prototypeAccessors5.height.get=function(){return this._height};prototypeAccessors5.height.set=function(value){this._height=value;this._refresh()};prototypeAccessors5.leftWidth.get=function(){return this._leftWidth};prototypeAccessors5.leftWidth.set=function(value){this._leftWidth=value;this._refresh()};prototypeAccessors5.rightWidth.get=function(){return this._rightWidth};prototypeAccessors5.rightWidth.set=function(value){this._rightWidth=value;this._refresh()};prototypeAccessors5.topHeight.get=function(){return this._topHeight};prototypeAccessors5.topHeight.set=function(value){this._topHeight=value;this._refresh()};prototypeAccessors5.bottomHeight.get=function(){return this._bottomHeight};prototypeAccessors5.bottomHeight.set=function(value){this._bottomHeight=value;this._refresh()};NineSlicePlane2.prototype._refresh=function _refresh(){var texture=this.texture;var uvs=this.geometry.buffers[1].data;this._origWidth=texture.orig.width;this._origHeight=texture.orig.height;var _uvw=1/this._origWidth;var _uvh=1/this._origHeight;uvs[0]=uvs[8]=uvs[16]=uvs[24]=0;uvs[1]=uvs[3]=uvs[5]=uvs[7]=0;uvs[6]=uvs[14]=uvs[22]=uvs[30]=1;uvs[25]=uvs[27]=uvs[29]=uvs[31]=1;uvs[2]=uvs[10]=uvs[18]=uvs[26]=_uvw*this._leftWidth;uvs[4]=uvs[12]=uvs[20]=uvs[28]=1-_uvw*this._rightWidth;uvs[9]=uvs[11]=uvs[13]=uvs[15]=_uvh*this._topHeight;uvs[17]=uvs[19]=uvs[21]=uvs[23]=1-_uvh*this._bottomHeight;this.updateHorizontalVertices();this.updateVerticalVertices();this.geometry.buffers[0].update();this.geometry.buffers[1].update()};Object.defineProperties(NineSlicePlane2.prototype,prototypeAccessors5);return NineSlicePlane2}(SimplePlane);var AnimatedSprite=function(Sprite2){function AnimatedSprite2(textures,autoUpdate){Sprite2.call(this,textures[0]instanceof Texture?textures[0]:textures[0].texture);this._textures=null;this._durations=null;this._autoUpdate=autoUpdate!==false;this._isConnectedToTicker=false;this.animationSpeed=1;this.loop=true;this.updateAnchor=false;this.onComplete=null;this.onFrameChange=null;this.onLoop=null;this._currentTime=0;this._playing=false;this._previousFrame=null;this.textures=textures}if(Sprite2)AnimatedSprite2.__proto__=Sprite2;AnimatedSprite2.prototype=Object.create(Sprite2&&Sprite2.prototype);AnimatedSprite2.prototype.constructor=AnimatedSprite2;var prototypeAccessors5={totalFrames:{configurable:true},textures:{configurable:true},currentFrame:{configurable:true},playing:{configurable:true},autoUpdate:{configurable:true}};AnimatedSprite2.prototype.stop=function stop2(){if(!this.playing){return}this._playing=false;if(this._autoUpdate&&this._isConnectedToTicker){Ticker.shared.remove(this.update,this);this._isConnectedToTicker=false}};AnimatedSprite2.prototype.play=function play(){if(this.playing){return}this._playing=true;if(this._autoUpdate&&!this._isConnectedToTicker){Ticker.shared.add(this.update,this,UPDATE_PRIORITY.HIGH);this._isConnectedToTicker=true}};AnimatedSprite2.prototype.gotoAndStop=function gotoAndStop(frameNumber){this.stop();var previousFrame=this.currentFrame;this._currentTime=frameNumber;if(previousFrame!==this.currentFrame){this.updateTexture()}};AnimatedSprite2.prototype.gotoAndPlay=function gotoAndPlay(frameNumber){var previousFrame=this.currentFrame;this._currentTime=frameNumber;if(previousFrame!==this.currentFrame){this.updateTexture()}this.play()};AnimatedSprite2.prototype.update=function update7(deltaTime){var elapsed=this.animationSpeed*deltaTime;var previousFrame=this.currentFrame;if(this._durations!==null){var lag=this._currentTime%1*this._durations[this.currentFrame];lag+=elapsed/60*1e3;while(lag<0){this._currentTime--;lag+=this._durations[this.currentFrame]}var sign2=Math.sign(this.animationSpeed*deltaTime);this._currentTime=Math.floor(this._currentTime);while(lag>=this._durations[this.currentFrame]){lag-=this._durations[this.currentFrame]*sign2;this._currentTime+=sign2}this._currentTime+=lag/this._durations[this.currentFrame]}else{this._currentTime+=elapsed}if(this._currentTime<0&&!this.loop){this.gotoAndStop(0);if(this.onComplete){this.onComplete()}}else if(this._currentTime>=this._textures.length&&!this.loop){this.gotoAndStop(this._textures.length-1);if(this.onComplete){this.onComplete()}}else if(previousFrame!==this.currentFrame){if(this.loop&&this.onLoop){if(this.animationSpeed>0&&this.currentFrame<previousFrame){this.onLoop()}else if(this.animationSpeed<0&&this.currentFrame>previousFrame){this.onLoop()}}this.updateTexture()}};AnimatedSprite2.prototype.updateTexture=function updateTexture(){var currentFrame=this.currentFrame;if(this._previousFrame===currentFrame){return}this._previousFrame=currentFrame;this._texture=this._textures[currentFrame];this._textureID=-1;this._textureTrimmedID=-1;this._cachedTint=16777215;this.uvs=this._texture._uvs.uvsFloat32;if(this.updateAnchor){this._anchor.copyFrom(this._texture.defaultAnchor)}if(this.onFrameChange){this.onFrameChange(this.currentFrame)}};AnimatedSprite2.prototype.destroy=function destroy25(options){this.stop();Sprite2.prototype.destroy.call(this,options);this.onComplete=null;this.onFrameChange=null;this.onLoop=null};AnimatedSprite2.fromFrames=function fromFrames(frames){var textures=[];for(var i=0;i<frames.length;++i){textures.push(Texture.from(frames[i]))}return new AnimatedSprite2(textures)};AnimatedSprite2.fromImages=function fromImages(images){var textures=[];for(var i=0;i<images.length;++i){textures.push(Texture.from(images[i]))}return new AnimatedSprite2(textures)};prototypeAccessors5.totalFrames.get=function(){return this._textures.length};prototypeAccessors5.textures.get=function(){return this._textures};prototypeAccessors5.textures.set=function(value){if(value[0]instanceof Texture){this._textures=value;this._durations=null}else{this._textures=[];this._durations=[];for(var i=0;i<value.length;i++){this._textures.push(value[i].texture);this._durations.push(value[i].time)}}this._previousFrame=null;this.gotoAndStop(0);this.updateTexture()};prototypeAccessors5.currentFrame.get=function(){var currentFrame=Math.floor(this._currentTime)%this._textures.length;if(currentFrame<0){currentFrame+=this._textures.length}return currentFrame};prototypeAccessors5.playing.get=function(){return this._playing};prototypeAccessors5.autoUpdate.get=function(){return this._autoUpdate};prototypeAccessors5.autoUpdate.set=function(value){if(value!==this._autoUpdate){this._autoUpdate=value;if(!this._autoUpdate&&this._isConnectedToTicker){Ticker.shared.remove(this.update,this);this._isConnectedToTicker=false}else if(this._autoUpdate&&!this._isConnectedToTicker&&this._playing){Ticker.shared.add(this.update,this);this._isConnectedToTicker=true}}};Object.defineProperties(AnimatedSprite2.prototype,prototypeAccessors5);return AnimatedSprite2}(Sprite);Renderer.registerPlugin("accessibility",_AccessibilityManager);Renderer.registerPlugin("extract",Extract);Renderer.registerPlugin("interaction",_InteractionManager);Renderer.registerPlugin("particle",ParticleRenderer);Renderer.registerPlugin("prepare",Prepare);Renderer.registerPlugin("batch",BatchRenderer);Renderer.registerPlugin("tilingSprite",TilingSpriteRenderer);Loader2.registerPlugin(BitmapFontLoader);Loader2.registerPlugin(SpritesheetLoader);Application.registerPlugin(TickerPlugin);Application.registerPlugin(AppLoaderPlugin);var CanvasMaskManager=function CanvasMaskManager2(renderer){this.renderer=renderer;this._foundShapes=[]};CanvasMaskManager.prototype.pushMask=function pushMask(maskData){var renderer=this.renderer;var maskObject=maskData.isMaskData?maskData.maskObject:maskData;renderer.context.save();var foundShapes=this._foundShapes;this.recursiveFindShapes(maskObject,foundShapes);if(foundShapes.length>0){var context2=renderer.context;context2.beginPath();for(var i=0;i<foundShapes.length;i++){var shape=foundShapes[i];var transform=shape.transform.worldTransform;this.renderer.setContextTransform(transform);this.renderGraphicsShape(shape)}foundShapes.length=0;context2.clip()}};CanvasMaskManager.prototype.recursiveFindShapes=function recursiveFindShapes(container,out){if(container.geometry&&container.geometry.graphicsData){out.push(container)}var children=container.children;if(children){for(var i=0;i<children.length;i++){this.recursiveFindShapes(children[i],out)}}};CanvasMaskManager.prototype.renderGraphicsShape=function renderGraphicsShape(graphics){graphics.finishPoly();var context2=this.renderer.context;var graphicsData=graphics.geometry.graphicsData;var len=graphicsData.length;if(len===0){return}for(var i=0;i<len;i++){var data=graphicsData[i];var shape=data.shape;if(data.type===SHAPES.POLY){var points=shape.points;context2.moveTo(points[0],points[1]);for(var j=1;j<points.length/2;j++){context2.lineTo(points[j*2],points[j*2+1])}if(points[0]===points[points.length-2]&&points[1]===points[points.length-1]){context2.closePath()}}else if(data.type===SHAPES.RECT){context2.rect(shape.x,shape.y,shape.width,shape.height);context2.closePath()}else if(data.type===SHAPES.CIRC){context2.arc(shape.x,shape.y,shape.radius,0,2*Math.PI);context2.closePath()}else if(data.type===SHAPES.ELIP){var w=shape.width*2;var h=shape.height*2;var x=shape.x-w/2;var y=shape.y-h/2;var kappa=0.5522848;var ox=w/2*kappa;var oy=h/2*kappa;var xe=x+w;var ye=y+h;var xm=x+w/2;var ym=y+h/2;context2.moveTo(x,ym);context2.bezierCurveTo(x,ym-oy,xm-ox,y,xm,y);context2.bezierCurveTo(xm+ox,y,xe,ym-oy,xe,ym);context2.bezierCurveTo(xe,ym+oy,xm+ox,ye,xm,ye);context2.bezierCurveTo(xm-ox,ye,x,ym+oy,x,ym);context2.closePath()}else if(data.type===SHAPES.RREC){var rx=shape.x;var ry=shape.y;var width=shape.width;var height=shape.height;var radius=shape.radius;var maxRadius=Math.min(width,height)/2|0;radius=radius>maxRadius?maxRadius:radius;context2.moveTo(rx,ry+radius);context2.lineTo(rx,ry+height-radius);context2.quadraticCurveTo(rx,ry+height,rx+radius,ry+height);context2.lineTo(rx+width-radius,ry+height);context2.quadraticCurveTo(rx+width,ry+height,rx+width,ry+height-radius);context2.lineTo(rx+width,ry+radius);context2.quadraticCurveTo(rx+width,ry,rx+width-radius,ry);context2.lineTo(rx+radius,ry);context2.quadraticCurveTo(rx,ry,rx,ry+radius);context2.closePath()}}};CanvasMaskManager.prototype.popMask=function popMask(renderer){renderer.context.restore();renderer.invalidateBlendMode()};CanvasMaskManager.prototype.destroy=function destroy20(){};function createColoredCanvas(color){var canvas4=document.createElement("canvas");canvas4.width=6;canvas4.height=1;var context2=canvas4.getContext("2d");context2.fillStyle=color;context2.fillRect(0,0,6,1);return canvas4}function canUseNewCanvasBlendModes(){if(typeof document==="undefined"){return false}var magenta=createColoredCanvas("#ff00ff");var yellow=createColoredCanvas("#ffff00");var canvas4=document.createElement("canvas");canvas4.width=6;canvas4.height=1;var context2=canvas4.getContext("2d");context2.globalCompositeOperation="multiply";context2.drawImage(magenta,0,0);context2.drawImage(yellow,2,0);var imageData=context2.getImageData(2,0,1,1);if(!imageData){return false}var data=imageData.data;return data[0]===255&&data[1]===0&&data[2]===0}function mapCanvasBlendModesToPixi(array){if(array===void 0)array=[];if(canUseNewCanvasBlendModes()){array[BLEND_MODES.NORMAL]="source-over";array[BLEND_MODES.ADD]="lighter";array[BLEND_MODES.MULTIPLY]="multiply";array[BLEND_MODES.SCREEN]="screen";array[BLEND_MODES.OVERLAY]="overlay";array[BLEND_MODES.DARKEN]="darken";array[BLEND_MODES.LIGHTEN]="lighten";array[BLEND_MODES.COLOR_DODGE]="color-dodge";array[BLEND_MODES.COLOR_BURN]="color-burn";array[BLEND_MODES.HARD_LIGHT]="hard-light";array[BLEND_MODES.SOFT_LIGHT]="soft-light";array[BLEND_MODES.DIFFERENCE]="difference";array[BLEND_MODES.EXCLUSION]="exclusion";array[BLEND_MODES.HUE]="hue";array[BLEND_MODES.SATURATION]="saturate";array[BLEND_MODES.COLOR]="color";array[BLEND_MODES.LUMINOSITY]="luminosity"}else{array[BLEND_MODES.NORMAL]="source-over";array[BLEND_MODES.ADD]="lighter";array[BLEND_MODES.MULTIPLY]="source-over";array[BLEND_MODES.SCREEN]="source-over";array[BLEND_MODES.OVERLAY]="source-over";array[BLEND_MODES.DARKEN]="source-over";array[BLEND_MODES.LIGHTEN]="source-over";array[BLEND_MODES.COLOR_DODGE]="source-over";array[BLEND_MODES.COLOR_BURN]="source-over";array[BLEND_MODES.HARD_LIGHT]="source-over";array[BLEND_MODES.SOFT_LIGHT]="source-over";array[BLEND_MODES.DIFFERENCE]="source-over";array[BLEND_MODES.EXCLUSION]="source-over";array[BLEND_MODES.HUE]="source-over";array[BLEND_MODES.SATURATION]="source-over";array[BLEND_MODES.COLOR]="source-over";array[BLEND_MODES.LUMINOSITY]="source-over"}array[BLEND_MODES.NORMAL_NPM]=array[BLEND_MODES.NORMAL];array[BLEND_MODES.ADD_NPM]=array[BLEND_MODES.ADD];array[BLEND_MODES.SCREEN_NPM]=array[BLEND_MODES.SCREEN];array[BLEND_MODES.SRC_IN]="source-in";array[BLEND_MODES.SRC_OUT]="source-out";array[BLEND_MODES.SRC_ATOP]="source-atop";array[BLEND_MODES.DST_OVER]="destination-over";array[BLEND_MODES.DST_IN]="destination-in";array[BLEND_MODES.DST_OUT]="destination-out";array[BLEND_MODES.DST_ATOP]="destination-atop";array[BLEND_MODES.XOR]="xor";array[BLEND_MODES.SUBTRACT]="source-over";return array}var tempMatrix2=new Matrix;var CanvasRenderer=function(AbstractRenderer2){function CanvasRenderer2(options,arg2,arg3){AbstractRenderer2.call(this,"Canvas",options,arg2,arg3);this.type=RENDERER_TYPE.CANVAS;this.rootContext=this.view.getContext("2d",{alpha:this.transparent});this.context=this.rootContext;this.refresh=true;this.maskManager=new CanvasMaskManager(this);this.smoothProperty="imageSmoothingEnabled";if(!this.rootContext.imageSmoothingEnabled){if(this.rootContext.webkitImageSmoothingEnabled){this.smoothProperty="webkitImageSmoothingEnabled"}else if(this.rootContext.mozImageSmoothingEnabled){this.smoothProperty="mozImageSmoothingEnabled"}else if(this.rootContext.oImageSmoothingEnabled){this.smoothProperty="oImageSmoothingEnabled"}else if(this.rootContext.msImageSmoothingEnabled){this.smoothProperty="msImageSmoothingEnabled"}}this.initPlugins(CanvasRenderer2.__plugins);this.blendModes=mapCanvasBlendModesToPixi();this._activeBlendMode=null;this._outerBlend=false;this._projTransform=null;this.renderingToScreen=false;_sayHello("Canvas");this.resize(this.options.width,this.options.height)}if(AbstractRenderer2)CanvasRenderer2.__proto__=AbstractRenderer2;CanvasRenderer2.prototype=Object.create(AbstractRenderer2&&AbstractRenderer2.prototype);CanvasRenderer2.prototype.constructor=CanvasRenderer2;CanvasRenderer2.prototype.render=function render6(displayObject,renderTexture,clear5,transform,skipUpdateTransform){if(!this.view){return}this.renderingToScreen=!renderTexture;this.emit("prerender");var rootResolution=this.resolution;if(renderTexture){renderTexture=renderTexture.baseTexture||renderTexture;if(!renderTexture._canvasRenderTarget){renderTexture._canvasRenderTarget=new _CanvasRenderTarget(renderTexture.width,renderTexture.height,renderTexture.resolution);renderTexture.resource=new index.CanvasResource(renderTexture._canvasRenderTarget.canvas);renderTexture.valid=true}this.context=renderTexture._canvasRenderTarget.context;this.resolution=renderTexture._canvasRenderTarget.resolution}else{this.context=this.rootContext}var context2=this.context;this._projTransform=transform||null;if(!renderTexture){this._lastObjectRendered=displayObject}if(!skipUpdateTransform){var cacheParent=displayObject.parent;displayObject.parent=this._tempDisplayObjectParent;displayObject.updateTransform();displayObject.parent=cacheParent}context2.save();context2.setTransform(1,0,0,1,0,0);context2.globalAlpha=1;this._activeBlendMode=BLEND_MODES.NORMAL;this._outerBlend=false;context2.globalCompositeOperation=this.blendModes[BLEND_MODES.NORMAL];if(clear5!==void 0?clear5:this.clearBeforeRender){if(this.renderingToScreen){if(this.transparent){context2.clearRect(0,0,this.width,this.height)}else{context2.fillStyle=this._backgroundColorString;context2.fillRect(0,0,this.width,this.height)}}}var tempContext=this.context;this.context=context2;displayObject.renderCanvas(this);this.context=tempContext;context2.restore();this.resolution=rootResolution;this._projTransform=null;this.emit("postrender")};CanvasRenderer2.prototype.setContextTransform=function setContextTransform(transform,roundPixels,localResolution){var mat=transform;var proj=this._projTransform;var resolution=this.resolution;localResolution=localResolution||resolution;if(proj){mat=tempMatrix2;mat.copyFrom(transform);mat.prepend(proj)}if(roundPixels){this.context.setTransform(mat.a*localResolution,mat.b*localResolution,mat.c*localResolution,mat.d*localResolution,mat.tx*resolution|0,mat.ty*resolution|0)}else{this.context.setTransform(mat.a*localResolution,mat.b*localResolution,mat.c*localResolution,mat.d*localResolution,mat.tx*resolution,mat.ty*resolution)}};CanvasRenderer2.prototype.clear=function clear5(clearColor){var context2=this.context;clearColor=clearColor||this._backgroundColorString;if(!this.transparent&&clearColor){context2.fillStyle=clearColor;context2.fillRect(0,0,this.width,this.height)}else{context2.clearRect(0,0,this.width,this.height)}};CanvasRenderer2.prototype.setBlendMode=function setBlendMode(blendMode,readyForOuterBlend){var outerBlend=blendMode===BLEND_MODES.SRC_IN||blendMode===BLEND_MODES.SRC_OUT||blendMode===BLEND_MODES.DST_IN||blendMode===BLEND_MODES.DST_ATOP;if(!readyForOuterBlend&&outerBlend){blendMode=BLEND_MODES.NORMAL}if(this._activeBlendMode===blendMode){return}this._activeBlendMode=blendMode;this._outerBlend=outerBlend;this.context.globalCompositeOperation=this.blendModes[blendMode]};CanvasRenderer2.prototype.destroy=function destroy25(removeView){AbstractRenderer2.prototype.destroy.call(this,removeView);this.context=null;this.refresh=true;this.maskManager.destroy();this.maskManager=null;this.smoothProperty=null};CanvasRenderer2.prototype.resize=function resize3(screenWidth,screenHeight){AbstractRenderer2.prototype.resize.call(this,screenWidth,screenHeight);if(this.smoothProperty){this.rootContext[this.smoothProperty]=settings.SCALE_MODE===SCALE_MODES.LINEAR}};CanvasRenderer2.prototype.invalidateBlendMode=function invalidateBlendMode(){this._activeBlendMode=this.blendModes.indexOf(this.context.globalCompositeOperation)};CanvasRenderer2.registerPlugin=function registerPlugin3(pluginName,ctor){CanvasRenderer2.__plugins=CanvasRenderer2.__plugins||{};CanvasRenderer2.__plugins[pluginName]=ctor};return CanvasRenderer2}(AbstractRenderer);var canvasUtils={getTintedCanvas:function getTintedCanvas(sprite,color){var texture=sprite.texture;color=canvasUtils.roundColor(color);var stringColor="#"+("00000"+(color|0).toString(16)).substr(-6);texture.tintCache=texture.tintCache||{};var cachedCanvas=texture.tintCache[stringColor];var canvas4;if(cachedCanvas){if(cachedCanvas.tintId===texture._updateID){return texture.tintCache[stringColor]}canvas4=texture.tintCache[stringColor]}else{canvas4=document.createElement("canvas")}canvasUtils.tintMethod(texture,color,canvas4);canvas4.tintId=texture._updateID;if(canvasUtils.convertTintToImage){var tintImage=new Image;tintImage.src=canvas4.toDataURL();texture.tintCache[stringColor]=tintImage}else{texture.tintCache[stringColor]=canvas4}return canvas4},getTintedPattern:function getTintedPattern(texture,color){color=canvasUtils.roundColor(color);var stringColor="#"+("00000"+(color|0).toString(16)).substr(-6);texture.patternCache=texture.patternCache||{};var pattern=texture.patternCache[stringColor];if(pattern&&pattern.tintId===texture._updateID){return pattern}if(!canvasUtils.canvas){canvasUtils.canvas=document.createElement("canvas")}canvasUtils.tintMethod(texture,color,canvasUtils.canvas);pattern=canvasUtils.canvas.getContext("2d").createPattern(canvasUtils.canvas,"repeat");pattern.tintId=texture._updateID;texture.patternCache[stringColor]=pattern;return pattern},tintWithMultiply:function tintWithMultiply(texture,color,canvas4){var context2=canvas4.getContext("2d");var crop=texture._frame.clone();var resolution=texture.baseTexture.resolution;crop.x*=resolution;crop.y*=resolution;crop.width*=resolution;crop.height*=resolution;canvas4.width=Math.ceil(crop.width);canvas4.height=Math.ceil(crop.height);context2.save();context2.fillStyle="#"+("00000"+(color|0).toString(16)).substr(-6);context2.fillRect(0,0,crop.width,crop.height);context2.globalCompositeOperation="multiply";var source=texture.baseTexture.getDrawableSource();context2.drawImage(source,crop.x,crop.y,crop.width,crop.height,0,0,crop.width,crop.height);context2.globalCompositeOperation="destination-atop";context2.drawImage(source,crop.x,crop.y,crop.width,crop.height,0,0,crop.width,crop.height);context2.restore()},tintWithOverlay:function tintWithOverlay(texture,color,canvas4){var context2=canvas4.getContext("2d");var crop=texture._frame.clone();var resolution=texture.baseTexture.resolution;crop.x*=resolution;crop.y*=resolution;crop.width*=resolution;crop.height*=resolution;canvas4.width=Math.ceil(crop.width);canvas4.height=Math.ceil(crop.height);context2.save();context2.globalCompositeOperation="copy";context2.fillStyle="#"+("00000"+(color|0).toString(16)).substr(-6);context2.fillRect(0,0,crop.width,crop.height);context2.globalCompositeOperation="destination-atop";context2.drawImage(texture.baseTexture.getDrawableSource(),crop.x,crop.y,crop.width,crop.height,0,0,crop.width,crop.height);context2.restore()},tintWithPerPixel:function tintWithPerPixel(texture,color,canvas4){var context2=canvas4.getContext("2d");var crop=texture._frame.clone();var resolution=texture.baseTexture.resolution;crop.x*=resolution;crop.y*=resolution;crop.width*=resolution;crop.height*=resolution;canvas4.width=Math.ceil(crop.width);canvas4.height=Math.ceil(crop.height);context2.save();context2.globalCompositeOperation="copy";context2.drawImage(texture.baseTexture.getDrawableSource(),crop.x,crop.y,crop.width,crop.height,0,0,crop.width,crop.height);context2.restore();var rgbValues=_hex2rgb(color);var r=rgbValues[0];var g=rgbValues[1];var b=rgbValues[2];var pixelData=context2.getImageData(0,0,crop.width,crop.height);var pixels3=pixelData.data;for(var i=0;i<pixels3.length;i+=4){pixels3[i+0]*=r;pixels3[i+1]*=g;pixels3[i+2]*=b}context2.putImageData(pixelData,0,0)},roundColor:function roundColor(color){var step=canvasUtils.cacheStepsPerColorChannel;var rgbValues=_hex2rgb(color);rgbValues[0]=Math.min(255,rgbValues[0]/step*step);rgbValues[1]=Math.min(255,rgbValues[1]/step*step);rgbValues[2]=Math.min(255,rgbValues[2]/step*step);return _rgb2hex(rgbValues)},cacheStepsPerColorChannel:8,convertTintToImage:false,canUseMultiply:canUseNewCanvasBlendModes(),tintMethod:function tintMethod(){}};canvasUtils.tintMethod=canvasUtils.canUseMultiply?canvasUtils.tintWithMultiply:canvasUtils.tintWithPerPixel;var parentCreate=Renderer.create;Renderer.create=function create2(options){var forceCanvas=options&&options.forceCanvas;if(!forceCanvas){try{return parentCreate(options)}catch(err){}}return new CanvasRenderer(options)};BaseTexture.prototype.getDrawableSource=function getDrawableSource(){var resource=this.resource;return resource?resource.bitmap||resource.source:null};var CanvasMeshRenderer=function CanvasMeshRenderer2(renderer){this.renderer=renderer};CanvasMeshRenderer.prototype.render=function render3(mesh){var renderer=this.renderer;var transform=mesh.worldTransform;renderer.context.globalAlpha=mesh.worldAlpha;renderer.setBlendMode(mesh.blendMode);renderer.setContextTransform(transform,mesh.roundPixels);if(mesh.drawMode!==DRAW_MODES.TRIANGLES){this._renderTriangleMesh(mesh)}else{this._renderTriangles(mesh)}};CanvasMeshRenderer.prototype._renderTriangleMesh=function _renderTriangleMesh(mesh){var length=mesh.geometry.buffers[0].data.length;for(var i=0;i<length-2;i++){var index3=i*2;this._renderDrawTriangle(mesh,index3,index3+2,index3+4)}};CanvasMeshRenderer.prototype._renderTriangles=function _renderTriangles(mesh){var indices2=mesh.geometry.getIndex().data;var length=indices2.length;for(var i=0;i<length;i+=3){var index0=indices2[i]*2;var index1=indices2[i+1]*2;var index22=indices2[i+2]*2;this._renderDrawTriangle(mesh,index0,index1,index22)}};CanvasMeshRenderer.prototype._renderDrawTriangle=function _renderDrawTriangle(mesh,index0,index1,index22){var context2=this.renderer.context;var vertices=mesh.geometry.buffers[0].data;var uvs=mesh.uvs;var texture=mesh.texture;if(!texture.valid){return}var base=texture.baseTexture;var textureSource=base.getDrawableSource();var textureWidth=base.width;var textureHeight=base.height;var u0=uvs[index0]*base.width;var u1=uvs[index1]*base.width;var u2=uvs[index22]*base.width;var v0=uvs[index0+1]*base.height;var v1=uvs[index1+1]*base.height;var v2=uvs[index22+1]*base.height;var x0=vertices[index0];var x1=vertices[index1];var x2=vertices[index22];var y0=vertices[index0+1];var y1=vertices[index1+1];var y2=vertices[index22+1];var canvasPadding=mesh.canvasPadding/this.renderer.resolution;if(canvasPadding>0){var paddingX=canvasPadding/Math.abs(mesh.worldTransform.a);var paddingY=canvasPadding/Math.abs(mesh.worldTransform.d);var centerX=(x0+x1+x2)/3;var centerY=(y0+y1+y2)/3;var normX=x0-centerX;var normY=y0-centerY;var dist=Math.sqrt(normX*normX+normY*normY);x0=centerX+normX/dist*(dist+paddingX);y0=centerY+normY/dist*(dist+paddingY);normX=x1-centerX;normY=y1-centerY;dist=Math.sqrt(normX*normX+normY*normY);x1=centerX+normX/dist*(dist+paddingX);y1=centerY+normY/dist*(dist+paddingY);normX=x2-centerX;normY=y2-centerY;dist=Math.sqrt(normX*normX+normY*normY);x2=centerX+normX/dist*(dist+paddingX);y2=centerY+normY/dist*(dist+paddingY)}context2.save();context2.beginPath();context2.moveTo(x0,y0);context2.lineTo(x1,y1);context2.lineTo(x2,y2);context2.closePath();context2.clip();var delta=u0*v1+v0*u2+u1*v2-v1*u2-v0*u1-u0*v2;var deltaA=x0*v1+v0*x2+x1*v2-v1*x2-v0*x1-x0*v2;var deltaB=u0*x1+x0*u2+u1*x2-x1*u2-x0*u1-u0*x2;var deltaC=u0*v1*x2+v0*x1*u2+x0*u1*v2-x0*v1*u2-v0*u1*x2-u0*x1*v2;var deltaD=y0*v1+v0*y2+y1*v2-v1*y2-v0*y1-y0*v2;var deltaE=u0*y1+y0*u2+u1*y2-y1*u2-y0*u1-u0*y2;var deltaF=u0*v1*y2+v0*y1*u2+y0*u1*v2-y0*v1*u2-v0*u1*y2-u0*y1*v2;context2.transform(deltaA/delta,deltaD/delta,deltaB/delta,deltaE/delta,deltaC/delta,deltaF/delta);context2.drawImage(textureSource,0,0,textureWidth*base.resolution,textureHeight*base.resolution,0,0,textureWidth,textureHeight);context2.restore();this.renderer.invalidateBlendMode()};CanvasMeshRenderer.prototype.renderMeshFlat=function renderMeshFlat(mesh){var context2=this.renderer.context;var vertices=mesh.geometry.getBuffer("aVertexPosition").data;var length=vertices.length/2;context2.beginPath();for(var i=1;i<length-2;++i){var index3=i*2;var x0=vertices[index3];var y0=vertices[index3+1];var x1=vertices[index3+2];var y1=vertices[index3+3];var x2=vertices[index3+4];var y2=vertices[index3+5];context2.moveTo(x0,y0);context2.lineTo(x1,y1);context2.lineTo(x2,y2)}context2.fillStyle="#FF0000";context2.fill();context2.closePath()};CanvasMeshRenderer.prototype.destroy=function destroy21(){this.renderer=null};settings.MESH_CANVAS_PADDING=0;MeshMaterial.prototype._renderCanvas=function _renderCanvas(renderer,mesh){renderer.plugins.mesh.render(mesh)};NineSlicePlane.prototype._cachedTint=16777215;NineSlicePlane.prototype._tintedCanvas=null;NineSlicePlane.prototype._canvasUvs=null;NineSlicePlane.prototype._renderCanvas=function _renderCanvas2(renderer){var context2=renderer.context;var transform=this.worldTransform;var isTinted=this.tint!==16777215;var texture=this.texture;if(!texture.valid){return}if(isTinted){if(this._cachedTint!==this.tint){this._cachedTint=this.tint;this._tintedCanvas=canvasUtils.getTintedCanvas(this,this.tint)}}var textureSource=!isTinted?texture.baseTexture.getDrawableSource():this._tintedCanvas;if(!this._canvasUvs){this._canvasUvs=[0,0,0,0,0,0,0,0]}var vertices=this.vertices;var uvs=this._canvasUvs;var u0=isTinted?0:texture.frame.x;var v0=isTinted?0:texture.frame.y;var u1=u0+texture.frame.width;var v1=v0+texture.frame.height;uvs[0]=u0;uvs[1]=u0+this._leftWidth;uvs[2]=u1-this._rightWidth;uvs[3]=u1;uvs[4]=v0;uvs[5]=v0+this._topHeight;uvs[6]=v1-this._bottomHeight;uvs[7]=v1;for(var i=0;i<8;i++){uvs[i]*=texture.baseTexture.resolution}context2.globalAlpha=this.worldAlpha;renderer.setBlendMode(this.blendMode);renderer.setContextTransform(transform,this.roundPixels);for(var row=0;row<3;row++){for(var col=0;col<3;col++){var ind=col*2+row*8;var sw=Math.max(1,uvs[col+1]-uvs[col]);var sh=Math.max(1,uvs[row+5]-uvs[row+4]);var dw=Math.max(1,vertices[ind+10]-vertices[ind]);var dh=Math.max(1,vertices[ind+11]-vertices[ind+1]);context2.drawImage(textureSource,uvs[col],uvs[row+4],sw,sh,vertices[ind],vertices[ind+1],dw,dh)}}};Mesh.prototype._renderCanvas=function _renderCanvas3(renderer){if(this.shader.uvMatrix){this.shader.uvMatrix.update();this.calculateUvs()}this.material._renderCanvas(renderer,this)};Mesh.prototype._canvasPadding=null;Object.defineProperty(Mesh.prototype,"canvasPadding",{get:function get2(){return this._canvasPadding!==null?this._canvasPadding:settings.MESH_CANVAS_PADDING},set:function set3(value){this._canvasPadding=value}});SimpleMesh.prototype._renderCanvas=function _renderCanvas4(renderer){if(this.autoUpdate){this.geometry.getBuffer("aVertexPosition").update()}if(this.shader.update){this.shader.update()}this.calculateUvs();this.material._renderCanvas(renderer,this)};SimpleRope.prototype._renderCanvas=function _renderCanvas5(renderer){if(this.autoUpdate||this.geometry._width!==this.shader.texture.height){this.geometry._width=this.shader.texture.height;this.geometry.update()}if(this.shader.update){this.shader.update()}this.calculateUvs();this.material._renderCanvas(renderer,this)};var CanvasGraphicsRenderer=function CanvasGraphicsRenderer2(renderer){this.renderer=renderer;this._svgMatrix=null};CanvasGraphicsRenderer.prototype._calcCanvasStyle=function _calcCanvasStyle(style2,tint){var res;if(style2.texture&&style2.texture.baseTexture!==Texture.WHITE.baseTexture){if(style2.texture.valid){res=canvasUtils.getTintedPattern(style2.texture,tint);this.setPatternTransform(res,style2.matrix||Matrix.IDENTITY)}else{res="#808080"}}else{res="#"+("00000"+(tint|0).toString(16)).substr(-6)}return res};CanvasGraphicsRenderer.prototype.render=function render4(graphics){var renderer=this.renderer;var context2=renderer.context;var worldAlpha=graphics.worldAlpha;var transform=graphics.transform.worldTransform;renderer.setContextTransform(transform);if(graphics.canvasTintDirty!==graphics.geometry.dirty||graphics._prevTint!==graphics.tint){this.updateGraphicsTint(graphics)}renderer.setBlendMode(graphics.blendMode);var graphicsData=graphics.geometry.graphicsData;var contextFillStyle;var contextStrokeStyle;for(var i=0;i<graphicsData.length;i++){var data=graphicsData[i];var shape=data.shape;var fillStyle=data.fillStyle;var lineStyle=data.lineStyle;if(fillStyle.visible){contextFillStyle=this._calcCanvasStyle(fillStyle,data._fillTint)}if(lineStyle.visible){contextStrokeStyle=this._calcCanvasStyle(lineStyle,data._lineTint)}context2.lineWidth=lineStyle.width;if(data.type===SHAPES.POLY){context2.beginPath();var points=shape.points;var holes=data.holes;var outerArea=void 0;var innerArea=void 0;var px=void 0;var py=void 0;context2.moveTo(points[0],points[1]);for(var j=2;j<points.length;j+=2){context2.lineTo(points[j],points[j+1])}if(shape.closeStroke){context2.closePath()}if(holes.length>0){outerArea=0;px=points[0];py=points[1];for(var j$1=2;j$1+2<points.length;j$1+=2){outerArea+=(points[j$1]-px)*(points[j$1+3]-py)-(points[j$1+2]-px)*(points[j$1+1]-py)}for(var k=0;k<holes.length;k++){points=holes[k].shape.points;if(!points){continue}innerArea=0;px=points[0];py=points[1];for(var j$2=2;j$2+2<points.length;j$2+=2){innerArea+=(points[j$2]-px)*(points[j$2+3]-py)-(points[j$2+2]-px)*(points[j$2+1]-py)}if(innerArea*outerArea<0){context2.moveTo(points[0],points[1]);for(var j$3=2;j$3<points.length;j$3+=2){context2.lineTo(points[j$3],points[j$3+1])}}else{context2.moveTo(points[points.length-2],points[points.length-1]);for(var j$4=points.length-4;j$4>=0;j$4-=2){context2.lineTo(points[j$4],points[j$4+1])}}if(holes[k].shape.closeStroke){context2.closePath()}}}if(fillStyle.visible){context2.globalAlpha=fillStyle.alpha*worldAlpha;context2.fillStyle=contextFillStyle;context2.fill()}if(lineStyle.visible){context2.globalAlpha=lineStyle.alpha*worldAlpha;context2.strokeStyle=contextStrokeStyle;context2.stroke()}}else if(data.type===SHAPES.RECT){if(fillStyle.visible){context2.globalAlpha=fillStyle.alpha*worldAlpha;context2.fillStyle=contextFillStyle;context2.fillRect(shape.x,shape.y,shape.width,shape.height)}if(lineStyle.visible){context2.globalAlpha=lineStyle.alpha*worldAlpha;context2.strokeStyle=contextStrokeStyle;context2.strokeRect(shape.x,shape.y,shape.width,shape.height)}}else if(data.type===SHAPES.CIRC){context2.beginPath();context2.arc(shape.x,shape.y,shape.radius,0,2*Math.PI);context2.closePath();if(fillStyle.visible){context2.globalAlpha=fillStyle.alpha*worldAlpha;context2.fillStyle=contextFillStyle;context2.fill()}if(lineStyle.visible){context2.globalAlpha=lineStyle.alpha*worldAlpha;context2.strokeStyle=contextStrokeStyle;context2.stroke()}}else if(data.type===SHAPES.ELIP){var w=shape.width*2;var h=shape.height*2;var x=shape.x-w/2;var y=shape.y-h/2;context2.beginPath();var kappa=0.5522848;var ox=w/2*kappa;var oy=h/2*kappa;var xe=x+w;var ye=y+h;var xm=x+w/2;var ym=y+h/2;context2.moveTo(x,ym);context2.bezierCurveTo(x,ym-oy,xm-ox,y,xm,y);context2.bezierCurveTo(xm+ox,y,xe,ym-oy,xe,ym);context2.bezierCurveTo(xe,ym+oy,xm+ox,ye,xm,ye);context2.bezierCurveTo(xm-ox,ye,x,ym+oy,x,ym);context2.closePath();if(fillStyle.visible){context2.globalAlpha=fillStyle.alpha*worldAlpha;context2.fillStyle=contextFillStyle;context2.fill()}if(lineStyle.visible){context2.globalAlpha=lineStyle.alpha*worldAlpha;context2.strokeStyle=contextStrokeStyle;context2.stroke()}}else if(data.type===SHAPES.RREC){var rx=shape.x;var ry=shape.y;var width=shape.width;var height=shape.height;var radius=shape.radius;var maxRadius=Math.min(width,height)/2|0;radius=radius>maxRadius?maxRadius:radius;context2.beginPath();context2.moveTo(rx,ry+radius);context2.lineTo(rx,ry+height-radius);context2.quadraticCurveTo(rx,ry+height,rx+radius,ry+height);context2.lineTo(rx+width-radius,ry+height);context2.quadraticCurveTo(rx+width,ry+height,rx+width,ry+height-radius);context2.lineTo(rx+width,ry+radius);context2.quadraticCurveTo(rx+width,ry,rx+width-radius,ry);context2.lineTo(rx+radius,ry);context2.quadraticCurveTo(rx,ry,rx,ry+radius);context2.closePath();if(fillStyle.visible){context2.globalAlpha=fillStyle.alpha*worldAlpha;context2.fillStyle=contextFillStyle;context2.fill()}if(lineStyle.visible){context2.globalAlpha=lineStyle.alpha*worldAlpha;context2.strokeStyle=contextStrokeStyle;context2.stroke()}}}};CanvasGraphicsRenderer.prototype.updateGraphicsTint=function updateGraphicsTint(graphics){graphics._prevTint=graphics.tint;graphics.canvasTintDirty=graphics.geometry.dirty;var tintR=(graphics.tint>>16&255)/255;var tintG=(graphics.tint>>8&255)/255;var tintB=(graphics.tint&255)/255;var graphicsData=graphics.geometry.graphicsData;for(var i=0;i<graphicsData.length;++i){var data=graphicsData[i];var fillColor=data.fillStyle.color|0;var lineColor=data.lineStyle.color|0;data._fillTint=((fillColor>>16&255)/255*tintR*255<<16)+((fillColor>>8&255)/255*tintG*255<<8)+(fillColor&255)/255*tintB*255;data._lineTint=((lineColor>>16&255)/255*tintR*255<<16)+((lineColor>>8&255)/255*tintG*255<<8)+(lineColor&255)/255*tintB*255}};CanvasGraphicsRenderer.prototype.setPatternTransform=function setPatternTransform(pattern,matrix){if(this._svgMatrix===false){return}if(!this._svgMatrix){var svg=document.createElementNS("http://www.w3.org/2000/svg","svg");if(svg&&svg.createSVGMatrix){this._svgMatrix=svg.createSVGMatrix()}if(!this._svgMatrix||!pattern.setTransform){this._svgMatrix=false;return}}this._svgMatrix.a=matrix.a;this._svgMatrix.b=matrix.b;this._svgMatrix.c=matrix.c;this._svgMatrix.d=matrix.d;this._svgMatrix.e=matrix.tx;this._svgMatrix.f=matrix.ty;pattern.setTransform(this._svgMatrix.inverse())};CanvasGraphicsRenderer.prototype.destroy=function destroy22(){this.renderer=null};var canvasRenderer;var tempMatrix3=new Matrix;Graphics.prototype.generateCanvasTexture=function generateCanvasTexture(scaleMode,resolution){if(resolution===void 0)resolution=1;var bounds=this.getLocalBounds();var canvasBuffer=RenderTexture.create(bounds.width,bounds.height,scaleMode,resolution);if(!canvasRenderer){canvasRenderer=new CanvasRenderer}this.transform.updateLocalTransform();this.transform.localTransform.copyTo(tempMatrix3);tempMatrix3.invert();tempMatrix3.tx-=bounds.x;tempMatrix3.ty-=bounds.y;canvasRenderer.render(this,canvasBuffer,true,tempMatrix3);var texture=Texture.from(canvasBuffer.baseTexture._canvasRenderTarget.canvas,{scaleMode:scaleMode});texture.baseTexture.resolution=resolution;texture.baseTexture.update();return texture};Graphics.prototype.cachedGraphicsData=[];Graphics.prototype._renderCanvas=function _renderCanvas6(renderer){if(this.isMask===true){return}this.finishPoly();renderer.plugins.graphics.render(this)};var canvasRenderWorldTransform=new Matrix;var CanvasSpriteRenderer=function CanvasSpriteRenderer2(renderer){this.renderer=renderer};CanvasSpriteRenderer.prototype.render=function render5(sprite){var texture=sprite._texture;var renderer=this.renderer;var context2=renderer.context;var width=texture._frame.width;var height=texture._frame.height;var wt=sprite.transform.worldTransform;var dx=0;var dy=0;var source=texture.baseTexture.getDrawableSource();if(texture.orig.width<=0||texture.orig.height<=0||!texture.valid||!source){return}if(!texture.valid){return}renderer.setBlendMode(sprite.blendMode,true);renderer.context.globalAlpha=sprite.worldAlpha;var smoothingEnabled=texture.baseTexture.scaleMode===SCALE_MODES.LINEAR;if(renderer.smoothProperty&&renderer.context[renderer.smoothProperty]!==smoothingEnabled){context2[renderer.smoothProperty]=smoothingEnabled}if(texture.trim){dx=texture.trim.width/2+texture.trim.x-sprite.anchor.x*texture.orig.width;dy=texture.trim.height/2+texture.trim.y-sprite.anchor.y*texture.orig.height}else{dx=(0.5-sprite.anchor.x)*texture.orig.width;dy=(0.5-sprite.anchor.y)*texture.orig.height}if(texture.rotate){wt.copyTo(canvasRenderWorldTransform);wt=canvasRenderWorldTransform;groupD8.matrixAppendRotationInv(wt,texture.rotate,dx,dy);dx=0;dy=0}dx-=width/2;dy-=height/2;renderer.setContextTransform(wt,sprite.roundPixels,1);if(sprite.roundPixels){dx=dx|0;dy=dy|0}var resolution=texture.baseTexture.resolution;var outerBlend=renderer._outerBlend;if(outerBlend){context2.save();context2.beginPath();context2.rect(dx*renderer.resolution,dy*renderer.resolution,width*renderer.resolution,height*renderer.resolution);context2.clip()}if(sprite.tint!==16777215){if(sprite._cachedTint!==sprite.tint||sprite._tintedCanvas.tintId!==sprite._texture._updateID){sprite._cachedTint=sprite.tint;sprite._tintedCanvas=canvasUtils.getTintedCanvas(sprite,sprite.tint)}context2.drawImage(sprite._tintedCanvas,0,0,Math.floor(width*resolution),Math.floor(height*resolution),Math.floor(dx*renderer.resolution),Math.floor(dy*renderer.resolution),Math.floor(width*renderer.resolution),Math.floor(height*renderer.resolution))}else{context2.drawImage(source,texture._frame.x*resolution,texture._frame.y*resolution,Math.floor(width*resolution),Math.floor(height*resolution),Math.floor(dx*renderer.resolution),Math.floor(dy*renderer.resolution),Math.floor(width*renderer.resolution),Math.floor(height*renderer.resolution))}if(outerBlend){context2.restore()}renderer.setBlendMode(BLEND_MODES.NORMAL)};CanvasSpriteRenderer.prototype.destroy=function destroy23(){this.renderer=null};Sprite.prototype._tintedCanvas=null;Sprite.prototype._renderCanvas=function _renderCanvas7(renderer){renderer.plugins.sprite.render(this)};var TEMP_RECT2=new Rectangle;var CanvasExtract=function CanvasExtract2(renderer){this.renderer=renderer;renderer.extract=this};CanvasExtract.prototype.image=function image2(target,format,quality){var image3=new Image;image3.src=this.base64(target,format,quality);return image3};CanvasExtract.prototype.base64=function base642(target,format,quality){return this.canvas(target).toDataURL(format,quality)};CanvasExtract.prototype.canvas=function canvas3(target){var renderer=this.renderer;var context2;var resolution;var frame;var renderTexture;if(target){if(target instanceof RenderTexture){renderTexture=target}else{renderTexture=renderer.generateTexture(target)}}if(renderTexture){context2=renderTexture.baseTexture._canvasRenderTarget.context;resolution=renderTexture.baseTexture._canvasRenderTarget.resolution;frame=renderTexture.frame}else{context2=renderer.rootContext;resolution=renderer.resolution;frame=TEMP_RECT2;frame.width=this.renderer.width;frame.height=this.renderer.height}var width=Math.floor(frame.width*resolution+1e-4);var height=Math.floor(frame.height*resolution+1e-4);var canvasBuffer=new _CanvasRenderTarget(width,height,1);var canvasData=context2.getImageData(frame.x*resolution,frame.y*resolution,width,height);canvasBuffer.context.putImageData(canvasData,0,0);return canvasBuffer.canvas};CanvasExtract.prototype.pixels=function pixels2(target){var renderer=this.renderer;var context2;var resolution;var frame;var renderTexture;if(target){if(target instanceof RenderTexture){renderTexture=target}else{renderTexture=renderer.generateTexture(target)}}if(renderTexture){context2=renderTexture.baseTexture._canvasRenderTarget.context;resolution=renderTexture.baseTexture._canvasRenderTarget.resolution;frame=renderTexture.frame}else{context2=renderer.rootContext;frame=TEMP_RECT2;frame.width=renderer.width;frame.height=renderer.height}return context2.getImageData(0,0,frame.width*resolution,frame.height*resolution).data};CanvasExtract.prototype.destroy=function destroy24(){this.renderer.extract=null;this.renderer=null};var CANVAS_START_SIZE=16;var CanvasPrepare=function(BasePrepare3){function CanvasPrepare2(renderer){BasePrepare3.call(this,renderer);this.uploadHookHelper=this;this.canvas=document.createElement("canvas");this.canvas.width=CANVAS_START_SIZE;this.canvas.height=CANVAS_START_SIZE;this.ctx=this.canvas.getContext("2d");this.registerUploadHook(uploadBaseTextures2)}if(BasePrepare3)CanvasPrepare2.__proto__=BasePrepare3;CanvasPrepare2.prototype=Object.create(BasePrepare3&&BasePrepare3.prototype);CanvasPrepare2.prototype.constructor=CanvasPrepare2;CanvasPrepare2.prototype.destroy=function destroy25(){BasePrepare3.prototype.destroy.call(this);this.ctx=null;this.canvas=null};return CanvasPrepare2}(BasePrepare);function uploadBaseTextures2(prepare,item){if(item instanceof BaseTexture){var image3=item.source;var imageWidth=image3.width===0?prepare.canvas.width:Math.min(prepare.canvas.width,image3.width);var imageHeight=image3.height===0?prepare.canvas.height:Math.min(prepare.canvas.height,image3.height);prepare.ctx.drawImage(image3,0,0,imageWidth,imageHeight,0,0,prepare.canvas.width,prepare.canvas.height);return true}return false}TilingSprite.prototype._renderCanvas=function _renderCanvas8(renderer){var texture=this._texture;if(!texture.baseTexture.valid){return}var context2=renderer.context;var transform=this.worldTransform;var baseTexture=texture.baseTexture;var source=baseTexture.getDrawableSource();var baseTextureResolution=baseTexture.resolution;var modX=this.tilePosition.x/this.tileScale.x%texture._frame.width*baseTextureResolution;var modY=this.tilePosition.y/this.tileScale.y%texture._frame.height*baseTextureResolution;if(this._textureID!==this._texture._updateID||this._cachedTint!==this.tint){this._textureID=this._texture._updateID;var tempCanvas=new _CanvasRenderTarget(texture._frame.width,texture._frame.height,baseTextureResolution);if(this.tint!==16777215){this._tintedCanvas=canvasUtils.getTintedCanvas(this,this.tint);tempCanvas.context.drawImage(this._tintedCanvas,0,0)}else{tempCanvas.context.drawImage(source,-texture._frame.x*baseTextureResolution,-texture._frame.y*baseTextureResolution)}this._cachedTint=this.tint;this._canvasPattern=tempCanvas.context.createPattern(tempCanvas.canvas,"repeat")}context2.globalAlpha=this.worldAlpha;renderer.setBlendMode(this.blendMode);renderer.setContextTransform(transform);context2.fillStyle=this._canvasPattern;context2.scale(this.tileScale.x/baseTextureResolution,this.tileScale.y/baseTextureResolution);var anchorX=this.anchor.x*-this._width;var anchorY=this.anchor.y*-this._height;if(this.uvRespectAnchor){context2.translate(modX,modY);context2.fillRect(-modX+anchorX,-modY+anchorY,this._width/this.tileScale.x*baseTextureResolution,this._height/this.tileScale.y*baseTextureResolution)}else{context2.translate(modX+anchorX,modY+anchorY);context2.fillRect(-modX,-modY,this._width/this.tileScale.x*baseTextureResolution,this._height/this.tileScale.y*baseTextureResolution)}};ParticleContainer.prototype.renderCanvas=function renderCanvas(renderer){if(!this.visible||this.worldAlpha<=0||!this.children.length||!this.renderable){return}var context2=renderer.context;var transform=this.worldTransform;var isRotated=true;var positionX=0;var positionY=0;var finalWidth=0;var finalHeight=0;renderer.setBlendMode(this.blendMode);context2.globalAlpha=this.worldAlpha;this.displayObjectUpdateTransform();for(var i=0;i<this.children.length;++i){var child=this.children[i];if(!child.visible){continue}if(!child._texture.valid){continue}var frame=child._texture.frame;context2.globalAlpha=this.worldAlpha*child.alpha;if(child.rotation%(Math.PI*2)===0){if(isRotated){renderer.setContextTransform(transform,false,1);isRotated=false}positionX=child.anchor.x*(-frame.width*child.scale.x)+child.position.x+0.5;positionY=child.anchor.y*(-frame.height*child.scale.y)+child.position.y+0.5;finalWidth=frame.width*child.scale.x;finalHeight=frame.height*child.scale.y}else{if(!isRotated){isRotated=true}child.displayObjectUpdateTransform();var childTransform=child.worldTransform;renderer.setContextTransform(childTransform,this.roundPixels,1);positionX=child.anchor.x*-frame.width+0.5;positionY=child.anchor.y*-frame.height+0.5;finalWidth=frame.width;finalHeight=frame.height}var resolution=child._texture.baseTexture.resolution;context2.drawImage(child._texture.baseTexture.getDrawableSource(),frame.x*resolution,frame.y*resolution,frame.width*resolution,frame.height*resolution,positionX*renderer.resolution,positionY*renderer.resolution,finalWidth*renderer.resolution,finalHeight*renderer.resolution)}};Container.prototype._renderCanvas=function _renderCanvas9(renderer){};Container.prototype.renderCanvas=function renderCanvas2(renderer){if(!this.visible||this.worldAlpha<=0||!this.renderable){return}if(this._mask){renderer.maskManager.pushMask(this._mask)}this._renderCanvas(renderer);for(var i=0,j=this.children.length;i<j;++i){this.children[i].renderCanvas(renderer)}if(this._mask){renderer.maskManager.popMask(renderer)}};DisplayObject.prototype.renderCanvas=function renderCanvas3(renderer){};Text.prototype._renderCanvas=function _renderCanvas10(renderer){if(this._autoResolution&&this._resolution!==renderer.resolution){this._resolution=renderer.resolution;this.dirty=true}this.updateText(true);Sprite.prototype._renderCanvas.call(this,renderer)};CanvasRenderer.registerPlugin("accessibility",accessibility_es_exports.AccessibilityManager);CanvasRenderer.registerPlugin("extract",CanvasExtract);CanvasRenderer.registerPlugin("graphics",CanvasGraphicsRenderer);CanvasRenderer.registerPlugin("interaction",interaction_es_exports.InteractionManager);CanvasRenderer.registerPlugin("mesh",CanvasMeshRenderer);CanvasRenderer.registerPlugin("prepare",CanvasPrepare);CanvasRenderer.registerPlugin("sprite",CanvasSpriteRenderer);var import_pixi_tweener2=__toModule(require_pixi_tweener());var Sprites=function(){function Sprites(assets){_classCallCheck2(this,Sprites);this._loader=new Loader2;this.assets=assets;for(var key in this.assets){if(this.assets[key].url){this._loader.add(key,this.assets[key].url)}}}_createClass3(Sprites,[{key:"load",value:function load(callback){var _this4=this;this._loader.load(function(loader,resources){for(var key in _this4.assets){var item=_this4.assets[key];var texture=item.url?resources[key].texture:item.texture;if(item.isChild){_this4[key]=_objectSpread(_objectSpread({},item),{},{texture:texture})}else{_this4[key]=new Sprite(texture);_this4[key].x=item.x;_this4[key].y=item.y;if(item.w&&item.h){_this4[key].width=item.w;_this4[key].height=item.h}if(item.click){_this4[key].interactive=true;_this4[key].buttonMode=true;typeof item.click==="function"&&_this4[key].on("click",item.click)}if(typeof item.visible!=="undefined"){_this4[key].visible=item.visible}}}callback()})}}]);return Sprites}();var sprites_default=Sprites;var import_pixi_tweener=__toModule(require_pixi_tweener());var NORMAL_WIDTH=1600;var WIDTH=window.innerWidth;var HEIGHT=window.innerHeight;var WIDTH_RATIO=WIDTH/NORMAL_WIDTH;var LAND_HEIGHT=95*WIDTH_RATIO*1.5;var SPACE_HEIGHT=HEIGHT-LAND_HEIGHT;var ASSETS_MAP={"sky":{x:0,y:0,texture:createGradTexture(WIDTH,SPACE_HEIGHT,"rgba(255, 255, 255, 0.0)","rgba(87, 155, 255, 0.9)")},"cloud1":{w:101*WIDTH_RATIO,h:54*WIDTH_RATIO,x:0,y:HEIGHT/2,url:"https://p0.qhimg.com/t01f7eb9835124077da.png"},"cloud2":{w:243*WIDTH_RATIO,h:171*WIDTH_RATIO,x:WIDTH/15,y:HEIGHT/3,url:"https://p0.qhimg.com/t0136ed6f06747549c7.png"},"cloud3":{w:101*WIDTH_RATIO,h:54*WIDTH_RATIO,x:WIDTH/4,y:HEIGHT/3,url:"https://p0.qhimg.com/t01f7eb9835124077da.png"},"cloud4":{w:243*WIDTH_RATIO,h:171*WIDTH_RATIO,x:WIDTH/2.2,y:HEIGHT/4,url:"https://p0.qhimg.com/t0136ed6f06747549c7.png"},"cloud5":{w:101*WIDTH_RATIO,h:54*WIDTH_RATIO,x:WIDTH/1.6,y:HEIGHT/3.5,url:"https://p0.qhimg.com/t01f7eb9835124077da.png"},"cloud6":{w:101*WIDTH_RATIO,h:54*WIDTH_RATIO,x:WIDTH/1.3,y:HEIGHT/2,url:"https://p0.qhimg.com/t01f7eb9835124077da.png"},"cloud7":{w:243*WIDTH_RATIO,h:171*WIDTH_RATIO,x:WIDTH/1.2,y:HEIGHT/2.5,url:"https://p0.qhimg.com/t0136ed6f06747549c7.png"},"airship":{w:250*WIDTH_RATIO,h:88*WIDTH_RATIO,x:WIDTH/1.5,y:SPACE_HEIGHT-500*WIDTH_RATIO,url:"https://p0.qhimg.com/t01ea2524e0ed4c2bba.png"},"land":{w:95*WIDTH_RATIO,h:95*WIDTH_RATIO,isChild:true,url:"https://p0.qhimg.com/t0161110df8acc0eb81.png"},"grass1":{w:355*WIDTH_RATIO,h:95*WIDTH_RATIO,x:-(WIDTH/10),y:SPACE_HEIGHT-95*WIDTH_RATIO,url:"https://p0.qhimg.com/t0187f205ad810f68d1.png"},"grass2":{w:355*WIDTH_RATIO,h:95*WIDTH_RATIO,x:WIDTH/10,y:SPACE_HEIGHT-95*WIDTH_RATIO,url:"https://p0.qhimg.com/t0187f205ad810f68d1.png"},"grass3":{w:355*WIDTH_RATIO,h:95*WIDTH_RATIO,x:WIDTH/2,y:SPACE_HEIGHT-95*WIDTH_RATIO,url:"https://p0.qhimg.com/t0187f205ad810f68d1.png"},"grass4":{w:355*WIDTH_RATIO,h:95*WIDTH_RATIO,x:WIDTH/1.3,y:SPACE_HEIGHT-95*WIDTH_RATIO,url:"https://p0.qhimg.com/t0187f205ad810f68d1.png"},"stone":{w:253*WIDTH_RATIO,h:91*WIDTH_RATIO,x:WIDTH/3.5,y:SPACE_HEIGHT-91*WIDTH_RATIO,url:"https://p0.qhimg.com/t01692505902f6f32f3.png"},"redBrick":{isChild:true,url:"https://p0.qhimg.com/t010ebcb061d16e0459.png"},"yellowBrick":{isChild:true,url:"https://p0.qhimg.com/t0100352fa2b71ca6e3.png"},"questionBrick":{isChild:true,url:"https://p0.qhimg.com/t01c7dfe5eb65552256.png"},"cat1":{isChild:true,url:"https://p0.qhimg.com/t0188b156417b266967.png"},"cat2":{isChild:true,url:"https://p0.qhimg.com/t019cc98f1c2a8807c0.png"},"cat3":{isChild:true,url:"https://p0.qhimg.com/t011a73ab8168e74444.png"},"coin1":{w:69*WIDTH_RATIO,h:87*WIDTH_RATIO,x:WIDTH/4+108*WIDTH_RATIO,y:SPACE_HEIGHT-370*WIDTH_RATIO,url:"https://p0.qhimg.com/t01e2ab3579b284d20e.png"},"coin2":{w:69*WIDTH_RATIO,h:87*WIDTH_RATIO,x:WIDTH/1.5+15*WIDTH_RATIO,y:SPACE_HEIGHT-396*WIDTH_RATIO,url:"https://p0.qhimg.com/t01e2ab3579b284d20e.png"},"redPacket":{isChild:true,url:"https://p0.qhimg.com/t014417601df1b1ccfa.png"},"lipstick":{w:56*WIDTH_RATIO,h:87*WIDTH_RATIO,x:WIDTH/2.6+108*WIDTH_RATIO,y:SPACE_HEIGHT-570*WIDTH_RATIO,url:"https://p0.qhimg.com/t015264934bfd8f014d.png"},"pack":{w:150*WIDTH_RATIO,h:155*WIDTH_RATIO,x:WIDTH/1.5,y:SPACE_HEIGHT-155*WIDTH_RATIO,url:"https://p0.qhimg.com/t01a1bf274bfa97d317.png"},"close":{w:26*WIDTH_RATIO,h:26*WIDTH_RATIO,x:WIDTH/1.5+252*WIDTH_RATIO,y:SPACE_HEIGHT-530*WIDTH_RATIO,visible:true,click:true,url:"https://p2.ssl.qhimg.com/t014276f41d6ab23bab.png"},"closeHover":{w:26*WIDTH_RATIO,h:26*WIDTH_RATIO,x:WIDTH/1.5+252*WIDTH_RATIO,y:SPACE_HEIGHT-530*WIDTH_RATIO,visible:false,click:true,url:"https://p2.ssl.qhimg.com/t0169342df2de4f1aa1.png"}};function createGradTexture(w,h,startColor,endColor){var canvas4=document.createElement("canvas");canvas4.width=w;canvas4.height=h;var ctx=canvas4.getContext("2d");var grd=ctx.createLinearGradient(0,0,0,h);grd.addColorStop(0,startColor);grd.addColorStop(1,endColor);ctx.fillStyle=grd;ctx.fillRect(0,0,w,h);return Texture.from(canvas4)}var View=function(){function View(stage,sprites,marioCat){_classCallCheck2(this,View);this.stage=stage;this.sprites=sprites;this.marioCat=marioCat;this.stage.sortableChildren=true}_createClass3(View,[{key:"renderSky",value:function renderSky(){var sky=this.sprites.sky;this.stage.addChild(sky)}},{key:"renderCloud",value:function renderCloud(){var _this$sprites=this.sprites,cloud1=_this$sprites.cloud1,cloud2=_this$sprites.cloud2,cloud3=_this$sprites.cloud3,cloud4=_this$sprites.cloud4,cloud5=_this$sprites.cloud5,cloud6=_this$sprites.cloud6,cloud7=_this$sprites.cloud7;this.stage.addChild(cloud1);this.stage.addChild(cloud2);this.stage.addChild(cloud3);this.stage.addChild(cloud4);this.stage.addChild(cloud5);this.stage.addChild(cloud6);this.stage.addChild(cloud7)}},{key:"renderAirship",value:function renderAirship(){var airship=this.sprites.airship;this.stage.addChild(airship);var flag=true;function loop(){import_pixi_tweener.Tweener.add({target:airship,duration:2,ease:import_pixi_tweener.Easing.easeInOutCubic},{x:flag?WIDTH/1.54:WIDTH/1.46}).then(function(){flag=!flag;loop()})}loop()}},{key:"renderLand",value:function renderLand(){var _this$sprites$land=this.sprites.land,texture=_this$sprites$land.texture,w=_this$sprites$land.w,h=_this$sprites$land.h;var container=new Container;var landItemWidth=w;var landItemHeight=h;var row=0;var containerWidth=0;while(containerWidth<WIDTH&&row<2){var land=new Sprite(texture);land.x=containerWidth;land.y=row*landItemHeight;land.width=w;land.height=h;container.addChild(land);containerWidth+=landItemWidth;if(containerWidth>=WIDTH){row++;containerWidth=0}}container.x=0;container.y=SPACE_HEIGHT;this.stage.addChild(container)}},{key:"renderGrassAndStone",value:function renderGrassAndStone(){var _this$sprites2=this.sprites,grass1=_this$sprites2.grass1,grass2=_this$sprites2.grass2,grass3=_this$sprites2.grass3,grass4=_this$sprites2.grass4,stone=_this$sprites2.stone;this.stage.addChild(grass1);this.stage.addChild(grass2);this.stage.addChild(grass3);this.stage.addChild(grass4);this.stage.addChild(stone)}},{key:"renderOrnament",value:function renderOrnament(){var _this$sprites3=this.sprites,lipstick=_this$sprites3.lipstick,coin1=_this$sprites3.coin1,coin2=_this$sprites3.coin2,pack=_this$sprites3.pack;this.stage.addChild(lipstick);this.stage.addChild(coin1);this.stage.addChild(coin2);this.stage.addChild(pack)}},{key:"renderBrick",value:function renderBrick(){var sprites=this.sprites;var container1=new Container;container1.x=WIDTH/4;container1.y=SPACE_HEIGHT-275*WIDTH_RATIO;container1.zIndex=2;this.stage.addChild(render6([0,1,0,2,0],container1));var container2=new Container;container2.x=WIDTH/2.6;container2.y=SPACE_HEIGHT-475*WIDTH_RATIO;this.stage.addChild(render6([2,0],container2));var container3=new Container;container3.x=WIDTH/1.5;container3.y=SPACE_HEIGHT-300*WIDTH_RATIO;this.stage.addChild(render6([0,1,0],container3));function render6(orderList,container){var textureList=[{key:"redBrick",width:97*WIDTH_RATIO,height:87*WIDTH_RATIO},{key:"yellowBrick",width:90*WIDTH_RATIO,height:87*WIDTH_RATIO},{key:"questionBrick",width:90*WIDTH_RATIO,height:87*WIDTH_RATIO}];var dynamic={"0":0};for(var i=0;i<orderList.length;i++){var textureItem=textureList[orderList[i]];var texture=sprites[textureItem.key].texture;var brick=new Sprite(texture);brick.x=dynamic[i];brick.width=textureItem.width;brick.height=textureItem.height;dynamic[i+1]=dynamic[i]+textureItem.width;container.addChild(brick)}return container}}},{key:"renderCat",value:function renderCat(){var marioCat=this.marioCat;var _this$sprites4=this.sprites,cat1=_this$sprites4.cat1,cat2=_this$sprites4.cat2,cat3=_this$sprites4.cat3,redPacket=_this$sprites4.redPacket;var stage=this.stage;var step=WIDTH/80;var stopPosition=WIDTH/4+250*WIDTH_RATIO;var animatedSprite=new AnimatedSprite([cat1.texture,cat2.texture]);animatedSprite.x=0;animatedSprite.y=SPACE_HEIGHT-162*WIDTH_RATIO;animatedSprite.width=150*WIDTH_RATIO;animatedSprite.height=162*WIDTH_RATIO;animatedSprite.animationSpeed=0.32;animatedSprite.play();animatedSprite.onFrameChange=function(){if(animatedSprite.x<WIDTH){animatedSprite.x+=step}if(!animatedJumpSprite.ended&&animatedSprite.x>stopPosition){animatedSprite.visible=false;animatedSprite.stop();animatedJumpSprite.visible=true;animatedJumpSprite.play()}};stage.addChild(animatedSprite);var animatedJumpSprite=new AnimatedSprite([cat2.texture,cat3.texture]);animatedJumpSprite.x=stopPosition;animatedJumpSprite.y=SPACE_HEIGHT-162*WIDTH_RATIO;animatedJumpSprite.width=150*WIDTH_RATIO;animatedJumpSprite.height=162*WIDTH_RATIO;animatedJumpSprite.animationSpeed=0.05;animatedJumpSprite.visible=false;animatedJumpSprite.jumpTotal=0;animatedJumpSprite.onFrameChange=function(){if(animatedJumpSprite.jumpTotal>=3){animatedSprite.visible=true;animatedSprite.play();animatedJumpSprite.visible=false;animatedJumpSprite.stop();animatedJumpSprite.ended=true}if(animatedJumpSprite.currentFrame===0){animatedJumpSprite.y=SPACE_HEIGHT-162*WIDTH_RATIO}if(animatedJumpSprite.currentFrame===1){animatedJumpSprite.jumpTotal++;animatedJumpSprite.y=SPACE_HEIGHT-(162+24)*WIDTH_RATIO;var redPacketSprite=new Sprite(redPacket.texture);redPacketSprite.x=WIDTH/4+300*WIDTH_RATIO;redPacketSprite.y=SPACE_HEIGHT-273*WIDTH_RATIO;redPacketSprite.width=500*WIDTH_RATIO;redPacketSprite.height=681*WIDTH_RATIO;redPacketSprite.scale.set(0.12*WIDTH_RATIO,0.12*WIDTH_RATIO);redPacketSprite.zIndex=1;stage.addChild(redPacketSprite);import_pixi_tweener.Tweener.add({target:redPacketSprite,duration:0.5,ease:import_pixi_tweener.Easing.easeInOutCubic},{y:SPACE_HEIGHT-366*WIDTH_RATIO}).then(function(){if(animatedJumpSprite.jumpTotal===3){import_pixi_tweener.Tweener.add({target:redPacketSprite,duration:1,ease:import_pixi_tweener.Easing.easeInOutCubic},{x:(WIDTH-300*WIDTH_RATIO)/2,y:(HEIGHT-408*WIDTH_RATIO)/2,width:300*WIDTH_RATIO,height:408*WIDTH_RATIO}).then(function(){marioCat.onComplete&&marioCat.onComplete(marioCat)});redPacketSprite.zIndex=3;redPacketSprite.interactive=true;redPacketSprite.buttonMode=true;redPacketSprite.on("click",function(){marioCat.onClick&&marioCat.onClick(marioCat)})}else{redPacketSprite.visible=false}})}};stage.addChild(animatedJumpSprite)}},{key:"renderClose",value:function renderClose(){var marioCat=this.marioCat;var _this$sprites5=this.sprites,close=_this$sprites5.close,closeHover=_this$sprites5.closeHover;var closeHandle=function closeHandle(){marioCat.onClose&&marioCat.onClose(marioCat)};close.on("click",closeHandle);close.on("mouseover",function(){close.visible=false;closeHover.visible=true});closeHover.on("click",closeHandle);closeHover.on("mouseout",function(){close.visible=true;closeHover.visible=false});this.stage.addChild(close);this.stage.addChild(closeHover)}}]);return View}();var view_default=View;utils_es_exports.skipHello();var MarioCat=function(){function MarioCat(options){_classCallCheck2(this,MarioCat);this.options=options;this.init()}_createClass3(MarioCat,[{key:"init",value:function init(){var _this5=this;var app=new Application(this.options);var view2=app.view,stage=app.stage,ticker=app.ticker;this.app=app;this.canvas=view2;this.loadAssets(ASSETS_MAP,function(sprites){import_pixi_tweener2.Tweener.init(ticker);_this5.render(stage,sprites);_this5.onShow&&_this5.onShow(_this5)})}},{key:"loadAssets",value:function loadAssets(assets,callback){var sprites=new sprites_default(assets);sprites.load(function(){callback(sprites)})}},{key:"render",value:function render(stage,sprites){var view2=new view_default(stage,sprites,this);view2.renderSky();view2.renderCloud();view2.renderAirship();view2.renderLand();view2.renderGrassAndStone();view2.renderOrnament();view2.renderBrick();view2.renderCat();view2.renderClose()}},{key:"mount",value:function mount(node){node.appendChild(this.canvas)}},{key:"destroy",value:function destroy(){this.app.destroy(true);this.app=null}}]);return MarioCat}();var main_default=MarioCat;var festival360eeClosed=window.festival360ee&&window.festival360ee.isClosed();if(!festival360eeClosed){main(window.marioScreenConfig)}function hitTest(startTime,endTime,isOn){var startTime=new Date(startTime);var endTime=new Date(endTime);var date=hao360.queryUrl(location.href,"previewTime")||new Date;return startTime<=new Date(date)&&endTime>=new Date(date)&&isOn}function showCanvas(options){var WIDTH2=window.innerWidth;var HEIGHT2=window.innerHeight;var $container=W("#festival-mario-screen");var $href=W("<a href=\""+options.url+"\" target=\"_blank\"></a>");$container.appendChild($href);var marioCat=new main_default({width:WIDTH2,height:HEIGHT2,transparent:true,backgroundAlpha:0});$container.show();marioCat.onShow=options.onShow;marioCat.onClick=options.onClick;marioCat.onClose=options.onClose;marioCat.onComplete=options.onComplete;$href.on("click",function(e){if(marioCat.closed){e.preventDefault()}});marioCat.mount($href[0]);window.moniter&&moniter.setId(["festival-mario-screen"])}function main(config){if(!config){return}var closed=qboot.cookie.get(config.closeCookie);if(!closed&&hitTest(config.startTime,config.endTime,config.isOn)){var fireEventNameList=["openscreen:close","openscreen:hitclosed","openscreen:miss"];for(var i=0,len=fireEventNameList.length;i<len;i++){qboot.events.on(fireEventNameList[i],function(){function clean(marioCat){marioCat.destroy();W("#festival-mario-screen").removeNode();qboot.cookie.set(config.closeCookie,1,{expires:1e3*60*60*24})}showCanvas({closed:false,url:config.url,onShow:function onShow(){LogHub.behavior("festival-mario-screen","show")},onClose:function onClose(marioCat){this.closed=true;clean(marioCat);LogHub.behavior("festival-mario-screen","clk-close")},onComplete:function onComplete(marioCat){setTimeout(function(){clean(marioCat);LogHub.behavior("festival-mario-screen","out-close")},config.countDownSecond*1e3)}})})}}}})();(function(){if(window.festival360ee&&window.festival360ee.isClosed())return;if(!window.configSlotMachine||!configSlotMachine.isOn)return;if(Browser.ie&&Browser.ie<=8)return;var e=function(e,t){var n=location.href.queryUrl("previewTime")?new Date(location.href.queryUrl("previewTime")):hao360.todayObj;return n>=e&&n<=t},t=function(){var e=["","webkit-","Moz-","ms-","o-"];for(var t in e){var n=e[t]+"animation";if(n in document.documentElement.style)return!0}return!1}(),n=function(){return e(configSlotMachine.startTime,configSlotMachine.endTime)};if(!n())return;var r=function(e){this.init(e)};r.prototype.constructor=r,r.prototype.init=function(e){this.closeCookie=e.cookie;var t=qboot.cookie.get(this.closeCookie);if(t)return;this.showTime=e.showTime||5e3,this.url=e.url,this.eventName=e.eventName,this.$docView=W("#doc-view-front"),this.$mainContainer="",this.$slotContainer="",this.closeTimer=null,this.coinFall=null,this.prizedPos=0,this.pokerRow=3,this.pokerNums=40,this.animationSec=4,this.pokerchips=[{icon:"https://hao2.qhimg.com/t01c6018225dcd00d44.png",width:43,height:55},{icon:"https://hao1.qhimg.com/t0166bd6fb27b8c67f5.png",width:65,height:54},{icon:"https://hao1.qhimg.com/t0182533a58166a8d7c.png",width:53,height:59},{icon:"https://hao2.qhimg.com/t0198c6e706dd642c7d.png",width:50,height:68},{icon:"https://hao1.qhimg.com/t01ebdf819b29c6d37b.png",width:58,height:44}],this.prizedPokerchips={icon:"https://hao2.qhimg.com/t011809ab341937b292.png",width:101,height:111},this.lightInterval=500,this.lightTimer=null,this.bindStartEvt(e)},r.prototype.start=function(){this.renderMain(),this.beginLight(),this.renderPokers(),t?this.bindAnimationEvt():Browser.ie&&Browser.ie<=9&&this.hackCapabilities(),this.bindRenderedEvt()},r.prototype.getRandomIntInclusive=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},r.prototype.buildPokers=function(){var e=[],t='<div class="poker-item"><img src="{icon}" height="{height}" width="{width}" /></div>',n='<img class="prized-poker" src={icon} width="{width}" height="{height}" />',r='<div class="poker-item prized"><img class="normal-poker" src="{icon}" height="{height}" width="{width}" />'+R.tmpl(n,this.prizedPokerchips)+"</div>",i="";for(var s=0;s<this.pokerNums;s++){var o=this,u="",a=t,f=function(){var e=o.getRandomIntInclusive(0,o.pokerchips.length-1);return e===i?f():e};u=f(),s===this.pokerNums-2&&(u=this.prizedPos,a=r);var l=this.pokerchips[u];e.push(R.tmpl(a,l)),i=u}return'<div class="poker-container">'+e.join("")+"</div>"},r.prototype.renderMain=function(){var e=74,t=e*(this.pokerNums-3),n=["#festival-slotmachine #slotmachine-link{width:100%;height:100%;display:block}","#festival-slotmachine{position:fixed;width:100%;height:100%;top:0;right:0;bottom:0;left:0;z-index:600;background:rgba(101,98,116,0.6);}","#festival-slotmachine canvas{z-index:3;position:absolute;}",'#festival-slotmachine .slot-mach{position:absolute;width:670px;height:578px;bottom:0;z-index:2;left:50%;transform:translate(-50%,0);-ms-transform:translate(-50%,0);-webkit-transform:translate(-50%,0);background:url("https://hao2.qhimg.com/t01565e719397cb73a6.png") no-repeat;background-size:670px 155px;background-position:0 423px;}',"#festival-slotmachine .machine-box{width:516px;height:500px;position:absolute;bottom:72px;left:50%;transform:translate(-50%,0);-ms-transform:translate(-50%,0);-webkit-transform:translate(-50%,0);}","#festival-slotmachine .machine-box .main-host{position:relative;width:516px;height:500px;}","#festival-slotmachine .machine-box .main-host .host1,#festival-slotmachine .machine-box .main-host .host2{position:absolute;left:0;top:0;width:516px;height:500px;}","#festival-slotmachine .machine-box .main-host .host1{z-index:2;}","#festival-slotmachine .machine-box .main-host .host2{z-index:3;opacity:0;}","#festival-slotmachine .machine-box .main-host.light .host2{opacity:1;}","#festival-slotmachine .machine-box .rocking-bar{width:60px;height:210px;position:absolute;right:-27px;z-index:1;}",'#festival-slotmachine .machine-box .rocking-bar.top{background:url("https://hao2.qhimg.com/t01bb95abc2eae85a3c.png") no-repeat;background-size:59px 210px;bottom:55px;}','#festival-slotmachine .machine-box .rocking-bar.bottom{background:url("https://hao2.qhimg.com/t01e83c92d98d477559.png") no-repeat;background-size:56px 150px;bottom:-83px;}',"#festival-slotmachine .slot-mach .poker-container{width:91px;position:absolute;top:0;left:0;right:0;}","#festival-slotmachine .channel-1,#festival-slotmachine .channel-2,#festival-slotmachine .channel-3{width:91px;height:222px;position:absolute;top:190px;overflow:hidden;z-index:3;}","#festival-slotmachine .channel-1 .poker-container{animation:"+this.animationSec+"s 1s ease forwards pokerslide;-webkit-animation:"+this.animationSec+"s 1s ease forwards pokerslide;}","#festival-slotmachine .channel-2 .poker-container{animation:"+this.animationSec+"s 1.5s ease forwards pokerslide;-webkit-animation:"+this.animationSec+"s 1.5s ease forwards pokerslide;}","#festival-slotmachine .channel-3 .poker-container{animation:"+this.animationSec+"s 2s ease forwards pokerslide;-webkit-animation:"+this.animationSec+"s 2s ease forwards pokerslide;}","#festival-slotmachine .poker-item{height:74px;position:relative;}","#festival-slotmachine .poker-item img{display:block;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);-ms-transform:translate(-50%, -50%);-webkit-transform:translate(-50%, -50%);}","#festival-slotmachine .channel-1{left: 151px;}","@keyframes pokerslide{0%{top:0;}100%{top:-"+t+"px}}","@-webkit-keyframes pokerslide{0%{top:0;}100%{top:-"+t+"px}}","#festival-slotmachine .channel-2{left: 291px;}","#festival-slotmachine .channel-3{left: 430px;}","#festival-slotmachine .red-bag{position:absolute;z-index:4;width:780px;height:810px;top:50%;left:50%;transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);-wbkit-transform:translate(-50%,-50%);}","#festival-slotmachine .red-bag .red-bag-image{display:none;}","#festival-slotmachine .red-bag.slide .red-bag-image,#festival-slotmachine .red-bag.drop .red-bag-image{display:block;}","#festival-slotmachine .red-bag img{display:block;width:780px;height:810px;}","#festival-slotmachine .red-bag.drop .red-bag-image{position:absolute;top:-810px;left:0;}","#festival-slotmachine .red-bag.slide img{animation: 2s ease forwards redbagslides;-webkit-animation: 2s ease forwards redbagslides;}","@keyframes redbagslides{0%{transform:scale(0);-ms-transform:scale(0);-webkit-transform:scale(0);}100%{transform:scale(1);-ms-transform:scale(1);-webkit-transform:scale(1);}}","@-webkit-keyframes redbagslides{0%{transform:scale(0);-ms-transform:scale(0);-webkit-transform:scale(0);}100%{transform:scale(1);-ms-transform:scale(1);-webkit-transform:scale(1);}}","#festival-slotmachine .poker-item .prized-poker{display:none;}","#festival-slotmachine .machine-box .twink-text{width:398px;height:36px;position:absolute;top:38px;left:50%;transform:translate(-50%,0);-ms-transform:translate(-50%,0);-webkit-transform:translate(-50%,0);z-index:3;}","#festival-slotmachine .machine-box .twink-text .text1,#festival-slotmachine .machine-box .twink-text .text2{position:absolute;left:0;top:0;height:36px;width:398px;}","#festival-slotmachine .machine-box .twink-text .text1{z-index:2;}","#festival-slotmachine .machine-box .twink-text .text2{z-index:3;opacity:0;}","#festival-slotmachine .machine-box .twink-text.light .text2{opacity:1;}","#festival-slotmachine .machine-box .light-box{position:absolute;top:0;}",'#festival-slotmachine .red-bag .close-btn{display:block;background:url("https://hao2.qhimg.com/t01813c2842d59e3797.png") no-repeat;background-size:48px;background-position:0 -61px;height:48px;width:48px;top:260px;right:75px;cursor:pointer;}',"#festival-slotmachine .red-bag .close-btn:hover{background-position:0 0;}"].join("");qboot.load.css(n,"festival_slotmachine");var r=['<div id="festival-slotmachine">','<a id="slotmachine-link" href="'+this.url+'" target="_blank" text="slot-machine">','<div class="slot-mach">','<div class="machine-box">','<div class="main-host"><img class="host1" src="https://hao2.qhimg.com/t01c84bd9639fab0fd0.png" width="516" height="500" /><img class="host2" src="https://hao2.qhimg.com/t013de2ce55b095f963.png" width="516" height="500" /></div>','<div class="twink-text"><img class="text1" src="https://hao2.qhimg.com/t01bd2c686549d6fd0e.png" width="398" height="36" /><img class="text2" src="https://hao2.qhimg.com/t018ad6c943a368b088.png" width="398" height="36" /></div>','<div class="light-box"></div>','<div class="rocking-bar top"></div>',"</div>","</div>",'<div class="red-bag"><div class="red-bag-image"><img src="https://hao2.qhimg.com/t0186b3aa5a1594633e.png" wdith="780" height="810" /></div><div class="close-btn"></div></div>',"</a>","</div>"];this.$docView.insertAdjacentHTML("beforeend",r.join("")),this.$mainContainer=W("#festival-slotmachine"),this.$slotContainer=this.$mainContainer.query(".slot-mach"),this.monitor.show(),this.monitor.setId()},r.prototype.beginLight=function(){var e=this,t=e.$slotContainer.query(".rocking-bar");setTimeout(function(){t.removeClass("top").addClass("bottom"),setTimeout(function(){t.removeClass("bottom").addClass("top")},300)},500),this.lightTimer=setInterval(function(){e.$slotContainer.query(".twink-text").toggleClass("light"),e.$slotContainer.query(".main-host").toggleClass("light")},this.lightInterval)},r.prototype.renderPokers=function(){var e=[];for(var t=0;t<this.pokerRow;t++){var n='<div class="channel-{index}">'+this.buildPokers()+"</div>";e.push(R.tmpl(n,{index:t+1}))}this.$slotContainer.insertAdjacentHTML("afterbegin",e.join(""))},r.prototype.renderCoin=function(){var e=this;qboot.load("https://s3.ssl.qhres2.com/static/3f1beec087719256.js",function(){e.buildCoin()})},r.prototype.buildCoin=function(){var e=function(){var e=Matter.Engine,t=Matter.Render,n=Matter.Runner,r=Matter.Composite,i=Matter.Composites,s=Matter.Common,o=Matter.Bodies,u=Matter.Events,a=window.innerWidth,f=window.innerHeight,l=e.create(),c=l.world;c.gravity.y=2;var h=t.create({element:document.getElementById("slotmachine-link"),engine:l,options:{width:a,height:f,showAngleIndicator:!1,wireframes:!1,background:"transparent"}});t.run(h);var p=n.create();n.run(p,l);var d=function(){var e=o.rectangle(window.innerWidth/2,window.innerHeight+1,window.innerWidth+400,1,{isStatic:!0,friction:1,render:{fillStyle:"#060a19"}}),t=o.rectangle(-200,window.innerHeight/2,1,window.innerHeight-1,{isStatic:!0,friction:1,render:{fillStyle:"#060a19"}}),n=o.rectangle(window.innerWidth+200,window.innerHeight/2,1,window.innerHeight-1,{isStatic:!0,friction:1,render:{fillStyle:"#060a19"}});return[e,t,n]},v=d();r.add(c,v);var m=i.stack(window.innerWidth/5,-4e3,14,14,20,200,function(e,t){e+=s.random(-50,50),t+=s.random(-200,200);var n=s.random(15,30),r=2.6*n/106;return o.circle(e,t,n,{restitution:.3,friction:.3,render:{sprite:{texture:"https://hao1.qhimg.com/t01176759176ad26429.png",xScale:r,yScale:r}}})});return r.add(c,[m]),{engine:l,runner:p,render:h,canvas:h.canvas,world:l.world,Composite:r,Events:u,Bodies:o,stop:function(){Matter.Render.stop(h),Matter.Runner.stop(p)},canvasReset:function(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight},coinReset:function(){var e=window.innerWidth-a,t=window.innerHeight-f;Matter.Composite.allBodies(m).forEach(function(n){var r=n.position;Matter.Body.set(n,{position:{x:r.x+e,y:r.y+t}})}),a=window.innerWidth,f=window.innerHeight},wallReset:function(){var e=[[window.innerWidth/2,window.innerHeight+1],[-200,window.innerHeight/2],[window.innerWidth+200,window.innerHeight/2]],t=[[window.innerWidth+400,1],[1,window.innerHeight-1],[1,window.innerHeight-1]];v.forEach(function(n,r){Matter.Body.set(n,{position:{x:e[r][0],y:e[r][1]},width:t[r][0],height:t[r][1]})})}}};this.coinFall=e()},r.prototype.bindStartEvt=function(e){var t=this;e.isChain?qboot.events.on(e.eventName+":start",function(e){t.start(),e.returnValue=!1}):(qboot.events.on("openscreen:close",function(){t.start()}),qboot.events.on("openscreen:hitclosed",function(){t.start()}),qboot.events.on("openscreen:miss",function(){t.start()})),W(window).on("resize",function(){t.resize()})},r.prototype.pokerEnd=function(){var e=this;setTimeout(function(){W("#festival-slotmachine .poker-item .normal-poker").hide(),W("#festival-slotmachine .poker-item .prized-poker").show()},50),setTimeout(function(){Browser.ie&&Browser.ie<=9?e.$mainContainer.query(".red-bag").addClass("drop").query(".red-bag-image").animate({top:{to:"0px"}},1e3,function(){e.closeTimer=setTimeout(function(){e.close()},e.showTime)},QW.Easing.easeBoth):e.$mainContainer.query(".red-bag").addClass("slide")},100),this.renderCoin()},r.prototype.bindAnimationEvt=function(){var e=this,t=W("#festival-slotmachine .channel-3 .poker-container");$redBag=W("#festival-slotmachine .red-bag img"),t.on("animationend",function(t){e.pokerEnd()},!1),$redBag.on("animationend",function(t){e.closeTimer=setTimeout(function(){e.close()},e.showTime)},!1)},r.prototype.hackCapabilities=function(){var e=this,t=this.$slotContainer.query(".channel-1"),n=this.$slotContainer.query(".channel-2"),r=this.$slotContainer.query(".channel-3"),i=74,s=i*(this.pokerNums-3);this.poker1Timer=setTimeout(function(){t.query(".poker-container").animate({top:{to:"-"+s+"px"}},e.animationSec*1e3,function(){},QW.Easing.easeBoth)},1e3),this.poker2Timer=setTimeout(function(){n.query(".poker-container").animate({top:{to:"-"+s+"px"}},e.animationSec*1e3,function(){},QW.Easing.easeBoth)},1500),this.poker3Timer=setTimeout(function(){r.query(".poker-container").animate({top:{to:"-"+s+"px"}},e.animationSec*1e3,function(){e.pokerEnd()},QW.Easing.easeBoth)},2e3)},r.prototype.bindRenderedEvt=function(){var e=this;this.$mainContainer.query(".red-bag .close-btn").on("click",function(t){t.preventDefault(),t.stopPropagation(),e.close(),e.monitor.click("close")})},r.prototype.monitor=function(){return{setId:function(){window.moniter&&moniter.setId(["festival-slotmachine"])},show:function(){LogHub.behavior("festival_slotmachine","show")},click:function(e){LogHub.behavior("festival_slotmachine",e)}}}(),r.prototype.close=function(){this.$mainContainer.removeNode(),clearTimeout(this.closeTimer),clearInterval(this.lightTimer),this.poker1Timer&&clearTimeout(this.poker1Timer),this.poker2Timer&&clearTimeout(this.poker2Timer),this.poker3Timer&&clearTimeout(this.poker3Timer),qboot.cookie.set(this.closeCookie,1,{expires:864e5}),qboot.events.fire(this.eventName+":end"),W(window).un("resize",function(){self.resize()})},r.prototype.resize=function(){if(!this.coinFall)return;this.coinFall.canvasReset(),this.coinFall.wallReset(),this.coinFall.coinReset()},new r(configSlotMachine)})();(function(){function u(e,t){var n=W(".festival_single_redbag .time span");n&&n.length&&(n.setHtml("\u5269\u4f59"+e+"\u79d2"),i.start(e,1e3,function(t){n.setHtml("\u5269\u4f59"+(e-t)+"\u79d2")},function(e){t&&t(),n.setHtml("\u5173\u95ed")}))}function a(e){var t=new Image;t.onload=function(){o.show(),n(),u(configSingleRedbag.time,o.collapse)},t.src=configSingleRedbag.centerImage}function f(){r()||(o.init(),qboot.events.on("openscreen:close",function(){setTimeout(a,0)}),qboot.events.on("openscreen:hitclosed",function(){setTimeout(a,0)}),qboot.events.on("openscreen:miss",function(){setTimeout(a,0)}))}if(Browser.ie<=6)return;var e=function(){if(!window.configSingleRedbag||!configSingleRedbag.isOn)return!1;var e=new Date(configSingleRedbag.startTime),t=new Date(configSingleRedbag.endTime),n=hao360.queryUrl(location.href,"previewTime")||hao360.todayObj;return e>new Date(n)||new Date(n)>t?!1:!0};if(!e())return;var t=configSingleRedbag.id,n=function(){qboot.cookie.set(t,1,{expires:864e5})},r=function(){return qboot.cookie.get(t)},i=function(){var e,t=!0,n=1;return{start:function(r,i,s,o){var u=this;if(!t)return;e=setInterval(function(){n>=r||t?(u.reset(),o&&o(n)):(s&&s(n),n++)},i),t=!1},abort:function(){t=!0},reset:function(){t=!0,n=1,clearInterval(e)}}}(),s=function(){return{show:function(){LogHub.behavior("festival_single_redbag","show")},closeMain:function(){LogHub.behavior("festival_single_redbag","close-main")},clickMain:function(){LogHub.behavior("festival_single_redbag","click-main")}}}(),o={init:function(){var e=configSingleRedbag.centerImage;hao360.isHttps()&&(e=hao360.convertHttpToHttps(e));var t=["#festival_single_redbag{","visibility:hidden;","position:fixed;","bottom:0;","left:50%;","width:255px;","height:366px;","margin-left:-128px;","z-index:410;","}","#festival_single_redbag .main{","position:relative;","margin:0 auto;","height:100%;","width:100%;","}","#festival_single_redbag .link{","display:block;","height:100%;","width:100%;",'background-image:url("'+e+'");',"background-size: cover;","}","#festival_single_redbag .close{","position:absolute;","width:48px;","height:48px;","top:6px;","right:18px;","background-image:url(https://hao2.qhimg.com/t01813c2842d59e3797.png);","background-position:0 -61px;","}","#festival_single_redbag .close:hover{","background-position:0 0;","}","#festival_single_redbag .time{","position:absolute;","top:18px;","right:-37px;","height:24px;","width:59px;",'background:url("https://hao1.qhimg.com/t01ebea93fbe7dd8b50.png");',"text-align:left;","line-height:24px;","}","#festival_single_redbag .time span{","color:#fff;","font-size:12px;","margin-left:9px;","}","#festival_single_redbag .btn{","position:absolute;","width: 90px;","height: 101px;","top:225px;","left: 50%;","margin-left: -45px;","background:url(https://p3.ssl.qhimg.com/t01ebab1f1929df027c.png) no-repeat;","background-size:cover;","animation: btn_scale 0.5s ease infinite;","}","@-webkit-keyframes btn_scale {","0% {","-webkit-transform: scale(1);","transform: scale(1);","}","50% {","-webkit-transform: scale(1.1);","transform: scale(1.1);","}","100% {","-webkit-transform: scale(1);","transform: scale(1);","}","}","@-moz-keyframes btn_scale {","0% {","-moz-transform: scale(1);","transform: scale(1);","}","50% {","-moz-transform: scale(1.1);","transform: scale(1.1);","}","100% {","-moz-transform: scale(1);","transform: scale(1);","}","}","@keyframes btn_scale {","0% {","-webkit-transform: scale(1);","-moz-transform: scale(1);","-o-transform: scale(1);","transform: scale(1);","}","50% {","-webkit-transform: scale(1.1);","-moz-transform: scale(1.1);","-o-transform: scale(1.1);","transform: scale(1.1);","}","100% {","-webkit-transform: scale(1);","-moz-transform: scale(1);","-o-transform: scale(1);","transform: scale(1);","}","}"].join(""),n=['<div class="festival_single_redbag" id="festival_single_redbag">','<div class="main">','<a class="link" href="'+configSingleRedbag.url+'">','<span class="btn"></span>',"</a>",'<div class="time"><span></span></div>','<a class="close"></a>',"</div>","</div>"].join(""),r=W(n);qboot.load.css(t),r.appendTo(W("#doc-view-front")[0]),W(document).delegate(".festival_single_redbag .close","click",function(e){e.preventDefault(),o.collapse(),s.closeMain()}),W(document).delegate(".festival_single_redbag .link","click",function(e){s.clickMain()})},show:function(){W(".festival_single_redbag").css("visibility","visible"),W(".festival_single_redbag").show(),s.show()},collapse:function(){i.abort(),W(".festival_single_redbag .time").hide(),W(".festival_single_redbag .close").hide(),W(".festival_single_redbag").hide(),qboot.events.fire("singleRedBag:end")}};f()})();(function(){var e=hao360.isHttps()?"https":"http",t=location.href.queryUrl("testrich"),n={http:"http://show.g.mediav.com/s",https:"https://show-g.mediav.com/s"},r={http:"http://show-g.mediav.com/s",https:"https://show-g.mediav.com/s"},i=e+"://static.mediav.com/js/richmedia/index.html",s=!!Browser.ie,o=function(){return(!s||Browser.ie>9)&&!!document.createElement("canvas").getContext}(),u=new AppData("api.hao.360.cn"),a=window.configHei&&configHei.name?configHei.name:"",f=function(){var i=t?r:n;return i[e]||i.https},l=function(e){VersionHub.get("openscreen")=="sample"&&LogHub.behavior("pmpopenscreen",e)},c={SEND_RM_DATA:function(e,t){e.contentWindow.postMessage({type:"SEND_RM_DATA",data:t},i)},SEND_RM_REPLAY:function(e){e.contentWindow.postMessage({type:"SEND_RM_REPLAY",data:"RM_REPLAY"},i)},SEND_RM_CLOSE:function(e){e.contentWindow.postMessage({type:"SEND_RM_CLOSE",data:"RM_CLOSE"},i)}},h=function(e){function t(e,t){var n=[];return e&&n.push(e),n.concat(t).join("_")}return e=e||"",{set:function(n,r,i){qboot.cookie.set(t(e,n),r,{expires:i})},get:function(n){return qboot.cookie.get(t(e,n))}}},p=function(){return{copy:function(e){return qboot.mix({},e||{},!0)},isQueryEqual:function(e,t){return hao360.queryUrl(location.href,e)==t},isTimeRange:function(e,t){var n=location.href.queryUrl("previewTime")?new Date(location.href.queryUrl("previewTime")):hao360.todayObj;return n>=e&&n<=t},formatImgProc:function(e){return hao360.convertHttpToHttps(e||"",!0).replace(/^http:/i,"https:")}}}(),d=function(){var e,t=!0,n=1;return{start:function(r,i,s,o){var u=this;if(!t)return;e=setInterval(function(){n>=r||t?(u.reset(),o&&o(n)):(s&&s(n),n++)},i),t=!1},abort:function(){t=!0},reset:function(){t=!0,n=1,clearInterval(e)}}}(),v=function(){var e=!1,t={};return{init:function(n){return e||(t=qboot.mix(t,n,!0),e=!0),this},pv:function(n){return e&&LogHub.openScreen("pv",qboot.mix({position:n},t)),this},click:function(n){return e&&LogHub.openScreen("click",qboot.mix({position:n},t)),this}}}(),m=function(){var e={};return{init:function(t){return e=qboot.mix(e,t,!0),this},pv:function(){var t=e.imptk,n=e.imparg,r=e.impurl;while(t&&t.length)logPureSender(t.shift());n&&r&&logPureSender(r+n)},replay:function(){var t=e.acttk;t&&logPureSender(t)},click:function(){var t=e.clktk;t&&t.length&&t.forEach(function(e){logPureSender(e)})}}}(),g=function(e){this.init(e)};g.prototype.constructor=g,g.prototype.defaultConfig={type:"pmp",height:360,mainHeight:215,showTime:1e4,returnTo:"left",returnToImg:"//hao2.qhimg.com/t011d977bd20ed858e0.png"},g.prototype.init=function(e){qboot.createEvents(this),this.options=qboot.mix({},e,!0),this.baseConfig=this.options.baseConfig,this.pmpConfig=this.options.pmpConfig,this.viewStoreConfig=this.options.viewStoreConfig,this.interface=new Interface(this.options.interface),this.baseStore=h(this.options.baseKey),this.pmpStore=h(this.options.pmpKey)},g.prototype.checkView=function(){var e=this.pmpStore,t=this.viewStoreConfig;return!e.get(t.key)},g.prototype.markView=function(e){var t=this.pmpStore,n=this.viewStoreConfig;if(e=="pmp"){var r=n.key,i=n.expires;t.set(r,1,i)}},g.prototype.markClose=function(e){this.baseStore.set(e,1,864e5)},g.prototype.checkClose=function(e){return this.baseStore.get(e)},g.prototype.verify=function(e){var t=e=="config"?pmpOfflineData:this.baseConfig,n=this.pmpConfig,r=t.startTime,i=t.endTime,s=n.startTime,o=n.endTime,u=p.isQueryEqual("from","pmp");return e=="pmp"?t&&n&&n.isOn&&p.isTimeRange(s,o)&&(u||!p.isTimeRange(r,i))&&(u||this.checkView()):t&&t.name&&p.isTimeRange(r,i)&&!u},g.prototype.mergePMPData=function(e,t){if(t&&t.ads&&t.ads.length){var n=t.ads[0];return qboot.mix(e,qboot.mix(p.copy(this.defaultConfig),{name:"mediav_"+parseInt((new Date).getTime()/5e3,10),url:n.curl,lurl:n.lcurl||n.curl,img:n.img,returnToImg:n.limg||this.defaultConfig.returnToImg,imptk:n.imptk,impurl:t.impurl,imparg:n.imparg,clktk:n.clktk,acttk:n.acttk,desurl:n.desurl,richmedia:n.richmedia,originData:t,ldtype:n.ldtype},!0),!0)}return},g.prototype.formatData=function(e,t){var n=this.baseConfig;return e=="pmp"?n=this.mergePMPData(n,t):e=="config"&&(n=t),n&&(n.lurl=n.lurl||n.url,n.close=this.checkClose(n.name),n.richmedia=o&&n.richmedia,n.type=n.richmedia?"pmprich":e),n},g.prototype.loadData=function(e){var t=this,n=this.baseConfig;this.verify("base")?e&&e(this.formatData("base",n)):this.verify("pmp")?this.interface.excute("getPMPData",function(n){n=t.formatData("pmp",n),n?e&&e(n):t.verify("config")?(e&&e(t.formatData("config",pmpOfflineData)),LogHub.behavior("pmp_config","pv")):t.fire("model:miss")}):t.fire("model:miss")};var y=function(e){this.init(e)};y.prototype.constructor=y,y.prototype.init=function(e){qboot.createEvents(this),this.options=qboot.mix({},e),this.container=this.options.container,this.main=this.options.main,this.iframeWrap=this.options.iframeWrap,this.title=this.options.title,this.timeArea=this.options.timeArea,this.itemLogo=this.options.itemLogo,this.closeBtn=this.options.closeBtn,this.fankuiBtn=this.options.fankuiBtn,this.replayBtn=this.options.replayBtn,this.recycleCloseBtn=this.options.recycleCloseBtn,this.leftWrap=this.options.leftWrap,this.leftLink=this.options.leftLink,this.rightLink=this.options.rightLink,this.logoLink=this.options.logoLink,this.themeLogo=this.options.themeLogo,this.advert=this.options.advert,this.backView=W(this.options.backView)[0],this.frontView=W(this.options.frontView)[0],this.$itemLogo=W(this.itemLogo),this.$container=W(this.container),this.$themeLogo=W(this.themeLogo),this.$main=this.$container.query(this.main),this.$title=this.$container.query(this.title),this.$timeArea=this.$container.query(this.timeArea),this.$closeBtn=this.$container.query(this.closeBtn),this.$fankuiBtn=this.$container.query(this.fankuiBtn),this.$advert=this.$container.query(this.advert),this.leftTpl=this.options.leftTpl,this.rightTpl=this.options.rightTpl,this.logoTpl=this.options.logoTpl,this.logoLinkTpl=this.options.logoLinkTpl,this.iframeTpl=this.options.iframeTpl},y.prototype.bindEvt=function(){var e=this,t=this.data,n=W(document),r=W("body"),i=this.$container,s=this.$closeBtn,o=this.$fankuiBtn,u=this.$title,a=this.$advert,f=i.query(this.iframeWrap)[0],l=this.replayBtn,h=this.recycleCloseBtn,p=this.leftWrap,d=this.leftLink,v=this.rightLink,m=this.logoLink;s.on("click",function(n){t.type==="pmprich"&&c.SEND_RM_CLOSE(f),e.close(),e.fire("view:clickClose")}),o.on("click",function(t){e.fire("view:clickFankui")}),u.on("click",function(t){e.fire("view:clickMain")}),e.data.ldtype&&e.data.ldtype===6&&(u.on("mouseover",function(e){e.preventDefault(),a.css("width","91px")}),u.on("mouseout",function(e){e.preventDefault(),a.css("width","18px")})),r.delegate(l,"click",function(n){n.preventDefault(),t.type==="pmprich"&&c.SEND_RM_REPLAY(f),e.unCollapse(),e.spread(!0),e.fire("view:clickReplay")}),r.delegate(h,"click",function(t){t.preventDefault(),e.fire("view:clickRecycleClose"),e.closeRecycle()}),r.delegate(d,"click",function(t){e.fire("view:clickLeft")}),r.delegate(p,"mouseenter",function(e){var t=W(this);vendor.animate(t,{animation:"jello",animationDuration:1e3})}),r.delegate(v,"click",function(t){e.fire("view:clickRight")}),r.delegate(m,"click",function(t){e.fire("view:clickLogo")}),n.receive("page-size-changed",function(t){var n=e.data.returnTo,r=t.data.spaceWidth,s=i.attr("data-width");if(s&&r!=s)switch(n){case"right":r<132?e.unCollapse(n):e.collapse(n);break;case"left":r<50?e.unCollapse(n):e.collapse(n)}i.attr("data-width",r)})},y.prototype.bindIframeEvt=function(){var e=this,t=this.$container,n=t.query(this.iframeWrap)[0],r=this.data.originData,i=this.$timeArea,s=function(s){switch(s.data.type){case"RM_READY":c.SEND_RM_DATA(n,r);break;case"RM_PV":e.countDown(),t.show(),e.fire("view:iframePv",{first:!0});break;case"RM_PV_REPLAY":e.countDown(),t.show(),e.fire("view:iframePv",{first:!1});break;case"RM_CLICK":e.fire("view:iframeClick");break;case"RM_AUTOCLOSED":e.close();break;case"RM_PAUSE":d.reset(),i&&i.length&&i.setHtml("\u5173\u95ed")}};window.addEventListener("message",s,!1)},y.prototype.render=function(e){var t=e.returnTo,n=this.$itemLogo,r=this.$container,i=this.$main,s=this.$closeBtn,o=this.$title,u=this.$advert,a=this[t+"Tpl"],f=this.logoLinkTpl,l=this.iframeTpl,c=this.frontView,h=this.backView,p=c,d="$"+t;this.data=e;switch(t){case"logo":p=h,this.$logoLink=W(R.tmpl(f,e)).appendTo(n[0]);break;case"left":e.offsetBottom=document.documentElement.clientHeight/10+62}a&&(this[d]=W(R.tmpl(a,e)).appendTo(p)),e.type==="pmprich"?(W(l).appendTo(i[0]).css("height",e.height+"px"),i.css("height",e.height+"px"),o.parentNode().css("height","0"),s.parentNode().css("top",e.height-e.mainHeight-45+"px"),this.bindIframeEvt()):(r.css({backgroundImage:"url("+e.img+")"}),i.css("height",e.mainHeight+"px"),o.attr("href",e.url),e.ldtype&&e.ldtype===6&&(u.toArray()[0].className="ad-tag ad-minipro-long")),r.css({height:e.height+"px"}),this.bindEvt()},y.prototype.countDown=function(){var e=this,t=this.data,n=t.showTime,r=parseInt(n/1e3),i=this.$timeArea;i&&i.length&&(i.setHtml("\u5269\u4f59"+r+"\u79d2"),d.start(r,1e3,function(e){i.setHtml("\u5269\u4f59"+(r-e)+"\u79d2")},function(t){e.close(),i.setHtml("\u5173\u95ed")}))},y.prototype.spread=function(e){var t=this.data,n=this.$container,r=n.query(this.iframeWrap),s=r[0];n&&n.length&&!n.attr("status-show")&&(n.attr("status-show",!0),t.type==="pmprich"&&!n.attr("data-count")&&(s.src=i),t.type!=="pmprich"&&(n.show(),this.countDown(),this.fire("view:spread",{replay:!!e,_type:t.type,name:t.name,imptk:t.imptk,imparg:t.imparg,impurl:t.impurl,first:!n.attr("data-count")})),n.attr("data-count",!0))},y.prototype.close=function(){var e=this,t=this.data,n=this.$container,r=this.data.returnTo,i=!s&&r==="left",o=function(){n.hide().removeAttr("status-show"),e.collapse(),qboot.events.fire("openscreen:close")};n&&n.length&&(d.abort(),i?vendor.animate(n,{animation:"pullOutLeft",animationDuration:1200},function(){o()}):o())},y.prototype.closeRecycle=function(){var e=this.data&&this.data.returnTo;if(e){var t=this["$"+e];t.hide()}},y.prototype.collapse=function(e){var e=e||this.data&&this.data.returnTo,t=this.$themeLogo,n=this["$"+e],r=this.$logoLink,i=n&&n.length&&n.css("display")!="block";switch(e){case"left":break;case"right":i&&n.show();break;case"logo":if(i){var s=u.get("newUserTheme");s&&s[0]!="default"?(t.removeAttr("style"),n.hide(),r.hide()):(n.show(),r.show(),t.hide())}}this.fire("view:collapse",{_target:e,$element:n,isValid:i,name:this.data&&this.data.name})},y.prototype.unCollapse=function(e){var e=e||this.data.returnTo,t=this["$"+e],n=this.$themeLogo,r=this.$logoLink,i=t&&t.length&&t.css("display")=="block";switch(e){case"left":case"right":i&&t.hide();break;case"logo":i&&(t.hide(),r.hide(),n.hide())}this.fire("view:unCollapse",{target:e,$element:t,isValid:i})};var b=function(){this.init()};b.prototype.constructor=b,b.prototype.init=function(){qboot.createEvents(this),this.model=new g({baseKey:"festival",pmpKey:"pmp_festival",baseConfig:configFloatBottom,pmpConfig:configFloatBottomPMP,viewStoreConfig:{key:"float2"+a,expires:864e5},"interface":{host:f(),apiMap:{getPMPData:{timeout:6e3,params:{mid:hao360.mid||"",type:1,of:4,newf:1,showids:t?"ypbOPU":"boSMUj",djsource:hao360.project==="cube"?"ypbOPU":""},jsonpName:"jsonp"}}}}),this.view=new y({leftTpl:'<div class="festival_float_bottom-leftBottom" style="bottom:{offsetBottom}px;"><a class="link" href="{lurl}"><img src="{returnToImg}"></a><a href="javascript:void(0);" class="replay"><img src="https://hao1.qhimg.com/t0196a3fb978bf3ac27.png"></a><a class="recycle-close" href="javascript:void(0);"></a></div>',rightTpl:'<div class="festival_float_bottom-rightBottom"><a class="link" href="{url}"><img src="{returnToImg}"></a></div>',logoTpl:'<div class="festival_float_bottom-logo"><img src="{returnToImg}"></div>',logoLinkTpl:'<a class="festival_float_bottom-link" href="{url}" target="_blank"></a>',iframeTpl:'<iframe src="about:blank" name="richmedia-iframe" id="richmedia-iframe" allowtransparency="true" scrolling="no" height="0" frameborder="no"></iframe>',frontView:"#doc-view-front",backView:"#doc-bd-behind",container:"#festival_float_bottom",main:".main",iframeWrap:"#richmedia-iframe",leftWrap:".festival_float_bottom-leftBottom",leftLink:".festival_float_bottom-leftBottom .link",rightLink:".festival_float_bottom-rightBottom .link",logoLink:".festival_float_bottom-link",title:".title a",timeArea:".close .count-down",closeBtn:".close .btn",fankuiBtn:".close .fankui",replayBtn:".festival_float_bottom-leftBottom .replay",recycleCloseBtn:".festival_float_bottom-leftBottom .recycle-close",itemLogo:".item-logo",advert:".ad-tag"}),this.bindEvt()},b.prototype.bindEvt=function(){var e=this;this.model.on("model:miss",function(e){qboot.events.fire("openscreen:miss")}),this.on("system:dataReady",function(t){var n=t.data;v.init({p:n.type.indexOf("pmp")>-1?n.type:"normal",resource:p.formatImgProc(n.img),url:n.desurl||"none"}),n.type!=="pmprich"&&m.init(n),e.view.render(n),n.close?(e.view.collapse(),qboot.events.fire("openscreen:hitclosed")):(qboot.events.fire("openscreen:hit"),e.view.spread())}),this.view.on("view:clickClose",function(){v.click("close")}),this.view.on("view:clickMain",function(){v.click("main"),m.click()}),this.view.on("view:clickFankui",function(){v.click("fankui")}),this.view.on("view:clickReplay",function(){v.click("replay"),m.replay()}),this.view.on("view:clickRecycleClose",function(){v.click("recycleclose")}),this.view.on("view:clickLeft",function(){v.click("left"),m.click()}),this.view.on("view:clickRight",function(){v.click("right")}),this.view.on("view:clickLogo",function(){v.click("logo")}),this.view.on("view:collapse",function(t){e.model.markClose(t.name),v.pv(t._target)}),this.view.on("view:spread",function(t){t.first&&!t.replay&&(e.model.markView(t._type),m.pv()),v.pv("main")}),this.view.on("view:iframePv",function(t){t.first&&e.model.markView("pmp"),v.pv("main")}),this.view.on("view:iframeClick",function(e){v.click("main")})},b.prototype.prepare=function(){var e=this;this.verify()&&(this.model.loadData(function(t){t&&e.fire("system:dataReady",{data:t})}),moniter.setId(["festival_float_bottom"]))},b.prototype.verify=function(){return window.adOnOff&&window.adOnOff.openscreen_2020==="off"?!1:!(Browser.ie<7)},(new b).prepare()})();