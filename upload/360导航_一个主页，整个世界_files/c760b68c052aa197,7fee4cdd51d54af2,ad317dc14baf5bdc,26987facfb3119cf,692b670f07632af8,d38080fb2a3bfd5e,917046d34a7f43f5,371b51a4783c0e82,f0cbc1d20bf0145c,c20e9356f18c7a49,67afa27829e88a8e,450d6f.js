(function(){var e="show",t="follow",n="clk",r="new",i={api:"https://user.360kuai.com/user/fans",logUrl:"https://s.hao.360.com/wzdh/tf.gif",mid:hao360.mid,guid:qboot.cookie.get("__guid"),huid:qboot.cookie.get("__huid"),version:"",count:undefined,logQueue:[],reg:/(^|\.)360kuai\.com$/,init:function(){var e=this;this.bindEvent(),Dom.ready(function(){e.getCountAsync(function(e){var t=parseInt(e.fans,10),n=parseInt(e.cube_fans,10),r=t+n;isNaN(r)||qboot.events.fire("360kuai-follow-count",{total:r})})})},bindEvent:function(){var r=this;qboot.events.on("360kuai-export",function(){r.count===undefined?r.logQueue.push(n):r.trigger(n)}),qboot.events.on("360kuai-follow-count",function(t){r.setCount(t.total),r.trigger(e),r.logQueue.length&&(r.logQueue.forEach(function(e){r.trigger(e)}),r.logQueue.length=0)}),qboot.events.on("total-follow-add",function(){r.count===undefined?r.logQueue.push(t):r.trigger(t)}),qboot.events.on("cube:follow",function(e){qboot.events.fire("total-follow-add")}),qboot.events.on("360kuai-follow-add",function(){qboot.events.fire("total-follow-add")}),W(document).delegate("a","click",function(e){this.hostname&&r.reg.test(this.hostname)&&!e.defaultPrevented&&qboot.events.fire("360kuai-export")}),W(document).delegate(".infoflow-right-source","click",function(e){var t=W(this).attr("href");if(t){var n=r.getHostname(t);n&&r.reg.test(n)&&qboot.events.fire("360kuai-export")}})},trigger:function(i){switch(i){case t:this.count===0&&this.send(this.logUrl,this.buildLogParams(r)),this.addCount();break;case n:case e:this.count>0&&this.send(this.logUrl,this.buildLogParams(i))}},getUid:function(){return this.mid||this.guid||this.huid},getCountAsync:function(e){this.request(this.api,{uid:this.getUid(),f:"jsonp"},function(t){t.errno===0&&typeof t.data=="object"&&e(t.data)})},setCount:function(e){this.count=e},addCount:function(){this.count++},buildLogParams:function(e){return this.count===undefined||e===undefined?!1:{m:this.mid,guid:this.guid,huid:this.huid,uid:this.getUid(),count:this.count,version:this.version,act:e,t:(new Date).getTime()}},makeURL:function(e,t){return typeof t=="object"?e+"?"+qboot.encodeURIJson(t):e},send:function(e,t){window.logPureSender(this.makeURL(e,t))},request:function(e,t,n){qboot.jsonp(e,t,n,{jsonp:"callback"})},getHostname:function(e){var t=document.createElement("a");return t.href=e,t.hostname}};i.init()})();(function(){try{var e="api.hao.360.cn",t="cubesdk_cube",n=new AppData(e),r=new AppData(t),i={cubefollow:"mycube_expandstate",cuberecommend:"haocube_expandstate",cubeyule:"yulecube_expandstate",cubeshopping:"gouwucube_expandstate",cubegame:"youxicube_expandstate",cubestory:"gushicube_expandstate"};for(var s in i)(function(e){var t=n.get(e);if(!t||typeof t!="object")return;var s={};for(var o in t)t[o].expanded&&(s[o]=1);var u=r.get(i[e])||{};qboot.mix(u,s),r.set(e,u),n.remove(e)})(s)}catch(o){LogHub&&LogHub.behavior("cube","clean_old_storage_error")}})();(function(){function S(e){var t=C(e);window.followQueues=t,x(e,t),k(e),L(e),T(e),A(e),_(e)}function x(e,t){var s=t.followCubes,o=t.unfollowCubes;W("#cube-nav").delegate(".cube-nav-li","click",function(t){var u=W(this),a=u.attr("data-id"),f,l=u.previousSiblings(".cube-nav-li").length,c=e[l];if(l===n)return;if(!e[n].disable())return;u.parentNode(".cube-nav-ul").query(".cube-nav-li").removeClass("active"),u.addClass("active").removeClass("red-tips"),a!=="follow"?qboot.events.fire("cube:tipshide"):d&&qboot.events.fire("cube:userlogintips"),i[l]?W("#cube-loaded").show():W("#cube-loaded").hide(),r[l]?(c.enable(),E[l].followInsert?N.renderNew(c,s[l],o[l]):N.updateOld(c,s[l],o[l]),E[l].usertips?c.cubes.length||(W(".cube-nodata").show(),W("#cube-loaded").hide()):W(".cube-nodata").hide()):(W("#cube-loaded").hide(),W(".cube-nodata").hide(),W(".cube-loading-bg").show(),f=E[l].api,f?c.load(f.host+"?"+qboot.encodeURIJson(f.param)):c.load(),r[l]=!0),n=l,LogHub&&LogHub.behavior("cube","tab-click-"+a),qboot.events.fire("cubeflow:switchtab")})}function T(e){W(".follow-link").on("click",function(){M(e)}),W(".follow-guide-know").on("click",function(){M(e)})}function C(e){var t=[],n=[];return e.forEach(function(e,i){t[i]=[],n[i]=[],e.on("follow",function(e){O("follow",e.data),t.forEach(function(t,s){if(!r[s]||i===s)return;for(var o=0,u=t.length;o<u;o++)if(e.id===t[o].id)return;for(var a=0,u=n[s].length;a<u;a++)if(e.id===n[s][a].id){n[s].splice(a,1);return}e.data.follow=1,t.unshift(e)}),W(".cube-nodata").hide(),qboot.events.fire("cube:follow",e)}),e.on("unFollow",function(s){O("unfollow",s.data),n.forEach(function(e,n){if(!r[n]||i===n)return;for(var o=0,u=e.length;o<u;o++)if(s.id===e[o].id)return;for(var a=0,u=t[n].length;a<u;a++)if(s.id===t[n][a].id){t[n].splice(a,1);return}s.data.follow=0,e.unshift(s)}),E[i].unfollowDelete&&e.removeCube(s.data.pos),E[i].usertips&&!e.cubes.length&&(W(".cube-nodata").show(),W("#cube-loaded").hide())})}),{followCubes:t,unfollowCubes:n}}function k(e){function o(){if(r)return;r=!0,setTimeout(function(){r=!1,u()},80)}function u(){var t=e[n];if(t.isLoading())return;if(t.cubes.length&&!i[n]){var r=t.cubes[t.cubes.length-1],s=r.element.getBoundingClientRect(),o=window.innerHeight,u=o-s.bottom;if(u>-660){W(".cube-loading-bg").show();if(E[n].api===undefined)t.load();else{var f=t.load(E[n].api.loadMoreUrl(t));f||E[n].api.param.p--}}}else{var l=".cube-container";a(l)}}function a(e){var n=document.querySelector(e),r=n.parentNode,i=n.getBoundingClientRect(),s=r.getBoundingClientRect(),o=(((t=document.documentElement)||(t=document.body.parentNode))&&typeof t.scrollTop=="number"?t:document.body).scrollTop,u=W("#doc-main").getRect().left+W("#sites-lib-classify").getRect().width-t.scrollLeft,a=window.innerHeight,f,l;i.height+100>a?(f="fixed-bottom",l=s.top+i.height+o-a):(f="fixed-top",l=s.top+o-100),o>l?W(e).addClass(f).css({left:u+"px"}):W(e).removeClass("fixed-bottom").removeClass("fixed-top").css({left:null})}var r=!1,s=!1;e.forEach(function(t,n){t.on("timeout",function(e){W(".cube-loading-bg").hide(),E[n].usertips&&W(".cube-nodata").show(),e&&e.backup&&e.backup.data&&e.backup.data.list&&D.cubeReqDot(e.backup.data.list),e.url&&D.cubeTimeout(e.url)}),t.on("data",function(e){W(".cube-loading-bg").hide(),E[n].loadBackupData&&(e.data=E[n].backup.data,i[n]=!0,(!E[n].usertips||t.cubes.length)&&W("#cube-loaded").show());if(e&&e.errno===0&&e.data){if(e.data.list&&e.data.list.length&&E[n].showfollowtips&&!l.get("cube-alreadyshowtips")&&!s&&!e.data.list[0].follow){var r=e.data.list[0];r.clicktimes=1,s=!0,l.set("cube-alreadyshowtips",!0),LogHub&&LogHub.behavior("cube","followtips-show-"+r.id),m=r.id}h=e.data.uid,p=e.data.uid_type,E[n].usertips&&p!==1&&e.data.list&&e.data.list.length>0&&!d&&(qboot.events.fire("cube:userlogintips"),d=!0),E[n].usertips&&!e.data.list.length?(W(".cube-nodata").show(),W("#cube-loaded").hide()):W(".cube-nodata").hide(),e.data.list&&D.cubeReqDot(e.data.list)}}),t.on("end",function(){i[n]=!0,(!E[n].usertips||t.cubes.length)&&W("#cube-loaded").show()}),t.on("completeShow",function(e){e.data.unread&&(e.data.unread=0,qboot.events.fire("cube:updateunreadnumber",{number:1,ids:[e.id],uid:h,uid_type:p}))}),t.on("show",function(e){var n=W("#cube-mod-"+t.name+"-"+e.id).query(".cube-hd").query(".cube-follow-tips");n.css("animation-play-state","running")}),t.on("hide",function(e){var n=W("#cube-mod-"+t.name+"-"+e.id).query(".cube-hd").query(".cube-follow-tips");n.css("animation-play-state","paused")}),t.on("offlineFindMore",function(t){M(e)}),t.on("mpFindMore",function(t){M(e)}),t.on("feedback",function(e){window.CubeFeedBack&&window.CubeFeedBack({id:e.id,name:e.data.name,where:t.name})})}),W(window).on("scroll",o),W(window).on("resize",o)}function L(e){e.forEach(function(e){e.on("top",function(e){O("top",e.data)}),e.on("unTop",function(e){O("untop",e.data)})})}function A(e){qboot.events.on("cubelist:reload",function(){d=!1,E.forEach(function(e){e.api.resetParams()}),e.forEach(function(e){e.reset()}),r=[],i=[];var t=E[n].api;W(".cube-loading-bg").show(),t?e[n].load(t.host+"?"+qboot.encodeURIJson(t.param)):e[n].load(),r[n]=!0})}function O(e,t){var n=["follow","unfollow","top","untop","sync","onshow"],r="https://user.dhrest.com/mycube/";if(n.indexOf(e)!==-1){var i={};switch(e){case"follow":i={uid:h,uid_type:p,cube_id:t.id,ext:t.ext,content_id:t.content_id,ticket:t.ticket,tmprtp:t.tmprtp,source:t.source,psource:t.psource,rtag:t.rtag,name:t.name,icon:t.icon};break;case"sync":i={q:c("cube_flow"),m:o,g:u,h:a};break;default:i={uid:h,uid_type:p,cube_id:t.id}}qboot.jsonp(r+e,i,function(t){e==="sync"&&(h=c("cube_flow"),p=1)},{jsonp:"callback",threshold:1})}}function M(e){if(!e[n].disable())return;W(".cube-nav-ul").query(".cube-nav-li").removeClass("active"),W(".cube-nav-li[data-id=recommend]").addClass("active"),W(".cube-nodata").hide(),qboot.events.fire("cube:tipshide");if(r[1])e[1].enable();else{var t=E[1].api;t?e[1].load(t.host+"?"+qboot.encodeURIJson(t.param)):e[1].load(),r[1]=!0}n=1;var i=W("#cube-nav").getRect();document.body.scrollTop=document.documentElement.scrollTop=i.top-92,W(".cube-container").removeClass("fixed-bottom").removeClass("fixed-top").css({left:null})}function _(e){e.forEach(function(e){e.on("inserted",function(e){e.element&&e.element.id&&moniter.setId([e.element.id])}),e.on("click",function(e){if(e.params){haoUser&&haoUser.userInfo&&(e.params.sqid=haoUser.userInfo.qid),logPureSender("//s.hao.360.com/wzdh/cc.gif?"+qboot.encodeURIJson(e.params).replace("func=adclk","func=realclk")),e.params.func==="interactiveclk"&&window.moniter&&window.moniter.sendClklog(e.params.c,"",e.cube.element.id);var t=e.cube&&e.cube.data,n=e.params.func;n==="follow"&&m===t.id&&LogHub&&LogHub.behavior("cube","followtips-followclk-"+t.id)}}),e.on("clicktimes",function(t){if(m===t.id)return;if(!t.data.follow){for(var n=0;n<e.cubes.length;n++){var r=e.cubes[n];if(m===r.id){r.data.clicktimes=0;break}}LogHub&&LogHub.behavior("cube","followtips-clickshow-"+t.id),m=t.id}})})}function P(e){window.cubeFlows={getFlows:function(){return e},getActiveFlows:function(){return e[n]},getActiveIdx:function(){return n},getLoadedState:function(){return r},getEndState:function(){return i}}}function H(){var e=[],t=E[n].api;for(var i=0,s=E.length;i<s;i++)e[i]=new CubeSdk.CoolFlow(E[i]);W(".cube-loading-bg").show(),t?e[n].load(t.host+"?"+qboot.encodeURIJson(t.param)):e[n].load(),r[n]=!0,S(e),P(e)}var e=6,n=1,r=[],i=[],s=["follow","expand","dislike","feedback","logo","unfollow"],o=hao360.mid,u=qboot.cookie.get("__guid"),a=qboot.cookie.get("__huid"),f=qboot.cookie.get("__hsid"),l=new AppData("api.hao.360.cn"),c=function(e){return SERVER_DATA.qttk&&SERVER_DATA.qttk[e]?SERVER_DATA.qttk[e]:undefined},h="",p="",d=!1,v={},m="",g=function(e){return hao360.queryUrl(location.search)[e]},y=function(t){return{host:"https://i.dhrest.com/gw/cube/"+t+"/list/v1",param:{p:1,m:o,g:u,h:a,hsid:f,size:e,q:c("cube_flow"),citycode:hao360.cityCode.get(),miniapp_only:hao360.mp360Support?1:0,iever:Browser.ie&&parseInt(Browser.ie,10),call_chain:g("call_chain"),online:g("online")==0?0:undefined},loadMoreUrl:function(e){return this.param.p++,this.host+"?"+qboot.encodeURIJson(this.param)},resetParams:function(){this.param.p=1,this.param.q=c("cube_flow")}}},b=function(){return{host:"https://cubetool.dhrest.com/preview",param:{tk:c("cube_preview"),pkg_ids:g("pkg_ids"),cube_ids:g("cube_ids"),exts:g("cube_ext"),content_ids:g("content_ids"),tmprtps:g("tmprtps"),miniapp_only:hao360.mp360Support?1:0,iever:Browser.ie&&parseInt(Browser.ie,10),online:g("online")==1?1:undefined},loadMoreUrl:function(){return this.host},resetParams:function(){this.param.tk=c("cube_preview")}}},w=(!!g("cube_ids")||!!g("pkg_ids"))&&!g("mid"),E=[{name:"mycube",container:".cube-list-follow",buttons:["unfollow","expand","feedback","logo","top","untop"],api:{host:"https://cube.dhrest.com/listmy",param:{p:1,offset:0,m:o,g:u,h:a,hsid:f,size:e,miniapp_only:hao360.mp360Support?1:0,q:c("cube_flow")},loadMoreUrl:function(e){return this.param.p++,this.param.offset=e.cubes.length,this.host+"?"+qboot.encodeURIJson(this.param)},resetParams:function(){this.param.p=1,this.param.offset=0,this.param.q=c("cube_flow")}},followInsert:!0,unfollowDelete:!0,unreadPoint:!0,usertips:!0,showOffline:!0,showMiniApp:!0,unfollowReplaceDislike:!1},{name:"haocube",size:e,container:".cube-list-recommend",buttons:w?["expand","dislike","feedback","logo"]:s,timeout:5e3,api:w?b():y("cube"),backup:CUBE_BACKUP_DATA,showfollowtips:!0,loadBackupData:!!window.loadDefaultCubeData,showViewedTips:!0},{name:"yulecube",size:e,container:".cube-list-yule",buttons:s,api:y("yulecube"),backup:CUBE_BACKUP_DATA},{name:"zhishicube",size:e,container:".cube-list-zhishi",buttons:s,api:y("zhishicube"),backup:CUBE_BACKUP_DATA},{name:"youxicube",size:e,container:".cube-list-game",buttons:s,api:y("youxicube"),backup:CUBE_BACKUP_DATA},{name:"gushicube",size:e,container:".cube-list-story",buttons:s,api:y("gushicube"),backup:CUBE_BACKUP_DATA}];CubeSdk.init({debug:!!window.DEBUG,appid:"cube",mid:o,guid:u,huid:a,hsid:f,mp360Support:hao360.mp360Support,project:"hao360_shouye_"+hao360.project,u:hao360.channel.lm?"http://hao.360.cn/lianmeng.html":"http://hao.360.cn/tiyan.html",cityCode:hao360.cityCode.get(),monitor:{show:!0,click:!1}});var N={renderNew:function(e,t,n){var r=e.getTopCount();t.forEach(function(t,n){e.insertCube(t.data,r+n)}),t.length=0,n.forEach(function(t){var n=e.indexOf(t.id);n!==-1&&e.removeCube(n)}),n.length=0},updateOld:function(e,t,n){t.forEach(function(t){var n=e.indexOf(t.id);n!==-1&&(e.cubes[n].data.follow=1,e.cubes[n].buttons=["follow","expand","feedback","logo","unfollow"])}),t.length=0,n.forEach(function(t){var n=e.indexOf(t.id);n!==-1&&(e.cubes[n].data.follow=0,e.cubes[n].buttons=["follow","expand","dislike","feedback","logo","unfollow"])}),n.length=0}},D=function(){var e="https://s.hao.360.com/wzdh/cr.gif?",t="https://s.hao.360.com/wzdh/cubeto.gif?",r={guid:qboot.cookie.get("__guid"),huid:qboot.cookie.get("__huid"),mid:hao360.mid},i=function(e){var t=["mid","guid","huid"],n=[1,3,2];for(var r=0;r<t.length;r++)if(e[t[r]])return{uid:e[t[r]],uid_type:n[r]}},s=i(r),o={uid:s.uid,uid_type:s.uid_type,guid:r.guid,hsid:qboot.cookie.get("__hsid"),sqid:"",city:hao360.cityCode.get(),p:"hao360_shouye_"+hao360.project,version:"",u:hao360.channel.lm?"http://hao.360.cn/lianmeng.html":"http://hao.360.cn/tiyan.html"};return{cubeReqDot:function(t){var r=[],i={};for(var s=0;s<t.length;s++)r.push({cube_id:t[s].id,pos:typeof t[s].pos=="number"?t[s].pos+1:-1,ext:t[s].ext,source:t[s].source,psource:t[s].psource,cube_content:t[s].cube_content||"",is_bp:t[s].is_bp,rtag:t[s].rtag||"",content_id:t[s].content_id||"",tmprtp:t[s].tmprtp||"",rc_type:t[s].rc_type||0});i={act:"request",t:+(new Date),sign:t[0]&&t[0].sign||"",contents:JSON.stringify(r),where:E[n].name};var u={};for(var a in o)o.hasOwnProperty(a)&&(u[a]=o[a]);u=qboot.encodeURIJson(qboot.mix(u,i,!0)),logPureSender(e+u)},cubeTimeout:function(e){var n={ua:window.navigator.userAgent,url:e,referer:window.location.href};logPureSender(t+qboot.encodeURIJson(n))}}}();qboot.events.on("cube:sync",function(){O("sync")}),H()})();(function(){function s(){QW.Ajax.get("/qttk?app_ids=cube_flow,cube_preview",function(e){var t=JSON.parse(e);if(t.code===0&&t.data){for(var n in t.data)SERVER_DATA.qttk[n]=t.data[n];qboot.events.fire("cubelist:reload"),u()}})}function o(e){if(e===0){W("#followcube-update-count").hide();return}var t=16,n=-4,r=-8;e>9&&(t=20,n=-8),e>99&&(e="99+",t=26,n=-10);var i=W("#cube-nav .cube-nav-ul .cube-nav-li[data-id=follow]"),s=W("#followcube-update-count");if(s.length)s.html(e).css({width:t+"px",right:n+"px",top:r+"px"});else{var o=['<div id="followcube-update-count">',e,"</div>"].join(""),u="#followcube-update-count{z-index:2;position:absolute;height:16px;line-height:16px;background-color:#F84E44;color:#fff;border-radius:50px;border:1px solid #fff;cursor:pointer;font-size:12px;right:"+n+"px;width:"+t+"px;top:"+r+"px;text-align:center;transform:scale(0.8);-webkit-transform:scale(0.8);-ms-transform:scale(0.8);}";qboot.load.css(u),i.insertAdjacentHTML("beforeend",o)}}function u(){var e={m:hao360.mid,g:qboot.cookie.get("__guid"),h:qboot.cookie.get("__huid"),q:function(){return SERVER_DATA.qttk&&SERVER_DATA.qttk.cube_flow?SERVER_DATA.qttk.cube_flow:undefined}()};qboot.jsonp("https://cube.dhrest.com/unviewcount",e,function(e){e&&e.errno===0&&e.data&&(t=parseInt(e.data.unviewcount,10),t?o(t):W("#followcube-update-count").hide())},{jsonp:"callback",timeout:5e3,threshold:1})}var e=window.haoUser,t=0,n=[],r=!1,i=!1;SERVER_DATA.qttk=SERVER_DATA.qttk||{},W(".cube-tips").delegate(".cube-tips-container span","click",function(t){var n=W(this);switch(n.attr("id")){case"sync-cloud":qboot.events.fire("cube:sync"),W(".cube-tips.cube-login").hide(),r=!0,LogHub&&LogHub.behavior("cube","usersync-click");break;case"sync-giveup":W(".cube-tips.cube-login").hide(),r=!0,LogHub&&LogHub.behavior("cube","usersync-giveup-click");break;case"cube-user-login":e.login(),LogHub&&LogHub.behavior("cube","userlogin-click");break;case"cube-user-register":e.signUp(),LogHub&&LogHub.behavior("cube","userregister-click");break;case"cube-user-know":W(".cube-tips.cube-nologin").hide(),i=!0,LogHub&&LogHub.behavior("cube","userknow-click");break;default:}}),e.on("UserInfo",function(e){e&&(W(".cube-tips.cube-nologin").hide(),JSON.stringify(SERVER_DATA.qttk)==="{}"&&s())}),e.on("Logout",function(){W(".cube-tips.cube-login").hide(),SERVER_DATA.qttk={},qboot.events.fire("cubelist:reload"),u()}),qboot.events.on("cube:userlogintips",function(){if(e.userInfo&&!r){W(".cube-tips.cube-login").show(),LogHub&&LogHub.behavior("cube","usersync-tips-show");return}!e.userInfo&&!i&&(W(".cube-tips.cube-nologin").show(),LogHub&&LogHub.behavior("cube","userlogin-tips-show"))}),qboot.events.on("cube:follow",function(){t===0&&W("#cube-nav .cube-nav-ul .cube-nav-li[data-id=follow]").addClass("red-tips")}),qboot.events.on("cube:updateunreadnumber",function(e){var r=e.number;if(t){var i=t-r;i<0&&(i=0),o(i),t=i}e.ids.forEach(function(e){n.push(e)}),setTimeout(function(){if(n.length){var t={uid:e.uid,uid_type:e.uid_type,cube_ids:n.join(",")},r="https://user.dhrest.com/mycube/onshow?"+qboot.encodeURIJson(t);qboot.jsonp(r,function(){n=[]},{jsonp:"callback",timeout:5e3,threshold:1})}},0)}),qboot.events.on("cube:tipshide",function(){W(".cube-tips.cube-nologin").hide(),W(".cube-tips.cube-login").hide()}),u()})();(function(){function c(e,t){var n;return function(r){clearTimeout(n);var i=this,s=arguments;n=setTimeout(function(){e.apply(i,s)},t)}}function h(e,t){var t=t||30,n;return function(r){n==null&&(e.apply(this,[r]),n=setTimeout(function(){n=null},t))}}function p(e){var t=e.offsetTop;while(e=e.offsetParent)t+=e.offsetTop;return t}function d(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,function(){n.call(e)})}var e=function(){var e="",t="",n={guid:qboot.cookie.get("__guid"),huid:qboot.cookie.get("__huid"),mid:hao360.mid},r=function(e){var t=["mid","guid","huid"],n=[1,3,2];for(var r=0;r<t.length;r++)if(e[t[r]])return{uid:e[t[r]],uid_type:n[r]}},i=r(n),s={uid:i.uid,uid_type:i.uid_type,hsid:qboot.cookie.get("__hsid"),sqid:"",city:hao360.cityCode.get(),u:location.href,p:"hao360_shouye_"+hao360.project,version:window._sitesLibVersion},o=function(e,t){return{sc:t.sc,act:e,logid:t.logid||"",list:t.list,source:t.source,format:"",t:+(new Date),qd:t.qd,pd:t.pd,f:t.f,c:t.c,pos:t.pos,format:"",id:t.id||"",sign:t.sign||"sites-lib"}};return{init:function(n){e=n.logshowUrl,t=n.logclickUrl},sitesDot:function(n,r,i){var u=qboot.encodeURIJson(qboot.mix(s,o(n,r),!0));logPureSender(n==="show"?e+u:t+u),i&&i(r.id)}}}();e.init({logshowUrl:hao360.isHttp()?"http://s.hao.360.com/wzdh/ss.gif?":"https://s.hao.360.com/wzdh/ss.gif?",logclickUrl:hao360.isHttp()?"http://s.hao.360.com/wzdh/sc.gif?":"https://s.hao.360.com/wzdh/sc.gif?"}),window.sitesMonitor=e,moniter.setId(["sites-lib-common","activity","sites-lib-subpage","sites-11-flow","sites-11-pic","sites-lib-flow"]);var t=[],n=[],r=document.getElementById("sites-lib-flow"),i=document.getElementById("sites-lib-list"),s=document.getElementById("sites-lib-common"),o=!1,u=document.getElementById("famous-section"),a=c(function(){if(document.getElementById("hot-site-2020").getBoundingClientRect().top>0&&!o)for(var e=0;e<n.length;e++)logPureSender(window._commonMidLogList[n[e]].pv),o=!0},2e3),f=function(){var t=s.querySelectorAll(".sites-lib-site"),r=document.getElementById("sites-lib-main-common").offsetWidth,i=0,u={};n=[];var f=window.IGUESS_2020;f&&f.totalRecommond&&(t=Array.prototype.slice.call(t,0,t.length-f.totalRecommond));for(var l=0,c=t.length;l<c;l++)i+=t[l].offsetWidth,i<=r&&!t[l].getAttribute("data-log")&&(n.push(t[l].getAttribute("data-id")),t[l].setAttribute("data-log",1));n.length>0&&(u={sc:1,logid:window._commonLogId,list:n.join(","),source:window._commonSource,qd:"",pd:"",city:hao360.cityCode.get()},e.sitesDot("show",u),o=!1,window._commonMidLogList&&(a(),d(window,"scroll",a),d(window,"resize",a)))},l=window.setInterval(function(){window._commonMonitor&&(f(),clearInterval(l))},500);d(s,"click",function(t){if(t.target&&t.target.nodeName.toUpperCase()=="A"){var n=t.target,r=n.parentElement.getAttribute("data-id");e.sitesDot("click",{sc:1,logid:window._commonLogId,pos:n.parentElement.getAttribute("data-pos"),source:window._commonSource,qd:"",pd:"",c:n.innerText,f:n.getAttribute("href"),city:hao360.cityCode.get(),id:r}),window._commonMidLogList&&logPureSender(window._commonMidLogList[r].clk)}}),d(u,"click",function(t){if(t.target&&t.target.parentNode.nodeName.toUpperCase()=="A"){var n=t.target;e.sitesDot("click",{sc:3,logid:"",sign:"sites-op",pos:n.parentNode.getAttribute("data-pos"),source:"",qd:"",pd:"",c:n.innerText,f:n.parentNode.getAttribute("href"),city:hao360.cityCode.get(),id:""})}}),d(i,"click",function(t){if(t.target&&t.target.nodeName.toUpperCase()=="A"){var n=t.target;e.sitesDot("click",{sc:4,logid:"",sign:"sites-op",pos:0,source:"",qd:"",pd:"",c:n.innerText,f:n.getAttribute("href"),city:hao360.cityCode.get(),id:""})}}),window.setTimeout(function(){d(window,"resize",f)},0)})();(function(){function e(e,t){this.pubbleEle=W(e),this.parentNode=this.pubbleEle.parentNode(),this.conf=t||{},this.data=this._setData(),this.cssLoaded=!1,this._init()}e.prototype._init=function(){if(this.data.text.length<4)return;this._render(),this._animate()},e.prototype._setData=function(){var e=this.pubbleEle[0].innerText.split("").slice(0,4),t=this.pubbleEle[0].getAttribute("href"),n=this.pubbleEle[0].getAttribute("left-pos")||this.parentNode[0].clientWidth+8;return{text:e||"",url:t||"javascript:void(0);",left:n||0}},e.prototype._render=function(){this.cssLoaded||(qboot.load.css(this._cssStyle(),"pubble-shape-style"),this.cssLoaded=!0),W(this._htmlTpl().tmpl(this.data)).appendTo(this.parentNode),this.pubbleEle.removeNode()},e.prototype._animate=function(){var e=this.parentNode.query(".pubble-shape-wrap"),t=e.query(".white-red-font1"),n=e.query(".white-red-font2"),r=e.query(".white-red-font3"),i=e.query(".white-red-font4"),s=e.query(".red-white-font1"),o=e.query(".red-white-font2"),u=e.query(".red-white-font3"),a=e.query(".red-white-font4"),f=14,l=14,c=80,h=function(){var e=0,r=function(){e<f?(e+=1,t.css({width:e+"px"}),n.css({width:f-e+"px",left:f+e+"px",textIndent:-e+"px"}),setTimeout(r,c)):p()};t.css({height:l+"px",width:0}),u.css({height:l+"px",width:0}),r()},p=function(){var e=0,t=function(){e<l?(e+=1,a.css({height:e+"px"}),n.css({height:e+"px"}),setTimeout(t,c)):d()};n.css({width:f+"px",height:0,left:f+"px",textIndent:0}),t()},d=function(){var e=0,t=function(){e<f?(e+=1,a.css({width:f-e+"px"}),u.css({width:e+"px",left:f-e+"px",textIndent:e-f+"px"}),setTimeout(t,c)):v()};t()},v=function(){var e=0,n=function(){e<l?(e+=1,u.css({height:l-e+"px"}),t.css({height:l-e+"px"}),setTimeout(n,c)):h()};r.css({width:f+"px"}),a.css({width:f+"px",height:0}),n()};setTimeout(function(){h()},1e3)},e.prototype._htmlTpl=function(){return'<div class="pubble-shape-wrap" style="left:{$left}px"><a class="cont" href="{$url}" target="_blank"><b class="font red-white-font red-white-font1">{$text[0]}</b><b class="font red-white-font red-white-font2">{$text[1]}</b><b class="font white-red-font white-red-font3">{$text[2]}</b><b class="font white-red-font white-red-font4">{$text[3]}</b><b class="font white-red-font white-red-font1">{$text[0]}</b><b class="font white-red-font white-red-font2">{$text[1]}</b><b class="font red-white-font red-white-font3">{$text[2]}</b><b class="font red-white-font red-white-font4">{$text[3]}</b></a></div>'},e.prototype._cssStyle=function(){return[".pubble-shape-wrap {width: 28px; height: 28px; padding: 1px 0 1px 2px; border: 1px solid #ff9b1b; background-color: #fff; -moz-border-radius: 2px; -webkit-border-radius: 2px; border-radius: 2px; position: absolute; left: 78px; top: 2px; z-index: 2;}",'.pubble-shape-wrap::before, .pubble-shape-wrap::after {display: block; content: ""; position: absolute; top: 50%; margin-top: -6px; width: 0; height: 0; border-width: 6px; border-style: dashed solid dashed dashed; border-color: transparent #fff transparent transparent;}',".pubble-shape-wrap::before { left: -12px; border-color: transparent #ff9b1b transparent transparent; }",".pubble-shape-wrap::after { left: -11px; border-color: transparent #fff transparent transparent; }",".pubble-shape-wrap .cont { display: block; width: 28px; height: 28px; font-size: 12px; line-height: 14px; white-space: nowrap; position: relative; }",".pubble-shape-wrap .font {position: absolute; width: 50%; height: 14px; overflow: hidden; font-weight: normal;}",".pubble-shape-wrap .red-white-font {color: #fff; background: #ee3300;}",".pubble-shape-wrap .white-red-font {color: #ee3300; background: #fff;}",".pubble-shape-wrap .red-white-font1 {top: 0; left: 0;}",".pubble-shape-wrap .red-white-font2 {top: 0; left: 50%;}",".pubble-shape-wrap .red-white-font3 {width: 0; top: 50%; left: 50%;}",".pubble-shape-wrap .red-white-font4 {height: 0; top: 50%; left: 50%;}",".pubble-shape-wrap .white-red-font1 {width: 0; left: 0; top: 0; }",".pubble-shape-wrap .white-red-font2 {left: 50%; top: 0; }",".pubble-shape-wrap .white-red-font3 {left: 0; top: 50%; }",".pubble-shape-wrap .white-red-font4 {left: 50%; top: 50%; }"].join("")},QW.NodeW.pluginHelper({sitesPubble:function(t,n){if(Dom.isElement(t)){var r=W(t).query(".sites-pubble-anim"),i={};for(var s=0;s<r.length;s++){var o=r[s];new e(o,qboot.mix({},i,n))}}}},"opreator")})();(function(){function e(){var e=document.getElementById("sites-lib-subpage"),t=e.querySelectorAll(".sites-lib-title");for(var n=0;n<t.length;n++){var r=t[n].querySelector(".sites-lib-site-text span").innerText||"",i=hao360.md5(r).substring(8,24);t[n].setAttribute("class-id",i)}}try{W("#sites-lib-flow").sitesPubble()}catch(t){alert(t)}e()})();(function(){function e(){this.init()}e.prototype.TYPE_ITEM_NUM=1,e.prototype.init=function(){function t(){if(window.IGUESS_2020.renderStatus===!1)return;window.IGUESS_2020.renderStatus===undefined?setTimeout(t,500):(e.SITES_ITEM_NUM=window.IGUESS_2020.totalRender||0,e.sendshowLog(),e.bindEvt())}var e=this;this.logType={click:2,show:4},this.iguessWrap=W("#iguess-container-2020"),this.iguessSite=W("#famous-section"),t()},e.prototype.sendshowLog=function(e){var t=window.IGUESS_2020.guess,n=[];for(var r=0;r<this.TYPE_ITEM_NUM;r++){var i=t[r];if(i.asin&&i.asin.length>0)for(var s=0;s<i.asin.length;s++)logPureSender(i.asin[s]);var o=i.sites,u=i.type_item&&i.type_item.id;for(var a=0;a<this.SITES_ITEM_NUM;a++){var f="";o[a].aid?f=[u,o[a].aid,2].join("_"):f=[u,o[a].id,1].join("_"),n.push(f)}}n.length>0&&this.sendNormalLog(this.logType.show,n)},e.prototype.sendNormalLog=function(e,t){var n=this.iguessWrap.attr("data-trackhost"),r={jzqchl:2,bidid:this.iguessWrap.attr("data-bidid"),mid:hao360.mid,type:e,p:Object.isArray(t)?t.join(","):t};if(!r.p)return;var i=[];for(var s in r)i.push(s+"="+encodeURIComponent(r[s]));var o=n+(n.indexOf("?")>-1?"&":"?")+i.join("&");logPureSender(o)},e.prototype.bindEvt=function(){var e=this;this.iguessWrap.delegate("a","click",function(t){var n=e.link4Log(t.target);e.sendNormalLog(e.logType.click,n);var r=W(t.target).attr("clk");r&&(hao360.isHttps()&&(r=r.replace(/^http:/ig,"https:")),logPureSender(r))}),this.iguessSite.delegate("a","click",function(t){if(!e.checkOpsId(W(t.target).attr("id")))return;var n=e.link4Log(t.target);e.sendNormalLog(e.logType.click,n);var r=W(t.target).attr("clk");r&&(hao360.isHttps()&&(r=r.replace(/^http:/ig,"https:")),logPureSender(r))})},e.prototype.link4Log=function(e){var t=this.iguessWrap.attr("data-type"),n=W(e).attr("siteid"),r=W(e).attr("aid");return r?[t,r,2].join("_"):[t,n,1].join("_")},e.prototype.checkOpsId=function(e){for(var t=0;t<window.IGUESS_2020.opsIds.length;t++){var n=window.IGUESS_2020.opsIds[t];if(n===e)return!0}return!1};var t=new e})();(function(){var e=W("#sites-lib-classify"),t=W("#mysite-section"),n=".sites-lib-flow-title";e.delegate(n,"click",function(){var t=W(this),n=t.attr("id").split("-")[0];if(e.hasClass(n))return;n==="mysite"&&((new AppData("api.hao.360.cn")).set("mysite-active",!0),t.addClass("active"));var r=["classify","mysite","eleven"],i="";r.every(function(t){return e.hasClass(t)?(i=t,!1):!0}),e.toggleClass(i,n)}),t.delegate("#mysite-section-btn-more","click",function(){t.toggleClass("open")})})();(function(){var e='<div>            <span>{tag}</span>            <a href="{url}">{title}</a>        </div>',t=function(){var e={};return function(t,n){e[t]||(e[t]=!0,n(t))}}(),n={tpl:e,dataAdapter:function(e){var t=[];for(var n=0;n<e.length;n++){var r=e[n];t.push({title:r.t,url:r.pcurl,tag:r.attr&&r.attr[0]&&r.attr[0].content})}return t},getHTML:function(e,t){var n=[];for(var r=0;r<t.length;r++)n.push(R.tmpl(e,t[r]));return n.join("")},init:function(e){var n=e.tpl||this.tpl,r=W(e.container),i=this.dataAdapter(e.data),s=this.getHTML(n,i);t(e.container,function(){qboot.load.css(e.css)}),r.html(s)}};window.govNewsIsOn["infoflow-right"]&&qboot.events.on("infoflow-right-gov-news",function(e){n.init({container:".infoflow-right-gov-news",css:".infoflow-right-gov-news{font-size:16px;border-bottom:solid 1px #f2f2f2;margin-top: 12px;}            .infoflow-right-gov-news div{height:24px;line-height: 24px;overflow:hidden;margin-bottom: 12px;}            .infoflow-right-gov-news span{color:#cc0000;padding-right:6px;margin-right: 3px;border-right:solid 1px #404040}",data:e.data})})})();var infoflowApp=function(){var e=function(e,t){switch(arguments.length){case 1:return e;case 2:return Math.floor(Math.random()*(t-e+1)+e,10);default:return 0}},t=function(t){return t<3?"\u521a\u521a":e((t-3)*3+3,(t-3)*3+5)+"\u5206\u949f\u524d"},n=function(e){var t=parseInt(e)||0,n=parseInt(t/60),r=t%60;return n=n<10?"0"+n:n,r=r<10?"0"+r:r,n+":"+r},r=function(e,t,n){var r=W("#infoflow-list"),e=typeof e=="number"?e:2,t=t||4,i=0,s=0,o=n?r.query(".infoflow-item").length+r.query(".bigimg-ad").length:0;return function(n,r,u){if(!u.length)return r;var a=n.INTERVAL_MODE,f=n.INTERVAL;t=f[a];var l=W("#infoflow-list").query(".infoflow-item:last-child").getRect();l&&l.left<20&&s++;var c=3,h={1:1,3:2},p=r.length,d=[],v=[],m=null;if(p>=e){e>0&&(m=u.shift(),m.type===c&&(e++,t=4,a=1),o+=h[m.type]+e,d=r.slice(0,e),d.push(m)),v=r.slice(e,p);var g=v.length,y,b=0,w=!1;for(var E=0;E<g;E++){i++,o++;if(!u.length){o+=g-(E+1);break}if(w||i%t==0){if(o%2!==0&&u[0].type===c&&!w){w=!0;continue}w=!1,u.length>0&&(m=u.shift(),b++,y=E+b,v.splice(y,0,m),s+=h[m.type],o+=h[m.type]),m.type===c?(t=4,a=1):(a=++a%f.length,t=f[a]),i=0}}var S=function(e){return e.clktk&&e.imptk};e=0;var x=d.concat(v);while(o%2!==0){var T=x.pop();o-=S(T)&&T.type===c?2:1,i>0&&i--}return{data:x,interval_mode:a}}return r}},i=function(e){return function(t){if(e){var n=e.apply(this,[t]);return e=null,n}}},s=function(e,t){var t=t||500,n;return function(r){n==null&&(e.apply(this,[r]),n=setTimeout(function(){n=null},t))}},o=function(e,t){var n,r,i,s,o;return e.indexOf("qhimg.com")<0&&e.indexOf("qhimgs4.com")<0&&e.indexOf("qhimgs.com")<0&&e.indexOf("qhmsg.com")<0?e:(t&&(s=t.split("-")[0]+"_"+t.split("-")[1]+"_",o=e.match(/^((http|https):\/\/.+?)(\/.+)*(\/.+)$/),o&&o.length>0&&(n=[o[1],"/","dmfd","/",s,o[4]].join(""))),n?n:e)},u=function(e){var t=Math.floor(e/864e5);if(t>0)return t+"\u5929\u524d";var n=Math.floor(e%864e5/36e5);if(n>0)return n+"\u5c0f\u65f6\u524d";var r=Math.floor(e%864e5%36e5/6e4);return r>0?r+"\u5206\u949f\u524d":"\u521a\u521a"},a=function(e,t){return W(e).getRect().top-(Dom.getDocRect().scrollY+Dom.getDocRect().height)<parseInt(t)},f=function(e){var t=Dom.getDocRect().height-91+e.getRect().height;return a(W(e),0)&&!a(W(e),-t)},l=function(e){if(!e)return e;var t=function(e){return e.clktk&&e.imptk},n=3,r=0;for(var i=0,s=e.length;i<s;i++)r+=t(e[i])&&e[i].type===n?2:1;while(r%2!==0||t(e[e.length-1])){var o=e.pop();r-=t(o)&&o.type===n?2:1}return e};return{once:i,throttle:s,getDur:n,combinData:r,randomNum:e,generateRdmTime:t,isVisualArea:f,intoVisualArea:a,convertTime:u,clipImage:o,uid:qboot.cookie.get("__guid")||qboot.cookie.get("__huid"),protocol:hao360.isHttp()?"http":"https",infoflowGuess:{monitorStore:{},commonParams:{}},infoflowFt:{monitorStore:{},commonParams:{}},infoflowRight:{monitorStore:{},commonParams:{}},topRefreshFilter:l}}();var logStorage={check:function(e,t){return!e||!t||!infoflowApp[e]||!infoflowApp[e].monitorStore||!infoflowApp[e].monitorStore[t]},get:function(e){var t=e.position,n=e.dataKey,r=this.check(t,n);return r?"":infoflowApp[t].monitorStore[n]},set:function(e,t){var n=e.position,r=e.dataKey,i=this.check(n,r);if(i)return"";for(var s in t)infoflowApp[n].monitorStore[r][s]=t[s]}};var RealshowMonitor=function(e){this.init(e)};RealshowMonitor.prototype.varructor=RealshowMonitor,RealshowMonitor.prototype.defaultOptions={},RealshowMonitor.prototype.init=function(e){qboot.createEvents(this),this.options=qboot.mix(e||{},this.defaultOptions),this.position=this.options.position,this.$wrap=W(this.options.wrap),this.$secondLevelWrap=W(this.options.secondLevelWrap),this.selector=this.options.selector,this.realshowTime=this.options.realshowTime,this.packNum=this.options.packNum||10,this.logUrl=this.options.logUrl,this.filterHandle=this.options.filterHandle,this.logBaseParams=this.options.logBaseParams,this.keyList=[],this.logList=[],this.lastData=[],this.transTimer=null,this.checkTimer=null,this.pause=!1,this.hasRun=!1},RealshowMonitor.prototype.pauseHandle=function(){this.pause=!0,this.hasRun=!1,clearTimeout(this.transTimer),clearTimeout(this.checkTimer)},RealshowMonitor.prototype.runHandle=function(){this.pause=!1,this.hasRun=!0,this.intervalLookup(),this.intervalTrans()},RealshowMonitor.prototype.listen=function(){var e=this,t=function(){if(infoflowApp.isVisualArea(e.$wrap)){if(e.hasRun)return;e.runHandle()}else{if(e.pause)return;e.pauseHandle()}};QW.W(window).on("scroll",t),t()},RealshowMonitor.prototype.intervalLookup=function(){var e=this;this.checkTimer=setInterval(function(){if(!infoflowApp[e.position].commonParams.isRealshow)return;if(e.pause)return;var t=e.lookupEls(),n=e.getArrDiff(e.lastData,t);n.forEach(function(t){e.collectKey(W(t),"isReset")}),e.lastData=t,e.setTimeStamp(t)},100)},RealshowMonitor.prototype.intervalTrans=function(){var e=this;this.transTimer=setTimeout(function(){if(!infoflowApp[e.position].commonParams.isRealshow)return;e.timingTrans();if(e.pause)return;e.intervalTrans()},999)},RealshowMonitor.prototype.lookupEls=function(){var e=this.getSelectorEls();return e.toArray().filter(this.filterHandle)},RealshowMonitor.prototype.getSelectorEls=function(){return this.$wrap.query(this.selector)},RealshowMonitor.prototype.getArrDiff=function(e,t){return e.filter(function(e){return t.indexOf(e)<0})},RealshowMonitor.prototype.setTimeStamp=function(e){var t=this;e.forEach(function(e,n){var r=W(e),i=r.getAttr("data-key")||r.getAttr("data-gid");if(i){var s=infoflowApp[t.position].monitorStore[i].realtime,o=s.sTime,u=s.eTime,a=o?"eTime":"sTime";t.collectKey(r),t.setTime(i,a)}})},RealshowMonitor.prototype.alreadySend=function(e){infoflowApp[this.position].monitorStore[e].isSendout=1},RealshowMonitor.prototype.setTime=function(e,t){var n=(new Date).getTime();infoflowApp[this.position].monitorStore[e].realtime[t]=n},RealshowMonitor.prototype.resetTime=function(e){infoflowApp[this.position].monitorStore[e].realtime.sTime=0,infoflowApp[this.position].monitorStore[e].realtime.eTime=0},RealshowMonitor.prototype.collectKey=function(e,t){var n=e.getAttr("data-key")||e.getAttr("data-gid");if(n){var r=infoflowApp[this.position].monitorStore[n],i=r.log,s=r.realtime,o=s.sTime,u=s.eTime,a=u-o;if(a>=this.realshowTime&&!r.isSendout){this.keyList.push(n);if(Object.isArray(i))for(var f=0,l=i.length;f<l;f++)this.logList.push([i[f].gnid,i[f].a||"",i[f].c||"",i[f].source||"",i[f].s||"",i[f].style||"",a,i[f].sid||"",i[f].position,i[f].cube_id]);else this.logList.push([i.gnid,i.a||"",i.c||"",i.source||"",i.s||"",i.style||"",a,i.sid||"",i.position,""]);this.alreadySend(n)}t==="isReset"&&this.resetTime(n)}},RealshowMonitor.prototype.getUrlParams=function(){var e=infoflowApp[this.position].commonParams,t={uid:e.uid,sign:e.sign,channel:e.channel||this.logBaseParams.channel},n=qboot.mix(t||{},this.logBaseParams);return{logBaseParams:n}},RealshowMonitor.prototype.timingTrans=function(){if(!this.logList.length)return;var e=this.getUrlParams(),t=e.logBaseParams;t.url_pack=JSON.stringify(this.logList.splice(0,this.packNum));var n=this.logUrl+ObjectH.encodeURIJson(t);logPureSender(n)};var mvApp=function(){function e(e,t){this.$container=W(e),this.options=t,this.bindAttrSelector=this.options.bindAttrSelector,this.selector=this.options.selector,this.queryKey=this.options.queryKey,this.logSource=this.options.logSource,this.position=this.options.position,this.evTime={__EVENT_TIME_START__:0,__EVENT_TIME_END__:0},this.offSet={x:0,y:0},this.adspace={w:0,h:0},this.dislike={__DISLIKE_RULE_ID__:2,__DISLIKE_TAG__:"\u4e0d\u611f\u5174\u8da3"}}function t(){}function n(t,n){e.call(this,t,n)}e.prototype.updateSt=function(){this.evTime.__EVENT_TIME_START__=(new Date).getTime()},e.prototype.updateEt=function(){this.evTime.__EVENT_TIME_END__=(new Date).getTime()},e.prototype.getXY=function(e,t){try{var n=e.pageX-t.getRect().left-t.paddingWidth()[3],r=e.pageY-t.getRect().top-t.paddingWidth()[0];this.offSet={x:parseInt(n<0?0:n),y:parseInt(r<0?0:r)}}catch(i){}},e.prototype.getAdspace=function(e){var t=e.getRect().width,n=e.getRect().height;this.adspace={w:t,h:n}},e.prototype.registerPlugins=function(e){var t=this;e.forEach(function(e){e.action(t)})},t.prototype=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.prototype.replaceEvent=function(e){var t=this.evTime.__EVENT_TIME_START__,n=this.evTime.__EVENT_TIME_END__,r=this.offSet.x,i=this.offSet.y,s=this.adspace.w,o=this.adspace.h;return e.replace(/__EVENT_TIME_START__/g,t).replace(/__EVENT_TIME_END__/g,n).replace(/__OFFSET_X__/g,r).replace(/__OFFSET_Y__/g,i).replace(/__ADSPACE_W__/g,s).replace(/__ADSPACE_H__/g,o)},n.prototype.replaceDislike=function(e){var t=this.dislike.__DISLIKE_RULE_ID__,n=this.dislike.__DISLIKE_TAG__;return e.replace(/__DISLIKE_RULE_ID__/g,t).replace(/__DISLIKE_TAG__/g,encodeURIComponent(n))};var r={action:function(e){e.$container.delegate(e.selector,"mousedown",function(t){var n=W(this).parentNode(".js-mv-infoflow-item");e.getAdspace(n),e.getXY(t,n),e.updateSt()}),e.$container.delegate(e.selector,"mouseup",function(t){e.updateEt()})}},i={sendMonitor:function(e,t){infoflowApp[t.position].monitorStore[e].log.clktk.forEach(function(e,n){var r=t.replaceEvent(e);logPureSender(r)})},action:function(e){var t=this;e.$container.delegate(e.selector,"click",function(){var n=W(this),r=n.parentNode(e.bindAttrSelector),i=r.getAttr(e.queryKey),s=n.getAttr("href");t.sendMonitor(i,e);var o=e.replaceEvent(s);n.setAttr("href",o),setTimeout(function(){n.setAttr("href",s)},0)})}},s={sendMonitor:function(e,t){infoflowApp[t.position].monitorStore[e].log.clstk!==undefined&&infoflowApp[t.position].monitorStore[e].log.clstk.forEach(function(e,n){var r=t.replaceDislike(e);logPureSender(r)})},action:function(e){var t=this;e.$container.delegate(e.selector,"click",function(){var n=W(this).getAttr(e.queryKey);t.sendMonitor(n,e)})}};return{Monitor:n,replaceEvPlugin:r,clkMonitorPlugin:i,dislikeMonitorPlugin:s}}();(function(e){var t=function(){var t={moniterElIds:["infoflow-right-nav-ul"]},n=function(e,t,n,r){var i="";try{var s=infoflowFtStorage.infoFlow[e].logMap[t],o={};if(!Object.isArray(s))o=s;else for(var u=0,a=s.length;u<a;u++){var f=s[u],l=n?n:t;if(f[l]){o=f[l];break}}o.ts=+(new Date),o.act=r,i=qboot.encodeURIJson(o)}catch(c){}return i},r=function(e,t,n){var r="",n=n||{};try{var i=infoflowFtStorage.infoFlow[e].logMap[t];qboot.mix(n,i),r=qboot.encodeURIJson(n)}catch(s){}return r};return{init:function(e){t=qboot.mix(t,e,!0)},haoClick:function(e){for(var n=0,r=e.length;n<r;n++){var i="infoflow-right-"+e[n].cid+"-wrap";t.moniterElIds.push(i)}window.moniter&&moniter.setId(t.moniterElIds)},infoflowItemClick:function(e){var r=e.data.dataGid,i=e.data.dataSubGid,s=e.data.useLogV2,o=infoflowFtStorage.cid.currentCid,u=n(o,r,i,"click"),a=e.data.tagName==="img"?"image":"text",f=hao360.queryUrl(u);u&&(f.ext=f.ext?f.ext+"|"+a:a,u=(s==="1"?t.logUrlV3:t.logUrl)+qboot.encodeURIJson(f),logSender(u),LogHub.behavior("360kuai-detail","infoflow-right-youlike-wrap:"+f.s))},mvView:function(){var n=W(t.infoFlow).query(".js-mv-infoflow-item"),r=e.infoflowFt.monitorStore;if(n.length){var i=n.filter(function(e,t){return W(e).getAttr("log-already")==="0"});i.forEach(function(t,n){var i=W(t);if(i.isVisible()&&e.intoVisualArea(i,0)){var s=i.getAttr("data-gid");r[s]&&r[s].log.imptk&&(r[s].log.imptk.forEach(function(e,t){logPureSender(e)}),W(t).setAttr("log-already","1"))}})}},infoflowDislike:function(e){var n=e.data.dataGid,i=infoflowFtStorage.cid.currentCid,s={func:"dislike",version:"2.0",net:4,stype:"portal",t:(new Date).getTime(),act:"click"},o=t.logUrlV2+r(i,n,s);logSender(o)},infoflowComment:function(e){var n=e.data.dataGid,i=infoflowFtStorage.cid.currentCid,s={ext:"comment",act:"click",t:(new Date).getTime()},o=t.logUrl+r(i,n,s);logSender(o)},infoflowSource:function(e){var n=e.data.dataGid,r=infoflowFtStorage.cid.currentCid,i=infoflowFtStorage.infoFlow[r].logMap[n],s={};if(!Object.isArray(i))s=i;else for(var o=0,u=i.length;o<u;o++){var a=i[o];if(a[n]){s=a[n];break}}var f={uid:s.uid||"",sign:s.sign||"",device:s.device||"",net:s.net||"",t:(new Date).getTime(),act:"click",func:"zmt_click",url:e.data.url,where:e.data.where||"list",gnid:s.gnid||"",ext:s.ext||"",hsid:s.hsid||""},l=t.logUrlV3+qboot.encodeURIJson(f);logSender(l)},moreFollowedAuth:function(e){var n=e.data.dataGid,r=infoflowFtStorage.cid.currentCid,i=infoflowFtStorage.infoFlow[r].logMap[n],s={uid:i.uid||"",sign:i.sign||"",device:i.device||"",net:i.net||"",t:(new Date).getTime(),act:"click",func:e.data.func,url:e.data.url,gnid:i.gnid||"",ext:i.ext||"",hsid:i.hsid||""},o=t.logUrlV3+qboot.encodeURIJson(s);logSender(o)},infoflowExtClick:function(n){var r={uid:hao360.mid||e.uid,sign:"360_36e79513",device:"2",net:"5",t:(new Date).getTime(),act:"click",func:n.data.clicktype,hsid:qboot.cookie.get("__hsid")||""},i=t.logUrlV4+qboot.encodeURIJson(r);logSender(i)},infoflowFirstScreenTimeout:function(n){var r=n.ext,i={uid:hao360.mid||e.uid,startTime:r.startTime,endTime:r.endTime,hsid:qboot.cookie.get("__hsid")||""},s=t.logUrlV5+qboot.encodeURIJson(i);logPureSender(s)}}}();t.init({infoFlow:"#info-flow",targetId:"info-flow-wrap",logUrl:e.protocol+"://papi.look.360.cn/srv/c?",logUrlV2:e.protocol+"://api.look.360.cn/srv/c2?",logUrlV3:e.protocol+"://papi.look.360.cn/srv/c2?",logUrlV4:e.protocol+"://res.qhupdate.com/360reader/click.gif?",logUrlV5:e.protocol+"://news.qhstatic.com/srv/stat?"}),e.infoflowFt.monitor=t})(infoflowApp);(function(){var e=function(){var e=infoflowApp.protocol+"://news.qhstatic.com/srv/c2?",t={version:"1.0",device:2,sdkv:2,market:"pc_def",net:5,stype:"portal",t:(new Date).getTime(),channel:"youlike",sqid:"",act:"real_show",scene:1,sub_scene:1,refer_scene:0,refer_subscene:0,func:"pc_news_realshow",where:"list"};return{init:function(){this.listen()},listen:function(){var e=this;qboot.events.on("hotcard:switch:realshow:monitor",function(t){e.realShow(t.toView,t.toIndex)})},realShow:function(e,t){var n=this,r=W(e),i=null,s=r.parentNode(".js-feed").attr("data-gid");if(!n.isTargetVisible(r)||r.getAttr("sub-log-already")=="1")return;i=setTimeout(function(){if(!n.isTargetVisible(r)||r.getAttr("sub-log-already")=="1")return;var e=n.getStoreMonitor(s),o=e[t],u=[];for(var a=0,f=o.length;a<f;a++){if(r.query(".slide-item-pic").item(a).hasClass("hot-toutiao__piclinkad"))continue;u.push([o[a].gnid,o[a].a||"",o[a].c||"",o[a].source||"",o[a].s||"",o[a].style||"","2000",o[a].sid||"",o[a].position])}n.sendLog(u),r.attr("sub-log-already","1"),clearTimeout(i)},2e3)},isTargetVisible:function(e){var t=Dom.getDocRect(),n={top:t.scrollY,left:t.scrollX,bottom:t.scrollY+t.height,right:t.scrollX+t.width},r=e.getRect();return Dom.rectContains(n,r)},getStoreMonitor:function(e){return infoflowApp&&infoflowApp.infoflowRight&&infoflowApp.infoflowRight.monitorStore&&infoflowApp.infoflowRight.monitorStore[e]&&infoflowApp.infoflowRight.monitorStore[e].all_log},getUrlParams:function(){var e={};if(infoflowApp&&infoflowApp.infoflowRight&&infoflowApp.infoflowRight.commonParams){var n=infoflowApp.infoflowRight.commonParams;e={uid:n.uid,sid:n.sid,sign:n.sign,channel:n.channel||this.logBaseParams.channel}}return qboot.mix(e,t)},sendLog:function(t){var n=this.getUrlParams(),r=qboot.mix(n,{url_pack:JSON.stringify(t)}),i=e+ObjectH.encodeURIJson(r);logPureSender(i)}}}();e.init()})();function defaultNavData(){var e=[{cid:"follow",cname:"\u5173\u6ce8",href:"###"},{"default":!0,cid:"youlike",cname:"\u70ed\u70b9",href:"###"},{cid:"fun_pc",cname:"\u5a31\u4e50",href:"https://yule.360.com/"},{cid:"game_pc",cname:"\u6e38\u620f",href:"https://news.g.360.cn/"},{cid:"militery",cname:"\u519b\u4e8b",href:"https://junshi.hao.360.cn/#cid=militery"},{cid:"sport_pc",cname:"\u4f53\u80b2",href:"https://sports.hao.360.cn/#cid=sport"},{cid:"car",cname:"\u6c7d\u8f66",href:"https://qiche.hao.360.cn/#cid=car"},{cid:"economy",cname:"\u8d22\u7ecf",href:"https://licai.360.cn/"},{cid:"video",cname:"\u751f\u6d3b",href:"https://shenghuo.hao.360.cn/#cid=healthcare"},{cid:"estate",cname:"\u623f\u4ea7",href:"https://fangchan.hao.360.cn/#cid=estate?from=infoflow"}];return{data:e}}var Model=function(e){this.init(e)};Model.prototype.constructor=Model,Model.prototype.defaultConfig={mvHostConfig:{http:"http://show.g.mediav.com/s?type=1&of=4&newf=1&scheme=http&",https:"https://show-g.mediav.com/s?type=1&of=4&newf=1&scheme=https&"},addFollowHostConfig:{host:"://user.360kuai.com/following/add?",timeout:5e3,loadStatus:!1},infoFlowHostConfig:{host:"://papi.look.360.cn/mlist?",timeout:3e3,page:1},followHostConfig:{host:"://user.360kuai.com/following/getFollowList?",timeout:1e4,page:1,num:10},followZmtListHostConfig:{host:"://www.360kuai.com/user/following/zmtList?",timeout:1e4},subMediaConfig:{fun_pc:{config:{http:"http://yule.dhrest.com/feeds/getListAll?",https:"https://yule.dhrest.com/feeds/getListAll?",params:{size:10,pn:1,from:"nav_right",fmt:"jsonp"},handler:{isSuccess:function(e,t){return t&&t.errno===0&&t.data.list?(e.pn++,t.data.list):!1}}}},game_pc:{config:{http:"http://groot.hao.360.cn/api/nav/feeds?",https:"https://groot.hao.360.cn/api/nav/feeds?",params:{project_id:2,page:1,per_page:10,from:"nav_right",fmt:"jsonp"},handler:{isSuccess:function(e,t){return t&&t.errno===0&&t.data.article_data?(e.page++,t.data.article_data):!1}}}},edu:{config:{http:"http://groot.hao.360.cn/api/nav/feeds?",https:"https://groot.hao.360.cn/api/nav/feeds?",params:{project_id:1,page:1,per_page:10,from:"nav_right",fmt:"jsonp"},handler:{isSuccess:function(e,t){return t&&t.errno===0&&t.data.article_data?(e.page++,t.data.article_data):!1}}}}},defaultNavData:defaultNavData()},Model.prototype.init=function(e){qboot.createEvents(this),this.options=qboot.mix(this.defaultConfig,e,!0),this.httpType=this.options.httpType,this.addFollowHostConfig=this.options.addFollowHostConfig,this.followHostConfig=this.options.followHostConfig,this.followZmtListHostConfig=this.options.followZmtListHostConfig,this.mvHostConfig=this.options.mvHostConfig,this.infoFlowHostConfig=this.options.infoFlowHostConfig,this.subMediaConfig=this.options.subMediaConfig,this.defaultNavData=this.options.defaultNavData,this.storageMvData=this.options.storageMvData,this.initStorageData();if(window.INFO_FLOW_MULTI_DATA&&window.INFO_FLOW_MULTI_DATA.data&&window.INFO_FLOW_MULTI_DATA.data.res){var t=window.INFO_FLOW_MULTI_DATA,n={currentCid:"youlike",insertType:"beforeend",queryKey:"loadInfoFlowData"};window.INFO_FLOW_MULTI_DATA=this.infoFlowLookFormateData(t.data.res,n)}this.status={yuleInsertMv:!1,infoflowRendered:!1,firstRender:!0,infoflowFstScreenData:0,firstPreLoadMv:!0}},Model.prototype.timeoutHandle=function(e){var t=this,n=!1,r=+(new Date);e.on("resourceTimeoutLoaded",function(e){var r=e.data;n||(t.fire("model:infoflowFirstScreenTimeout",{ext:r}),n=!0,clearTimeout(t.timeoutTimer))}),t.timeoutTimer=setTimeout(function(){n||(t.fire("model:infoflowFirstScreenTimeout",{ext:{startTime:r,endTime:+(new Date)}}),n=!0)},6e4)},Model.prototype.getChannelConfig=function(e){var t={loadConfig:{queryKey:"loadInfoFlowData"},behavior:{failKey:"info-flow-right"}},n={follow:{loadConfig:{queryKey:"loadFollowInfoFlowData"},behavior:{failKey:"info-flow-follow-channel"}},follow_recom:{loadConfig:{queryKey:"loadFollowRecomInfoFlowData"},behavior:{failKey:"info-flow-follow-recom-channel"}},fun_pc:{loadConfig:{queryKey:"loadYuleInfoFlowData"},behavior:{failKey:"info-flow-yule-channel"}},game_pc:{loadConfig:{queryKey:"loadGameInfoFlowData"},behavior:{failKey:"info-flow-game-channel"}},edu:{loadConfig:{queryKey:"loadEduInfoFlowData"},behavior:{failKey:"info-flow-edu-channel"}}};return!e||!n.hasOwnProperty(e)?t:n[e]},Model.prototype.loadData=function(e,t){var n=this,r=e.queryKey,i=e.type||"",s={getNavData:"getNavData",getMvData:"getMvData",loadInfoFlowData:"loadInfoFlowData",loadGameInfoFlowData:"loadSubMediaInfoFlowData",loadYuleInfoFlowData:"loadSubMediaInfoFlowData",loadEduInfoFlowData:"loadSubMediaInfoFlowData",loadFollowInfoFlowData:"loadFollowInfoFlowData",loadFollowRecomInfoFlowData:"loadFollowRecomInfoFlowData"};if(!s.hasOwnProperty(r))return;this[s[r]](e,t)},Model.prototype.initStorageData=function(){var e=this.defaultNavData.data;for(var t=0,n=e.length;t<n;t++){var r=e[t].cid;infoflowFtStorage.infoFlow[r]={infoFlowData:[],preReqInfoFlowData:[],infoFlowTotal:0,firstShow:!0,startPosition:START_POSITION,startTimes:0,logMap:{},adOff:e[t].adoff||!1}}},Model.prototype.startLoadMvData=function(){this.loadMvData({type:"tabMv"})},Model.prototype.loadMvData=function(e,t){if(window.adOnOff&&window.adOnOff.infoflow_right_2020==="off")return;if(IS_RIF_ON_ADS)return;var n=this,r=e.type||"tabMv",i={uid:infoflowApp.uid,mid:hao360.mid,impct:this.storageMvData[r].impct,reqtimes:this.storageMvData[r].reqMvtimes,showid:this.storageMvData[r].showId,refurl:document.referrer,tmprtp:(new AppData("api.hao.360.cn")).get("infoflow-tmprtp")||""},s=this.mvHostConfig[this.httpType]+qboot.encodeURIJson(i);this.storageMvData[r].reqMvtimes+=1,this.fire("model:reqMvData",{type:r}),qboot.jsonp(s,function(e){e&&e.ads&&e.ads.length>0?(n.fire("model:reqMvDataSuccess",{type:r}),n.loadMvSuccess({data:n.handleAds(e.ads),type:r},t)):(r==="tabMv"&&n.status.firstRender&&(n.status.firstRender=!1),n.loadMvFail())},{jsonp:"jsonp"})},Model.prototype.handleAds=function(e){for(var t=0;t<e.length;t++){(e[t].type===1||e[t].type===2)&&e[t].img&&(e[t].img=hao360.clipImage(e[t].img,{whq:"158_88_75",webp:!0})),e[t].type===4&&(e[t].video_play=qboot.checkVideo);var n=Math.random().toString().substring(2,6)+t;e[t].unique=n}return e},Model.prototype.loadMvSuccess=function(e,t){var n=this,r=e.data;this.storageMv(e),e.type==="yuleMv"&&!this.status.yuleInsertMv&&this.fire("model:yuleMvDataReady",{data:n.storageMvData.yuleMv.data}),e.type==="tabMv"&&this.status.firstRender&&this.status.infoflowRendered?(this.mvDataInsertDom(),this.status.firstRender=!1):e.type==="tabMv"&&(this.status.firstRender=!1)},Model.prototype.mvDataInsertDom=function(){var e=this,t=this.status.infoflowFstScreenData,n=t.length,r=[],i=0,s=infoflowFtStorage.infoFlow.youlike.startPosition;this.fire("model:tabMvDataReady",{data:e.storageMvData.tabMv.data.splice(0,3),startPosition:s,interval:INTERVAL}),n>=s?(r=t.slice(s,n),i=r.length,infoflowFtStorage.infoFlow.youlike.startPosition=INTERVAL-i%INTERVAL):infoflowFtStorage.infoFlow.youlike.startPosition=s-n},Model.prototype.loadMvFail=function(){this.fire("model:reqMvDataFail")},Model.prototype.storageMv=function(e){var t=e.data,n=e.type;for(var r=0,i=t.length;r<i;r++){var s=""+ +(new Date)+Math.random();t[r].module=8,t[r].gid=s,infoflowApp.infoflowFt.monitorStore[s]={log:{imptk:t[r].imptk,clktk:t[r].clktk,clstk:t[r].clstk},realtime:{sTime:0,eTime:0},isSendout:0}}this.storageMvData[n].data=this.storageMvData[n].data.concat(t)},Model.prototype.resetFollowInfoflow=function(e){e==="tab"&&(this.followHostConfig.page=1)},Model.prototype.resetInfoflowInit=function(e){e==="refresh"&&(this.infoFlowHostConfig.page=1)},Model.prototype.getMlistAction=function(e){var t;switch(e){case"refresh":t="1";break;case"tab":t="2";break;case"tips":t="3";break;case"scroll":t="4";break;case"retry":t="5";break;default:t="2"}return t},Model.prototype.loadInfoFlowData=function(e,t){this.resetInfoflowInit(e.optType);var n=hao360.queryUrl(location.href,"channel_type"),r=this,i=e.currentCid||"youlike",s=e.insertType||"beforeend",o=this.getMlistAction(e.optType),u={u:hao360.mid||infoflowApp.uid,hsid:qboot.cookie.get("__hsid")||"",sqid:"",sign:"360_36e79513",version:"1.0",market:"pc_def",device:2,v:1,sv:7,c:n||i,net:5,ufrom:1,n:10,scene:1,sub_scene:1,refer_scene:0,refer_subscene:0,f:"jsonp",where:"list",djsource:this.storageMvData.tabMv.showId,action:o||"2",rec_v:2,min_text_n:hao360.screen.wide?4:3},a=hao360.queryUrl(location.href,"abtest");a&&(u.abtest=a);var f=hao360.queryUrl(location.href,"engaddr");f&&(u.engaddr=f);var l=qboot.cookie.get("user_suffix_new");!l||(u.u=u.u+l),IS_RIF_ON_ADS&&(u.dhflag="noad");var c=this.httpType+this.infoFlowHostConfig.host+qboot.encodeURIJson(u);e.resetTotal&&(infoflowFtStorage.infoFlow[i].infoFlowTotal=0),e.currentCid=i,e.insertType=s;var h={jsonp:"callback",timeout:this.infoFlowHostConfig.timeout,threshold:1};this.status.firstRender||delete h.timeout;var p=this.status.firstRender;this.fire("model:infoflowReqtimes");var d=qboot.jsonp(c,function(n){r.infoFlowLookRel(e,t,n),p&&n&&(clearTimeout(this.timeoutTimer),r.timeoutTimer=null),n&&n.user_suffix&&!l&&qboot.cookie.set("user_suffix_new",n.user_suffix,{expires:864e5});if(o=="1"&&n&&n.errno===0&&n.data&&n.data.res&&n.data.res.length>0)for(var i=0;i<n.data.res.length;i++){var s=n.data.res[i].pcurl;if(s){var u=hao360.queryUrl(s).tmprtp||"";u&&(new AppData("api.hao.360.cn")).set("infoflow-tmprtp",u);break}}},h);p&&r.timeoutHandle(d)},Model.prototype.loadFollowRecomInfoFlowData=function(e,t){var n=this,r={u:hao360.mid||infoflowApp.uid,sqid:"",sign:"360_36e79513",hsid:qboot.cookie.get("__hsid")||"",version:"1.0",market:"pc_def",device:2,v:1,sv:7,c:"youlike",net:5,ufrom:1,n:10,scene:1,sub_scene:1,refer_scene:0,refer_subscene:0,f:"jsonp",where:"list",djsource:this.storageMvData.tabMv.showId,action:"2",rec_v:2,n:20},i=this.httpType+this.infoFlowHostConfig.host+qboot.encodeURIJson(r),s={jsonp:"callback",timeout:3e4,threshold:1};qboot.jsonp(i,function(r){if(r&&r.errno===0&&r.data&&r.data.res&&r.data.res.length){var i=r.data.res;e.data=i,e.uid=r.uid||"",e.sid=r.sid||"",t&&t(e)}else n.loadInfoFlowFail(e)},s)},Model.prototype.loadFlwInfoFlowData=function(e){var t=this,n=qboot.when.defer(),r=this.followHostConfig,i=hao360.mid||infoflowApp.uid,s=parseInt(+(new Date)/1e3),o=hao360.md5(i+"fdasof09vni234rk23b498uvo234eo14n123b12v31v23c1y23y1u"+s);return params={uid:i,hsid:qboot.cookie.get("__hsid")||"",token:s+"|"+o,sign:"360_36e79513",num:r.num,f:"jsonp",page:r.page,auth_card:1,min_text_n:hao360.screen.wide?4:3},url=this.httpType+r.host+qboot.encodeURIJson(params),jsonpConf={jsonp:"callback",timeout:r.timeout||1e4,threshold:1},qboot.jsonp(url,function(e){var t=[],i=0;e&&e.errno===0&&e.data&&e.data.res&&(t=e.data.res,i=e.data.count),n.resolve({from:"flw_if_list",data:t,uid:e&&e.uid?e.uid:"",sid:e&&e.sid?e.sid:"",nodata:i<=r.page*r.num})},jsonpConf),n.promise},Model.prototype.loadFollowZmtListData=function(){var e=qboot.when.defer();return config=this.followZmtListHostConfig,params={uid:hao360.mid||infoflowApp.uid,sign:"360_36e79513",scene:1,djsource:this.storageMvData.tabMv.showId,f:"jsonp",page:1},url=this.httpType+config.host+qboot.encodeURIJson(params),jsonpConf={jsonp:"callback",timeout:config.timeout||1e4,threshold:1},qboot.jsonp(url,function(t){var n=[];t&&t.errno===0&&t.data&&t.data.length&&(n=[{card_json:{card_data:t.data},s:"followed_auth_card",type:"followed_auth_card"}]),e.resolve({from:"flw_zmt_list",data:n,uid:t&&t.uid?t.uid:hao360.mid||infoflowApp.uid,sid:t&&t.sid?t.sid:""})},jsonpConf),e.promise},Model.prototype.loadFollowInfoFlowData=function(e,t){this.resetFollowInfoflow(e.optType);var n=this,r=this.followHostConfig,i;r.page===1?i=qboot.when.all([this.loadFlwInfoFlowData(e),this.loadFollowZmtListData(e)]):i=this.loadFlwInfoFlowData(e),i.then(function(i){var s={},o={},u=[];if(Object.isArray(i)){for(var a=0;a<i.length;a++)i[a].from==="flw_if_list"&&(s=i[a]),i[a].from==="flw_zmt_list"&&(o=i[a]);u=u.concat(o.data,s.data)}else s=i,u=u.concat(s.data);if(u.length)e.data=u,e.uid=s.uid||"",e.sid=s.sid||"",e.zmt_uid=o.uid||"",e.zmt_sid=o.sid||"",e.currentPage=r.page,n.setInfoflowRealShowData(e),n.loadFollowInfoFlowSuccess(e,t),r.page===1&&u.length<10&&n.loadData({queryKey:"loadFollowRecomInfoFlowData",insertType:"beforeend",currentCid:"follow",subCurrentCid:"follow-recom-noenough"},function(e){n.setInfoflowRealShowData(e),n.loadFollowInfoFlowSuccess(e,t),n.noData(e)}),s&&s.nodata&&n.noData(e),r.page++;else{if(r.page!==1)return!1;n.loadData({queryKey:"loadFollowRecomInfoFlowData",insertType:"beforeend",currentCid:"follow",subCurrentCid:"follow-recom-nodata"},function(e){n.setInfoflowRealShowData(e),n.loadFollowInfoFlowSuccess(e,t),n.noData(e)})}},function(){n.loadInfoFlowFail(e)})},Model.prototype.loadSubMediaInfoFlowData=function(e,t){var n=this,r=e.currentCid||"fun_pc",i=e.insertType||"beforeend",s=n.subMediaConfig[e.currentCid].config,o=s.params,u=s[n.httpType]+qboot.encodeURIJson(o);e.resetTotal&&(infoflowFtStorage.infoFlow[r].infoFlowTotal=0),e.currentCid=r,e.insertType=i,e.adOff=infoflowFtStorage.infoFlow[r].adOff;var a={jsonp:"_callback",timeout:s.timeout||3e4,threshold:1};qboot.jsonp(u,function(r){var i=s.handler.isSuccess(s.params,r);i.length>0?(e.data=i,n.loadMediaInfoFlowSuccess(e,t)):i.length===0?n.noData(e):n.loadInfoFlowFail(e)},a)},Model.prototype.infoFlowLookRel=function(e,t,n){n&&n.errno===0&&n.data.res&&n.data.res.length>0?(e.data=n.data.res,e.uid=n.uid,e.sid=n.sid,e.currentCid==="youlike"&&this.infoFlowHostConfig.page===1&&this.cleanAndSaveGovNews(n),this.setInfoflowRealShowData(e),this.loadInfoFlowSuccess(e,t),this.infoFlowHostConfig.page++):n&&n.errno===0&&n.data.res&&n.data.res.length===0?(this.noData(e),this.infoFlowHostConfig.page===1&&this.infoFlowHostConfig.page++):(this.loadInfoFlowFail(e),this.infoFlowHostConfig.page===1&&this.infoFlowHostConfig.page++)},Model.prototype.setInfoflowRealShowData=function(e){var t="360_36e79513",n=1,r=e.currentCid;infoflowApp.infoflowRight.commonParams={uid:e.uid||"",sign:t,isRealshow:n,channel:r}},Model.prototype.loadMediaInfoFlowSuccess=function(e,t){var n=e.currentCid,r=e.data,i=e.insertType;this.countInfoFlowTotal(r,n),e.adOff||(r=this.infoFlowInsertMvData(r,n,i)),t({data:r,currentCid:n,insertType:i}),this.preLoadMvData()},Model.prototype.loadFollowInfoFlowSuccess=function(e,t){var n=e.currentCid,r=this.infoFlowLookFormateData(e.data,e),i=e.insertType;this.countInfoFlowTotal(r,n),this.storageLog(r,n),r=this.infoFlowInsertMvData(r,n,i),t({data:r,currentCid:n,insertType:i,currentPage:e.currentPage,subCurrentCid:e.subCurrentCid}),this.preLoadMvData()},Model.prototype.loadInfoFlowSuccess=function(e,t){var n=e.currentCid,r=e.data,i=e.insertType,s=this.infoFlowLookFormateData(r,e);this.countInfoFlowTotal(s,n),this.storageLog(s,n),s=this.infoFlowInsertMvData(s,n,i),this.storageFirstScreen("api.hao.360.cn","info_flow_multi",s),t({data:s,currentCid:n,insertType:i}),this.preLoadMvData()},Model.prototype.preLoadMvData=function(){if(this.status.firstPreLoadMv){this.status.firstPreLoadMv=!1;return}this.storageMvData.tabMv.data.length<3&&this.loadMvData({type:"tabMv"})},Model.prototype.noData=function(e){this.fire("model:infoflowNodata",{data:e})},Model.prototype.loadInfoFlowFail=function(e){e.currentCid==="youlike"&&Object.prototype.toString.call(window.INFO_FLOW_MULTI_DATA)==="[object Array]"&&this.storageLog(window.INFO_FLOW_MULTI_DATA,e.currentCid),this.fire("model:infoflowFail",{data:e})},Model.prototype.arrayTransform=function(e){var t=2,n=e.length,r=n%t===0?n/t:Math.floor(n/t+1),i=[];for(var s=0;s<r;s++){var o=e.slice(s*t,s*t+t);i.push(o)}return i},Model.prototype.pvLogDefaultParams={gnid:"",sid:"",uid:"",sqid:"",sign:"360_36e79513",hsid:qboot.cookie.get("__hsid")||"",version:"1.0",market:"pc_def",device:2,net:5,sdkv:2,scene:1,sub_scene:1,refer_scene:0,refer_subscene:0,channel:"youlike",where:"list",func:"",a:"",c:"",s:"",url:"",pcurl:"",source:"",style:""},Model.prototype.clkLogDefaultParams={gnid:"",sid:"",uid:"",sqid:"",sign:"360_36e79513",hsid:qboot.cookie.get("__hsid")||"",version:"1.0",market:"pc_def",device:2,net:5,sv:4,scene:1,sub_scene:1,refer_scene:0,refer_subscene:0,channel:"youlike",where:"list",func:"",a:"",c:"",s:"",url:"",pcurl:"",source:"",style:""},Model.prototype.infoFlowFormatHotCardData=function(e,t,n,r){try{var i=e.currentCid,s=n.card_json.card_data,o=[],u=[];hotClkLogArr=[];var a=s.length%2!==0?s.slice(0,s.length-1):s,f=HOT_TOUTIAO_OPERATE&&HOT_TOUTIAO_OPERATE.tag_extend;for(var l=0,c=a.length;l<c;l++){var h=""+ +(new Date)+Math.random(),p=a[l],d={sub_key:h,title:p.t,covers:p.i.split("|"),pcurl:p.pcurl,wide:hao360.screen.wide};n.s==="hot_card"&&(d.tag=p.mark||"",d.tag_bg=f.bg||"#e93d2e",d.tag_icon=f.icon||"");var v={uid:e.uid||"",sid:e.sid||"",channel:i||"youlike",gnid:p.gnid,a:p.a,c:p.c,s:p.s,url:p.u,pcurl:p.pcurl,source:p.source,style:n.s||"",cube_id:n.card_id||"",position:r+"_"+(l+1)},m=qboot.mix({},this.pvLogDefaultParams,!0),g=qboot.mix(m,v,!0);g.filter=p.filter||"";var y=qboot.mix({},this.clkLogDefaultParams,!0),b=qboot.mix(y,v,!0);b.ext=p.zmid,n.s==="hot_card"&&(b.refer_scene=1);var w={};w[h]=b,o.push(d),u.push(g),hotClkLogArr.push(w)}return infoflowApp.infoflowRight.monitorStore[t]={all_log:this.arrayTransform(u),log:u.slice(0,2),realtime:{sTime:0,eTime:0},isSendout:0},{gid:t,data:this.arrayTransform(o),s_log:hotClkLogArr,card_type:n.s,module:5}}catch(E){return}},Model.prototype.infoFlowFormatZtCardData=function(e,t,n,r){try{var i=e.currentCid,s=n.card_json.card_data,o=s.slice(0,3),u=[],a=[];ztClkLogArr=[];var f={uid:e.uid,sid:e.sid||"",channel:i||"youlike",gnid:"",url:n.card_url||"",style:n.s||"",position:r,cube_id:n.card_id||""},l=qboot.mix({},this.pvLogDefaultParams,!0),c=qboot.mix(l,f,!0);a.push(c);var h=qboot.mix({},this.clkLogDefaultParams,!0),p=qboot.mix(h,f,!0),d={};d[t]=p,ztClkLogArr.push(d);for(var v=0,m=o.length;v<m;v++){var g=""+ +(new Date)+Math.random(),y=o[v],b={sub_key:g,title:y.t,covers:y.i.split("|"),pcurl:y.pcurl,wide:hao360.screen.wide},w={uid:e.uid||"",sid:e.sid||"",channel:i||"youlike",gnid:y.gnid,a:y.a,c:y.c,s:y.s,url:y.u,pcurl:y.pcurl,source:y.source,style:n.s||"",cube_id:n.card_id||"",position:r+"_"+(v+1)},E=qboot.mix({},this.pvLogDefaultParams,!0),S=qboot.mix(E,w,!0);S.filter=y.filter||"";var x=qboot.mix({},this.clkLogDefaultParams,!0),T=qboot.mix(x,w,!0);T.ext=y.zmid||"";var N={};N[g]=T,u.push(b),a.push(S),ztClkLogArr.push(N)}return infoflowApp.infoflowRight.monitorStore[t]={log:a,realtime:{sTime:0,eTime:0},isSendout:0},{gid:t,data:u,s_log:ztClkLogArr,card_type:n.s,title:n.t,pcurl:n.card_url,module:6}}catch(C){console.log(C);return}},Model.prototype.infoFlowFormatAuthorCardData=function(e,t,n,r){try{var i=e.currentCid,s=hao360.screen.wide?4:3,o=n.card_json.card_data,u=o.slice(0,s),a=[],f=[],l=[],c={uid:e.uid,sid:e.sid||"",channel:i||"youlike",gnid:"auth_card|"+n.gzhid,style:n.s||"",position:r,cube_id:n.card_id||"",ext:n.gzhid},h=qboot.mix({},this.pvLogDefaultParams,!0),p=qboot.mix(h,c,!0);f.push(p);var d=qboot.mix({},this.clkLogDefaultParams,!0),v=qboot.mix(d,c,!0),m={};m[t]=v,l.push(m);for(var g=0,y=u.length;g<y;g++){var b=""+ +(new Date)+Math.random(),w=u[g];if(!w.i)continue;var E=parseInt(w.duration)||0,S={sub_key:b,title:w.t,covers:w.i.split("|"),pcurl:w.pcurl,zmt:w.zmt,s:w.s,duration:infoflowApp.getDur(E)},x={uid:e.uid,sid:e.sid||"",channel:e.currentCid||"youlike",gnid:w.gnid,a:w.a,c:w.c,s:w.s,url:w.u,pcurl:w.pcurl,source:w.source,style:n.s||"",cube_id:n.card_id||"",position:r+"_"+(g+1)},T=qboot.mix({},this.pvLogDefaultParams,!0),N=qboot.mix(T,x,!0);N.filter=w.filter||"";var C=qboot.mix({},this.clkLogDefaultParams,!0),k=qboot.mix(C,x,!0);k.ext=w.zmid;var L={};L[b]=k,a.push(S),f.push(N),l.push(L)}infoflowApp.infoflowRight.monitorStore[t]={log:f,realtime:{sTime:0,eTime:0},isSendout:0};var A=hao360.queryUrl(a[0].pcurl);A.id=n.gzhid;if(a.length<s)return;return{gid:t,s_log:l,author:{name:n.name||"",icon:n.image||"",desc:n.description||"",url:"https://www.360kuai.com/pc/zmt?"+qboot.encodeURIJson(A),zmt:a[0].zmt},data:a,card_type:n.s,module:7}}catch(O){return}},Model.prototype.infoFlowFormatFollowedAuthCardData=function(e,t,n,r){try{var i=n.card_json.card_data,s=hao360.screen.wide?6:4,o=i.slice(0,s),u=[],a={uid:e.zmt_uid,sid:e.zmt_sid,channel:e.currentCid||"youlike",gnid:"",style:"",position:r,cube_id:"",ext:""},f=qboot.mix({},this.clkLogDefaultParams,!0),l=qboot.mix(f,a,!0);for(var c=0,h=o.length;c<h;c++){var p=""+ +(new Date)+Math.random(),d=o[c],v={uid:e.zmt_uid,sid:e.zmt_sid,channel:e.currentCid||"youlike",gnid:n.s+"|"+d.id,a:"",c:"",s:"",url:"",pcurl:d.pcurl,source:"",style:n.s||"",cube_id:"",position:r},m=qboot.mix({},this.pvLogDefaultParams,!0),g=qboot.mix(m,v,!0);u.push(g)}return infoflowApp.infoflowRight.monitorStore[t]={log:u,realtime:{sTime:0,eTime:0},isSendout:0},{gid:t,s_log:l,data:o,card_type:n.s,module:10}}catch(y){console.log(y);return}},Model.prototype.infoFlowFormatTopicCardData=function(e,t,n,r){try{var i=n.card_json.card_data,s=3,o=i.slice(0,s),u=[],a=[];if(o.length<s)return;o.push({disableClkLog:!1,disablePvLog:!0,func:"huati_more",pcurl:"https://www.360kuai.com/pc/user?type=browse&uid="+(e.uid||"")+"&sign=360_36e79513#topic"});for(var f=0,l=o.length;f<l;f++){var c=""+ +(new Date)+Math.random(),h=o[f];h.sub_key=c;var p={uid:e.uid||"",sid:e.sid||"",channel:e.currentCid||"youlike",gnid:h.pcurl||"",a:h.a||"",c:h.c||"",s:h.s||"",url:h.pcurl,pcurl:h.pcurl,source:h.source||"",style:n.s||"",position:r+"_"+(f+1),cube_id:n.card_id||"",func:h.func||""},d=qboot.mix({},this.pvLogDefaultParams,!0),v=qboot.mix(d,p,!0),m=qboot.mix({},this.clkLogDefaultParams,!0),g=qboot.mix(m,p,!0),y={};y[c]=g,!h.disablePvLog&&u.push(v),!h.disableClkLog&&a.push(y)}return infoflowApp.infoflowRight.monitorStore[t]={log:u,realtime:{sTime:0,eTime:0},isSendout:0},{gid:t,s_log:a,data:o,card_type:n.s,module:11}}catch(b){console.log(b),LogHub.behavior("info-flow-right","topic_card_error");return}},Model.prototype.infoFlowFormatOtherData=function(e,t,n,r,i){try{var s=n,o=e.currentCid;if(!s.i)return;var u=s.i.split("|"),a=u.length,f=1,l=s.plist&&s.plist.split("|");if(s.s==="p"&&l&&l.length>=3){f=4;var c=l.slice(0,3),h=l.length}s.s==="y"&&(f=4),s.s==="t"&&a>=3&&s.show_pnum&&parseInt(s.show_pnum)===3&&(f=3,s.style=12,u=u.slice(0,3));if(s.duration){var p=parseInt(s.duration)||0;s.duration=infoflowApp.getDur(p)}if(s.f&&s.zmt&&s.zmt.id){var d=hao360.queryUrl(s.pcurl);d.id=s.zmt.id,s.source_url="https://www.360kuai.com/pc/zmt?"+qboot.encodeURIJson(d)}else s.f=s.f||"\u5feb\u8d44\u8baf",s.source_url=s.pcurl;if(s.ntag){var v=/(?=(;y2:)|(^y2:)).+?((?=;)|$)/,m=s.ntag.match(v);m&&m[0]&&(s.y2_tag=m[0].replace(";","").replace("y2:","").replace(":"," "))}var g={author_img:s.fromicon,zmt:s.zmt,uid:e.uid,author_name:s.f,source:s.f.slice(0,10),covers:u,s_covers:u,l_covers:u,title:s.t,s:s.s,duration:s.duration||"",playcnt:s.playcnt||"",pdate_str:infoflowApp.generateRdmTime(i),s1:s.s1||"",attr:s.attr,cmt_num:s.cmt_num||"0",source_url:s.source_url||"",ytag:s.y2_tag||"",wide:hao360.screen.wide,plist:c||[],plist_len:h||0,j:s.j,is_followicon:function(){var e=!1;if(s.attr&&s.zmt&&parseInt(s.zmt.is_followed,10)===1)for(var t=0;t<s.attr.length;t++)if(s.attr[t].content==="\u521a\u521a\u5173\u6ce8"||s.attr[t].content==="\u5df2\u5173\u6ce8"||s.attr[t].content==="\u4f60\u7684\u5173\u6ce8"){e=!0;break}return e}()},y={uid:e.uid||"",sid:e.sid||"",channel:o||"youlike",gnid:s.gnid||s.rawurl||"",a:s.a,c:s.c,s:s.s,url:s.u,pcurl:s.pcurl,source:s.source,style:s.style||"",position:r},b=qboot.mix({},this.pvLogDefaultParams,!0),w=qboot.mix(b,y,!0);w.filter=s.filter||"";var E=qboot.mix({},this.clkLogDefaultParams,!0),S=qboot.mix(E,y,!0);return S.ext=s.zmid||"",infoflowApp.infoflowRight.monitorStore[t]={log:w,realtime:{sTime:0,eTime:0},isSendout:0},{gid:t,data:g,pcurl:s.pcurl,pcurl_comment:s.pcurl+"#bd_comment",s_log:S,module:f||1}}catch(x){return}},Model.prototype.infoFlowLookFormateData=function(e,t){var n=t.currentCid,r=[];for(var i=0,s=e.length;i<s;i++){var o=e[i],u=""+ +(new Date)+Math.random(),a=n==="follow"?this.followHostConfig.page:this.infoFlowHostConfig.page,f=(a-1)*10+i;if(o.s==="hot_card"||o.s==="pics_card"){var l=this.infoFlowFormatHotCardData(t,u,o,f);if(!l||!l.data||l.data.length<=0)continue;o.s==="hot_card"&&LogHub.behavior("info-flow-right","hot_toutiao_show")}else if(o.s==="zhuanti_card"){var l=this.infoFlowFormatZtCardData(t,u,o,f);if(!l||!l.data||l.data.length<=0)continue;LogHub.behavior("info-flow-right","zhuanti_card_show")}else if(o.s==="auth_card"){var l=this.infoFlowFormatAuthorCardData(t,u,o,f);if(!l||!l.data||l.data.length<=0)continue;LogHub.behavior("info-flow-right","author_card_show")}else if(o.s==="followed_auth_card"){var l=this.infoFlowFormatFollowedAuthCardData(t,u,o,f);if(!l||!l.data||l.data.length<=0)continue;LogHub.behavior("info-flow-right","followed_auth_card_show")}else if(o.s==="topic_card"){var l=this.infoFlowFormatTopicCardData(t,u,o,f);if(!l||!l.data||l.data.length<=0)continue;LogHub.behavior("info-flow-right","topic_card_show")}else{var l=this.infoFlowFormatOtherData(t,u,o,f,i);if(!l)continue}(o.s==="p"&&o.plist||o.s==="y")&&qboot.events.fire("right:infoflow:customize:textlink:ad",l),r.push(l)}return r},Model.prototype.storageFirstScreen=function(e,t,n){var r="youlike",i=W("#infoflow-right-"+r+"-wrap");i.html()||((new AppData(e)).set(t,n),this.status.infoflowFstScreenData=n)},Model.prototype.countInfoFlowTotal=function(e,t){infoflowFtStorage.infoFlow[t].infoFlowTotal+=e.length,infoflowFtStorage.infoFlow[t].infoFlowTotal>=150&&this.fire("model:infoFlowTotal150")},Model.prototype.storageLog=function(e,t){for(var n=0,r=e.length;n<r;n++){var i=e[n].gid;infoflowFtStorage.infoFlow[t].logMap[i]=e[n].s_log}},Model.prototype.infoFlowInsertMvData=function(e,t,n){var r=e.length,i=t,s=[],o=[];n==="afterbegin"&&(infoflowFtStorage.infoFlow[t].startPosition=START_POSITION);var u=infoflowFtStorage.infoFlow[t].startPosition;this.status.infoflowRendered=!0;if(!this.storageMvData.tabMv.data.length)return e;if(r>=u){s=e.slice(0,u),s.push(this.storageMvData.tabMv.data.shift()),o=e.slice(u,r);var a=o.length;infoflowFtStorage.infoFlow[t].startPosition=INTERVAL-a%INTERVAL;for(var f=0;f<parseInt(a/INTERVAL);f++){var l=(f+1)*INTERVAL+f;this.storageMvData.tabMv.data.length>0&&o.splice(l,0,this.storageMvData.tabMv.data.shift())}return s.concat(o)}return infoflowFtStorage.infoFlow[t].startPosition=u-r,e},Model.prototype.loadYuleSuccess=function(e,t){var n=e.data;n=this.formateYuleData(n),n=this.yuleInsertMvData(n),n&&t&&t(n)},Model.prototype.formateYuleData=function(e){for(var t=0,n=e.length;t<n;t++)e[t].module=9;return e},Model.prototype.yuleInsertMvData=function(e){if(!this.storageMvData.yuleMv.data.length)return e;var t=3,n=this.storageMvData.yuleMv.data,r=e.length,i=parseInt(r/2),s=e.length%t,o=0,u={};n.length>3&&(u=n[0],n[0]=n[2],n[2]=u),this.status.yuleInsertMv=!0;var a=e.slice(i,i+s);e.splice(i,s),r=e.length;for(var f=0;f<r/t;f++){o=r-f*t;if(!n.length)return e;e.splice(o,0,n.shift())}var l=i+parseInt(i/t);return a.forEach(function(t,n){o=l+n,e.splice(o,0,t)}),e},Model.prototype.getMvData=function(e,t){var n=e.type||"";if(this.storageMvData[n].data.length){var r=this.storageMvData[n].data;r&&t&&t(r)}else this.loadMvData({type:n},t)},Model.prototype.getNavData=function(e,t){var n,r=this;n=this.defaultNavData.data,n&&t&&t(n)},Model.prototype.cleanAndSaveGovNews=function(e){var t=[],n=e&&e.data&&e.data.res,r=5;if(n.length>=r)while(r--)n[r].a==="t"&&(t.unshift(n[r]),n.splice(r,1));qboot.events.fire("infoflow-right-gov-news",{data:t})},Model.prototype.addFollow=function(e){if(this.addFollowHostConfig.loadStatus)return!1;this.addFollowHostConfig.loadStatus=!0;var t=this,n=hao360.mid||infoflowApp.uid,r=parseInt(+(new Date)/1e3),i=hao360.md5(n+"fdasof09vni234rk23b498uvo234eo14n123b12v31v23c1y23y1u"+r);defParams={hsid:qboot.cookie.get("__hsid")||"",uid:n,token:r+"|"+i,sign:"360_36e79513",device:2,net:5,scene:1,refer_scene:0,where:e.where||"list",behavior_type:1,"do":e.opt==="add"?"1":"2",id:"",name:"",pic:"",jump_url:"",f:"jsonp"},params=qboot.mix(defParams,e.data,!0),url=this.httpType+this.addFollowHostConfig.host+qboot.encodeURIJson(params),jsonpConf={jsonp:"callback",threshold:1},qboot.jsonp(url,function(n){n&&n.errno===0&&e.cb&&e.cb(),t.addFollowHostConfig.loadStatus=!1},jsonpConf),qboot.events.fire("360kuai-follow-add")};var InfoflowView=function(e){this.init(e)};InfoflowView.prototype.constructor=InfoflowView,InfoflowView.prototype.init=function(e){qboot.createEvents(this),this.options=qboot.mix(e||{},this.defaultOptions),this.infoFlowInnerId=this.options.infoFlowInnerId,this.wrapClass=this.options.wrapClass,this.LOADTHRESHOLD=this.options.LOADTHRESHOLD,this.infoFlowOperatId=this.options.infoFlowOperatId,this.infoFlowWrapTpl=this.options.infoFlowWrapTpl,this.tabMvTpl=this.options.tabMvTpl,this.infoFlowTpl=this.options.infoFlowTpl,this.refreshTpl=this.options.refreshTpl,this.alertRefreshClass=this.options.alertRefreshClass,this.alertUnreadClass=this.options.alertUnreadClass,this.unreadClose=this.options.unreadClose,this.alertRefreshId=this.options.alertRefreshId,this.totalTipsId=this.options.totalTipsId,this.$infoFlowCon=W(this.options.infoFlowCon),this.$infoFlowInner=W("#"+this.infoFlowInnerId),this.$unRead=W("#"+this.options.unRead),this.$infoFlowError=W(this.options.infoFlowError),this.$infoFlowRetry=W(this.options.infoFlowRetry),this.$loadMoreCon=W(this.options.loadMoreCon),this.$totalTips=W("#"+this.totalTipsId),this.loadStatus={isScrollLoad:!1},this.status={insertOperat:!1},this.tabMvVideoStore=[],this.mvVidoSdkLoading=!1,this.setUnRead(),this.bindEvent(),this.listen()},InfoflowView.prototype.renderInfoFlowWrap=function(e){var t=template(this.infoFlowWrapTpl,e);this.$infoFlowInner.setHtml(t),this.resetStatus("youlike")},InfoflowView.prototype.renderFollowRecom=function(e,t,n){var r=e,i=this.infoFlowTpl+"-follow-recom",s=template(i,{nodata:n==="nodata"});W("#follow-recom-wrap")&&W("#follow-recom-wrap").removeNode(),r.insertAdjacentHTML("beforeend",s);var o=W("#follow-recom-feed");o&&o.insertAdjacentHTML("afterbegin",t)},InfoflowView.prototype.renderFollow=function(e){var t=this,n=e.insertType||"beforeend",r=e.currentCid||"follow",i=e.subCurrentCid||"",s=e.data||[],o=s.length,u=W("#infoflow-right-"+r+"-wrap"),a=t.getInfoFlowHtml(r,s);e.currentPage===1&&u.html(""),i==="follow-recom-nodata"?(u.html(""),t.renderFollowRecom(u,a,"nodata")):i==="follow-recom-noenough"?t.renderFollowRecom(u,a):u.insertAdjacentHTML(n,a),t.tabMvVideoRender(),t.fire("view:tabMvDataRendered"),this.rendered({len:o,insertType:n}),this.removeSkeleton(),this.renderAdMenu(),this.initAuthorInforSlider()},InfoflowView.prototype.render=function(e){var t=this,n=e.insertType||"beforeend",r=e.currentCid||"youlike",i=e.data,s=W("#infoflow-right-"+r+"-wrap"),o=i.length,u=t.getInfoFlowHtml(r,i);s.insertAdjacentHTML(n,u),t.tabMvVideoRender(),t.fire("view:tabMvDataRendered"),this.insertOperat(r),this.renderRefreshDom({insertType:n,insertIndex:o-1,data:{currentCid:r,time:"\u521a\u521a"}}),this.rendered({len:o,insertType:n}),this.removeSkeleton(),this.renderAdMenu(),this.initAuthorInforSlider(),this.initHotToutiaoSlider(),this.initHotToutiaoAd(i)},InfoflowView.prototype.adapterYuleTplData=function(e){var t=[];for(var n=0,r=e.length;n<r;n++){var i=e[n],s={};if(i.module===8){t.push(i);continue}s.pic=i.pic,s.title=i.text,s.type=i.type,s.picture_count=i.picture_count,s.url="https://yule.360.com/detail/"+i.id,s.source_name=i.source_name,s.source_url="https://yule.360.com/",s.category_list=QW.ArrayH.map(i.tags.split(","),function(e,t){return{name:e,url:"https://yule.360.com/list?tag="+i.tags.split(",")[t]}}),t.push(s)}return t},InfoflowView.prototype.adapterGameTplData=function(e){var t=[];for(var n=0,r=e.length;n<r;n++){var i=e[n],s={};if(i.module===8){t.push(i);continue}s.pic=i.pic,s.title=i.title,s.type=0,s.picture_count=1,s.url="https://news.g.360.cn/topicdetail/"+i.article_id,s.source_name=i.author,s.source_url="https://news.g.360.cn/",s.category_list=QW.ArrayH.map(i.category.split(","),function(e,t){return{name:e,url:"https://news.g.360.cn/topic/"+i.category_ids[t]}}),t.push(s)}return t},InfoflowView.prototype.adapterEduTplData=function(e){var t=[];for(var n=0,r=e.length;n<r;n++){var i=e[n],s={};if(i.module===8){t.push(i);continue}s.pic=i.pic,s.title=i.title,s.type=0,s.picture_count=1,s.url="https://news.edu.360.cn/article/detail/"+i.article_id,s.source_name=i.author,s.source_url="https://news.edu.360.cn/",s.category_list=QW.ArrayH.map(i.category.split(","),function(e,t){return{name:e,url:"https://news.edu.360.cn/articles/"+i.category_ids[t]}}),t.push(s)}return t},InfoflowView.prototype.getInfoFlowHtml=function(e,t){var n=this,r="",i={fun_pc:function(e){return n.adapterYuleTplData(e)},game_pc:function(e){return n.adapterGameTplData(e)},edu:function(e){return n.adapterEduTplData(e)}};return e in i?r=n.getSubMediaInfoFlowHtml(i[e](t)):r=n.getNormalInfoFlowHtml(t),r},InfoflowView.prototype.getNormalInfoFlowHtml=function(e){var t="";for(var n=0,r=e.length;n<r;n++){var i=parseInt(e[n].module)||1,s=e[n];s.s_log=JSON.stringify(s.s_log)||"";if(i&&i>0)if(i===8)t+=template(this.tabMvTpl+(s.type||1),s),e[n].type===4&&this.tabMvVideoStore.push(e[n]);else{var o=this.infoFlowTpl+e[n].module;t+=template(o,s)}}return t||""},InfoflowView.prototype.getSubMediaInfoFlowHtml=function(e){var t="";for(var n=0,r=e.length;n<r;n++){var i=e[n],s=this.infoFlowTpl+"-sub-media";i.module===8?(t+=template(this.tabMvTpl+(i.type||1),i),e[n].type===4&&this.tabMvVideoStore.push(e[n])):t+=template(s,i)}return t||""},InfoflowView.prototype.renderAdMenu=function(){var e=this.$infoFlowInner.query(".ad-dislike"),t=infoflowApp.infoflowFt.monitorStore;for(var n=0;n<e.length;n++){var r=W(e[n]),i=r.parentNode(".js-mv-infoflow-item");dataGid=i.getAttr("data-gid"),t[dataGid].loadislikeMenu||(t[dataGid].loadislikeMenu=!0,function(e,n){e.menu({logUrl:t[dataGid]&&t[dataGid].log.clstk,namespace:"infoflow-right-ad-dislike",afterRemove:function(){e.removeClass("show-menu")},afterClick:function(){n.removeNode()}})}(r,i))}},InfoflowView.prototype.tuijianFail=function(){var e=window.INFO_FLOW_MULTI_DATA||(new AppData("api.hao.360.cn")).get("info_flow_multi");if(!e)return;for(var t=0;t<e.length;t++)e[t]&&e[t].pcurl&&(e[t].pcurl=e[t].pcurl.replace(/g\d{19}/,hao360.mid||infoflowApp.uid));this.render({currentCid:"youlike",data:e,insertType:"beforeend"}),this.$loadMoreCon.hide()},InfoflowView.prototype.followInfoFlowNoData=function(e){this.$loadMoreCon.hide()},InfoflowView.prototype.infoFlowFail=function(e){var t=infoflowFtStorage.cid.currentCid,n=W("#infoflow-right-"+t+"-wrap");if(n.html())return;if(t==="youlike"){this.tuijianFail();return}this.$infoFlowError.show(),this.$loadMoreCon.hide()},InfoflowView.prototype.removeSkeleton=function(){W("#info-flow .info-flow-cont").css("background","#fff")},InfoflowView.prototype.resetStatus=function(e){this.$unRead.hide(),this.$infoFlowError.hide(),this.$totalTips.hide(),this.$loadMoreCon.show(),this.$infoFlowCon.query("."+this.wrapClass).hide(),W("#infoflow-right-"+e+"-wrap").show()},InfoflowView.prototype.rendered=function(e){this.fire("view:infoFlowRenered",{data:e}),this.renderTips({type:"success",data:e}),this.loadStatus={isScrollLoad:!0},this.$loadMoreCon.show(),this.$loadMoreCon.html("")},InfoflowView.prototype.renderRefreshDom=function(e){var t=this,n=e.data.currentCid,r=W("#infoflow-right-"+n+"-wrap").query(".feed-item"),i=e.insertIndex||r.length-1,s=W("#"+this.alertRefreshId+n);if(!s.length||e.insertType==="afterbegin")e.insertType==="afterbegin"?r.item(i)&&r.item(i).insert("afterend",s):r.item(i)&&r.item(i).insertAdjacentHTML("afterend",template(this.refreshTpl,e.data)),this.initRefreshTimer({currentCid:n})},InfoflowView.prototype.insertOperat=function(e){this.status.insertOperat||(W("#infoflow-right-"+e+"-wrap").insert("afterbegin",W("#"+this.infoFlowOperatId)),W("#"+this.infoFlowOperatId).show(),this.status.insertOperat=!0)},InfoflowView.prototype.refreshClick=function(e){var t='<span class="alerts-text"><img src="//hao1.qhimg.com/t012844a3ec4f870d1c.gif" /> \u52a0\u8f7d\u4e2d</span>';this.$totalTips.html(t).show(),e==="tab"?LogHub.behavior("info-flow-right","tab-refresh"):(document.body.scrollTop=document.documentElement.scrollTop=this.$infoFlowCon.getRect().top-SEARCH_HEIGHT,LogHub.behavior("info-flow-right","alert-refresh"))},InfoflowView.prototype.renderTips=function(e){var t=this,n=e.data.len,r='<span class="alerts-text">\u4e3a\u60a8\u66f4\u65b0\u4e86 '+n+" \u6761\u65b0\u6d88\u606f</span>";if(e.data.insertType!=="afterbegin")return;e.type==="fail"&&(r='<span class="alerts-text">\u6ca1\u6709\u66f4\u591a\u65b0\u95fb\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5</span>'),this.$totalTips.show().setStyle({height:0,opacity:0}).setHtml(r),this.$totalTips.animate({height:{to:"30px"},opacity:{to:1}},300),setTimeout(function(){t.$totalTips.animate({height:{to:"0px"},opacity:{to:0}},300,function(){t.$totalTips.hide().setStyle({height:"30px",opacity:1})})},1500)},InfoflowView.prototype.initRefreshTimer=function(e){var t=this,n=e.currentCid;infoflowFtStorage.infoFlow[n].startTimes=new Date,clearInterval(r),this.setRefreshTime(n);var r=setInterval(function(){t.setRefreshTime(n)},6e4)},InfoflowView.prototype.setRefreshTime=function(e){var t=W("#"+this.alertRefreshId+e).query("span").item(0);if(t){var n=new Date-infoflowFtStorage.infoFlow[e].startTimes;t.setHtml(infoflowApp.convertTime(n)+"\u770b\u5230\u8fd9\u91cc")}},InfoflowView.prototype.setUnRead=function(){var e=this,t=this.$unRead,n=function(e,n,r){var i=infoflowFtStorage.cid.currentCid;i!=="follow"&&(r.item(e).insert(n,t),t.fadeIn())},r=function(){var r=infoflowFtStorage.cid.currentCid,i=W("#"+e.alertRefreshId+r),s=W("#infoflow-right-"+r+"-wrap"),o=Dom.getDocRect().height,u=Dom.getDocRect().scrollY,a=t.getRect().top;if(infoflowApp.isVisualArea(t)||i.length>0&&infoflowApp.isVisualArea(i))return;var f=s.query(".feed-item"),l=f.length;if(f.length<1)return;var c=Math.ceil((u+o-s.getRect().top)/MIN_FEEDITEM_HEIGHT),h=Math.ceil((u+o-s.getRect().top)/MAX_FEEDITEM_HEIGHT);if(h<1){n(0,"beforebegin",f);return}c=c>l?l:c;var p={index:h,minVal:u+o-f.item(h-1).getRect()?f.item(h-1).getRect().top:0};for(var d=h;d<c;d++){var v=u+o-(f.item(d-1).getRect().top+f.item(d-1).getRect().height);infoflowApp.isVisualArea(f.item(d-1))&&Math.abs(v-(o-SEARCH_HEIGHT)/2)<p.minVal&&(p.minVal=Math.abs(v-(o-SEARCH_HEIGHT)/2),p.index=d-1)}n(p.index,"afterend",f)};clearInterval(i);var i=setInterval(r,18e4)},InfoflowView.prototype.loadMoreInfoFlow=function(){var e=infoflowFtStorage.cid;this.isLoadInfoFlow()&&(this.fire("view:loadMoreInfoFlow",{optType:"scroll",data:{cid:e,insertType:"beforeend"}}),this.loadStatus={isScrollLoad:!1})},InfoflowView.prototype.isLoadInfoFlow=function(){var e=infoflowApp.intoVisualArea(this.$loadMoreCon,this.LOADTHRESHOLD),t=this.loadStatus.isScrollLoad,n=!this.$loadMoreCon.query("a").hasClass("info-flow-nodata");return e&&t&&n},InfoflowView.prototype.freshCurrent=function(e,t){this.refreshClick(e),this.fire("view:loadMoreInfoFlow",{optType:e,data:{cid:infoflowFtStorage.cid,insertType:"afterbegin"}}),e==="tips"&&this.fire("view:tipsClick",{data:{clicktype:t}})},InfoflowView.prototype.listen=function(){var e=this;this.on("controller:navDataReady",function(t){e.renderInfoFlowWrap(t)}),this.on("controller:infoFlowDataReady",function(t){t.data.currentCid==="follow"?e.renderFollow(t.data):e.render(t.data),t.firstScreen&&e.renderTips({type:"success",data:{len:t.data&&t.data.data&&t.data.data.length||10,insertType:"afterbegin"}})}),this.on("controller:tabMvDataReady",function(t){var n="youlike",r=t.data,i=t.interval,s=t.startPosition-1,o=W("#infoflow-right-"+n+"-wrap").query(".js-feed");for(var u=0,a=o.length;u<a;u++){if(u===s&&!o.item(u).hasClass(".feed-mv")){o.item(u).insertAdjacentHTML("afterend",e.getNormalInfoFlowHtml([r.shift()]));continue}r.length>0&&u>s&&(u-s)%i===0&&o.item(u).insertAdjacentHTML("afterend",e.getNormalInfoFlowHtml([r.shift()]))}e.tabMvVideoRender(),e.fire("view:tabMvDataRendered"),e.renderAdMenu()}),this.on("controller:clickNavUl",function(t){var n=t.data.currentCid;e.resetStatus(n),e.setRefreshTime(n),t.refresh&&e.freshCurrent("tab"),e.removeSkeleton(),e.$loadMoreCon.html("");var r=W(".infoflow-right-gov-news");n==="youlike"?r.show():r.hide()}),this.on("controller:infoflowNoData",function(t){t&&t.data&&t.data.currentCid==="follow"&&e.followInfoFlowNoData(t.data)}),this.on("controller:infoflowFail",function(t){e.infoFlowFail(t.data),e.renderTips({type:"fail",data:{insertType:t.data&&t.data.insertType||"afterend"}})})},InfoflowView.prototype.videoControl=function(){var e=function(e){var t=e.offsetTop,n=e.offsetParent,r=document.body.scrollTop||document.documentElement.scrollTop;while(n!=null)t+=n.offsetTop+(n.offsetHeight-n.clientHeight)/2,n=n.offsetParent;return t-r};W("#"+this.infoFlowInnerId).query("video").forEach(function(t){try{var n=e(t),r=document.documentElement.clientHeight,i=n-r+W(t)[0].clientHeight/2;if(n<0||i>0)W(t)[0].muted=!0,W(t).ancestorNode(".js-mv-video").query(".volume").addClass("unvolume")}catch(s){}})},InfoflowView.prototype.visibleInfoflowBtmFixed=function(){var e=this,t=e.$infoFlowCon.parentNode(".js-f-r"),n=Dom.getDocRect(),r=t.getRect(),i=e.$infoFlowCon.getRect(),s=W("#copyright").getRect().height+25,o=document.body.scrollHeight-(n.height+n.scrollY);n.height+n.scrollY>=r.top+i.height&&W(".cube-container").getRect().height+W("#cube-nav").getRect().height+10>i.height?e.$infoFlowCon.parentNode(".js-f-r-box").css({position:"fixed",bottom:(o>s?0:s-o)+"px",left:r.left-n.scrollX+"px"}):e.$infoFlowCon.parentNode(".js-f-r-box").css({position:"static"})},InfoflowView.prototype.bindEvent=function(){var e=this;QW.W(window).on("scroll",function(t){e.loadMoreInfoFlow(),e.videoControl(),e.visibleInfoflowBtmFixed()}),QW.W(window).on("resize",function(t){e.visibleInfoflowBtmFixed()});var t="."+this.alertRefreshClass+", ."+this.alertUnreadClass;this.$infoFlowCon.delegate(t,"click",function(t){var n="";W(this).hasClass("alert-refresh")&&(n="refresh_before"),W(this).hasClass("alert-unread")&&(n="read_more"),e.freshCurrent("tips",n),W(this).hasClass("alert-unread")&&W(this).hide()}),W("#"+this.unreadClose).on("click",function(t){t.stopPropagation(),W("."+e.alertUnreadClass).hide()}),this.$infoFlowRetry.on("click",function(t){e.fire("view:loadMoreInfoFlow",{optType:"retry",data:{cid:infoflowFtStorage.cid,insertType:"afterend"}}),e.fire("view:retry"),e.$infoFlowError.hide(),e.$loadMoreCon.show()}),W("#"+this.infoFlowInnerId).delegate(".js-feed a","click",function(t){var n=W(this),r=n.parentNode(".feed-item"),i=r.getAttr("data-gid"),s=n.attr("data-sub-gid")||"",o=n.attr("data-log-v2")||"0";if(n.hasClass("hot-toutiao__piclinkad")||n.hasClass("slide-btn")||n.hasClass("infor-arrow-lt")||n.hasClass("infor-arrow-rt")||n.parentNode().hasClass("mv-ads__textlink"))return;e.fire("view:feedClick",{data:{dataGid:i,dataSubGid:s,useLogV2:o,tagName:t.target.tagName.toLowerCase()}})}),W("#"+this.infoFlowInnerId).delegate(".js-feed-dislike","click",function(t){var n=W(this),r=n.parentNode(".feed-item"),i=r.getAttr("data-gid");r.hide(),e.fire("view:feedDislike",{data:{dataGid:i}})}),W("#"+this.infoFlowInnerId).delegate(".ad-dislike","click",function(){W(this).addClass("show-menu")}),W("#"+this.infoFlowInnerId).delegate(".js-volume","click",function(t){t.preventDefault();var n=W(this).ancestorNode(".js-mv-video").query("video")[0],r=W(this).hasClass("unvolume"),i=function(){W("#"+e.infoFlowInnerId).query("video").forEach(function(e){e.muted=!0,W(e).ancestorNode(".js-mv-video").query(".volume").addClass("unvolume")})};i(),r&&(n.muted=!1,W(this).removeClass("unvolume"))}),this.$infoFlowCon.delegate(".infoflow-right-source","click",function(t){t.preventDefault();var n=W(this),r=n.parentNode(".feed-item"),i=r.getAttr("data-gid"),s=r.attr("data-card"),o="list",u="infoflow-right-source";s==="auth_card"?(o="list_authcard1",u="infoflow-right-auth-card"):s==="followed_auth_card"&&(o="followed_auth_card",u="infoflow-right-followed-auth-list");if(n.attr("href")){window.open(n.attr("href"));var a=n.query("span")[1]?n.query("span")[1].innerHTML:n.getAttr("data-text")||"";window.moniter&&window.moniter.sendClklog(a,n.attr("href"),u),e.fire("view:source",{data:{dataGid:i,url:n.attr("href"),where:o}})}}),this.$infoFlowCon.delegate(".more-followed-author","click",function(t){t.preventDefault();var n="https://www.360kuai.com/pc/zmt/following?",r={sign:"360_36e79513",refer_scene:0};hao360.mid?r.sc_id=qboot.mixMid(hao360.mid):r.uid=qboot.cookie.get("__guid")||qboot.cookie.get("__huid")||"";var i=n+qboot.encodeURIJson(r);window.open(i);var s=W(this),o=s.parentNode(".feed-item"),u=o.getAttr("data-gid"),a="more-followed-author",f=s.query("span")[1].innerHTML;window.moniter&&window.moniter.sendClklog(f,i,a),e.fire("view:moreFollowedAuth",{data:{dataGid:u,url:i,func:"zmt_click_more",channel:"follow"}})}),this.$infoFlowCon.delegate(".infoflow-right-comment","click",function(t){t.preventDefault();var n=W(this),r="infoflow-right-comment",i=n.parentNode(".feed-item"),s=i.getAttr("data-gid");if(n.attr("href")){window.open(n.attr("href"));var o=n.query("span")[0].innerHTML;window.moniter&&window.moniter.sendClklog(o,n.attr("href"),r),e.fire("view:comment",{data:{dataGid:s}})}}),this.$infoFlowCon.delegate(".js-add-follow","click",function(t){t.preventDefault();var n=W(this),r=infoflowFtStorage.cid.currentCid||"youlike",i=n.parentNode(".js-feed"),s=i.attr("data-card"),o=n.query("i")[0].innerHTML,u="list",a=s!=="auth_card"?"infoflow-right-add-follow":"infoflow-right-recommend-author",f=n.getAttr("data-zid");window.moniter&&window.moniter.sendClklog(o,"",a),s==="auth_card"&&(u="list_authcard_"+r),e.fire("view:authorAddFollow",{opt:"add",where:u,data:{id:f,name:n.getAttr("data-zname"),pic:n.getAttr("data-zpic"),jump_url:n.getAttr("data-zurl"),rec_info:n.getAttr("data-zrec")},cb:function(){var t=e.$infoFlowInner.query(".js-add-follow");t.forEach(function(e){var t=W(e),n=t.getAttr("data-zid");if(f==n){var r=t.parentNode(".js-feed");t.hide(),r.query(".js-cancel-follow").removeClass("hide")}})}})}),this.$infoFlowCon.delegate(".js-infor-arrow-lt","click",function(e){e.preventDefault();var t=W(this),n=t.parentNode(".js-author-infor-slider"),r=n.query(".js-author-infor-cont"),i=n.query(".js-infor-arrow-rt");r.animate({left:{to:"0px"}},200,function(){t.hide(),i.show()})}),this.$infoFlowCon.delegate(".js-infor-arrow-rt","click",function(e){e.preventDefault();var t=W(this),n=t.parentNode(".js-author-infor-slider"),r=n.query(".js-author-infor-cont"),i=n.query(".js-infor-arrow-lt"),s=hao360.screen.width?104:102;r.animate({left:{to:"-"+s+"px"}},200,function(){t.hide(),i.show()})})},InfoflowView.prototype.tabMvVideoRender=function(){try{var e=this.tabMvVideoStore,t=hao360.screen.wide?330:398,n=hao360.screen.wide?110:133,r=function(){for(var r=0;r<e.length;r++){var i="js-mv-video-"+e[r].unique,s=W("#"+i).query("iframe").length;if(s)continue;NEWS_FEED_VIDEO.render({data:e[r],placeholderId:i,blockPV:!0,w:t,h:n})}};if(typeof NEWS_FEED_VIDEO=="undefined"){if(this.mvVidoSdkLoading)return;this.mvVidoSdkLoading=!0,qboot.load("mvFeedVideoSdk",function(){r()})}else r()}catch(i){console&&console.warn&&console.warn(i)}},InfoflowView.prototype.initAuthorInforSlider=function(){var e=this.$infoFlowCon.query(".js-author-infor-slider");e.on("mouseenter",function(){var t=W(this),n=parseInt(t.query(".js-author-infor-cont").css("left"))||0;n<0?e.query(".js-infor-arrow-lt").show():e.query(".js-infor-arrow-rt").show()}).on("mouseleave",function(){e.query(".js-infor-arrow-lt").hide(),e.query(".js-infor-arrow-rt").hide()})},InfoflowView.prototype.initHotToutiaoSlider=function(){var e=this.$infoFlowCon.query(".js-infoflow-slider");for(var t=0,n=e.length;t<n;t++){var r=W(e[t]);if(r.hasClass("ready-slider"))continue;var i=r.switchable({animType:"fade",autoPlayTime:5e3,viewSelector:".slide-item",pageUpSelector:".slide-pageup",pageDownSelector:".slide-pagedown",autoPlay:!0,supportMouseenter:!1,mouseenterSwitchTime:300,autoPlayPausing:!1,selectedIndex:0,onafterswitch:function(e){qboot.events.fire("hotcard:switch:realshow:monitor",e),W(this.host).parentNode(".feed-hot-toutiao").attr("data-card")==="hot_card"&&qboot.events.fire("right:infoflow:hottoutiao:switchable-onbeforeswitch",e)},onbeforeswitch:function(e){}}).addClass("ready-slider");i.query(".slide-item").length>1&&i.addClass("hover")}},InfoflowView.prototype.initHotToutiaoAd=function(e){for(var t=0,n=e.length;t<n;t++)e[t].card_type==="hot_card"&&qboot.events.fire("right:infoflow:hottoutiao:piclink:ad")};var InfoflowNavView=function(e){this.init(e)};InfoflowNavView.prototype.constructor=InfoflowNavView,InfoflowNavView.prototype.defaultOptions={},InfoflowNavView.prototype.init=function(e){qboot.createEvents(this),this.options=qboot.mix(e||{},this.defaultOptions),this.navUl=this.options.navUl,this.navTpl=this.options.navTpl,this.videoCid=this.options.videoCid,this.videoHref=this.options.videoHref,this.hrefChannel=this.options.hrefChannel,this.listen(),this.bindEvent()},InfoflowNavView.prototype.listen=function(){var e=this;this.on("controller:navDataReady",function(t){e.render(t)})},InfoflowNavView.prototype.render=function(e){var t=this,n=W(this.navUl),r=template(this.navTpl,e);n.html(r)},InfoflowNavView.prototype.verify=function(e){return infoflowFtStorage.cid.currentCid!=e},InfoflowNavView.prototype.setCidStatus=function(e){infoflowFtStorage.cid.previousCid=infoflowFtStorage.cid.currentCid,infoflowFtStorage.cid.currentCid=e},InfoflowNavView.prototype.bindEvent=function(){var e=this,t=W(this.navUl),n=function(){if(e.isRollFixed()){var t=W("#doc-main-bd").getRect().top+10-W("#search").getRect().height;window.scrollTo(0,t)}};t.delegate("a","click",function(r){var i=W(r.target),s=i.getAttr("data-cid");r.target.tagName.toLowerCase()==="i"&&(i=i.parentNode());if(~e.hrefChannel.indexOf(s))return;(!i.hasClass("active")||i.attr("href")==="###")&&r.preventDefault(),e.verify(s)?(t.query("a").removeClass("active"),i.addClass("active"),e.setCidStatus(s),e.fire("view:clickNavUl",{data:infoflowFtStorage.cid}),VersionHub.is("cube","cube_roll")&&n()):s==="youlike"&&e.fire("view:refreshCurrent",{data:infoflowFtStorage.cid,refresh:!0})});if(VersionHub.is("cube","cube_roll")){var r=W(".info-flow-nav"),i=W(".info-flow-cont"),s=function(){e.isRollFixed()?(r.css({position:"fixed",top:W("#search").getRect().height+1+"px",width:W("#info-flow").getRect().width+"px",left:i.getRect().left-Dom.getDocRect().scrollX+"px"}),i.css({"margin-top":W(".info-flow-nav").getRect().height+"px"})):(r.css({position:"relative",top:null,width:null,left:null}),i.css({"margin-top":0}))};QW.W(window).on("scroll",function(){setTimeout(function(){s()})}),QW.W(window).on("resize",s)}},InfoflowNavView.prototype.isRollFixed=function(){var e=Dom.getDocRect(),t=e.scrollY,n=W("#search").getRect().height,r=W("#doc-main-bd").getRect().top+10-n;return t>=r};var LoadMoreView=function(e){this.init(e)};LoadMoreView.prototype.constructor=LoadMoreView,LoadMoreView.prototype.defaultOptions={},LoadMoreView.prototype.init=function(e){qboot.createEvents(this),this.options=qboot.mix(e||{},this.defaultOptions),this.loadMoreCon=this.options.loadMoreCon,this.$loadMoreCon=W(this.loadMoreCon),this.loadMoreTpl=this.options.loadMoreTpl,this.loadMoreData=this.options.loadMoreData,this.bindEvent(),this.listen()},LoadMoreView.prototype.render=function(e){var t=this,e=e||"clickLoadMore",n=this.loadMoreData[e],r=template(this.loadMoreTpl,n);this.$loadMoreCon.setHtml(r)},LoadMoreView.prototype.listen=function(){var e=this;this.on("controller:infoflowNoData",function(){e.render("noData")}),this.on("controller:infoflowFail",function(t){e.render("noData")}),this.on("controller:infoFlowTotal150",function(){e.render("clickLoadMore")}),this.on("controller:screen",function(t){e.render("loading")}),this.on("controller:clickNavUl",function(t){e.render("loading")}),this.on("controller:retry",function(t){e.render("loading")}),this.on("controller:loadMoreInfoFlow",function(){e.render("loading")})},LoadMoreView.prototype.bindEvent=function(){var e=this;this.$loadMoreCon.delegate(".info-flow-loaded","click",function(t){t.preventDefault(),e.render("loading"),e.fire("view:clickLoadMore",{data:infoflowFtStorage.cid,insertType:"beforeend"})})};var START_POSITION=2;try{var startPosData=parseInt(window.RIGHT_INFOFLOW_ADS_DATA.ads.start_pos)||1;START_POSITION=startPosData-1<0?0:startPosData-1}catch(err){}var ads_interval=parseInt(window.RIGHT_INFOFLOW_ADS_DATA.ads.interval)||3,MIN_FEEDITEM_HEIGHT=109,MAX_FEEDITEM_HEIGHT=164,SEARCH_HEIGHT=89,INTERVAL=ads_interval,IS_RIF_ON_ADS=function(){try{var e=parseInt(window.RIGHT_INFOFLOW_ADS_DATA.ads.ad_on),t=VersionHub.is("infoflow-right","no_ad"),n=UserTool.getCookieSeed("__guid").substr(1,1)||Math.floor(Math.random()*10),r=hao360.queryUrl(location.href,"right_infoflow_noad")=="1";return r||e===0&&t&&n=="1"?(LogHub.behavior("info-flow-right-noad","reqtimes"),!0):!1}catch(i){return LogHub.behavior("info-flow-right-noad","error"),!1}}(),infoflowFtStorage={infoFlow:{},mv:{logMap:{}},cid:{previousCid:"youlike",currentCid:"youlike"}},InfoflowController=function(e){this.init(e)};InfoflowController.prototype.constructor=InfoflowController,InfoflowController.prototype.defaultOptions={},InfoflowController.prototype.init=function(e){qboot.createEvents(this),this.options=qboot.mix(e||{},this.defaultOptions),this.infoFlowInnerId=this.options.infoFlowInnerId,this.$infoFlow=W(this.options.$infoFlow);var t=hao360.queryUrl(location.href,"btm_if_mv_showid"),n="XsgsZg";this.model=new Model({httpType:infoflowApp.protocol,storageMvData:{tabMv:{data:[],showId:t||n,reqMvtimes:1,impct:10},yuleMv:{data:[],showId:"rz9ysh",reqMvtimes:1,impct:8}}}),this.infoflowNavView=new InfoflowNavView({navUl:"#infoflow-right-nav-ul",navTpl:"infoflow-header-tpl",videoCid:"video",videoHref:"http://www.360kan.com/?src=360dh",hrefChannel:"video, militery"}),this.infoflowView=new InfoflowView({infoFlowCon:"#info-flow",unRead:"#j-alert-unread",infoFlowInnerId:"info-flow-inner",infoFlowWrapTpl:"switch-wrap-tpl",refreshTpl:"j-refresh-tpl",infoFlowTpl:"j-tpl-feed",tabMvTpl:"j-tpl-mv",wrapClass:"switch-wrap",alertRefreshClass:"alert-refresh",alertUnreadClass:"alert-unread",unreadClose:"j-unread-close",alertRefreshId:"alert-refresh-",totalTipsId:"j-alert-loading",unRead:"j-alert-unread",infoFlowError:"#info-flow-error",infoFlowRetry:"#info-flow-retry",loadMoreCon:"#loading-more-btn",infoFlowOperatId:"info-flow-operat",timeout:6e3,promptTime:18e4,LOADTHRESHOLD:327}),this.loadMoreView=new LoadMoreView({loadMoreData:{loading:{img:location.protocol+"//hao1.qhimg.com/t012844a3ec4f870d1c.gif",text:"\u52a0\u8f7d\u4e2d",loadCname:"info-flow-loading",disabled:!1},clickLoadMore:{img:"http://hao2.qhimg.com/t01c02966594377dec9.png",text:"\u52a0\u8f7d\u66f4\u591a",loadCname:"info-flow-loaded",disabled:!0},noData:{img:"",text:"\u6ca1\u6709\u66f4\u591a\u6570\u636e",loadCname:"info-flow-nodata",disabled:!1}},loadMoreCon:"#loading-more-btn",loadMoreTpl:"load-more-tpl"}),this.realshowMonitor=new RealshowMonitor({position:"infoflowRight",wrap:"#info-flow",secondLevelWrap:"#info-flow-inner",selector:".feed-item",packNum:3,realshowTime:2e3,logUrl:infoflowApp.protocol+"://news.qhstatic.com/srv/c2?",logBaseParams:{version:"1.0",device:2,sdkv:2,market:"pc_def",net:5,stype:"portal",t:(new Date).getTime(),channel:"youlike",sqid:"",act:"real_show",scene:1,sub_scene:1,refer_scene:0,refer_subscene:0,func:"pc_news_realshow",where:"list",hsid:qboot.cookie.get("__hsid")||""},filterHandle:function(e){var t=W(e);return infoflowApp.isVisualArea(t)&&!t.hasClass("infoflow-guess-default-mv")&&!t.hasClass("kuaiyan")&&!t.hasClass("feed-item-yule")&&!t.hasClass("feed-item-youyusi")&&!t.hasClass("js-mv-infoflow-item")}}),this.monitor=infoflowApp.infoflowFt.monitor,mvMonitor=new mvApp.Monitor("#info-flow",{position:"infoflowFt",bindAttrSelector:".js-mv-infoflow-item",selector:".js-mv-infoflow-item a",queryKey:"data-gid"});var r=mvApp.replaceEvPlugin,i=mvApp.clkMonitorPlugin;mvMonitor.registerPlugins([r,i]),this.bindEvent(),this.listen()},InfoflowController.prototype.listen=function(){var e=this;this.model.on("model:reqMvData",function(e){LogHub.behavior("info-flow-right-mv","reqtimes"),e.type==="yuleMv"&&LogHub.behavior("info-flow-right-mv","yuleMvReqtimes")}),this.model.on("model:reqMvDataSuccess",function(e){e.type==="yuleMv"&&LogHub.behavior("info-flow-right-mv","yuleMvSuccess")}),this.model.on("model:reqMvDataFail",function(){LogHub.behavior("info-flow-right-mv","error")}),this.model.on("model:infoflowReqtimes",function(e){LogHub.behavior("info-flow-right","reqtimes")}),this.model.on("model:infoflowFail",function(t){var n=t.data.currentCid,r=e.model.getChannelConfig(n);e.infoflowView.fire("controller:infoflowFail",t),LogHub.behavior(r.behavior.failKey,"error")}),this.model.on("model:infoflowNodata",function(t){e.infoflowView.fire("controller:infoflowNoData",t),e.loadMoreView.fire("controller:infoflowNoData"),LogHub.behavior("info-flow-right","nodata")}),this.model.on("model:infoflowFirstScreenTimeout",function(t){e.monitor.infoflowFirstScreenTimeout(t)}),this.model.on("model:tabMvDataReady",function(t){e.infoflowView.fire("controller:tabMvDataReady",t)}),this.model.on("model:infoFlowTotal150",function(){e.infoflowView.fire("controller:infoFlowTotal150")}),this.infoflowNavView.on("view:clickNavUl",function(t){var n=t.data.currentCid,r=function(){return W("#infoflow-right-"+n+"-wrap").html()};e.infoflowView.fire("controller:clickNavUl",t);if(!r()||n==="follow"){e.loadMoreView.fire("controller:clickNavUl",t);var i=e.model.getChannelConfig(n);e.model.loadData({optType:"tab",queryKey:i.loadConfig.queryKey,insertType:"beforeend",currentCid:n},function(t){t&&e.infoflowView.fire("controller:infoFlowDataReady",{data:t})})}}),this.infoflowNavView.on("view:refreshCurrent",function(t){e.infoflowView.fire("controller:clickNavUl",t),e.loadMoreView.fire("controller:clickNavUl",t)}),this.infoflowView.on("view:retry",function(){e.loadMoreView.fire("controller:retry")}),this.infoflowView.on("view:feedClick",function(t){e.monitor.infoflowItemClick(t)}),this.infoflowView.on("view:comment",function(t){e.monitor.infoflowComment(t)}),this.infoflowView.on("view:source",function(t){e.monitor.infoflowSource(t)}),this.infoflowView.on("view:moreFollowedAuth",function(t){e.monitor.moreFollowedAuth(t)}),this.infoflowView.on("view:loadMoreInfoFlow",function(t){e.loadMoreView.fire("controller:loadMoreInfoFlow",t);var n=e.model.getChannelConfig(t.data.cid.currentCid);e.model.loadData({optType:t.optType,queryKey:n.loadConfig.queryKey,currentCid:t.data.cid.currentCid,insertType:t.data.insertType},function(t){t&&e.infoflowView.fire("controller:infoFlowDataReady",{data:t})})}),this.loadMoreView.on("view:clickLoadMore",function(t){var n=e.model.getChannelConfig(t.data.currentCid);e.model.loadData({optType:"scroll",queryKey:n.loadConfig.queryKey,currentCid:t.data.currentCid,insertType:t.data.insertType,resetTotal:!0},function(t){t&&e.infoflowView.fire("controller:infoFlowDataReady",{data:t})})}),this.infoflowView.on("view:feedDislike",function(t){e.monitor.infoflowDislike(t)}),this.infoflowView.on("view:tipsClick",function(t){e.monitor.infoflowExtClick(t)}),this.infoflowView.on("view:tabMvDataRendered",function(){e.monitor.mvView()}),this.infoflowView.on("view:authorAddFollow",function(t){e.model.addFollow(t)})},InfoflowController.prototype.bindEvent=function(){var e=this,t=!1;QW.W(window).on("scroll",function(n){if(t)return;t=!0,setTimeout(function(){e.monitor.mvView(),t=!1},200)}),qboot.events.on("screen",function(t){infoflowFtStorage.cid.previousCid=infoflowFtStorage.cid.currentCid,e.startUp(),window.scrollTo(0,0),infoflowFtStorage.cid.currentCid="youlike",e.loadMoreView.fire("controller:screen",t),W(".infoflow-right-gov-news").show()})},InfoflowController.prototype.startUp=function(){var e=this,t=this.model;t.loadData({queryKey:"getNavData"},function(t){e.infoflowNavView.fire("controller:navDataReady",{data:t}),e.infoflowView.fire("controller:navDataReady",{data:t}),e.monitor.haoClick(t)}),e.infoFlowStartUp()},InfoflowController.prototype.infoFlowStartUp=function(){var e=this,t=this.model;t.startLoadMvData(),t.loadData({optType:"refresh",queryKey:"loadInfoFlowData"},function(t){t&&e.infoflowView.fire("controller:infoFlowDataReady",{data:t,firstScreen:!0})}),W("#info-flow-inner").query(".switch-wrap").hide(),W("#infoflow-right-youlike-wrap").show(),e.realshowMonitor.listen()};(function(){function t(e,t){this._dom=e,this._render(t),this._init()}var e=W("#info-flow");e.delegate("a","click",function(e){LogHub.behavior("infoflow-right-look","allClick")});if(Browser.ie<7){e.hide();return}t.prototype._render=function(e){this.onbeforeload=e.onbeforeload,this.onafterload=e.onafterload},t.prototype._init=function(){this._loadDoms(this._dom)},t.prototype._loadDoms=function(){this.current=W(this._dom);if(this.onbeforeload&&this.onbeforeload()===!1)return!1;if(this.onafterload&&this.onafterload()===!1)return!1};var n={onbeforeload:function(){LogHub.behavior("infoflow-right-look","show")},onafterload:function(){(new InfoflowController({infoFlowInnerId:"info-flow-inner",$infoFlow:"#info-flow"})).startUp(),qboot.events.fire("system:infoFlowLoaded")}};new t(e,n)})();(function(){function t(t){this.options=t||{},this.gid=this.options.gid,this.extraParams={title:this.options.data.title,queryword:this.options.data.j},this.showid=e||"N4ltXJ",this.adApiConf={http:"http://show.g.mediav.com/s?showid="+this.showid+"&type=1&of=4&newf=1&impct=1&reqtimes=1",https:"https://show-g.mediav.com/s?showid="+this.showid+"&type=1&of=4&newf=1&scheme=https&impct=1&reqtimes=1"},this.storeAdsData={},this.hong={__EVENT_TIME_START__:"",__EVENT_TIME_END__:"",__OFFSET_X__:"",__OFFSET_Y__:"",__ADSPACE_W__:"",__ADSPACE_H__:""},this.init()}if(window.adOnOff&&window.adOnOff.infoflow_right_2020==="off")return;if(IS_RIF_ON_ADS)return;var e="N4ltXJ";t.prototype.init=function(){var e=this;e.listenEvent(),e.bindEvent(),e.getAdData(e.render.bind(e))},t.prototype.listenEvent=function(){var e=this;e._eventBuilded||(e.scrollHandler=function(){var t=W("#info-flow-inner .feed-atlas[data-gid="+e.gid+"]"),n=t.query(".mv-ads__textlink");if(n.length){var r=W(n[0]);e.setPvMonitor(r),r.attr("data-imptk")===""&&W(window).un("scroll",e.scrollHandler)}},e.adViewMouseDownHandle=function(){var t=W(this),n=event||window.event;e.adHongUpdate(n,t.parentNode(),"start")},e.adViewMouseUpHandle=function(){var t=W(this),n=event||window.event;e.adHongUpdate(n,t.parentNode(),"end")},e._eventBuilded=!0)},t.prototype.bindEvent=function(){var e=this,t=".feed-atlas[data-gid="+e.gid+"] .mv-ads__textlink a";W(window).on("scroll",e.scrollHandler),W("#info-flow-inner").delegate(t,"mousedown",e.adViewMouseDownHandle),W("#info-flow-inner").delegate(t,"mouseup",e.adViewMouseUpHandle)},t.prototype.adHongUpdate=function(e,t,n){var r=this,i=t,s=(new Date).getTime(),o=function(e){for(var t in r.hong)e=e.replace(new RegExp(t,"g"),r.hong[t]);return e},u=function(e,t){var n=W(t).getXY()||[],r=n[0],i=n[1];return[parseInt(e.pageX-r),parseInt(e.pageY-i)]},a=u(e,i),f=a[0],l=a[1],c=i.getRect(),h=c.width,p=c.height;if(n==="start")r.hong.__EVENT_TIME_START__=s,r.hong.__OFFSET_X__=f,r.hong.__OFFSET_Y__=l,r.hong.__ADSPACE_W__=h,r.hong.__ADSPACE_H__=p;else if(n==="end"){r.hong.__EVENT_TIME_END__=s;var d=i.attr("data-clktk"),v=o(d),m=r.monitorLog();m.clk(v);var g=r.storeAdsData.curl;i.query("a").attr("href",o(g))}},t.prototype.render=function(e){var t=this,n=W("#info-flow-inner .feed-atlas[data-gid="+t.gid+"]");if(!n.length)return;var r=['<div class="mv-ads__textlink" data-imptk="'+e.dataImptk+'" data-clktk="'+e.dataClktk+'">','<a href="'+e.curl+'" class="'+e.hasIcon+'">'+e.title+"</a>","</div>"].join("");n.addClass("has-customizead"),n.query(".media-body").insert("beforeend",r);var i=n.query(".mv-ads__textlink");t.setPvMonitor(i)},t.prototype.formatAdsData=function(e){var t=["360\u641c\u7d22"];return{title:e.title,curl:e.curl,dataImptk:e.imptk.join("|"),dataClktk:e.clktk.join("|"),hasIcon:t.indexOf(e.src)<0?"ad-icon":""}},t.prototype.getAdData=function(e){var t=this,n=hao360.isHttp()?"http":"https",r=qboot.cookie.get("__guid")||"",i=t.adApiConf[n]+"&uid="+r+"&"+qboot.encodeURIJson(t.extraParams);qboot.jsonp(i,function(n){if(n&&n.ads&&n.ads[0]){var r=t.formatAdsData(n.ads[0]);t.storeAdsData=r,e(r)}},{jsonp:"jsonp"})},t.prototype.judgeVisible=function(e){var t=Dom.getDocRect(),n={top:t.scrollY,left:t.scrollX,bottom:t.scrollY+t.height,right:t.scrollX+t.width},r=e.getRect();return Dom.rectContains(n,r)},t.prototype.setPvMonitor=function(e){var t=this,n=t.monitorLog(),r=e.attr("data-imptk");t.judgeVisible(e)&&r!==""&&(n.pv(e.attr("data-imptk")),e.attr("data-imptk",""))},t.prototype.monitorLog=function(){return{pv:function(e){var t=e.split("|");while(t&&t.length)logPureSender(t.shift())},clk:function(e){var t=e.split("|");while(t&&t.length)logPureSender(t.shift())}}},qboot.events.on("right:infoflow:customize:textlink:ad",function(e){new t(e)})})();(function(){function e(e){this.options=e||{},this.videoDom=null,this.adObj={},this.listenEvent()}if(window.adOnOff&&window.adOnOff.infoflow_right_2020==="off")return;if(IS_RIF_ON_ADS)return;e.prototype.listenEvent=function(){var e=this;qboot.events.on("right:infoflow:hottoutiao:piclink:ad",function(){e.adLoadInit()}),qboot.events.on("right:infoflow:hottoutiao:switchable-onbeforeswitch",function(t){t.toIndex===1?(e.videoDom&&e.videoDom[0]&&e.videoDom[0].play(),e.sendVideoPv()):e.videoDom&&e.videoDom[0]&&e.videoDom[0].pause()})},e.prototype.adLoadInit=function(){var e=this,t="hotToutiaoPicture2020V2";new ChannelTextlinkAd({containerSelector:e.options.containerSelector,adKey:t,adSelector:e.options.adSelector,render:function(t,n){var r=hao360.screen.wide?"279_120_75":"194_90_75",i=hao360.clipImage(n.img,{whq:r,webp:!0});e.adObj=n,n.video?(W(t).attr("href",n.curl).attr("title",n.title||n.desc).query(".txt").addClass("hot-toutiao__piclinkad").html(n.title||n.desc),W(t).query("img.pic").replaceNode('<video class="hot-toutiao-card__videoad" style="width: 100%; height: 100%;" preload muted src="'+n.video+'" loop><img src="'+i+'"></video>'),e.videoDom=W(t).query("video.hot-toutiao-card__videoad")):W(t).attr("href",n.curl).attr("title",n.title||n.desc).addClass("hot-toutiao__piclinkad").query("img.pic").attr("src",i).nextSibling(".txt").html(n.title||n.desc),W(t).removeChild(W(t).query(".tag")),n.src!=="360\u641c\u7d22"&&W(t).appendChild(Dom.create('<span class="ad" style="top: 0px;"></span>'))}})},e.prototype.sendVideoPv=function(){var e=this,t=W(e.options.containerSelector).query(e.options.adSelector),n=e.adObj.vstarttk||[];if(!e.adObj.video)return;var r={__ADSIZE_TYPE__:2,__VIDEO_ACTION_ID__:2,__VIDEO_DURATION__:e.adObj.duration,__VIDEO_TIME__:0,__ADSPACE_W__:t.getRect().width,__ADSPACE_H__:t.getRect().height},i=function(e){for(var t in r)e=e.replace(new RegExp(t,"g"),r[t]);return e};n.forEach(function(e){var t=i(e);logPureSender&&logPureSender(t)})},new e({containerSelector:'#info-flow .js-feed-hot-toutiao[data-card="hot_card"]',adSelector:"a.slide-item-pic[data-ext=2_2]"})})();var InfoflowCommon=function(){var e={},t=function(){var e=new AppData("api.hao.360.cn"),t=e.get("infoflow_citycode");if(t)return;var n=hao360.todayObj.getTime()+1296e6,r=hao360.isHttp()?"http":"https",i=hao360.mid||qboot.cookie.get("__guid")||qboot.cookie.get("__huid"),s={sign:"360dh",u:i,f:"jsonp"},o=r+"://sdk.look.360.cn/sdkv2/pclocal?"+qboot.encodeURIJson(s);qboot.jsonp(o,function(t){t&&t.errno==0&&e.set("infoflow_citycode",1,n)},{jsonp:"callback",threshold:1})};return e.init=function(){t()},e}();InfoflowCommon.init();(function(e){var t=function(e){return Object.prototype.toString.call(e)==="[object Function]"},n=function(e){return Object.prototype.toString.call(e)==="[object Array]"},r=e("#tab-list"),i=e("#reco-list"),s=i.query(".loading"),o='<li class="{className} {type}" data-key="{key}"><a href="" onclick="return false;">{tab}<span class="mark">{type}</span></a></li>',u='<div class="line"><span class="split">\u2022</span><h3 class="title {type}"><span class="cont">{title}<span class="mark">{type}</span></span></h3></div>',a='<div class="g-tips g-tips-right tips-reco {display}" style="right:-{right}px"><div class="cont">{tip}</div><!--[if lte IE 7]><span class="arrow-border"></span><span class="arrow-background"></span><![endif]--></div>',f='<li data-sid="{sid}" class="{className}"><a href="{url}" class="{color}" data-nordr="true"><span class="name">{name}</span>'+a+"</a></li>",l="add-success",c={cache:{},DEFAULTKEY:"common",_filter:function(e,t){var r=[];for(var i=0,s=t.length;i<s;i++){var o=t[i];if(n(o)){var u=o[2],a=o[3];o=new SiteEnt(o[0],o[1])}u&&(o.color=u),e==o.sid&&(o.className=l),a&&(o.tip=a,o.display="show",o.right=a.byteLen()*6+16),o&&(r[i]=o)}return r},reFilterRecoSites:function(e,t,n){var r=function(e){e.removeClass(l)};n&&n=="add"&&(r=function(e){e.addClass(l)});for(var i=0,s=t.length;i<s;i++){var o=t.item(i);o.attr("data-sid")==e&&r(o)}},renderRecommendArea:function(e,n){var r=this,o=!1;typeof e=="object"?(n=e,e=this.DEFAULTKEY):n=n||{},setTimeout(function(){!o&&!n.preload&&(i.query(".reco").hide(),s.show())},500),mysiteService.getRecommendSites(e).then(function(i){if(n.preload)return;o=!0,s.hide();var u=i.current,a=u&&u.key,f=u&&u.url;r._renderRecommendTabs(i.category,e),r._renderRecommendSites(f,a),t(n.callback)&&n.callback()})},_renderRecommendTabs:function(e,t){if(this.cache.tab)return;var n=[];for(var i=0,s=e.length;i<s;i++){var u={},a=e[i];if(!a[1])continue;u.key=a[0],u.className="",u.key==t&&(u.className="cur"),u.type=a[2],u.tab=a[1];var f=R.tmpl(o,u);u.key==this.DEFAULTKEY?n.unshift(f):n.push(f)}r.html(n.join("")),this.cache.tab=!0},switchRecommendTab:function(e,t){var n=r.query("li");e&&(n.removeClass("cur"),r.query("li[data-key="+e+"]").addClass("cur")),t=t||function(){},this.renderRecommendArea(e,{callback:t})},_renderRecommendSites:function(e,t){var n=this;mysiteService.getCustomSites().then(function(r){var o=['<div class="reco" data-type="'+t+'">'];for(var a=0,l=e&&e.length;a<l;a++){var c=e[a][0],h=e[a][1];if(!c[0])continue;var p={};p.type=c[1],p.title=c[0];var d=R.tmpl(u,p);res=[d+'<ul class="gclearfix">'];if(r.length==0)h=n._filter(null,h);else for(var v=0,m=r.length;v<m;v++){var g=SiteEnt.getSid(r[v].url);h=n._filter(g,h)}for(var v=0,m=h.length;v<m;v++){if(!h[v].name)continue;res.push(R.tmpl(f,h[v]))}res.push("</ul>"),o.push(res.join(""))}o.push("</div>");var y=o.join("");i.query(".reco").hide(),s.hide(),i.html(i.html()+y),n.cache[t]='div[data-type="'+t+'"]'})},initRecommendArea:function(e){e=e||this.DEFAULTKEY,this.renderRecommendArea(e)}};window.mysiteRecommend=c})(W);(function(){function g(e,t){var n=null;t=="hover"?n=l:t=="click"&&(n=f,setTimeout(function(){n.hide()},p));var r=m(n[0]),i=m(W(".js-tips")[0]),s=m(e[0]),o=s.width,u=s.top-i.top-25,a=s.left-i.left+o/2-r.width/2;n.css({left:a+"px",top:u+"px"}).show()}function y(e,t){var n=W(".js-tips").getRect(),r=e.getRect(),i=r.top-n.top-25,o=r.left-n.left;c.query(".cont").html(t),c.css({left:o+"px",top:i+"px"}).show(),e.addClass(s),setTimeout(function(){c.hide(),e.removeClass(s)},p);if(e.query("input[type=text]")[0]){var u=e.query("input[type=text]")[0];setTimeout(function(){u.focus()},20)}}function b(e){h.query(".cont").html(e);var t=m(h[0]).width,n=m(W(".js-tips")[0]).width,r=10,i=n/2-t/2;h.css({left:i+"px",top:r+"px"}).show(),setTimeout(function(){h.hide()},p)}function w(e){var t=[].concat(e);for(var n=0,r=t.length;n<r;n++)t[n].hide()}function E(e){var n=r.query(".site-name"),i=r.query(".site-url");switch(e){case t.NameIsNull:n[0].value="",y(n,"\u8bf7\u8f93\u5165\u7f51\u7ad9\u540d\u79f0");break;case t.UrlIsNull:i[0].value="",y(i,"\u8bf7\u8f93\u5165\u7f51\u5740");break;case t.NameLengthErr:y(n,"\u60a8\u8f93\u5165\u7684\u540d\u79f0\u8fc7\u957f");break;case t.UrlLengthErr:y(i,"\u60a8\u8f93\u5165\u7684\u7f51\u5740\u8fc7\u957f");break;case t.SiteIsExist:b("\u8be5\u7f51\u5740\u5df2\u5b58\u5728");break;case t.SidIsNull:alert("sid is null");break;case t.SiteIsNotExist:alert("site is not exist");break;default:alert("\u4fc4\u4e5f\u5e03\u5409\u5c9b\u662f\u80bf\u4e48\u56de\u4e8b\uff01")}}var e=new MysiteCache,t=e.ERRORCODE,n=qboot.mix,r=W("#mysite"),i="add-success",s="site-input-error",o=W("#edit-mysite"),u=W(".mysite-list-null"),a=W("#reco-list"),f=r.query(".tips-success"),l=r.query(".tips-cancel"),c=r.query(".tips-error"),h=r.query(".tips-warning"),p=3e3,d='<li style="display:{display}"><div class="item"><a href="{url}" class="site"><img src="{favicon}" class="favicon"><span>{name}</span></a><a href="###" class="btn delete-site" data-sid="{sid}" title="\u5220\u9664">\u5220\u9664</a></div></li>',v={_renderCustomSites:function(e){var t=this,r=e&&e.sid||null,i=e&&e.type||null;mysiteService.getCustomSites().then(function(e){var t=e.length,s=null,a=[];for(var f=0;f<t;f++){var l=n({},e[f]);l.name=l.name.encode4Html();if(r==l.sid&&i=="add"){s=f;var c=n({display:"none"},l);a.push(R.tmpl(d,c))}else a.push(R.tmpl(d,l))}var h=a.join("");o.html(h),t?(u.hide(),o.show()):(u.show(),o.hide());if(s!=null){var l=o.query("li").item(s);i=="add"&&l.fadeIn()}}).otherwise(function(){u.show(),o.hide()})},relateMysiteToRecommandsite:function(e,t,n){this._renderCustomSites({type:t,sid:e}),siteList=a.query("li"),mysiteRecommend.reFilterRecoSites(e,siteList,t),t=="add"&&n?W(document).tweet("mysite:add-site",{name:n.name,url:n.url,domain:n.domain}):t=="delete"&&W(document).tweet("mysite:delete-site",n.id)},addSite:function(n,r){var i=this,s=function(e){var t=r&&r.type||"click",s=e.res,o=e.res.sid;n.domain=s.domain,i.relateMysiteToRecommandsite(o,"add",n);var u=[];if(t=="form"){var a=r&&r.form||W("form")[0];a.sitename.value="",W(a.siteurl).val(""),a.sitename.focus(),u=[f,h,c]}else if(t=="click"){var l=r&&r.site;g(l,t),u=[h,c]}w(u)},o=function(e){E(e.errCode)};e.isSiteFull()?b("\u6682\u65f6\u53ea\u80fd\u6dfb\u52a0\u8fd9\u4e48\u591a\u7f51\u5740\u4e86"):e.add(n,function(e){e.errCode==t.NoError?s(e):o(e)})},deleteSite:function(n){var r=this,i=MysiteCacheData.map[n]&&MysiteCacheData.map[n].id,s=MysiteCacheData.map[n]&&MysiteCacheData.map[n].name,o=function(){W(document).tweet("mysiteTweet:delete-site",{name:s}),r.relateMysiteToRecommandsite(n,"delete",{id:i}),w([f,h,c,l])};e.remove(n,function(e){e.errCode==t.NoError&&o()})},init:function(e){this._renderCustomSites(),mysiteRecommend.initRecommendArea(e)}};window.CustomSites=v;var m=function(e){var t={position:"absolute",visibility:"hidden",display:"block"},n=function(e,t,n,r){var i,s,o={};for(s in t)o[s]=e.style[s],e.style[s]=t[s];i=n.apply(e,r||[]);for(s in t)e.style[s]=o[s];return i};return W(e).isVisible()?W(e).getRect():n(e,t,function(){return W(e).getRect()})};r.delegate(".close-mysite","click",function(e){e.preventDefault(),panelMysite.close()}).delegate(".reco-list li a","click",function(e){e.preventDefault(),LogHub.behavior("mysite_2020","add-by-tuijian");var t=W(this),n=t.parentNode("li");if(n.hasClass(i)){var r=n.attr("data-sid");v.deleteSite(r)}else{var s={name:t.query(".name").html(),url:t.attr("href")};v.addSite(s,{type:"click",site:t})}}).delegate(".reco-list li a","mouseenter",function(e){var t=W(this);t.parentNode("li").hasClass(i)&&(w([f]),g(t,"hover"))}).delegate(".reco-list li","mouseleave",function(e){var t=W(this);t.hasClass(i)&&w(l)}).delegate(".tips-success","mouseenter",function(e){e.preventDefault(),W(this).hide()}).delegate("#tab-list li","mouseenter",function(e){var t=W(this),n=t.attr("data-key");t.addClass("hover"),mysiteRecommend.renderRecommendArea(n,{preload:!0})}).delegate("#tab-list li","mouseleave",function(e){W(this).removeClass("hover")}).delegate("#tab-list li","click",function(e){e.preventDefault();if(W(this).hasClass("cur"))return;var t=W(this).attr("data-key");mysiteRecommend.switchRecommendTab(t,function(){w([f,h,c,l])})}).delegate(".mysite-add .site-input","keydown",function(e){W(this).hasClass(s)&&(w(c),W(this).removeClass(s))}),r.query("form").on("submit",function(e){e.preventDefault(),LogHub.behavior("mysite_2020","add-by-user");var t={name:W(this.sitename).val().trim(),url:W(this.siteurl).val().trim()};v.addSite(t,{type:"form",form:this})}),r.query("#btn-site-add").hover(function(e){W(this).addClass("hover")},function(e){W(this).removeClass("hover").removeClass("mousedown")}).on("mousedown",function(e){W(this).addClass("mousedown")}).on("mouseup",function(e){W(this).removeClass("hover").removeClass("mousedown")}),o.delegate("li .delete-site","click",function(e){e.preventDefault();var t=W(this).attr("data-sid");v.deleteSite(t)})})();(function(){function u(){if(hao360.g("reco-site")){var e="recoSite_tips",t=escape(hao360.g("tips-reco-comment").innerHTML.trim());qboot.cookie.set(e,[3,t].join("|"),{expires:2592e6}),W("#tips-reco-site").hide(),W(document).tweet("page-height-resize")}}function a(){var e=W("#mysite-list li").length-1;if(e){LogHub&&LogHub.behavior("mysite_2020","hasData");var t=[],n=MysiteCacheData.map,r=/^http:\/\/tu.360.cn\/\w+$/,i=new MysiteCache,s=!1;for(var o in n){var u=n[o],a=u.type;if(!a||a=="0")s=!0,r.test(u.url)?a=2:a=1,i.modify(u.sid,{type:a});var f=encodeURIComponent(u.name)+"|"+encodeURIComponent(u.url)+"|"+a;t.push(f)}s&&R("mysite-list").reRender();var e=Math.ceil(t.length/10);for(var l=0;l<e;l++){var c=t.splice(0,10);LogHub.mysiteShow(c)}}}function f(){var e=new MysiteCache,t=MysiteCacheData.map;for(var n in t){var r=t[n];r.type==3&&e.remove(r.sid)}}var e=W("#sites-lib-classify"),t=W("#mysite"),n=!0,r=W("#mysite-list").attr("data-key"),i="site-input-error",s=function(){qboot.load(function(){W("#outer-extra").insertAdjacentHTML("beforeend",'<ul class="mysite-suggest" id="mysite-url-suggest" style="visibility:hidden;"></ul>'),W("#outer-extra").insertAdjacentHTML("beforeend",'<ul class="mysite-suggest" id="mysite-name-suggest" style="visibility:hidden;"></ul>')},"mysitequery"),s=function(){}},o={isShowed:!1,mask:null,resizeMaskPosition:function(){var e=W("body").getRect(),t=e.height+"px",n=e.width+"px";this.mask.css({height:t,width:n})},maskShow:function(){if(!this.isShowed){var e=W("#doc-view-front");if(Browser.ie6){var t=document.createElement("iframe");t.className="mask-iframe",e.appendChild(t)}var n=document.createElement("div");n.className="mask-panel",e.appendChild(n),this.isShowed=!0,this.mask=W(".mask-panel,.mask-iframe")}else this.mask.show();Browser.ie6&&(this.resizeMaskPosition(),W(window).on("scroll",this.resizeMaskPosition).on("resize",this.resizeMaskPosition))},maskHide:function(){this.mask.hide(),W(window).un("scroll",this.resizeMaskPosition).un("resize",this.resizeMaskPosition)},EscPress:function(e){e.keyCode==27&&o.close()},open:function(){t.removeClass("g-hide"),t.query("form")[0].sitename.focus(),this.maskShow(),W(document).on("keydown",this.EscPress),W(document).tweet("mysite-panel-turn-on")},close:function(){W(".tips-warning,.tips-error").hide(),W(".site-input").removeClass(i),t.addClass("g-hide"),this.maskHide(),R("mysite-list").reRender(),setTimeout(function(){W(document).tweet("page-height-resize")},100),W(document).un("keydown",this.EscPress),W(document).tweet("mysite-panel-turn-off")}};window.panelMysite=o,e.delegate(".btn-add-site .btn,.btn-add-site .hxd,.mysite-manage,.mysite-icon","click",function(e){e.preventDefault(),u(),LogHub.behavior("mysite_2020","btn-add"),W(document).tweet("mysite-editpanel-open")}).delegate("#tips-reco-site .btn-reco-site","click",function(e){e.preventDefault(),u();var t=W(this).attr("data-type");W(document).tweet("mysite-editpanel-open",{recoType:t})}).delegate(".btn-add-site","mouseenter",function(e){n&&mysiteRecommend.switchRecommendTab(r,{preload:!0})}).delegate("#tips-reco-site .close","click",function(e){e.preventDefault(),u()}).delegate("#tips-reco-site","mouseenter",function(e){var t=W("#reco-site").attr("data-type");mysiteRecommend.switchRecommendTab(t,{preload:!0})}).delegate(".mysite-list .site","click",function(e){var t=W(this),n=t[0].innerText,r=t.attr("href"),i=t.attr("data-type"),s=encodeURIComponent(n)+"|"+encodeURIComponent(r)+"|"+i;LogHub.mysiteClk(s)}),W(document).receive("mysite-editpanel-open",function(e){n&&CustomSites.init(e.data&&e.data.recoType),n=!1,o.open(),s()}),a(),f()})();(function(e){var t=window.configHuodong&&configHuodong.mysite_tweet;if(!t)return;var n=new MysiteCache,r=qboot.cookie,i=t.name,s=W(".reco-info"),o=+(new Date(t.endTime)),u=+hao360.todayObj,a=o-u,f=[],l={filter:function(e){var t=MysiteCacheData.map,n=[];for(var r=0,i=e.length;r<i;r++){var s=e[r],o=SiteEnt.getSid(s.url),u=!0;for(var a in t)if(s.text==t[a].name||o==a){u=!1;break}u&&n.push(s)}return n},tweet:function(){var e=this;if(n.isSiteFull())return;mysiteService.getCommonUseSites().then(function(t){var u=MysiteCacheData.order.length,l=e.filter(t.coolsite),c=0;r.set(i,1,{expires:a});var h=new AppData("api.hao.360.cn",HAO_CONFIG.mysiteTweet.r);h.set(HAO_CONFIG.mysiteTweet.api,1,o),LogHub.behavior("mysiteTweet","add");if(l.length<1)return;LogHub.behavior("mysiteTweet","add-success");var p=[];for(var d=0,v=l.length;d<v;d++){var m=l[d],g={name:m.text,url:m.url,domain:m.domain,type:"2"};m.order==1?(n.unshift(g),c++):n.add(g),f.push(g);switch(m.url){case"http://tu.360.cn/5A":p.push("qq"),LogHub.behavior("tweetMark","qq");break;case"http://tu.360.cn/q3yg":p.push("renren"),LogHub.behavior("tweetMark","renren")}}p.length>0&&qboot.cookie.set("tweetMark",p.join("-"),{expires:2592e6});var y=l.length-c;for(var d=0,v=f.length;d<v;d++)setTimeout(function(e){return function(){W(document).tweet("mysiteTweet:add-site",e)}}(f[d]),500*d);y>0&&(s.show(),s.query(".num").html(y)),R("mysite-list").reRender();var b=W(".mysite-list .item");for(var d=0;d<y;d++){var w=u+d+c;b.item(w).addClass("reco-auto")}})},tweetStatic:function(e,t){var r=this;if(n.isSiteFull())return;n.getAll(function(i){var s=i.res;for(var o=0,u=s.length;o<u;o++)s[o].type=="3"&&n.remove(s[o].sid);var a=r.filter(e),f=new AppData("api.hao.360.cn",HAO_CONFIG.mysiteTweet.r),l=f.get("mysiteBlack")||[];for(var o=0,u=a.length;o<u;o++){var c=a[o],h=!1;for(var p=0,d=l.length;p<d;p++)if(l[p]==c.text){h=!0;break}if(h)continue;var v={name:c.text,url:c.url,domain:c.domain,favicon:c.favicon,type:"3"};c.order==1?n.unshift(v):n.add(v)}t&&t()})}};window.mysiteTweet=l,W(document).receive("mysite-editpanel-open",function(){s.hide()}),W("#mysite-section").delegate(".know","click",function(e){e.preventDefault(),s.hide(),W(".mysite-list .item").removeClass("reco-auto")}).delegate(".delete-site","click",function(e){e.preventDefault();var t=W(this).previousSibling("a.site").attr("href"),n=SiteEnt.getSid(t),r=MysiteCacheData.map[n]&&MysiteCacheData.map[n].id;CustomSites.deleteSite(n),W(this).parentNode("li").removeNode(),LogHub.behavior("mysiteTweet","delete"),W(document).tweet("mysiteTweet:delete-site",{id:r,sid:n})})})();(function(){
	if(location.protocol == 'https:'){
		return;
	}
	var mysiteTweetConf = window.configHuodong && configHuodong.mysite_tweet;

	if(!mysiteTweetConf){
		return;
	}
	var cookie = qboot.cookie,
		queryGuid = hao360.queryUrl(location.href,"guid"),
		isOn = queryGuid  ? 1 : 0,
		cookieTweet = mysiteTweetConf.name,	
		switchMysiteTweet = parseInt(mysiteTweetConf.isOn),	// 常用网址推荐阀门，1为打开推荐，0为关闭推荐
		startTime = +new Date(mysiteTweetConf.startTime),	// 推荐开始时间
		endTime = +new Date(mysiteTweetConf.endTime),	// 推荐结束时间
		now = +hao360.todayObj;

	var random = 1;
	if(!qboot.cookie.get('tweetSiteFlag')){
		qboot.cookie.set('tweetSiteFlag2',1,{expires:1000*3600*24*60});
		random = Math.random() < mysiteTweetConf.random;
	}else{
		LogHub.behavior('tweetSite','flag');
	}
	// 小流量测试，减缓式放量
	function putOnline(){
		var condition = switchMysiteTweet && now > startTime && now < endTime;
		var localFlag = !cookie.get(cookieTweet) && !new AppData('api.hao.360.cn', HAO_CONFIG.mysiteTweet.r).get(HAO_CONFIG.mysiteTweet.api);
		if((random && condition && localFlag) || isOn){
			mysiteTweet.tweet();
		}
	}

	putOnline();
})();(function(){function s(){return window.PROJECT_SIGN==="extra_wide"}function o(){W(window).on("resize",a(u,r)),u()}function u(){var r=document.body.clientWidth||document.documentElement.clientWidth,i=r>=e?1:0;qboot.cookie.set(t,i,n)}function a(e,t,n){function a(){var f=(new Date).getTime()-o;f<t&&f>=0?r=setTimeout(a,t-f):(r=null,n||(u=e.apply(s,i),s=i=null))}var r,i,s,o,u;null==t&&(t=100);var f=function(){s=this,i=arguments,o=(new Date).getTime();var f=n&&!r;return r||(r=setTimeout(a,t)),f&&(u=e.apply(s,i),s=i=null),u};return f.clear=function(){r&&(clearTimeout(r),r=null)},f.flush=function(){r&&(u=e.apply(s,i),s=i=null,clearTimeout(r),r=null)},f}var e=1800,t="wide2021",n={expires:31536e6},r=200,i=VersionHub.is("wide-extra","wide-extra-hit");(i||s())&&o()})();